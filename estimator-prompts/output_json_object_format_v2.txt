################################################################################
#  VK CHARTS — OUTPUT JSON OBJECT FORMAT v2.0                                 #
#  Updated: 2026-02-15                                                        #
#  Model: Gemini 3 Flash                                                      #
#  This file defines the EXACT JSON structure the AI must output.              #
#  The main estimation prompt is a SEPARATE file.                             #
################################################################################

STRICT RULES:
  1. Output ONLY valid JSON. No markdown, no backticks, no commentary.
  2. ALL fields shown below are REQUIRED unless marked "optional".
  3. Use ONLY the enum values listed — any other value is INVALID.

ENUMS (use ONLY these values):

  intent:         "blocked_info" | "attract" | "inquire" | "inform"
  decision:       "accepted" | "blocked" | "excluded" | "neutral"
  confidence:     "high" | "medium" | "low" | "n/a"
  recommendation: "BLOCKED" | "STRONG" | "GOOD" | "CONDITIONAL" | "WEAK" | "SKIP"

  ⛔ "firm_offer" is NOT a valid intent
  ⛔ "do_not_offer" is NOT a valid intent
  ⛔ "recommended" is NOT a valid recommendation (use "STRONG" or "GOOD")

INTENT SELECTION:
  IF any criterion = BLOCK           → "blocked_info"
  IF total_score >= 80% AND no block → "attract"
  IF total_score 60-79%              → "inquire"
  IF total_score < 60%               → "inform"
  THEN apply proximity override (see main prompt Section 22)

═══════════════════════════════════════════════════════════════════════════════

OUTPUT JSON STRUCTURE:

{
  "vessel_name": "MV EXAMPLE",
  "total_score": 72,
  "total_score_raw": 75.6,
  "dynamic_max_score": 105,
  "confidence": 65,
  "confidence_note": "AIS data is 8 days old — position may be outdated.",
  "recommendation": "GOOD",
  "short_summary": "Good match for cargo, vessel in the right region...",

  "detailed_scoring": {
    "proximity":               { "code": "P1",  "score": 16,   "max_score": 20, "reasoning": "...", "offer_hint": "...", "decision": "accepted", "confidence": "high", "critical": false, "citations": ["destination: Sulina"] },
    "regional_patterns":       { "code": "P1A", "score": 15,   "max_score": 15, "reasoning": "...", "offer_hint": null,  "decision": "accepted", "confidence": "high", "critical": false, "citations": [] },
    "owner_preferences":       { "code": "P2",  "score": 12,   "max_score": 15, "reasoning": "...", "offer_hint": "...", "decision": "accepted", "confidence": "high", "critical": false, "citations": ["companies[0].comments: spec: turkey"] },
    "port_accessibility":      { "code": "P2A", "score": 9,    "max_score": 20, "reasoning": "...", "offer_hint": "...", "decision": "accepted", "confidence": "medium","critical": true,  "citations": ["classification-society: DROMON"] },
    "cargo_preferences":       { "code": "P3",  "score": 0,    "max_score": 0,  "reasoning": "No data — excluded.", "offer_hint": null, "decision": "excluded", "confidence": "n/a", "critical": false, "citations": [] },
    "last_ports":              { "code": "P4",  "score": 6.2,  "max_score": 10, "reasoning": "...", "offer_hint": "...", "decision": "accepted", "confidence": "high", "critical": false, "citations": ["top_ports.vessel: Istanbul (14.5%)"] },
    "intake_capacity":         { "code": "P5",  "score": 15,   "max_score": 15, "reasoning": "...", "offer_hint": "...", "decision": "accepted", "confidence": "high", "critical": false, "citations": ["dwt: 5326"] },
    "openarea_modifier":       { "code": "P6",  "score": 0,    "max_score": 0,  "reasoning": "No data — excluded.", "offer_hint": null, "decision": "excluded", "confidence": "n/a", "critical": false, "citations": [] },
    "readiness_eta":           { "code": "P7",  "score": 9,    "max_score": 10, "reasoning": "...", "offer_hint": "...", "decision": "accepted", "confidence": "low",  "critical": true,  "citations": ["current-draught: 3.6", "draft: 4.92"] },
    "restrictions_compliance": { "code": "P8",  "score": 0,    "max_score": 0,  "reasoning": "No restrictions — excluded.", "offer_hint": null, "decision": "excluded", "confidence": "n/a", "critical": false, "citations": [] }
  },

  "offer": {
    "email": {
      "subject": "att Anton \\\\ mv dremora 2 \\ 5-10k mins marmara-sfax",
      "to": ["albros@albros.com.tr", "anton@sarfo.com.tr"],
      "body": "Anton\n\nprivet !\nhope all good on yr side !\n\nre: mv dremora 2\n\nsee she was at temryuk...\n\n5-10k mins stw=dwt\nmarmara\\sfax\n2x be\n20-25 feb\n2.5add+1.25navistar\n\nwhen is she completing?\n\nregards"
    },
    "messages": [
      {
        "person": "Anton Romanishyn",
        "to": "+90 532 736 32 00",
        "body": "privet Anton !\nhope all good !\ndremora 2 — see she was at temryuk...\n\n5-10k mins stw=dwt\nmarmara\\sfax\n2x be\n20-25 feb\n2.5add+1.25navistar"
      }
    ],
    "metadata": {
      "vessel_name": "DREMORA 2",
      "vessel_score": 87,
      "intent": "attract",
      "approach": "A",
      "proximity_override_applied": false,
      "p1_p1a_combined": 27,
      "greeting_used": "privet",
      "pic_names": ["Anton"]
    }
  },

  "offer_opening": {
    "relationship_warning": {
      "status": "CLEAR",
      "type": "standard",
      "offer_guidance": "No special instructions"
    },
    "intent": "attract",
    "key_selling_points": [
      "Vessel is in the Black Sea, well positioned for Marmara load",
      "Owner specializes in Turkish trades"
    ],
    "key_concerns": [
      "AIS data is 13 days old",
      "Vessel was laden at last report"
    ],
    "questions_to_ask": [
      "When does she complete discharge?",
      "Is Tunisia workable for owners?"
    ]
  },

  "parsed_cargo": {
    "quantity": 5000,
    "quantity_unit": "mt",
    "quantity_option": "5-10k mins",
    "cargo_type": "minerals",
    "cargo_form": "in bulk",
    "stowage_factor": null,
    "hazard_status": "non-imo",
    "holds_requirement": "2x be",
    "commission": "2.5add+1.25navistar",
    "load_port": "Marmara",
    "discharge_port": "Sfax",
    "layday": "2026-02-20",
    "cancelling": "2026-02-25"
  },

  "db_corrections": []
}

═══════════════════════════════════════════════════════════════════════════════

FIELD NOTES:

  offer.email.subject — ALWAYS a separate field, NEVER embedded in body.
  offer.email.to — Array of ALL unique emails (company + people).
  offer.email.body — Starts with name(s), then greeting, then "re: mv [name]".
  
  offer.messages[] — One object PER PERSON who has messengersWhatsapp[].
    Each object: {person: full_name, to: first_whatsapp_number, body: personalized_text}
    Body includes cultural greeting + cargo block (identical to email).
    If person has NO WhatsApp → do NOT include in messages[].
    If NO people have WhatsApp → messages = [] (empty array).

  offer.metadata.intent — MUST match offer_opening.intent.
  offer.metadata.approach — "A" (strong), "B" (inquire), "C" (inform), "BLOCKED".

  citations[] — ONLY cite data that EXISTS in the vessel JSON.
    ⛔ NEVER fabricate citations like "Past Note: ..." or "broker notes..."
    ✅ Only cite actual JSON fields: "dwt: 5326", "companies[0].comments: spec: turkey"

  db_corrections[] — Array of {field, old_value, new_value, source} for any
    discrepancies found between DB and Gmail data, or AIS name mismatches.

═══════════════════════════════════════════════════════════════════════════════

CRITICAL REMINDERS:
  • intent MUST be one of: blocked_info | attract | inquire | inform
  • messages[] = per-person array, NOT a single text string
  • subject is its OWN field, never part of email body
  • citations must reference ACTUAL vessel JSON data only
  • cargo block in email body AND every message body must be IDENTICAL
  • score values are NUMBERS (not strings)
  • total_score is a PERCENTAGE (0-100), not raw points

################################################################################
#  END OF OUTPUT JSON OBJECT FORMAT v2.0                                       #
################################################################################
