================================================================================
VESSEL LOCATION DETERMINATION
Version: 4.0
Last updated: 2026-02-07
================================================================================

PURPOSE:
  Determine the vessel's current position, heading, and operational status
  to support P1 (proximity), P7 (readiness/ETA), and offer generation.
  Includes draught analysis for ballast/laden detection.

  ╔══════════════════════════════════════════════════════════════════╗
  ║  This file provides draught analysis logic that P7 MUST use     ║
  ║  before scoring readiness. See READINESSETA_TO_LOADING_PORT_    ║
  ║  SCORING.txt for how results feed into P7 scoring.             ║
  ╚══════════════════════════════════════════════════════════════════╝

================================================================================
POSITION SOURCES (priority order)
================================================================================

  1. OpenArea data (vessel listing):
     - open_area: "Montoir, Feb 17"
     - Contains: location name, date, sometimes heading
     
  2. VesselFinder / MarineTraffic data:
     - current-position: lat/lon
     - destination: next port
     - eta: estimated arrival
     - navigation-status: "under way", "at anchor", "moored"
     - current-draught: current draught reading (meters)
     
  3. Vessel JSON fields:
     - vessel_area: general area description
     - last_ports: recent port calls with dates

================================================================================
DETERMINING VESSEL READY DATE
================================================================================

  OPTION A — Open area with date only (no destination):
    Example: "open Montoir Feb 17"
    vessel_ready = Feb 17 (use as-is)
    No buffer needed — vessel is stated as open.

  OPTION B — Destination with ETA:
    Example: "heading Ravenna ETA Feb 13"
    
    Step 1: Perform DRAUGHT ANALYSIS (see below)
    Step 2: Apply operations buffer based on result
    
    BALLAST → vessel_ready = ETA (no buffer)
    LADEN   → vessel_ready = ETA + 7 days
    OVER_DRAFT → vessel_ready = ETA + 7 days (treat as laden)
      
  OPTION C — Current position only (no destination/ETA):
    Estimate sailing time from current position to load port.
    Use 10-12 knots average. Add 1 day port entry buffer.
    confidence = "low"

================================================================================
DRAUGHT ANALYSIS — BALLAST/LADEN DETECTION
================================================================================

  FORMULA:
    draught_ratio = current_draught / max_draft
    
    current_draught = field "current-draught" (from AIS/VesselFinder)
    max_draft = field "draft" (summer draft from vessel specs)
    
  THRESHOLDS:
  
    ratio < 0.65 → STATUS: BALLAST
    ────────────────────────────────────────
      Vessel is empty or nearly empty.
      operations_buffer = 0 days
      vessel_ready = ETA
      Ask owner: "Is she proceeding for loading or available?"

    ratio >= 0.65 → STATUS: LADEN
    ────────────────────────────────────────
      Vessel is carrying cargo, heading to discharge.
      operations_buffer = +7 days (discharge + preparation)
      vessel_ready = ETA + 7 days

    current_draught > max_draft → STATUS: OVER_DRAFT
    ────────────────────────────────────────
      Data anomaly (outdated AIS, tropical marks, error).
      Treat as LADEN (conservative).
      operations_buffer = +7 days
      Note data anomaly, confidence = "medium"

  MISSING DATA:
    If current_draught unavailable → default to LADEN (conservative)
    If max_draft unavailable → cannot calculate, use context clues
    Always note missing data in reasoning.

================================================================================
IMPACT ON OTHER CRITERIA
================================================================================

  P7 (Readiness/ETA):
    BALLAST → vessel_ready = ETA → closer to layday = better P7
    LADEN → vessel_ready = ETA + 7 → later ready date = worse P7
    P7 MUST use this analysis. See READINESSETA_TO_LOADING_PORT_SCORING.txt

  P1 (Proximity):
    Use DESTINATION port for distance when vessel is underway
    (not current mid-sea position)

  Offer Opening:
    BALLAST → include question about availability/status
    LADEN → standard approach, mention post-discharge timing

================================================================================
EXAMPLES
================================================================================

  Example 1: OVER_DRAFT (laden)
    current_draught = 8.8m, max_draft = 8.6m
    ratio = 1.023 → OVER_DRAFT → treat as LADEN
    vessel_ready = ETA + 7 days
    Note: "Draught 8.8m exceeds max 8.6m — anomaly, treating as laden."

  Example 2: BALLAST
    current_draught = 2.1m, max_draft = 5.2m  
    ratio = 0.404 → BALLAST
    vessel_ready = ETA (no buffer)
    Ask: "Confirm if heading for loading or open."

  Example 3: LADEN
    current_draught = 7.5m, max_draft = 9.8m
    ratio = 0.765 → LADEN
    vessel_ready = ETA + 7 days

  Example 4: No draught data
    current_draught = not available
    Default: LADEN (+7 days buffer)
    Note: "No draught data — defaulting to laden."
    confidence = "medium"

================================================================================
