================================================================================
P2A — PSC PORT ACCESSIBILITY SCORING
Version: 4.1
Last updated: 2026-02-20
================================================================================

PURPOSE:
  Evaluate whether the vessel can safely call at the cargo's loading and 
  discharge ports without excessive PSC (Port State Control) risk. Considers
  vessel's class, P&I, age, flag, and inspection history against port 
  strictness tiers.

SCORE RANGE: [0, 20]
ALWAYS ACTIVE: This criterion always has max_score = 20

╔═══════════════════════════════════════════════════════════════════════════════╗
  ║  IACS members: ABS, BV, CCS, CRS, DNV, IRClass (IRS), LR, KR, ClassNK,    ║
  ║               PRS, RINA, Türk Loydu (TL)                                  ║
  ║  NOT IACS: (examples) non-IACS class societies;                            ║
  ║           NOTE: RS/RMRS (Russian Maritime Register) was withdrawn in 2022 ║
╚═══════════════════════════════════════════════════════════════════════════════╝

================================================================================
PORT STRICTNESS TIERS
================================================================================

  TIER 1 — Very Strict (high detention risk)
  ─────────────────────────────────────────
    Countries: Italy, France, Greece, Spain, Portugal, Belgium, Netherlands,
               Germany, UK, Ireland, Norway, Sweden, Denmark, Finland,
               Australia, New Zealand, Canada, Japan, South Korea
    
  TIER 2 — Moderate Strict
  ─────────────────────────────────────────
    Countries: Turkey, Croatia, Slovenia, Montenegro, Albania, 
               Romania, Bulgaria, Egypt (Suez/Alex)
               
  TIER 3 — Moderate Tolerant
  ─────────────────────────────────────────
    Countries: Ukraine, Russia (Black Sea ports), Georgia, 
               Tunisia, Algeria, Morocco, Libya, Lebanon, Syria
               
  TIER 4 — Lax (low detention risk)
  ─────────────────────────────────────────
    Countries: Most West Africa, India, Bangladesh, Pakistan,
               most Southeast Asia, Central America, South America

================================================================================
VESSEL STATUS CATEGORIES
================================================================================

  ╔═══════════════════════════════════════════════════════════════════════════╗
  ║  STATUS DETERMINATION — THREE ELEMENTS:                                  ║
  ║                                                                          ║
  ║  Element 1: IACS class (active, confirmed IACS member)                   ║
  ║  Element 2: IG P&I club (Gard, Skuld, UK P&I, West, Standard, etc.)    ║
  ║  Element 3: White list flag (Paris MOU)                                  ║
  ║                                                                          ║
  ║  HIGH   = ALL THREE present (IACS + IG P&I + White flag)                ║
  ║  MEDIUM = TWO of three present (one element missing)                     ║
  ║  LOW    = ONE or ZERO of three present                                   ║
  ║                                                                          ║
  ║  Examples:                                                               ║
  ║  BV (IACS) + Gard (IG) + Liberia (White) = HIGH (3 of 3)              ║
  ║  BV (IACS) + Liberia (White) + no P&I data = MEDIUM (2 of 3)          ║
  ║  PRS (Non-IACS) + Gard (IG) + Liberia (White) = MEDIUM (2 of 3)       ║
  ║  PRS (Non-IACS) + no P&I + Tuvalu (Black) = LOW (0 of 3)             ║
  ║                                                                          ║
  ║  IMPORTANT: pi_information = null means WE don't have data, not that    ║
  ║  vessel has no insurance. Count as "missing" (not present), but do NOT  ║
  ║  penalize as harshly as confirmed Non-IG.                                ║
  ╚═══════════════════════════════════════════════════════════════════════════╝

  HIGH STATUS — Score bonus for strict ports
    Class: IACS member (BV, LR, DNV, ABS, ClassNK, RINA, CCS, KR, RS)
    P&I: Top-tier IG club (Gard, Skuld, UK P&I, West of England, etc.)
    Flag: White list (Paris MOU) — EU flags, Marshall Islands, Bahamas,
          Panama, Liberia, Singapore, Hong Kong, Japan, Norway
    All three elements present → HIGH
    
  MEDIUM STATUS — Standard scoring
    Two of three elements present. Examples:
    - IACS class + White flag but P&I unknown/missing → MEDIUM
    - IACS class + IG P&I but Grey flag → MEDIUM
    - Non-IACS class but IG P&I + White flag → MEDIUM
    
    Note: Default category for vessels missing one piece of documentation.
    
  LOW STATUS — Penalty for strict ports
    One or zero of three elements present. Examples:
    - Non-IACS class + no P&I + any flag → LOW
    - No class on record + anything → LOW (unless both P&I and flag are good)
    - Black list flag + Non-IACS + no P&I → LOW
    
    IMPORTANT: Distinguish in reasoning:
      classification-society = null → "No class society on record" (worst case)
      classification-society = "Turkish Lloyd" → "Non-IACS class"
      pi_information = null → "No P&I club on record" (data missing, not confirmed absent)
      pi_information = "some small club" → "Non-IG P&I"

  FLAG LISTS (Paris MOU — simplified):
    White list (good): Most EU flags, Marshall Islands, Bahamas, Singapore,
      Hong Kong, Japan, Norway, Panama (generally), Liberia
    Grey list (watch): Some flags with moderate detention rates
    Black list (bad): Flags with consistently high detention rates
    
    Note: Paris MOU flag lists are updated annually. When in doubt,
    treat unknown flags as Grey list.

================================================================================
BASE SCORING MATRIX
================================================================================

  Port Tier 1 (Very Strict):
    HIGH status:   16-20/20
    MEDIUM status: 10-14/20
    LOW status:    2-6/20 (potential BLOCK if critical deficiency)

  Port Tier 2 (Moderate Strict):
    HIGH status:   18-20/20
    MEDIUM status: 14-17/20
    LOW status:    6-10/20

  Port Tier 3 (Moderate Tolerant):
    HIGH status:   20/20
    MEDIUM status: 16-19/20
    LOW status:    10-14/20

  Port Tier 4 (Lax):
    HIGH status:   20/20
    MEDIUM status: 18-20/20
    LOW status:    14-18/20

================================================================================
PORT HISTORY BONUS
================================================================================

  If the vessel has RECENT successful calls at ports in the SAME TIER or 
  HIGHER (stricter) tier as the cargo ports, apply a bonus.
  
  RULES:
    - Bonus applies to SAME tier AND lower (less strict) tiers
    - Bonuses do NOT stack — use highest applicable only
    - "Recent" = within last 12 months of port history
    - We do NOT have detention data — do not require "no detention"

  BONUS VALUES:
  
    Tier 1 history: +3 for ALL tiers (1, 2, 3, 4)
    Tier 2 history: +2 for Tier 2, 3, 4 only (NOT Tier 1)
    Tier 3 history: +1 for Tier 3, 4 only
    Tier 4 history: No bonus

  EXAMPLES:
    Vessel called Ravenna (Italy, Tier 1) → +3 for everything
    Vessel called Istanbul (Turkey, Tier 2) → +2 for Tier 2/3/4, NOT Tier 1
    Vessel called BOTH Naples AND Samsun → use Naples (+3), don't stack

  BONUS CAP: Total P2A score cannot exceed 20

================================================================================
SCORING FOR MULTIPLE PORTS
================================================================================

  When cargo has both loading and discharge ports:
    - Score each port separately (status + tier + bonus)
    - Final P2A = weighted average (load port 60%, discharge port 40%)
    - If either port results in BLOCK → entire P2A is BLOCK
    
  Show both port scores in reasoning for transparency.

================================================================================
BLOCK CONDITIONS
================================================================================

  - LOW status vessel + Tier 1 port + no port history bonus → BLOCK
  - Vessel on Paris MOU blacklist + any EU port → BLOCK
  - No class certificate + Tier 1 or 2 port → BLOCK

================================================================================
OFFER HINTS
================================================================================

  High score (16+): null
  Medium score (10-15): "PSC risk manageable — vessel [class/age/flag] may 
    draw attention at [port]."
  Low score (<10): "Significant PSC risk at [port]."
  BLOCK: "Cannot safely call at [port] — do not offer."

================================================================================
AI INSTRUCTIONS
================================================================================

  ai_must:
    - Determine vessel status (HIGH/MEDIUM/LOW) using the THREE ELEMENTS test
    - Count how many of (IACS class, IG P&I, White flag) are present
    - Look up port tiers for ALL cargo ports
    - Check vessel port history for bonus eligibility
    - Apply highest applicable bonus (no stacking)
    - Score using the matrix
    - Show BOTH port scores when cargo has 2 ports
    
  ai_must_not:
    - ❌ Never require "no detention" data (we don't have it)
    - ❌ Never stack multiple port history bonuses
    - ❌ Never apply Tier 2 bonus to Tier 1 ports
    - ❌ Never block solely based on age
    - ❌ Never confuse P2A with P8 (P2A = PSC risk, P8 = cargo restrictions)
    - ❌ Never treat pi_information = null same as confirmed Non-IG

================================================================================
