
--- START OF estimator-prompts/COMMENTS_PROCESSING_GUIDE.txt ---
================================================================================
COMMENTS PROCESSING GUIDE — P2 & P3 Support
Version: 4.0
Last updated: 2026-02-07
================================================================================

PURPOSE:
  Guide for parsing and interpreting company/vessel/person comments to 
  extract owner preferences (P2), cargo preferences (P3), and relationship 
  data (P9). Comments are free-text and use shipping industry shorthand.

================================================================================
P2 — OWNER PREFERENCES (from comments + system settings)
================================================================================

  Score range: [0, 15]
  DYNAMIC CRITERION: If no preference data exists → score = 0, max_score = 0

  DATA SOURCES (check ALL):
    1. Company comments (free text)
    2. Person comments (free text)
    3. Vessel comments (free text)
    4. System settings / structured preferences (when available)
    
================================================================================
P2 — NO DATA vs NEUTRAL vs MATCH/CONFLICT
================================================================================

  This is a critical distinction. Three different situations:

  SITUATION A — NO PREFERENCE DATA AT ALL:
    score = 0, max_score = 0 (excluded from total)
    
    When to apply:
    - ALL comment sources are empty (no text at all)
    - Comments exist but contain ONLY non-preference information:
      • Business descriptions: "israel trader", "greek owner", "family company"
      • Relationship info: "works with Bunge", "Cargill via Clarkson"
      • Contact notes: "speak with John only", "email preferred"
      • Vessel operations: "fast loading", "good cranes"
      • Company size/type: "small operator", "single vessel company"
    - System settings have no preference data
    
    reasoning = "No owner preference data available — criterion excluded."

  SITUATION B — NEUTRAL (comments exist with preference-relevant words but no
    clear match or conflict):
    score = 7.5/15, max_score = 15
    
    When to apply:
    - Comments mention regions/cargoes but ambiguously
    - "open for all areas" → neutral
    - "flexible on cargo types" → neutral
    - Generic trading descriptions without specific preferences
    
    reasoning = "Comments exist but no clear preference match or conflict."

  SITUATION C — CLEAR MATCH OR CONFLICT:
    Score based on degree of match (see score mapping below)
    max_score = 15

================================================================================
P2 — WHAT IS AND IS NOT PREFERENCE DATA
================================================================================

  ✅ IS PREFERENCE DATA (score P2):
    "spec med/bs" → specializes in Med and Black Sea
    "pref atlantic" → prefers Atlantic trade
    "no ukr" → avoids Ukraine
    "ok greece but pref turkey" → Greece acceptable, Turkey preferred
    "avoids west africa" → negative for WA cargoes
    "only med/bs" → exclusive preference

  ❌ IS NOT PREFERENCE DATA (do NOT score P2, use 0/0):
    "israel trader" → business description, not a preference
    "greek owner" → nationality, not a preference
    "family company" → company type, not a preference
    "works direct with Bunge" → relationship data (P9), not preference
    "good operator" → reputation, not a preference
    "single vessel" → fleet info, not a preference
    "fast fixer" → behavior, not a preference
    "DPA in Istanbul" → operational info, not a preference

  ⚠️ EDGE CASES — use judgment:
    "trades mainly med" → WEAK preference data, score 7-8/15 (slight positive)
    "always in BS/Med area" → implied preference, score based on match
    "never goes to atlantic" → this IS a preference (negative for atlantic)

================================================================================
P2 — PARSING PREFERENCES FROM COMMENTS
================================================================================
  
  Keyword patterns:
    "spec [region]" → specialization, score 12-15 if match
    "pref [region]" → preference, score 10-12 if match
    "ok [region]" → acceptable, score 7.5-9 if match
    "no [region/country]" → hard block, score 0 for that region
    "avoids [region]" → soft block, score 2-4
    "only [region]" → exclusive, score 13-15 if match, 0-2 if not

  Score mapping:
    Perfect match (spec + region match): 15/15
    Good match (pref + region match): 10-12/15
    Acceptable match (ok + region): 7.5-9/15
    Neutral (ambiguous data): 7.5/15
    Soft conflict (avoids but not "no"): 3-5/15
    Hard conflict ("no [region]"): 0/15, potential BLOCK

================================================================================
P3 — CARGO PREFERENCES (vessel/company comments)
================================================================================

  Score range: [0, 15]
  DYNAMIC CRITERION: If no cargo preference data exists → score = 0, max_score = 0

  DATA SOURCES:
    1. Company comments — may mention cargo specializations
    2. Vessel comments — may mention cargo types handled
    3. Vessel type — General Cargo, Bulk Carrier, etc.
    
  NO DATA RULE:
    If no cargo preference information is found in any source:
      score = 0
      max_score = 0
      reasoning = "No cargo preference data available — criterion excluded."
      offer_hint = null

  PARSING CARGO PREFERENCES:
  
    "grain specialist" → high score for grain cargoes
    "cement carrier" → high score for cement, low for grain
    "no dangerous goods" → block for IMO/DG cargoes
    "clean holds required" → vessel maintained for sensitive cargoes
    "bulk only" → block for breakbulk/project cargo
    "steel/timber regular" → specialization indicators

================================================================================
AI MUST NOT — CRITICAL RULES
================================================================================

  ❌ Never consider vessel AGE when scoring P2 or P3.
     Age is NOT a preference factor. Age belongs in P8 only.
     
  ❌ Never treat business descriptions as preference data.
     "israel trader", "greek owner", "family company" = NOT preferences.
     These go to 0/0 (excluded) unless combined with actual preferences.
     
  ❌ Never assign neutral (7.5/15) when data clearly supports match/conflict.
  
  ❌ Never assign neutral (7.5/15) when comments contain only non-preference info.
     If no actual preference keywords found → use 0/0 (excluded).
     
  ❌ Never treat absence of negative data as positive.
     "No comment about grain" ≠ "vessel is good for grain"
     
  ❌ Never mix P2 (region preferences) with P3 (cargo preferences).
     P2 = WHERE the owner wants to trade
     P3 = WHAT cargo the vessel can/prefers to carry
     
  ❌ Never infer preferences from vessel type alone when comments exist.
     Comments override vessel type assumptions.
     
  ❌ Never consider vessel class, P&I, or flag in P2/P3 — that's P2A/P8.

================================================================================
COMMENT PARSING PATTERNS
================================================================================

  ABBREVIATIONS commonly found in comments:
    spec = specializes           pref = prefers  
    ok = acceptable              no = does not accept / avoids
    w/ = with                    w/o = without
    dg = dangerous goods         imo = IMO classified cargo
    bs = Black Sea               med = Mediterranean
    waf = West Africa            eaf = East Africa
    cont = Continent (NW Europe) ukr = Ukraine
    tur / trk = Turkey           gre = Greece
    ita = Italy                  fra = France
    
  RELATIONSHIP INDICATORS (for P9, see MASTER_SCORING_SYSTEM.txt):
    "works direct with [company]" → direct relationship
    "[company] cargoes via [broker]" → broker relationship
    "exclusive [company]" → exclusive relationship, caution
    "broker for [company]" → intermediary relationship

  NON-PREFERENCE INDICATORS (use 0/0 for P2):
    "[country] trader" → business description
    "[nationality] owner" → nationality info
    "family company" → company type
    "single vessel" → fleet size
    "good/reliable operator" → reputation

================================================================================


--- START OF estimator-prompts/MASTER_SCORING_SYSTEM.txt ---
================================================================================
MASTER SCORING SYSTEM
Version: 5.0
Last updated: 2026-02-07
================================================================================

PURPOSE:
  Central scoring framework for vessel-cargo matching. Defines all criteria,
  dynamic score calculation, priority order, P9 relationship check, and 
  offer opening generation logic.

================================================================================
ALL CRITERIA — OVERVIEW
================================================================================

  Code  Name                    Max    Type       Reference File
  ────  ────────────────────    ───    ────       ──────────────
  P1    Proximity               20     Always     proximity_scoring_matrix.txt
  P1A   Regional Patterns       15     Always     P1A_REGIONAL_SCORING_RULES.txt
  P2    Owner Preferences       15     Dynamic    COMMENTS_PROCESSING_GUIDE.txt
  P2A   PSC Port Accessibility  20     Always     P2A_PSC_PORT_ACCESSIBILITY_SCORING.txt
  P3    Cargo Preferences       15     Dynamic    COMMENTS_PROCESSING_GUIDE.txt
  P4    Last Ports              10     Always     P4_LAST_PORTS_SCORING.txt
  P5    Intake / Cargo Fit      15     Always     intake_calculator_formula.txt
  P6    OpenArea Comments       15     Dynamic    OPEN_AREA_COMMENTS_SCORING.txt
  P7    Readiness / ETA         10     Always     READINESSETA_TO_LOADING_PORT_SCORING.txt
  P8    Restrictions            20     Dynamic    P8_RESTRICTIONS_COMPLIANCE_SCORING.txt
  P9    Relationship Check      —      Warning    (this file, section below)

================================================================================
DYNAMIC MAX_SCORE CALCULATION
================================================================================

  Not all criteria are always active. Some criteria produce 0/0 when there
  is no data — these are EXCLUDED from the total, not penalized.

  ALWAYS ACTIVE (max_score is always set):
    P1  = 20
    P1A = 15
    P2A = 20
    P4  = 10
    P5  = 15
    P7  = 10
    ────────
    Base always-active MAX = 90

  DYNAMIC (max_score = 0 if no data, otherwise max):
    P2  = 15 or 0 (no owner preference data → excluded)
    P3  = 15 or 0 (no cargo preference data → excluded)
    P6  = 15 or 0 (no OpenArea comments → excluded)
    P8  = 20 or 0 (no restrictions set → excluded)

  FORMULA:
    dynamic_max_score = SUM of max_score for ALL criteria where max_score > 0
    
    Minimum: 90 (only always-active criteria)
    Maximum: 90 + 15 + 15 + 15 + 20 = 155 (all criteria active)

  ╔══════════════════════════════════════════════════════════════════╗
  ║  FINAL SCORE — ALWAYS EXPRESSED AS PERCENTAGE:                  ║
  ║                                                                 ║
  ║  total_score = ROUND((total_score_raw / dynamic_max_score)×100) ║
  ║                                                                 ║
  ║  total_score is a number from 0 to 100 (percentage).            ║
  ║  total_score_raw is the sum of absolute points.                 ║
  ║  NEVER report total_score as raw points.                        ║
  ╚══════════════════════════════════════════════════════════════════╝

================================================================================
EVALUATION PRIORITY ORDER
================================================================================

  Evaluate in this order (highest impact first):
  
  1. P8  — Restrictions Compliance (BLOCK potential — but NOT for age)
  2. P5  — Intake / Cargo Fit (BLOCK potential — includes draft restrictions)
  3. P2A — PSC Port Accessibility (BLOCK potential)
  4. P2  — Owner Preferences (BLOCK potential for "no X")
  5. P3  — Cargo Preferences
  6. P6  — OpenArea Comments
  7. P4  — Last Ports
  8. P1A — Regional Patterns
  9. P1  — Proximity (BLOCK for non-viable distances)
  10. P7  — Readiness / ETA (BLOCK for missed laycan)
  11. P9  — Relationship Check (warning only, no score)

  IMPORTANT: Even when a BLOCK is found early, score ALL remaining criteria.
  The full scoring provides informational value.

================================================================================
CRITICAL — RESTRICTION SCOPE RULES
================================================================================

  Different criteria handle different types of restrictions. Never mix them:

  P5 handles: Draft/draught restrictions (from cargo description or 
              port_restrictions_map), cargo quantity fit, cubature
              
  P8 handles: ONLY these 8 types from cargo settings:
              Class, P&I, IMO, Holds Type, DWT, Age, LOA, Beam
              
  P2A handles: PSC risk based on flag, class, P&I, age, port strictness
  
  P2 handles: Owner's regional preferences from comments
  
  P3 handles: Cargo type preferences from comments

  EXAMPLE: Cargo says "max age 25yr, draft 7.5m"
    → Age 25yr → goes to P8 (gradual restriction)
    → Draft 7.5m → goes to P5 (intake calculator)
    → AI must NOT put draft in P8

================================================================================
BLOCK LOGIC
================================================================================

  Any criterion can produce a BLOCK. A single BLOCK = vessel is not viable.
  
  When BLOCK is triggered:
    - recommendation = "BLOCKED"
    - Still score ALL other criteria (for informational value)
    - Mark blocked criterion with "decision": "blocked", "critical": true
    - short_summary explains why vessel is blocked
    - Offer opening is NOT generated (or marked as "do not offer")

  BLOCK can come from:
    P8: Class/IMO hard fail, DWT >15%, LOA >5% (NEVER from age)
    P5: intake < min_qty × 0.85 (vessel physically too small)
    P2A: LOW status + Tier 1 port, Paris MOU blacklist
    P2: "no [region]" when cargo is in that region
    P1: Non-viable distance for vessel size
    P7: Vessel misses laycan by >7 days

  Multiple BLOCKs: Report all. Summary mentions the most impactful.

================================================================================
RECOMMENDATION CATEGORIES
================================================================================

  Based on total_score (percentage):

  BLOCKED — One or more criteria triggered BLOCK
    → Do not offer
    
  STRONG (80%+) — Excellent match
    → Offer with confidence, intent = ATTRACT
    
  GOOD (65-80%) — Solid match with minor issues
    → Offer proactively, intent = ATTRACT or INQUIRE
    
  CONDITIONAL (50-65%) — Decent match, has concerns
    → Offer with questions, intent = INQUIRE
    
  WEAK (35-50%) — Poor match but may work
    → Offer for information gathering, intent = INFORM
    
  SKIP (<35%) — Not worth offering
    → Skip unless desperate for tonnage

================================================================================
P9 — RELATIONSHIP CHECK (WARNING ONLY)
================================================================================

  P9 is NOT a scoring criterion. It generates a warning flag that influences
  the offer approach but does not affect total_score.

  PURPOSE: Detect if the vessel owner has a known relationship with the 
  charterer (cargo account) — either direct or through another broker.

  DATA SOURCES:
    - Company/vessel/person comments (current format)
    - Dedicated relationship field (future, when available)
    - Any structured data about owner-charterer connections
    
  PARSING NOTE:
    AI should check ALL available sources for relationship data.
    Source format may change — logic remains the same:
    Find mentions of charterer names, broker names, "works direct with X"

  WARNING TYPES:

    DIRECT_RELATIONSHIP
    ─────────────────────────────────────────
      Trigger: Owner works directly with this charterer
      Example comment: "works direct with Bunge"
      Warning: "Owner works directly with Bunge. They may already have 
               this cargo or prefer direct communication."
      Offer impact: Be careful — mention "in case you haven't seen this yet"
               
    BROKER_RELATIONSHIP
    ─────────────────────────────────────────
      Trigger: Owner works through specific broker for this charterer
      Example comment: "Cargill cargoes via Clarkson"
      Warning: "Owner handles Cargill cargoes through Clarkson."
      Offer impact: Owner may redirect to their broker. Adjust expectations.
               
    NO_RELATIONSHIP (CLEAR)
    ─────────────────────────────────────────
      Trigger: No known connection found
      Warning: null
      Offer impact: Standard approach

  OUTPUT FORMAT:
  
    "relationship_warning": {
      "status": "WARNING",
      "type": "direct_relationship",
      "details": "Owner works directly with Bunge (from company comments)",
      "offer_guidance": "They may already have this cargo."
    }

    "relationship_warning": { "status": "CLEAR" }

================================================================================
OFFER OPENING GENERATION
================================================================================

  After scoring all criteria, generate an offer opening line for both 
  email and messenger formats.
  
  See: OFFER_OPENING_STYLE_GUIDE.txt for detailed style rules and examples.

  GENERATION LOGIC:

  1. Determine INTENT based on total_score:
     - ATTRACT (70%+): Confident, lead with strengths
     - INQUIRE (50-70%): Balanced, show cargo + ask key questions
     - INFORM (<50%): Cautious, "for your reference", gather info
     
  2. Extract KEY SELLING POINTS from high-scoring criteria (offer_hints)
  3. Extract KEY CONCERNS from low-scoring criteria (offer_hints)
  4. Extract QUESTIONS TO ASK from missing data or unclear points
  5. Generate email_text (2-4 sentences, shipping English, abbreviations)
  6. Generate messenger_text (1-2 sentences, max abbreviations)

  "offer_opening": {
    "intent": "attract",
    "email_text": "...",
    "messenger_text": "...",
    "key_selling_points": ["proximity", "timing"],
    "key_concerns": ["intake slightly tight"],
    "questions_to_ask": []
  }
  
  IMPORTANT: 
    - NO greetings in offer_opening text
    - When BLOCKED: offer_opening not generated (intent = "do_not_offer")

================================================================================
JSON OUTPUT TEMPLATE
================================================================================

  ╔══════════════════════════════════════════════════════════════════╗
  ║  ALL criteria MUST appear in detailed_scoring, even if excluded ║
  ║  Excluded criteria show: score=0, max_score=0, decision="excluded" ║
  ╚══════════════════════════════════════════════════════════════════╝

{
  "vessel_name": "MV Example",
  "total_score": 81.1,
  "total_score_raw": 73,
  "dynamic_max_score": 90,
  "confidence": 85,
  "confidence_note": "High confidence. P2, P3, P6, P8 excluded (no data).",
  "recommendation": "STRONG",
  "short_summary": "Excellent match — well positioned, good timing, cargo fits. No restrictions to worry about.",
  
  "relationship_warning": {
    "status": "CLEAR"
  },
  
  "offer_opening": {
    "intent": "attract",
    "email_text": "Pls find below cargo which suits mv Example nicely — well positioned nearby and timing works perfectly. Kindly let us know yr interest/ideas.",
    "messenger_text": "have a nice cargo for Example — close by, good timing, full cargo. pls see below, lmk?",
    "key_selling_points": ["proximity", "timing", "cargo fit"],
    "key_concerns": [],
    "questions_to_ask": []
  },
  
  "detailed_scoring": {
    "proximity": {
      "code": "P1",
      "score": 14.0,
      "max_score": 20,
      "reasoning": "Constanta, ~150nm from Chornomorsk. Level 4 — short ballast.",
      "offer_hint": "Great positioning — lead with 'well positioned nearby'.",
      "decision": "accepted",
      "confidence": "high",
      "critical": false,
      "citations": ["ref:proximity_scoring_matrix.txt Level 4"]
    },
    "regional_patterns": {
      "code": "P1A",
      "score": 12,
      "max_score": 15,
      "reasoning": "BS internal — strong natural trade flow for coasters.",
      "offer_hint": "Natural trade pattern — mention backhaul opportunity.",
      "decision": "accepted",
      "confidence": "high",
      "critical": false,
      "citations": ["ref:P1A black_sea_internal"]
    },
    "owner_preferences": {
      "code": "P2",
      "score": 0,
      "max_score": 0,
      "reasoning": "No preference data available — criterion excluded.",
      "offer_hint": null,
      "decision": "excluded",
      "confidence": "n/a",
      "critical": false,
      "citations": []
    },
    "port_accessibility": {
      "code": "P2A",
      "score": 18,
      "max_score": 20,
      "reasoning": "IACS class, IG P&I. Ukraine Tier 3, Tunisia Tier 3.",
      "offer_hint": null,
      "decision": "accepted",
      "confidence": "high",
      "critical": false,
      "citations": ["ref:P2A Tier3 + High status"]
    },
    "cargo_preferences": {
      "code": "P3",
      "score": 0,
      "max_score": 0,
      "reasoning": "No cargo preference data — criterion excluded.",
      "offer_hint": null,
      "decision": "excluded",
      "confidence": "n/a",
      "critical": false,
      "citations": []
    },
    "last_ports": {
      "code": "P4",
      "score": 7,
      "max_score": 10,
      "reasoning": "Regular BS/Med caller. Poti 8.7%, Samsun 6.5%.",
      "offer_hint": "Vessel knows the region — mention familiarity.",
      "decision": "accepted",
      "confidence": "high",
      "critical": false,
      "citations": ["ref:P4_LAST_PORTS_SCORING.txt", "top_ports data"]
    },
    "intake_capacity": {
      "code": "P5",
      "score": 12,
      "max_score": 15,
      "reasoning": "Intake 14,305t (draft-restricted). Fits cargo range 13,500-16,500t.",
      "offer_hint": "Cargo fits but at draft limit. Be transparent about qty.",
      "decision": "accepted",
      "confidence": "high",
      "critical": false,
      "citations": ["ref:intake_calculator_formula.txt"]
    },
    "openarea_modifier": {
      "code": "P6",
      "score": 0,
      "max_score": 0,
      "reasoning": "No OpenArea comments — criterion excluded.",
      "offer_hint": null,
      "decision": "excluded",
      "confidence": "n/a",
      "critical": false,
      "citations": []
    },
    "readiness_eta": {
      "code": "P7",
      "score": 10,
      "max_score": 10,
      "reasoning": "Open Constanta Feb 12, layday Feb 14. Gap -2 days — ideal.",
      "offer_hint": "Timing perfect — highlight in opening.",
      "decision": "accepted",
      "confidence": "high",
      "critical": false,
      "citations": ["ref:READINESSETA_TO_LOADING_PORT_SCORING.txt"]
    },
    "restrictions_compliance": {
      "code": "P8",
      "score": 0,
      "max_score": 0,
      "reasoning": "No restrictions set — criterion excluded.",
      "offer_hint": null,
      "restrictions_checked": [],
      "decision": "excluded",
      "confidence": "n/a",
      "critical": false,
      "citations": []
    }
  }
}

  SCORE CALCULATION:
    Active: P1(20)+P1A(15)+P2A(20)+P4(10)+P5(15)+P7(10) = 90
    Excluded: P2(0/0), P3(0/0), P6(0/0), P8(0/0)
    dynamic_max_score = 90
    total_score_raw = 14+12+18+7+12+10 = 73
    total_score = ROUND((73/90) × 100, 1) = 81.1%
    recommendation = STRONG

================================================================================
AI INSTRUCTIONS
================================================================================

  ai_must:
    - Evaluate ALL criteria, even when BLOCK is found early
    - Include ALL criteria in detailed_scoring (even excluded ones with 0/0)
    - Calculate dynamic_max_score correctly (only active criteria)
    - Express total_score as PERCENTAGE (0-100), never as raw points
    - Generate offer_hint for each active criterion
    - Perform P9 relationship check
    - Generate offer_opening (unless BLOCKED)
    - Use short, natural reasoning
    - Route draft restrictions to P5, not P8
    - Route age/DWT/class/etc restrictions to P8
    
  ai_must_not:
    - ❌ Never include criteria with max_score=0 in the denominator
    - ❌ Never skip criteria evaluation
    - ❌ Never omit excluded criteria from output (show them as 0/0)
    - ❌ Never report total_score as raw points — always percentage
    - ❌ Never generate offer_opening when vessel is BLOCKED
    - ❌ Never put draft restrictions in P8 — they go to P5
    - ❌ Never let P9 affect the numerical score
    - ❌ Never BLOCK vessel for age alone (P8 rule)

================================================================================


--- START OF estimator-prompts/OFFER_OPENING_STYLE_GUIDE.txt ---
================================================================================
OFFER OPENING STYLE GUIDE
Version: 1.0
Last updated: 2026-02-07
================================================================================

PURPOSE:
  Define the style, tone, abbreviations, and approach for generating offer
  opening lines. These are ready-to-use phrases for the beginning of an 
  email or messenger message to a shipowner about a cargo opportunity.

  IMPORTANT: Offer openings contain NO GREETINGS. Greetings (gm, hi, dear)
  are handled separately with personalization based on company comments,
  nationalities, holidays, and relationship context.

================================================================================
ABBREVIATIONS LIBRARY — SHIPPING ENGLISH
================================================================================

  VESSEL & SPECS:
    mv = motor vessel
    vsl = vessel
    dwt = deadweight tonnage
    dft = draft/draught
    loa = length overall
    blt = built
    grd = geared
    gls = gearless
    ho/ha = holds/hatches
    cbft = cubic feet
    teu = twenty-foot equivalent unit
    
  CARGO & QUANTITY:
    mt = metric tonnes
    qty = quantity
    abt = about
    moloo = more or less in owner's option
    molchopt = more or less in charterer's option
    sf = stowage factor
    wog = without guarantee
    dg = dangerous goods
    imo = IMO classified
    
  TIMING & DATES:
    eta = estimated time of arrival
    etb = estimated time of berthing
    etc = estimated time of completion
    laycan = laydays/canceling
    ppt = prompt
    spd = speed
    
  PARTIES:
    ownrs = owners
    chrtrs = charterers
    rcvrs = receivers
    shprs = shippers
    
  REGIONS & PORTS:
    bs = Black Sea
    med = Mediterranean
    emed = East Mediterranean
    wmed = West Mediterranean
    cont = Continent (NW Europe)
    waf = West Africa
    eaf = East Africa
    ag = Arabian Gulf
    sea = Southeast Asia
    usec = US East Coast
    uswc = US West Coast
    poc = port of call / port of loading in context
    pod = port of discharge
    
  ACTIONS & PHRASES:
    pls = please
    yr = your
    fyi = for your information
    lmk = let me know
    wld = would
    cld = could
    shld = should
    re = regarding / about
    rgds = regards
    brgs = best regards
    tks = thanks
    thx = thanks
    w/ = with
    w/o = without
    incl = including
    excl = excluding
    approx = approximately
    subj = subject to
    
  SIGN-OFFS (email only):
    brgs = best regards (standard)
    rgds = regards (shorter)
    tks & brgs = thanks and best regards (when asking for something)

================================================================================
STYLE RULES
================================================================================

  GENERAL:
    - Sound like a REAL BROKER, not like AI
    - Colleague tone — sharing an opportunity, not selling
    - Short sentences, no fluff
    - Use shipping abbreviations naturally (not forced)
    - Be honest about concerns — diplomatic but direct
    - Always include a call to action (lmk, what do you think, yr ideas)
    
  EMAIL FORMAT:
    - 2-4 sentences for the opening/intro paragraph
    - Then cargo details follow (not generated here — just the intro)
    - Sign off: "brgs" or "rgds" (NOT generated in offer_opening)
    - Can reference specific selling points or concerns
    - Slightly more formal than messenger but still shipping casual
    
  MESSENGER FORMAT:
    - 1-2 sentences maximum
    - Maximum abbreviations
    - No sign-off
    - Get to the point immediately
    - Can use lowercase throughout
    - More direct and casual than email

  NEVER DO:
    - Never start with greetings (gm, ga, hi, dear — handled separately)
    - Never sound like a sales pitch or marketing copy
    - Never use "we are pleased to inform you"
    - Never use "we would like to take this opportunity"
    - Never be overly enthusiastic or use exclamation marks
    - Never use "dear sir/madam" style formality
    - Never include the full cargo description in the opening
    - Never use "I hope this email finds you well"

================================================================================
TEMPLATES BY INTENT LEVEL
================================================================================

  NOTE: These are EXAMPLES, not rigid templates. AI should adapt and vary
  the phrasing based on specific circumstances. Never copy-paste the same
  opening for different vessels.

────────────────────────────────────────────────────────────────────────────────
  ATTRACT (score 70%+) — vessel is a good match
────────────────────────────────────────────────────────────────────────────────

  Goal: Show confidence that cargo fits, encourage quick response.
  Tone: Positive, direct, enthusiastic (but professional)

  Email examples:
    "Pls find below cargo details which we believe suits mv [vessel] 
     nicely — she's well positioned and timing works. Wld appreciate 
     yr freight ideas."
     
    "Pls find below what looks like a very good fit for mv [vessel] —
     nearby, good timing, full cargo. Kindly let us know yr interest."
     
    "Wish to draw yr attention to below cargo for mv [vessel]. She 
     seems perfectly placed for this one. Yr indication pls."

  Messenger examples:
    "have a nice cargo for [vessel] — good position, good timing. 
     pls see below, lmk if interested?"
     
    "smth nice for [vessel] — close by and timing fits. see below, 
     what do you think?"
     
    "cargo that suits [vessel] well — pls check below and lmk yr view"

────────────────────────────────────────────────────────────────────────────────
  INQUIRE (50-70%) — decent match but has questions/concerns
────────────────────────────────────────────────────────────────────────────────

  Goal: Show cargo + ask key questions to clarify fit.
  Tone: Interested but cautious, transparent about concerns.

  Email examples:
    "Pls find below cargo we'd like to show for mv [vessel]. We note 
     she's opening [area] — cld you kindly confirm her exact opening 
     date/position? Also wld be helpful to know yr view on [topic]."
     
    "Pls find below cargo for mv [vessel]. Position looks reasonable 
     but intake is tight — wld appreciate yr indication on qty 
     flexibility. Yr view pls."
     
    "Wish to show below cargo for mv [vessel]. Timing cld work if she 
     opens as stated. Cld you confirm her current status?"

  Messenger examples:
    "sending you a cargo for [vessel]. can you confirm her opening? 
     also is she ok for [region/cargo]?"
     
    "cargo for [vessel] — position ok but need to check timing. 
     can you confirm when she opens exactly?"
     
    "have smth for [vessel] — looks possible but intake bit tight. 
     pls see below, yr view?"

────────────────────────────────────────────────────────────────────────────────
  INFORM (<50%) — poor match but showing for relationship/info
────────────────────────────────────────────────────────────────────────────────

  Goal: Send for reference, gather information, maintain contact.
  Tone: Low-key, honest about limitations, looking for info exchange.

  Email examples:
    "Pls find below cargo details for yr good order. We understand mv 
     [vessel] may not be ideal fit at this stage given [reason], hvr 
     sending in case circumstances have changed. Any update on her 
     availability/preferences wld be appreciated."
     
    "Pls find below for yr reference — appreciate this may not be the 
     best match for mv [vessel] but wanted to keep you informed. Wld 
     welcome any update on her trading plans."
     
    "Sending below cargo fyi for mv [vessel]. We note [concern] but 
     wanted to show just in case. Any news on her position/plans?"

  Messenger examples:
    "sending below cargo fyi — understand [vessel] might not fit 
     perfectly but wanted to show just in case. any updates on her?"
     
    "know [region] isn't first choice but sending below just in case —
     any change in plans for [vessel]?"
     
    "cargo fyi for [vessel] — not perfect match but sending for yr 
     reference. any news on her?"

================================================================================
SPECIAL CASES
================================================================================

  BALLAST QUESTION (vessel appears in ballast, need confirmation):
  ─────────────────────────────────────────
    Email: "Pls find below cargo for mv [vessel]. We see she's heading 
           to [destination] — cld you confirm if she's proceeding for 
           loading (already fixed) or if this is ballast positioning? 
           Cargo details below for yr consideration."
           
    Messenger: "see [vessel] heading to [destination] — is she going 
               for loading or just ballasting? have a cargo below that 
               cld work"

  OWNER AVOIDS REGION (soft block, sending anyway):
  ─────────────────────────────────────────
    Email: "Pls find below cargo details for yr reference. We note from 
           previous communication that [region] may not be of primary 
           interest, hvr sending for good order in case the situation 
           has changed. Any update on [vessel]'s current trading plans 
           wld be much appreciated."
           
    Messenger: "know [region] isn't first choice but sending below 
               just in case — any change in plans for [vessel]?"

  MULTIPLE ISSUES (several concerns at once):
  ─────────────────────────────────────────
    Email: "Pls find below cargo for yr reference re mv [vessel]. We 
           note [issue1] and [issue2] may present challenges, hvr 
           wanted to show in case any of these factors have changed. 
           Yr update wld be appreciated."
           
    Messenger: "cargo fyi for [vessel] — has some challenges 
               ([issue1], [issue2]) but sending in case situation 
               changed. any news?"

  NO DATA ON PREFERENCES (want to learn about the owner):
  ─────────────────────────────────────────
    Email: "Wish to draw yr attention to below cargo for mv [vessel]. 
           She seems well suited positionally. Cld you also let us know 
           if [vessel/owner] has any particular preferences on cargo 
           types or regions? Wld help us tailor future offerings."
           
    Messenger: "pls see below cargo for [vessel], looks ok positionally. 
               btw does she have any preferences on cargo/regions? good 
               to know for future"

  RELATIONSHIP WARNING (P9 flagged):
  ─────────────────────────────────────────
    When direct relationship found, add diplomatic language:
    
    Email: "Pls find below cargo details for mv [vessel] — sending in 
           case you haven't seen this one yet. [rest of opening]"
           
    Messenger: "in case you haven't seen it — cargo below for [vessel]. 
               [rest of opening]"

================================================================================
OFFER_HINT → OFFER_OPENING MAPPING
================================================================================

  The offer_opening is generated by combining offer_hints from individual 
  criteria into a coherent opening phrase. Here's how hints map to opening:

  High-score hints (selling points):
    P1 "well positioned nearby" → "she's well positioned"
    P7 "timing perfect" → "timing works nicely"
    P6 "matches stated strategy" → "fits with yr stated plans"
    P4 "knows the area" → "familiar with these ports"
    
  Low-score hints (concerns to mention diplomatically):
    P5 "intake tight" → "intake is a bit tight"
    P7 "timing tight" → "timing cld be challenging"
    P1 "long ballast" → "appreciate the ballast is significant"
    P2 "region not preferred" → "note [region] may not be first choice"
    
  Missing data hints (questions to ask):
    P2 "no preference data" → "wld be helpful to know yr preferences"
    Draught "ballast confirmation" → "cld you confirm her status?"
    P7 "opening date unclear" → "pls confirm her exact opening"

================================================================================


--- START OF estimator-prompts/OPEN_AREA_COMMENTS_SCORING.txt ---
================================================================================
OPEN_AREA_COMMENTS_SCORING — P6
Version: 5.0
Last updated: 2026-02-07
================================================================================

PURPOSE:
  Evaluate how well the cargo matches the vessel's stated voyage strategy 
  as expressed in OpenArea comments. These comments reflect what the owner
  or operator has communicated about their intentions, preferences, or 
  requirements for the next voyage.

SCORE RANGE: [0, 15]
DYNAMIC CRITERION: If no comments exist → score = 0, max_score = 0 (excluded)

================================================================================
CRITICAL — NO DATA vs NEUTRAL
================================================================================

  NO DATA (excluded):
    Comments field is empty or missing.
    score = 0, max_score = 0
    reasoning = "No OpenArea comments — criterion excluded."
    This removes P6 from the dynamic_max_score denominator.

  NEUTRAL (scored):
    Comments exist but don't clearly match or conflict with cargo.
    score = 7.5/15, max_score = 15
    reasoning = "Comments exist but no clear alignment or conflict."
    This keeps P6 in the denominator.

  These are DIFFERENT outcomes. Do not confuse them.

================================================================================
SCORING LEVELS (when comments exist, max_score = 15)
================================================================================

  FULL CONFLICT — score: 0/15
  ─────────────────────────────────────────
    Owner explicitly states they do NOT want what this cargo offers.
    Examples:
      - "looking for Med" but cargo is Black Sea
      - "no grain" but cargo is wheat
      - "needs min 20k" but cargo is 6,000t
    offer_hint: "Owner's strategy conflicts. Only offer if exceptional."

  SOFT CONFLICT — score: 3-5/15
  ─────────────────────────────────────────
    Owner's stated preferences don't match well but aren't hard blocks.
    Examples:
      - "pref Med/BS" and cargo is East Med (borderline)
      - Mentions different cargo type but doesn't exclude this one
      - "looking for long voyage" but this is short
    offer_hint: "Partial mismatch — emphasize what makes this attractive."

  NEUTRAL — score: 7.5/15
  ─────────────────────────────────────────
    Comments exist but don't clearly support or contradict.
    Examples:
      - Comment only mentions opening date/area, no preferences
      - "open for offers"
      - Mentions unrelated details
    offer_hint: null

  POSITIVE MATCH — score: 10-12/15
  ─────────────────────────────────────────
    Owner's comments align well with the cargo.
    Examples:
      - "open for BS/Med" and cargo is Black Sea
      - Mentions similar cargo type
      - "looking for short voyage" and this fits
    offer_hint: "Owner's strategy aligns — mention this in opening."

  PERFECT MATCH — score: 15/15
  ─────────────────────────────────────────
    Owner explicitly asks for exactly what this cargo is.
    Examples:
      - "looking for grain ex Ukraine" and cargo is wheat ex Chornomorsk
      - "need cargo to Sfax" and discharge is Sfax
    offer_hint: "Perfect match with owner's request — lead with this."

================================================================================
AI INSTRUCTIONS
================================================================================

  ai_must:
    - Read ALL OpenArea comments carefully
    - Compare against: cargo type, load/discharge region, quantity, timing
    - Score based on degree of alignment/conflict
    - Set max_score = 0 when comments are empty (excluded)
    - Set max_score = 15 when comments exist (even if neutral)

  ai_must_not:
    - ❌ Never invent preferences not stated in comments
    - ❌ Never score neutral (7.5) when clear match or conflict exists
    - ❌ Never give max_score = 15 when comments are empty
    - ❌ Never consider vessel specs here (that's P5, P8)
    - ❌ Never consider owner preferences from other sources (that's P2)
    - ❌ Never confuse "no comments" (excluded) with "neutral" (scored)

================================================================================


--- START OF estimator-prompts/P1A_REGIONAL_SCORING_RULES.txt ---
# ═══════════════════════════════════════════════════════════════════
# P1A: REGIONAL TRADE PATTERNS - EXPLICIT SCORING RULES
# VK Charts AI Scoring System
# ═══════════════════════════════════════════════════════════════════
#
# CRITICAL: This file provides EXPLICIT scoring rules for P1A criterion
# AI must use these rules instead of making assumptions about trade patterns
#
# Maximum Score: 15 points
# Confidence Range: 60-90%
#
# ═══════════════════════════════════════════════════════════════════

version: "2.0"
date: "2026-01-19"
priority: "CRITICAL - Regional patterns are complex and require explicit rules"

# ═══════════════════════════════════════════════════════════════════
# OVERVIEW
# ═══════════════════════════════════════════════════════════════════

purpose: |
  Regional trade patterns reflect:
  - Economic viability of vessel positioning
  - Availability of backhaul cargoes
  - Geopolitical restrictions (sanctions, war zones)
  - Cost structures (canal fees, ballast costs)
  - Historical trade flows and market practices
  
  AI MUST use explicit scoring rules from this file, not general assumptions.

# ═══════════════════════════════════════════════════════════════════
# SCORING METHODOLOGY
# ═══════════════════════════════════════════════════════════════════

scoring_approach: |
  1. Identify vessel's opening region/port
  2. Identify cargo loading region
  3. Match pattern to scoring table below
  4. Apply vessel size adjustments if needed
  5. Consider special cases (Danube, Russian ports, etc.)

# ═══════════════════════════════════════════════════════════════════
# EXPLICIT SCORING TABLE - PRIMARY PATTERNS
# ═══════════════════════════════════════════════════════════════════

primary_trade_patterns:

  # ─────────────────────────────────────────────────────────────────
  # BLACK SEA PATTERNS (Coasters & Small Handy)
  # ─────────────────────────────────────────────────────────────────
  
  black_sea_to_marmara:
    vessel_opens: "Black Sea (POC, Danube, Constanta area)"
    cargo_loads: "Black Sea"
    cargo_discharges: "Marmara Sea (Turkey)"
    vessel_sizes: ["Small Coaster", "Coaster", "Small Handy"]
    score: 15
    confidence: 90
    reasoning: |
      This is THE primary trade pattern for Black Sea coasters.
      POC grain/minerals to Turkish/Marmara ports is the backbone trade.
    examples:
      - "Chornomorsk → Yarimca"
      - "Odessa → Istanbul (Marmara)"
      - "Constanta → Derince"
      
  black_sea_to_mediterranean:
    vessel_opens: "Black Sea"
    cargo_loads: "Black Sea"
    cargo_discharges: "Mediterranean (Libya, Egypt, Lebanon, Israel)"
    vessel_sizes: ["Coaster", "Small Handy"]
    score: 14
    confidence: 90
    reasoning: |
      Standard export route for Black Sea grain and minerals.
      Slightly less common than Marmara but still core business.
    examples:
      - "Chornomorsk → Alexandria"
      - "Constanta → Tripoli"
      
  black_sea_internal:
    vessel_opens: "Black Sea"
    cargo_loads: "Black Sea"
    cargo_discharges: "Black Sea"
    vessel_sizes: ["Small Coaster", "Coaster"]
    score: 13
    confidence: 85
    reasoning: |
      Internal Black Sea trades - less common than export routes.
      Examples: Bulgaria to Romania, Georgia coastal trades.

  # ─────────────────────────────────────────────────────────────────
  # BACKHAUL PATTERNS (High Favorability)
  # ─────────────────────────────────────────────────────────────────
  
  aegean_to_black_sea:
    vessel_opens: "Aegean Sea"
    cargo_loads: "Black Sea (POC, Danube)"
    vessel_sizes: ["Small Coaster", "Coaster", "Small Handy"]
    score: 12
    confidence: 90
    reasoning: |
      STRONG backhaul pattern. Vessels commonly discharge in Aegean
      (Turkish Aegean ports, Greek ports) and return to Black Sea for loading.
      This is a well-established trade flow.
    examples:
      - "Aliaga → Chornomorsk"
      - "Piraeus → Constanta"
    citations:
      - "Correction: Aegean vessels commonly find backhaul to Black Sea"
      
  adriatic_to_black_sea:
    vessel_opens: "Adriatic Sea"
    cargo_loads: "Black Sea (POC, Danube)"
    vessel_sizes: ["Small Coaster", "Coaster", "Small Handy"]
    score: 12
    confidence: 90
    reasoning: |
      STRONG backhaul pattern due to LACK of Adriatic backhaul cargoes.
      After discharging in Adriatic ports (Italy, Croatia, Albania),
      vessels commonly ballast to Black Sea as there are limited 
      outbound cargoes from Adriatic region.
    examples:
      - "Rijeka → Chornomorsk"
      - "Bar → Constanta"
    citations:
      - "Correction: Adriatic vessels often ballast to Black Sea due to lack of backhaul"
      
  east_med_to_black_sea:
    vessel_opens: "East Mediterranean"
    cargo_loads: "Black Sea (POC, Danube)"
    vessel_sizes: ["Coaster", "Small Handy"]
    score: 11
    confidence: 85
    reasoning: |
      Common backhaul pattern. After discharging in East Med ports
      (Egypt, Libya, Lebanon, Israel), many vessels return to Black Sea.
      Strong backhaul market exists.
    examples:
      - "Alexandria → Chornomorsk"
      - "Mersin → Constanta"
    citations:
      - "Correction: East Med vessels commonly return to Black Sea for backhaul"

  # ─────────────────────────────────────────────────────────────────
  # DANUBE-SPECIFIC PATTERNS (Complex Economics)
  # ─────────────────────────────────────────────────────────────────
  
  danube_port_to_poc:
    vessel_opens: "Danube River ports (Braila, Reni, Izmail, Giurgiulesti)"
    vessel_opens_NOT: "Sulina Anchorage"
    cargo_loads: "POC (Chornomorsk, Pivdennyi, Odessa)"
    vessel_sizes: ["Small Coaster", "Coaster"]
    score: 8
    confidence: 90
    reasoning: |
      SECONDARY option. If vessel is already IN Danube port, it has
      paid high costs to enter (Sulina Bar transit fees, pilotage).
      Owners will PREFER to find cargo FROM Danube ports first to
      recoup these entry costs. Shifting to POC is possible but not ideal.
    key_principle: "Already paid Danube entry costs → seeks Danube cargo first"
    examples:
      - "Vessel at Braila → Chornomorsk loading"
      - "Vessel at Izmail → Chornomorsk loading"
    citations:
      - "Correction 1 (akdeniz): Danube vessels prefer Danube cargo to offset Sulina costs"
      
  sulina_anchorage_to_poc:
    vessel_opens: "Sulina Anchorage"
    cargo_loads: "POC (Chornomorsk, Pivdennyi, Odessa)"
    vessel_sizes: ["Small Coaster", "Coaster"]
    score: 14
    confidence: 90
    reasoning: |
      HIGH favorability. Sulina is a WAITING AREA / ANCHORAGE where
      vessels wait for either:
      a) Entry into Danube River, OR
      b) Direct call to POC ports
      
      From Sulina, POC and Danube are EQUAL choices - vessel has not
      yet committed to either direction. Distance to POC is minimal (~80nm).
    key_principle: "Sulina = neutral waiting area, POC and Danube equally viable"
    examples:
      - "Vessel at Sulina anchorage → Chornomorsk"
    citations:
      - "Correction 3 (eleanora): Sulina vessels can proceed to POC or Danube equally"
      
  heading_to_danube_to_poc:
    vessel_opens: "In transit, destination = Danube port"
    cargo_loads: "POC (Chornomorsk, Pivdennyi, Odessa)"
    vessel_sizes: ["Small Coaster", "Coaster"]
    score: 7
    confidence: 85
    reasoning: |
      LOW favorability. If vessel is HEADING TO (destination set to)
      a Danube port, it indicates owners have already chosen to enter
      Danube. Redirecting to POC is possible but requires changing plans.
    key_principle: "Vessel already committed to Danube direction"
    examples:
      - "Vessel heading to Izmail → Chornomorsk loading"
    warning: |
      AI should also ask owner to clarify if vessel is really opening
      in Danube or if it's loading there and will open elsewhere.

  # ─────────────────────────────────────────────────────────────────
  # GEOPOLITICAL RESTRICTIONS
  # ─────────────────────────────────────────────────────────────────
  
  russian_black_sea_to_ukraine:
    vessel_opens: "Russian Black Sea (Novorossiysk, Kavkaz, Kerch, Taman)"
    cargo_loads: "Ukraine (POC)"
    vessel_sizes: ["ALL"]
    score: 2
    confidence: 90
    reasoning: |
      MINIMAL viability due to geopolitical situation (Russia-Ukraine war,
      sanctions). Vessels opening in Russian Black Sea ports will seek
      Russian cargoes. Extremely unlikely to position to Ukrainian ports.
    key_principle: "Geopolitical barriers prevent Russian → Ukraine trades"
    examples:
      - "Novorossiysk → Chornomorsk (highly unlikely)"
    citations:
      - "Correction: Russian Black Sea vessels will seek Russian cargo, not Ukraine"
      
  ukraine_to_russian_black_sea:
    vessel_opens: "Ukraine (POC)"
    cargo_loads: "Russian Black Sea"
    vessel_sizes: ["ALL"]
    score: 2
    confidence: 90
    reasoning: |
      Same geopolitical barriers apply in reverse direction.
      Sanctions and war situation prevent normal trade flows.

  # ─────────────────────────────────────────────────────────────────
  # MEDIUM-DISTANCE PATTERNS
  # ─────────────────────────────────────────────────────────────────
  
  west_med_to_black_sea:
    vessel_opens: "West Mediterranean (Spain, France, Algeria, Morocco)"
    cargo_loads: "Black Sea"
    vessel_sizes: ["Coaster", "Small Handy"]
    score: 8
    confidence: 75
    reasoning: |
      Longer ballast leg (~2000nm) but viable for right freight rates.
      More common for Small Handy size, less for pure coasters.
    examples:
      - "Barcelona → Chornomorsk"
      
  atlantic_to_black_sea:
    vessel_opens: "Atlantic (Portugal, UK, Morocco Atlantic coast)"
    cargo_loads: "Black Sea"
    vessel_sizes: ["Small Handy", "Handy"]
    score: 6
    confidence: 70
    reasoning: |
      Long ballast (~3000nm). Requires strong freight incentive.
      Only viable for larger vessels or exceptional market conditions.
      
  west_africa_to_black_sea:
    vessel_opens: "West Africa (Senegal, Ivory Coast, Ghana, Nigeria)"
    cargo_loads: "Black Sea"
    vessel_sizes: ["Coaster"]
    score: 0
    confidence: 90
    reasoning: |
      Commercially non-viable for coasters. Distance ~4200nm creates
      prohibitive ballast costs. Would only occur for larger vessels
      or very exceptional circumstances.
    examples:
      - "Dakar → Chornomorsk (not viable for 7k coaster)"
    citations:
      - "Correction 7 (ak beauty): West Africa ballast non-viable for coaster"

# ═══════════════════════════════════════════════════════════════════
# VESSEL SIZE ADJUSTMENTS
# ═══════════════════════════════════════════════════════════════════

vessel_size_adjustments:
  
  principle: |
    Larger vessels can absorb longer ballast legs due to:
    - Higher earning potential per voyage
    - Lower ballast cost as % of revenue
    - More strategic positioning behavior
  
  adjustment_multipliers:
    description: |
      For patterns with distance-based scoring penalties,
      apply these multipliers based on vessel size:
    
    small_coaster_3_6k:
      range: "3000-6000 DWT"
      multiplier: 0.8
      effect: "MORE sensitive to distance - reduce score by 20%"
      
    coaster_6_8k:
      range: "6000-8000 DWT"
      multiplier: 1.0
      effect: "BASELINE - no adjustment"
      
    small_handy_8_17k:
      range: "8000-17000 DWT"
      multiplier: 1.15
      effect: "LESS sensitive - increase score by 15%"
      
    handy_17_24k:
      range: "17000-24000 DWT"
      multiplier: 1.3
      effect: "Much less sensitive - increase score by 30%"
      
    large_handy_plus:
      range: "24000+ DWT"
      multiplier: 1.5
      effect: "Least sensitive - increase score by 50%"
  
  application_example:
    pattern: "Adriatic to Black Sea"
    base_score: 12
    
    for_small_coaster:
      calculation: "12 × 0.8 = 9.6"
      final_score: 10
      
    for_coaster:
      calculation: "12 × 1.0 = 12"
      final_score: 12
      
    for_small_handy:
      calculation: "12 × 1.15 = 13.8"
      final_score: 14
      
    for_handy:
      calculation: "12 × 1.3 = 15.6"
      final_score: 15
      
  patterns_requiring_adjustment:
    - "adriatic_to_black_sea"
    - "east_med_to_black_sea"
    - "aegean_to_black_sea"
    - "west_med_to_black_sea"
    - "atlantic_to_black_sea"
    
  patterns_NOT_requiring_adjustment:
    - "black_sea_to_marmara" (already optimal)
    - "sulina_anchorage_to_poc" (very short distance)
    - "russian_black_sea_to_ukraine" (geopolitical, not economic)

# ═══════════════════════════════════════════════════════════════════
# SPECIAL CONSIDERATIONS
# ═══════════════════════════════════════════════════════════════════

special_rules:
  
  mediterranean_internal_trades:
    description: |
      For Med → Med trades (e.g., Egypt → Turkey, Libya → Italy):
    score_range: "11-13"
    reasoning: "Regional trade, economically viable but not as strong as Black Sea export routes"
    
  marmara_internal_trades:
    description: |
      Turkish Marmara → Turkish Marmara or Aegean
    score_range: "12-13"
    reasoning: "Turkish domestic trades, common for coasters"
    
  positioning_after_discharge:
    description: |
      If vessel has a known discharge port with ETA, and cargo loading
      is in a different region, consider the DISCHARGE port as the
      effective opening position for P1A scoring.
    example: |
      Vessel: "Current area: Aegean, Destination: Mersin (ETA Jan 25)"
      Cargo: Loads from Chornomorsk (Feb 5)
      
      Apply: "east_med_to_black_sea" pattern (score: 11)
      NOT: "aegean_to_black_sea" (vessel will be in East Med when ready)

# ═══════════════════════════════════════════════════════════════════
# AI REASONING TEMPLATES
# ═══════════════════════════════════════════════════════════════════

reasoning_templates:
  
  template_strong_pattern:
    score_range: "12-15"
    format: |
      "[Opening Region] to [Loading Region] is a [strong/primary] trade pattern 
      for [vessel size] vessels. [Specific reasoning: backhaul availability / 
      core trade route / etc.]"
    example: |
      "Aegean to Black Sea is a strong backhaul pattern for Coaster vessels. 
      Many vessels discharge in Turkish Aegean ports and return to Black Sea 
      for grain loading."
      
  template_secondary_pattern:
    score_range: "7-11"
    format: |
      "[Opening Region] to [Loading Region] is a [viable/secondary] option for 
      [vessel size]. [Specific challenges: distance / economics / alternatives]"
    example: |
      "Danube port to POC is a secondary option. Vessel has already paid Sulina 
      transit costs and will prioritize finding cargo from Danube ports first."
      
  template_weak_pattern:
    score_range: "0-6"
    format: |
      "[Opening Region] to [Loading Region] is [unfavorable/unlikely] due to 
      [specific reason: distance / geopolitics / economics]"
    example: |
      "Russian Black Sea to Ukraine is highly unlikely due to geopolitical 
      situation (sanctions, war). Vessel will seek Russian cargoes instead."

# ═══════════════════════════════════════════════════════════════════
# CRITICAL AI INSTRUCTIONS
# ═══════════════════════════════════════════════════════════════════

ai_must:
  - "ALWAYS check this file for explicit pattern matches before scoring P1A"
  - "NEVER assume a pattern is good/bad without checking explicit rules"
  - "Apply vessel size adjustments for distance-based patterns"
  - "Consider special cases (Danube, Russian ports, discharge positioning)"
  - "Cite specific pattern name in reasoning (e.g., 'aegean_to_black_sea pattern')"
  - "If pattern not found in this file, use conservative middle score (8-10) and note uncertainty"

ai_must_not:
  - "Never assume 'close distance = automatically good regional pattern'"
  - "Never ignore Danube economics (Sulina costs matter!)"
  - "Never ignore geopolitical restrictions (Russia-Ukraine)"
  - "Never use vague reasoning like 'regional trade is good' - be specific"

# ═══════════════════════════════════════════════════════════════════
# CONFIDENCE LEVELS
# ═══════════════════════════════════════════════════════════════════

confidence_guidelines:
  
  high_confidence_90:
    when: "Pattern explicitly defined in this file with clear examples"
    patterns:
      - "black_sea_to_marmara"
      - "sulina_anchorage_to_poc"
      - "russian_black_sea_to_ukraine"
      - "aegean_to_black_sea"
      - "adriatic_to_black_sea"
      
  medium_confidence_85:
    when: "Pattern defined but with some variability in market conditions"
    patterns:
      - "danube_port_to_poc"
      - "east_med_to_black_sea"
      - "heading_to_danube_to_poc"
      
  lower_confidence_70_75:
    when: "Longer distance patterns, market-dependent, or edge cases"
    patterns:
      - "west_med_to_black_sea"
      - "atlantic_to_black_sea"

# ═══════════════════════════════════════════════════════════════════
# END OF P1A REGIONAL SCORING RULES
# ═══════════════════════════════════════════════════════════════════


--- START OF estimator-prompts/P2A_PSC_PORT_ACCESSIBILITY_SCORING.txt ---
================================================================================
P2A — PSC PORT ACCESSIBILITY SCORING
Version: 4.0
Last updated: 2026-02-07
================================================================================

PURPOSE:
  Evaluate whether the vessel can safely call at the cargo's loading and 
  discharge ports without excessive PSC (Port State Control) risk. Considers
  vessel's class, P&I, age, flag, and inspection history against port 
  strictness tiers.

SCORE RANGE: [0, 20]
ALWAYS ACTIVE: This criterion always has max_score = 20

================================================================================
PORT STRICTNESS TIERS
================================================================================

  TIER 1 — Very Strict (high detention risk)
  ─────────────────────────────────────────
    Countries: Italy, France, Greece, Spain, Portugal, Belgium, Netherlands,
               Germany, UK, Ireland, Norway, Sweden, Denmark, Finland,
               Australia, New Zealand, Canada, Japan, South Korea
    
  TIER 2 — Moderate Strict
  ─────────────────────────────────────────
    Countries: Turkey, Croatia, Slovenia, Montenegro, Albania, 
               Romania, Bulgaria, Egypt (Suez/Alex)
               
  TIER 3 — Moderate Tolerant
  ─────────────────────────────────────────
    Countries: Ukraine, Russia (Black Sea ports), Georgia, 
               Tunisia, Algeria, Morocco, Libya, Lebanon, Syria
               
  TIER 4 — Lax (low detention risk)
  ─────────────────────────────────────────
    Countries: Most West Africa, India, Bangladesh, Pakistan,
               most Southeast Asia, Central America, South America

================================================================================
VESSEL STATUS CATEGORIES
================================================================================

  HIGH STATUS — Score bonus for strict ports
    Class: IACS member (BV, LR, DNV, ABS, ClassNK, RINA, CCS, KR, RS, PRS, CRS, IRS)
    P&I: Top-tier IG club (Gard, Skuld, UK P&I, West of England, etc.)
    Flag: White list (Paris MOU) — EU flags, Marshall Islands, Bahamas,
          Panama, Liberia, Singapore, Hong Kong, Japan, Norway
    Age: < 15 years
    
    Note: Vessel qualifies as HIGH if it meets MOST criteria (3 out of 4).
    
  MEDIUM STATUS — Standard scoring
    Class: IACS or recognized non-IACS (Turkish Lloyd, Indian Register, etc.)
    P&I: Some P&I coverage (not necessarily IG)
    Flag: Grey list or non-blacklisted flag
    Age: 15-25 years
    
    Note: Default category. Most Black Sea/Med coasters fall here.
    
  LOW STATUS — Penalty for strict ports
    Class: Non-IACS / unknown / expired
    P&I: No P&I or unknown
    Flag: Black list (Paris MOU) or flag of convenience with poor record
    Age: > 25 years
    
    Note: Any ONE critical deficiency (no class, no P&I, blacklisted flag)
    can push vessel to LOW status.

  FLAG LISTS (Paris MOU — simplified):
    White list (good): Most EU flags, Marshall Islands, Bahamas, Singapore,
      Hong Kong, Japan, Norway, Panama (generally), Liberia
    Grey list (watch): Some flags with moderate detention rates
    Black list (bad): Flags with consistently high detention rates
    
    Note: Paris MOU flag lists are updated annually. When in doubt,
    treat unknown flags as Grey list.

================================================================================
BASE SCORING MATRIX
================================================================================

  Port Tier 1 (Very Strict):
    HIGH status:   16-20/20
    MEDIUM status: 10-14/20
    LOW status:    2-6/20 (potential BLOCK if critical deficiency)

  Port Tier 2 (Moderate Strict):
    HIGH status:   18-20/20
    MEDIUM status: 14-17/20
    LOW status:    6-10/20

  Port Tier 3 (Moderate Tolerant):
    HIGH status:   20/20
    MEDIUM status: 16-19/20
    LOW status:    10-14/20

  Port Tier 4 (Lax):
    HIGH status:   20/20
    MEDIUM status: 18-20/20
    LOW status:    14-18/20

================================================================================
PORT HISTORY BONUS
================================================================================

  If the vessel has RECENT successful calls at ports in the SAME TIER or 
  HIGHER (stricter) tier as the cargo ports, apply a bonus.
  
  RULES:
    - Bonus applies to SAME tier AND lower (less strict) tiers
    - Bonuses do NOT stack — use highest applicable only
    - "Recent" = within last 12 months of port history
    - We do NOT have detention data — do not require "no detention"

  BONUS VALUES:
  
    Tier 1 history: +3 for ALL tiers (1, 2, 3, 4)
    Tier 2 history: +2 for Tier 2, 3, 4 only (NOT Tier 1)
    Tier 3 history: +1 for Tier 3, 4 only
    Tier 4 history: No bonus

  EXAMPLES:
    Vessel called Ravenna (Italy, Tier 1) → +3 for everything
    Vessel called Istanbul (Turkey, Tier 2) → +2 for Tier 2/3/4, NOT Tier 1
    Vessel called BOTH Naples AND Samsun → use Naples (+3), don't stack

  BONUS CAP: Total P2A score cannot exceed 20

================================================================================
SCORING FOR MULTIPLE PORTS
================================================================================

  When cargo has both loading and discharge ports:
    - Score each port separately (status + tier + bonus)
    - Final P2A = weighted average (load port 60%, discharge port 40%)
    - If either port results in BLOCK → entire P2A is BLOCK
    
  Show both port scores in reasoning for transparency.

================================================================================
BLOCK CONDITIONS
================================================================================

  - LOW status vessel + Tier 1 port + no port history bonus → BLOCK
  - Vessel on Paris MOU blacklist + any EU port → BLOCK
  - No class certificate + Tier 1 or 2 port → BLOCK

================================================================================
OFFER HINTS
================================================================================

  High score (16+): null
  Medium score (10-15): "PSC risk manageable — vessel [class/age/flag] may 
    draw attention at [port]."
  Low score (<10): "Significant PSC risk at [port]."
  BLOCK: "Cannot safely call at [port] — do not offer."

================================================================================
AI INSTRUCTIONS
================================================================================

  ai_must:
    - Determine vessel status (HIGH/MEDIUM/LOW) based on class, P&I, flag, age
    - Look up port tiers for ALL cargo ports
    - Check vessel port history for bonus eligibility
    - Apply highest applicable bonus (no stacking)
    - Score using the matrix
    - Show BOTH port scores when cargo has 2 ports
    
  ai_must_not:
    - ❌ Never require "no detention" data (we don't have it)
    - ❌ Never stack multiple port history bonuses
    - ❌ Never apply Tier 2 bonus to Tier 1 ports
    - ❌ Never block solely based on age
    - ❌ Never confuse P2A with P8 (P2A = PSC risk, P8 = cargo restrictions)

================================================================================


--- START OF estimator-prompts/P4_LAST_PORTS_SCORING.txt ---
================================================================================
P4 — LAST PORTS / PORT HISTORY SCORING
Version: 1.0
Last updated: 2026-02-07
================================================================================

PURPOSE:
  Score vessel's familiarity with the cargo's loading and discharge regions
  based on port call history. Vessels that regularly call at or near the
  cargo ports are more likely to be interested and operationally prepared.

SCORE RANGE: [0, 10]
ALWAYS ACTIVE: max_score = 10

================================================================================
DATA SOURCES
================================================================================

  Primary: top_ports array from vessel data
    Format: [{"port": "Poti", "percentage": 8.7}, ...]
    Shows historical port call distribution by percentage
    
  Secondary: Recent port call list (if available)
    Specific ports visited with dates

================================================================================
SCORING LOGIC
================================================================================

  Check vessel's port history against BOTH loading port and discharge port.
  Use the BETTER match (higher score) as the base, then apply bonuses.

  LEVEL 1 — EXACT PORT MATCH (8-10/10)
  ─────────────────────────────────────────
    Vessel has called at the exact loading or discharge port.
    
    High frequency (>5% of calls): 10/10
    Medium frequency (2-5% of calls): 9/10
    Low frequency (<2% or just once): 8/10
    
    offer_hint: "Vessel regularly calls at [port] — mention familiarity."

  LEVEL 2 — SAME SUB-REGION (5-7/10)
  ─────────────────────────────────────────
    Vessel hasn't called at exact port but has history in the same 
    sub-region or country.
    
    Sub-region definitions:
      POC group: Odessa, Chornomorsk, Pivdennyi (all count as same)
      Danube group: Izmail, Reni, Braila, Galati (all count as same)
      CVB group: Constanta, Varna, Burgas
      Turkish BS: Samsun, Trabzon, Zonguldak, Eregli
      Turkish Med: Mersin, Iskenderun, Antalya
      Marmara: Istanbul, Derince, Gemlik, Yarimca
      East Med: Alexandria, Damietta, Beirut, Haifa, Ashdod, Limassol
      North Africa: Tunis, Bizerte, Sfax, Sousse, Tripoli (Libya)
      Adriatic: Ravenna, Venice, Trieste, Rijeka, Bar, Durres
      Aegean: Piraeus, Thessaloniki, Izmir, Aliaga, Nemrut Bay
      West Med: Barcelona, Valencia, Marseille, Genoa, Algiers
      
    High frequency in sub-region (>10% combined): 7/10
    Medium frequency (5-10% combined): 6/10
    Low frequency (<5% combined): 5/10
    
    offer_hint: "Vessel trades in [sub-region] — familiar with the area."

  LEVEL 3 — SAME BROAD REGION (3-4/10)
  ─────────────────────────────────────────
    Vessel has history in the broader region but not the specific 
    sub-region.
    
    Broad regions:
      Black Sea: all BS sub-regions
      Mediterranean: all Med sub-regions
      Atlantic/Continent: UK, NW Europe, Iberian peninsula
      
    Example: Cargo loads Ukraine, vessel history shows Turkish Med ports.
    Both are Eastern Mediterranean / Black Sea adjacent.
    
    Regular broad region caller: 4/10
    Occasional broad region caller: 3/10
    
    offer_hint: "Vessel trades in [broad region] — not exact area but 
                 familiar with regional operations."

  LEVEL 4 — NO RELEVANT HISTORY (5/10 — neutral)
  ─────────────────────────────────────────
    Vessel has no port history in the cargo's loading or discharge 
    regions. This is NEUTRAL — not negative.
    
    score = 5/10
    
    Rationale: No history doesn't mean vessel can't or won't go there.
    Many vessels trade globally or change patterns. Neutral score avoids
    unfair penalty for vessels entering a new trade area.
    
    offer_hint: null (no relevant history to mention)

  LEVEL 5 — CONFLICTING PATTERN (1-2/10)
  ─────────────────────────────────────────
    Vessel's history strongly suggests it operates in a completely 
    different trade area with no overlap.
    
    Example: 100% of calls in West Africa, cargo is Black Sea.
    Example: 100% of calls in Far East, cargo is Mediterranean.
    
    score = 1-2/10
    
    offer_hint: "Vessel primarily trades [other region] — unusual for 
                 this cargo area. Confirm interest before proceeding."

================================================================================
SCORING FOR BOTH PORTS
================================================================================

  When cargo has loading + discharge ports in different regions:
    - Score each port area separately
    - Use weighted average: loading port 60%, discharge port 40%
    - Round to nearest 0.5

  Example:
    Loading: Chornomorsk (Ukraine) — vessel has Odessa history → 10/10
    Discharge: Sfax (Tunisia) — no North Africa history → 5/10
    P4 = (10 × 0.6) + (5 × 0.4) = 6.0 + 2.0 = 8.0/10

================================================================================
EXAMPLES
================================================================================

  Example 1: Strong match
    Vessel top_ports: Haifa 45.6%, Ashdod 15.8%, Mersin 12%
    Cargo: loads Chornomorsk, discharges Haifa
    
    Loading (Chornomorsk): No exact match, no Ukraine/BS history → 5/10
    Discharge (Haifa): Exact match, 45.6% frequency → 10/10
    P4 = (5 × 0.6) + (10 × 0.4) = 3.0 + 4.0 = 7.0/10
    offer_hint: "Vessel regularly calls Haifa — familiar with discharge port."

  Example 2: Regional match
    Vessel top_ports: Haifa 45%, Ashdod 16%, Mersin 12%
    Cargo: loads Chornomorsk, discharges Tunis
    
    Loading (Chornomorsk): No BS history → 5/10
    Discharge (Tunis): No exact match, but East Med history (Haifa/Ashdod/
      Mersin) is adjacent region → 3/10
    P4 = (5 × 0.6) + (3 × 0.4) = 3.0 + 1.2 = 4.2 → 4/10
    offer_hint: "Vessel trades East Med — Tunisia is adjacent but new area."

  Example 3: Perfect match
    Vessel top_ports: Constanta 22%, Chornomorsk 18%, Mersin 15%
    Cargo: loads Chornomorsk, discharges Mersin
    
    Loading: Exact match Chornomorsk 18% → 9/10
    Discharge: Exact match Mersin 15% → 9/10
    P4 = (9 × 0.6) + (9 × 0.4) = 5.4 + 3.6 = 9.0/10
    offer_hint: "Vessel regularly trades both ports — excellent fit."

  Example 4: No data
    Vessel: no top_ports data available
    score = 5/10 (neutral)
    confidence = "low"
    offer_hint: null

================================================================================
AI INSTRUCTIONS
================================================================================

  ai_must:
    - Check vessel port history against BOTH loading and discharge ports
    - Use sub-region groupings for nearby port matching
    - Apply weighted average (60% load, 40% discharge)
    - Give neutral 5/10 when no relevant history (not 0)
    - Consider adjacent regions (East Med ↔ Black Sea are related)
    
  ai_must_not:
    - ❌ Never give 0/10 just because exact port not in history
    - ❌ Never penalize vessel for having diverse port history
    - ❌ Never ignore discharge port (it contributes 40%)
    - ❌ Never treat "no data" as negative — it's neutral (5/10)
    - ❌ Never confuse P4 with P2 (P4 = history, P2 = owner preferences)

================================================================================


--- START OF estimator-prompts/P8_RESTRICTIONS_COMPLIANCE_SCORING.txt ---
================================================================================
P8 — RESTRICTIONS COMPLIANCE SCORING
Version: 2.0
Last updated: 2026-02-07
================================================================================

PURPOSE:
  Score how well the vessel complies with charterer/cargo restrictions.
  Restrictions come from the cargo/inquiry settings and define specific
  requirements the vessel must meet. Supports both hard (pass/fail) and
  gradual (scale) restrictions with per-restriction allocation.

SCORE RANGE: [0, 20]
DYNAMIC CRITERION: If no restrictions set → score = 0, max_score = 0 (excluded)

================================================================================
CRITICAL — WHAT P8 DOES AND DOES NOT COVER
================================================================================

  P8 COVERS ONLY these restriction types from cargo/inquiry settings:
    HARD: Class, P&I Club, IMO Class, Holds Type
    GRADUAL: DWT, Age, LOA, Beam

  P8 DOES NOT COVER — DO NOT SCORE THESE IN P8:
    ❌ Draft / draught restrictions → handled in P5 (Intake Calculator)
    ❌ Port physical limitations → handled in P5 via port_restrictions_map
    ❌ Vessel proximity / distance → handled in P1
    ❌ PSC / flag / inspection risk → handled in P2A
    ❌ Cargo type compatibility → handled in P3
    ❌ Owner regional preferences → handled in P2

  If cargo description mentions "draft 7.5m limit" — this is a P5 matter.
  AI must NOT create a draft restriction in P8.

================================================================================
NO RESTRICTIONS → EXCLUDED
================================================================================

  If the cargo/inquiry has NO restrictions from the 8 types above:
    score = 0
    max_score = 0
    reasoning = "No restrictions set — criterion excluded from scoring."
    offer_hint = null

================================================================================
RESTRICTION TYPES
================================================================================

  HARD RESTRICTIONS (pass/fail — no gradient):
  ─────────────────────────────────────────
  
    CLASS — Required classification society
      Pass: Vessel class matches required (e.g., IACS when IACS required)
      Fail: Vessel class doesn't match
      BLOCK: When class is explicitly required (e.g., "BV/LR/DNV only")
      
    P&I CLUB — Required P&I coverage
      Pass: Vessel has required P&I club or tier
      Fail: Vessel doesn't have required P&I
      BLOCK: When specific IG club is mandatory
      
    IMO CLASS — Required for dangerous goods
      Pass: Vessel has required IMO fitness (e.g., class 1.1, class 9)
      Fail: Vessel not certified for required IMO class
      BLOCK: Always when dangerous cargo requires specific IMO certification
      
    HOLDS TYPE — Box-shaped vs non-box
      Pass: Vessel hold type matches requirement
      Fail: Hold type doesn't match
      Note: Usually not a BLOCK, sometimes negotiable

  GRADUAL RESTRICTIONS (scale — degrees of compliance):
  ─────────────────────────────────────────
  
    DWT — Maximum deadweight tonnage
      Within limit: 100% of allocated points
      Within 5% over: 75% of allocated points
      Within 10% over: 50% of allocated points
      Over 10%: 0% of allocated points
      BLOCK: Over 15% of limit (vessel too big for berth/facility)
      
    AGE — Maximum vessel age
      ╔══════════════════════════════════════════════════════════════╗
      ║  CRITICAL: AGE NEVER TRIGGERS BLOCK. NEVER. NO EXCEPTIONS. ║
      ║  Age is ALWAYS negotiable with charterer. Even +10 years    ║
      ║  over limit = 0 points but vessel is still scoreable.      ║
      ╚══════════════════════════════════════════════════════════════╝
      Within limit: 100% of allocated points
      +1-2 years over: 75% of allocated points
      +3-5 years over: 50% of allocated points
      +5 years over: 0% of allocated points
      BLOCK: NEVER — age is always negotiable
      
    LOA — Maximum length overall
      Within limit: 100% of allocated points
      Within 5% over: 75% of allocated points
      Over 5%: 0% of allocated points
      BLOCK: LOA is usually physical limitation (berth length)
      
    BEAM — Maximum beam
      Within limit: 100% of allocated points
      Within 5% over: 75% of allocated points
      Over 5%: 0% of allocated points
      Note: Less commonly restricted

================================================================================
SCORING FORMULA
================================================================================

  1. Count active restrictions (ONLY from the 8 types listed above)
     Do NOT invent additional restriction types.
  
  2. Allocate points equally:
     points_per_restriction = 20 / number_of_active_restrictions
     
  3. Score each restriction:
  
     HARD restriction:
       Pass → full allocated points
       Fail → 0 points (+ potential BLOCK if critical)
       
     GRADUAL restriction:
       Full pass (within limit) → 100% of allocated points
       Close (within 5% for DWT/LOA/Beam, +1-2yr for Age) → 75%
       Marginal (within 10% for DWT, +3-5yr for Age) → 50%
       Fail (beyond thresholds) → 0%
       
  4. Sum all restriction scores
  
  5. Check for BLOCK conditions (NEVER for age)

================================================================================
BLOCK CONDITIONS
================================================================================

  FULL VESSEL BLOCK (do not offer):
    - Hard fail on Class when charterer EXPLICITLY requires specific class
    - Hard fail on IMO when cargo is classified dangerous goods
    - DWT exceeds limit by more than 15%
    - LOA exceeds limit by more than 5% (physical berth limitation)

  NEVER BLOCK (scored 0 but vessel remains scoreable):
    - Age over limit — ALWAYS negotiable, no matter how much over
    - Holds type mismatch — often negotiable
    - DWT within 15% over — negotiable with charterer
    - P&I not matching preference — usually negotiable
    - Beam over limit — usually negotiable

================================================================================
EXAMPLES
================================================================================

  EXAMPLE 1: Three restrictions, all pass
  ─────────────────────────────────────────
    Restrictions: DWT max 12000, Age max 20 years, Class IACS
    3 restrictions → 20/3 = 6.67 pts each
    
    Vessel: DWT 11,500 (pass), Age 18 (pass), Class BV (IACS, pass)
    Score: 6.67 + 6.67 + 6.67 = 20/20
    offer_hint: null (all restrictions met)

  EXAMPLE 2: Age +2 years over — NOT a block
  ─────────────────────────────────────────
    Restrictions: Age max 25 years, DWT max 18000
    2 restrictions → 10 pts each
    
    Vessel: Age 27 (+2yr over), DWT 16,000 (pass)
    Age: 10 × 0.75 = 7.5 (gradual, +1-2yr = 75%)
    DWT: 10 × 1.0 = 10.0 (within limit)
    Score: 7.5 + 10.0 = 17.5/20
    Decision: "accepted" — NOT blocked
    offer_hint: "Vessel is 2 years over age limit — negotiable. 
                 Emphasize vessel condition and recent survey dates."

  EXAMPLE 3: Age +7 years over — STILL not a block
  ─────────────────────────────────────────
    Restrictions: Age max 20 years
    1 restriction → 20 pts
    
    Vessel: Age 27 (+7yr over)
    Age: 20 × 0.0 = 0 (beyond +5yr)
    Score: 0/20
    Decision: "accepted" with very low score — NOT blocked
    offer_hint: "Vessel significantly over age limit. Offer only if 
                 market is tight and condition is excellent."

  EXAMPLE 4: Mixed results
  ─────────────────────────────────────────
    Restrictions: DWT max 12000, Age max 20, Class IACS
    3 restrictions → 6.67 pts each
    
    Vessel: DWT 12,400 (5% over), Age 22 (+2yr), Class non-IACS (fail)
    DWT: 6.67 × 0.75 = 5.0
    Age: 6.67 × 0.75 = 5.0
    Class: 0 (fail)
    Score: 10/20
    offer_hint: "Non-IACS class — expect pushback. DWT and age close 
                 to limits but acceptable."

  EXAMPLE 5: IMO BLOCK
  ─────────────────────────────────────────
    Restrictions: IMO class 9 required, DWT max 15000
    2 restrictions → 10 pts each
    
    Vessel: No IMO cert (fail → BLOCK), DWT 14,500 (pass)
    Score: BLOCK
    offer_hint: "Vessel not certified for IMO cargo — do not offer."

  EXAMPLE 6: Cargo has draft restriction — NOT scored in P8
  ─────────────────────────────────────────
    Cargo description: "Age max 25 years, draft 7.5m limit"
    
    P8 restrictions: Age max 25 years ONLY (1 restriction → 20 pts)
    Draft 7.5m → goes to P5 (Intake Calculator), NOT P8
    
    Vessel: Age 27 (+2yr over)
    Age: 20 × 0.75 = 15
    Score: 15/20
    Decision: "accepted"

================================================================================
OUTPUT FORMAT
================================================================================

  "restrictions_compliance": {
    "code": "P8",
    "score": 17.5,
    "max_score": 20,
    "reasoning": "2 restrictions checked. DWT pass, Age +2yr (75%). No blocks.",
    "offer_hint": "Age 2yr over limit — negotiable, mention condition.",
    "restrictions_checked": [
      "DWT 16000 vs max 18000: PASS (100%)",
      "Age 27 vs max 25: MARGINAL +2yr (75%)"
    ],
    "decision": "accepted",
    "confidence": "high",
    "critical": false,
    "citations": ["cargo restriction: age max 25, vessel built: 1999"]
  }

================================================================================
AI INSTRUCTIONS
================================================================================

  ai_must:
    - Check ONLY the 8 restriction types listed in this file
    - Score each restriction individually with percentage
    - Show restrictions_checked array in output
    - Apply BLOCK only for: Class/IMO hard fail, DWT >15%, LOA >5%
    - Generate offer_hint when restrictions are close to limits
    
  ai_must_not:
    - ❌ NEVER BLOCK vessel for age — age is ALWAYS negotiable
    - ❌ NEVER BLOCK vessel for age even combined with other fails
    - ❌ NEVER score draft/draught in P8 — draft belongs in P5
    - ❌ NEVER invent restriction types beyond the 8 listed
    - ❌ NEVER assume "IACS required" unless explicitly stated
    - ❌ NEVER apply P8 when no restrictions exist (use 0/0)
    - ❌ NEVER count draft as a "restriction" in P8

================================================================================


--- START OF estimator-prompts/READINESSETA_TO_LOADING_PORT_SCORING.txt ---
================================================================================
READINESS / ETA TO LOADING PORT SCORING — P7
Version: 4.0
Last updated: 2026-02-07
================================================================================

PURPOSE:
  Score how well the vessel's availability timing matches the cargo laycan.
  Integrates draught analysis to determine if vessel needs operations buffer.

SCORE RANGE: [0, 10]
ALWAYS ACTIVE: max_score = 10

================================================================================
STEP 1 — MANDATORY DRAUGHT ANALYSIS
================================================================================

  ╔══════════════════════════════════════════════════════════════════╗
  ║  CRITICAL: AI MUST perform draught analysis BEFORE calculating  ║
  ║  vessel_ready date. Without this step, P7 score may be wrong.  ║
  ║  See vessel_location_determination.txt for full details.       ║
  ╚══════════════════════════════════════════════════════════════════╝

  DRAUGHT RATIO FORMULA:
    draught_ratio = current_draught / max_draft
    
    Fields: current-draught (from AIS/VesselFinder), draft (vessel specs)

  THRESHOLDS:
    ratio < 0.65  → BALLAST (vessel empty, heading to load)
    ratio >= 0.65 → LADEN (vessel carrying cargo, heading to discharge)
    current > max → OVER_DRAFT (data anomaly, treat as LADEN)
    
  If current_draught is NOT available:
    Default to LADEN (conservative) and note in reasoning.

================================================================================
STEP 2 — DETERMINE VESSEL READY DATE
================================================================================

  A) Vessel is OPEN with a date:
     Example: "open Montoir Feb 17"
     vessel_ready = Feb 17 (use as-is)
     No buffer needed — vessel stated as open.
     
  B) Vessel has destination + ETA:
     Perform draught analysis first, then:
     
     If BALLAST (ratio < 0.65):
       vessel_ready = ETA
       Note: "Vessel in ballast — no operations buffer. Confirm with 
              owner if heading for loading or available for redirection."
              
     If LADEN (ratio >= 0.65):
       vessel_ready = ETA + 7 days
       Note: "Vessel laden — adding 7 days buffer (discharge + preparation)."
              
     If OVER_DRAFT (current > max):
       vessel_ready = ETA + 7 days
       Note: "Draught exceeds max (data anomaly) — treating as laden, +7d."

  C) Vessel has no destination/ETA:
     Estimate sailing time from current position to loading port.
     Use average speed 10-12 knots. Add 1 day port entry buffer.
     confidence = "low"

================================================================================
STEP 3 — CALCULATE GAP
================================================================================

  gap = vessel_ready - cargo_layday (start of laycan)
  
  Positive gap = vessel is late (arrives AFTER layday)
  Negative gap = vessel is early (arrives BEFORE layday)
  Zero = perfect timing

================================================================================
STEP 4 — SCORING MATRIX
================================================================================

  gap <= -7 days (very early):
    score = 4/10
    Vessel idle too long. Owner may lose interest.
    offer_hint: "Vessel ready much earlier — suggest flexibility on dates."

  gap = -6 to -3 days (early):
    score = 7/10
    Slight wait but manageable.
    offer_hint: "Ready a few days early — timing works."

  gap = -2 to +1 days (ideal window):
    score = 10/10
    Perfect timing.
    offer_hint: "Timing aligns perfectly — highlight in opening."

  gap = +2 to +3 days (slightly late):
    score = 7/10
    Acceptable if flexible.
    offer_hint: "Timing slightly tight — mention laycan flexibility."

  gap = +4 to +5 days (late):
    score = 4/10
    Risky, may miss canceling.
    offer_hint: "Timing tight — offer only if laycan may extend."

  gap = +6 to +7 days (very late):
    score = 2/10
    Likely misses canceling.
    offer_hint: "Likely misses canceling — only if extension confirmed."

  gap > +7 days (past canceling):
    score = 0/10, decision = BLOCK
    offer_hint: "Cannot meet laycan — do not offer."

================================================================================
SPECIAL CASES
================================================================================

  BALLAST QUESTION:
    When vessel is in ballast heading somewhere:
    - Score using ETA (without +7 days)
    - Add question to offer: confirm if fixed or open
    - offer_hint includes: "Vessel appears in ballast — confirm with 
      owner if proceeding for loading or available for redirection."

  NO ETA AVAILABLE:
    - Estimate sailing time from current position
    - Use 10-12 knots average speed + 1 day buffer
    - Score with low confidence
    
  VESSEL AT ANCHOR (no destination):
    - If at/near load port area → vessel_ready = today/tomorrow
    - If elsewhere → estimate sailing time
    - Check if waiting for cargo, berth, or instructions

================================================================================
EXAMPLES
================================================================================

  Example 1: Laden vessel (draught analysis applied)
    Vessel heading Ravenna, ETA Feb 13
    current_draught = 8.8m, max_draft = 8.6m
    draught_ratio = 8.8/8.6 = 1.023 → OVER_DRAFT → treat as LADEN
    vessel_ready = Feb 13 + 7 = Feb 20
    Cargo layday = Feb 5, canceling = Feb 10
    gap = Feb 20 - Feb 5 = +15 days → score = 0/10, BLOCK
    reasoning: "Draught 8.8m > max 8.6m (over_draft, treat as laden). 
               After +7d operations buffer: ready Feb 20. Misses laycan by 15 days."

  Example 2: Ballast vessel (draught analysis applied)
    Vessel heading Mersin, ETA Feb 10
    current_draught = 2.1m, max_draft = 5.2m
    draught_ratio = 2.1/5.2 = 0.404 → BALLAST
    vessel_ready = Feb 10 (no buffer)
    Cargo layday = Feb 8, canceling = Feb 15
    gap = Feb 10 - Feb 8 = +2 days → score = 7/10
    reasoning: "Vessel in ballast (ratio 0.40). No operations buffer.
               Ready Feb 10, gap +2 days — acceptable timing."

  Example 3: Open vessel
    Vessel open Constanta Feb 12
    vessel_ready = Feb 12 (stated opening)
    Cargo layday = Feb 14, canceling = Feb 20
    gap = Feb 12 - Feb 14 = -2 days → score = 10/10
    reasoning: "Open Constanta Feb 12, gap -2 days — ideal timing."

  Example 4: No draught data
    Vessel heading Istanbul, ETA Feb 8. No current_draught available.
    → Default to LADEN (conservative)
    vessel_ready = Feb 8 + 7 = Feb 15
    Cargo layday = Feb 12
    gap = +3 days → score = 7/10
    reasoning: "No draught data — defaulting to laden (+7d buffer).
               Ready Feb 15, gap +3 days. Confirm actual status."
    confidence = "medium"

================================================================================
AI INSTRUCTIONS
================================================================================

  ai_must:
    - ALWAYS perform draught analysis before calculating vessel_ready
    - Show draught_ratio and ballast/laden determination in reasoning
    - Apply +7 days buffer for LADEN vessels, 0 days for BALLAST
    - Default to LADEN when draught data is missing
    - Include draught status in offer_hint when relevant
    
  ai_must_not:
    - ❌ Never skip draught analysis when current_draught is available
    - ❌ Never assume vessel is in ballast without checking ratio
    - ❌ Never forget +7 days buffer for laden vessels
    - ❌ Never score P7 without first determining vessel_ready date
    - ❌ Never ignore OVER_DRAFT condition (treat as laden)

================================================================================


--- START OF estimator-prompts/estimation-template-example.md ---
# Estimation Template — JSON Output Format
## Version 5.0 — Updated 2026-02-07

This file defines the expected JSON output format for vessel scoring results.
AI should produce output matching this structure.

---

## Critical Rules

1. **total_score is ALWAYS a percentage** (0-100), never raw points
2. **ALL criteria must appear** in detailed_scoring, even excluded ones (0/0)
3. **Draft restrictions go to P5**, never to P8
4. **Age NEVER triggers BLOCK** in P8

---

## Top-Level Structure

```json
{
  "vessel_name": "MV EXAMPLE",
  "total_score": 81.1,
  "total_score_raw": 73,
  "dynamic_max_score": 90,
  "confidence": 85,
  "confidence_note": "High confidence. P2, P3, P6, P8 excluded (no data).",
  "recommendation": "STRONG",
  "short_summary": "Excellent match — well positioned, good timing, cargo fits nicely.",
  
  "relationship_warning": {
    "status": "CLEAR"
  },
  
  "offer_opening": {
    "intent": "attract",
    "email_text": "Pls find below cargo which suits mv Example nicely — she's well positioned and timing works. Kindly let us know yr interest/ideas.",
    "messenger_text": "have a nice cargo for Example — close by, good timing. pls see below, lmk?",
    "key_selling_points": ["proximity", "timing"],
    "key_concerns": [],
    "questions_to_ask": []
  },
  
  "detailed_scoring": {
    
    "proximity": {
      "code": "P1",
      "score": 14.0,
      "max_score": 20,
      "reasoning": "Constanta, ~150nm from Chornomorsk. Level 4 — short ballast.",
      "offer_hint": "Great positioning — lead with 'well positioned nearby'.",
      "decision": "accepted",
      "confidence": "high",
      "critical": false,
      "citations": ["ref:proximity_scoring_matrix.txt Level 4"]
    },
    
    "regional_patterns": {
      "code": "P1A",
      "score": 12,
      "max_score": 15,
      "reasoning": "BS internal — strong natural trade flow for coasters.",
      "offer_hint": "Natural trade pattern — mention backhaul opportunity.",
      "decision": "accepted",
      "confidence": "high",
      "critical": false,
      "citations": ["ref:P1A black_sea_internal"]
    },
    
    "owner_preferences": {
      "code": "P2",
      "score": 0,
      "max_score": 0,
      "reasoning": "No preference data available — criterion excluded.",
      "offer_hint": null,
      "decision": "excluded",
      "confidence": "n/a",
      "critical": false,
      "citations": []
    },
    
    "port_accessibility": {
      "code": "P2A",
      "score": 18,
      "max_score": 20,
      "reasoning": "IACS class (BV), IG P&I. Both ports Tier 3 — no PSC risk.",
      "offer_hint": null,
      "decision": "accepted",
      "confidence": "high",
      "critical": false,
      "citations": ["ref:P2A_PSC_PORT_ACCESSIBILITY_SCORING.txt"]
    },
    
    "cargo_preferences": {
      "code": "P3",
      "score": 0,
      "max_score": 0,
      "reasoning": "No cargo preference data — criterion excluded.",
      "offer_hint": null,
      "decision": "excluded",
      "confidence": "n/a",
      "critical": false,
      "citations": []
    },
    
    "last_ports": {
      "code": "P4",
      "score": 7,
      "max_score": 10,
      "reasoning": "Regular BS/Med caller. Poti 8.7%, Samsun 6.5% — same broad region.",
      "offer_hint": "Vessel knows the region — mention familiarity.",
      "decision": "accepted",
      "confidence": "high",
      "critical": false,
      "citations": ["ref:P4_LAST_PORTS_SCORING.txt", "top_ports data"]
    },
    
    "intake_capacity": {
      "code": "P5",
      "score": 12,
      "max_score": 15,
      "reasoning": "Weight 16,403t, volume 14,781t, draft-restricted 14,305t. Final intake 14,305t fits cargo 13,500-16,500t. Limiting factor: draft.",
      "offer_hint": "Cargo fits but at draft limit. Be transparent about qty.",
      "decision": "accepted",
      "confidence": "high",
      "critical": false,
      "citations": ["ref:intake_calculator_formula.txt"]
    },
    
    "openarea_modifier": {
      "code": "P6",
      "score": 0,
      "max_score": 0,
      "reasoning": "No OpenArea comments — criterion excluded.",
      "offer_hint": null,
      "decision": "excluded",
      "confidence": "n/a",
      "critical": false,
      "citations": []
    },
    
    "readiness_eta": {
      "code": "P7",
      "score": 10,
      "max_score": 10,
      "reasoning": "Open Constanta Feb 12, layday Feb 14. Gap -2 days — ideal.",
      "offer_hint": "Timing perfect — highlight in opening.",
      "decision": "accepted",
      "confidence": "high",
      "critical": false,
      "citations": ["ref:READINESSETA_TO_LOADING_PORT_SCORING.txt"]
    },
    
    "restrictions_compliance": {
      "code": "P8",
      "score": 0,
      "max_score": 0,
      "reasoning": "No restrictions set — criterion excluded.",
      "offer_hint": null,
      "restrictions_checked": [],
      "decision": "excluded",
      "confidence": "n/a",
      "critical": false,
      "citations": []
    }
  }
}
```

---

## Score Calculation Example

Active criteria: P1(20) + P1A(15) + P2A(20) + P4(10) + P5(15) + P7(10)
Excluded: P2(0/0), P3(0/0), P6(0/0), P8(0/0)

```
dynamic_max_score = 20+15+20+10+15+10 = 90
total_score_raw = 14+12+18+7+12+10 = 73
total_score = ROUND((73/90) × 100, 1) = 81.1%
recommendation = STRONG (80%+)
```

---

## Example with P8 Active (age restriction, NOT blocked)

```json
{
  "vessel_name": "MV GUANA",
  "total_score": 59.1,
  "total_score_raw": 65,
  "dynamic_max_score": 110,
  "confidence": 80,
  "confidence_note": "P2 excluded (business description only). P8 active (age restriction).",
  "recommendation": "CONDITIONAL",
  "short_summary": "Decent positioning and trade pattern. Age 2yr over limit (negotiable). Draft restriction limits intake — confirm with owner.",
  
  "relationship_warning": { "status": "CLEAR" },
  
  "offer_opening": {
    "intent": "inquire",
    "email_text": "Pls find below cargo for mv Guana. Positioning looks reasonable and she trades the area. We note age is slightly over limit but believe this is negotiable. Cld you let us know yr interest/ideas?",
    "messenger_text": "cargo for Guana — position ok, trades the area. age bit over limit but negotiable. pls see below, yr view?",
    "key_selling_points": ["regional pattern", "port familiarity"],
    "key_concerns": ["age +2yr over limit", "draft-restricted intake"],
    "questions_to_ask": ["confirm opening position"]
  },
  
  "detailed_scoring": {
    "proximity": { "code": "P1", "score": 6.0, "max_score": 20, "decision": "accepted" },
    "regional_patterns": { "code": "P1A", "score": 11.0, "max_score": 15, "decision": "accepted" },
    "owner_preferences": { "code": "P2", "score": 0, "max_score": 0, "decision": "excluded" },
    "port_accessibility": { "code": "P2A", "score": 17.0, "max_score": 20, "decision": "accepted" },
    "cargo_preferences": { "code": "P3", "score": 0, "max_score": 0, "decision": "excluded" },
    "last_ports": { "code": "P4", "score": 7.0, "max_score": 10, "decision": "accepted" },
    "intake_capacity": { "code": "P5", "score": 0, "max_score": 15, "decision": "blocked", "critical": true },
    "openarea_modifier": { "code": "P6", "score": 0, "max_score": 0, "decision": "excluded" },
    "readiness_eta": { "code": "P7", "score": 7.0, "max_score": 10, "decision": "accepted" },
    "restrictions_compliance": {
      "code": "P8",
      "score": 17.5,
      "max_score": 20,
      "reasoning": "1 restriction: Age 27 vs max 25 (+2yr, 75%). NOT blocked.",
      "restrictions_checked": ["Age 27 vs max 25: MARGINAL +2yr (75%)"],
      "decision": "accepted",
      "critical": false
    }
  }
}
```

Note: In this example, P5 is BLOCKED due to draft restriction (7.5m limit makes
loading impossible), but P8 only handles age (not draft). Age is NOT blocked.

---

## Vessel JSON Input — Expected Fields

```json
{
  "vessel-name": "ADAMAR",
  "imo": "9356517",
  "vessel-type": "General Cargo Ship",
  "dwt": "16653",
  "draft": "8.6",
  "current-draught": "8.8",
  "loa": "135.0",
  "beam": "20.4",
  "built": "2006",
  "class": "BV",
  "flag": "Turkey",
  "grain-capacity": "694700",
  "navigation-status": "Under Way Using Engine",
  "destination": "RAVENNA",
  "eta": "2026-02-13",
  "current-position": { "lat": 40.123, "lon": 17.456 },
  "vessel_area": "Adriatic Sea",
  "top_ports": [
    { "port": "Poti", "percentage": 8.7 },
    { "port": "Samsun", "percentage": 6.5 }
  ],
  "open_area": "Montoir, Feb 17",
  "company_comments": "spec med/bs",
  "person_comments": "",
  "vessel_comments": ""
}
```

### Draught Analysis Fields
- `current-draught`: Current draught from AIS (meters)
- `draft`: Maximum summer draft from vessel specs (meters)
- `navigation-status`: AIS navigation status
- Used by: vessel_location_determination.txt, P7 scoring
- Draught ratio = current-draught / draft → ballast/laden detection

---

## Relationship Warning Examples

```json
"relationship_warning": {
  "status": "WARNING",
  "type": "direct_relationship",
  "details": "Owner works directly with Bunge (from company comments)",
  "offer_guidance": "They may already have this cargo."
}
```

```json
"relationship_warning": { "status": "CLEAR" }
```

---

## Key Reminders

- `total_score` = percentage (0-100), NEVER raw points
- `total_score_raw` = sum of actual points (informational)
- `dynamic_max_score` = sum of max_score for active criteria only
- ALL 9 criteria appear in detailed_scoring (excluded show 0/0)
- Draft restrictions → P5, never P8
- Age in P8 → NEVER triggers BLOCK
- `offer_opening` not generated when BLOCKED
- `restrictions_checked` array only in P8
- `relationship_warning` is separate from detailed_scoring


--- START OF estimator-prompts/intake_calculator_formula.txt ---
================================================================================
INTAKE CALCULATOR FORMULA — P5
Version: 5.0
Last updated: 2026-02-07
================================================================================

PURPOSE:
  Calculate vessel's cargo intake capacity and score how well the vessel 
  fits the cargo quantity requirements. Multi-step process covering weight,
  volume, draft restrictions, vessel utilization, and cubature.

  P5 is the ONLY criterion that handles draft/draught restrictions.
  Draft restrictions are NEVER scored in P8. If cargo mentions "draft 7.5m
  limit", that restriction is processed here in P5.

SCORE RANGE: [0, 15]
ALWAYS ACTIVE: max_score = 15
MINIMUM SCORE: 2 (except when BLOCK)

================================================================================
STEP 1 — PARSE CARGO QUANTITY (min_qty / max_qty)
================================================================================

  Convert cargo quantity description into numeric min/max range:
  
  "15,000t +/-10%"     → min 13,500 / max 16,500
  "6000/6600t"         → min 6,000 / max 6,600
  "6000t MOLOO"        → min 5,700 / max 6,300 (±5%)
  "6000t" (no qualifier) → min 5,700 / max 6,300 (assume ±5%)
  "15,000mt 10% MOLOO" → min 13,500 / max 16,500
  "abt 8,000t"         → min 7,600 / max 8,400 (±5%)

================================================================================
STEP 2 — CALCULATE VESSEL INTAKE
================================================================================

  A) WEIGHT INTAKE:
     weight_intake = DWT - ROB
     ROB (Remaining On Board) = 250 tonnes (default fuel/water/stores)
     
     If DWT is not available → BLOCK with note "Missing DWT data"
     
  B) VOLUME INTAKE (if stowage factor and grain capacity known):
     volume_intake = grain_capacity / SF
     
     grain_capacity = from vessel specs (cubic feet)
     SF = Stowage Factor of the cargo (cubic feet per tonne)
     
     Common SF values:
       Wheat: 46-48 cbft/t       Corn/Maize: 47-50 cbft/t
       Barley: 49-53 cbft/t      Soybeans: 48-50 cbft/t
       Cement: 28-30 cbft/t      Coal: 42-48 cbft/t
       Fertilizer (urea): 42-45  Sugar: 38-42 cbft/t
       Steel products: 15-25     Rice: 42-52 cbft/t
       
     If grain_capacity or SF not available → skip volume check
     
  C) DRAFT-RESTRICTED INTAKE (when port or cargo has draft restriction):
  
     DRAFT RESTRICTION SOURCES (use the MORE restrictive value):
       1. port_restrictions_map.txt — physical port depth limit
       2. Cargo description — charterer-imposed draft limit
       
     If BOTH sources exist, use: MIN(port_limit, cargo_limit)
     If neither exists → no draft restriction applies
     
     FORMULA (simplified linear approximation):
       draft_ratio = port_max_draft / vessel_max_draft
       draft_restricted_intake = weight_intake × draft_ratio
       
     Note: This is a LINEAR approximation. Actual DWT/draft relationship
     is non-linear (depends on vessel hull design). For screening purposes
     this approximation is acceptable. Actual intake must be confirmed
     with the owner.
       
     If no draft restriction → draft_restricted_intake = unlimited
     
  D) FINAL INTAKE:
     final_intake = MIN(weight_intake, volume_intake, draft_restricted_intake)
     
     Record which factor is limiting: weight / volume / draft

================================================================================
STEP 3 — CARGO FIT SCORE (base P5 score)
================================================================================

  Compare final_intake to cargo min_qty / max_qty:
  
  PERFECT FIT: min_qty <= final_intake <= max_qty
  ─────────────────────────────────────────
    P5_base = 15/15
    offer_hint: "Cargo fits vessel perfectly."
    
  UNDER CARGO: final_intake < min_qty
  ─────────────────────────────────────────
    shortfall = 1 - (final_intake / min_qty)
    penalty = shortfall × 2.0
    P5_base = MAX(15 × (1 - penalty), 2)
    
    BLOCK CONDITION: final_intake < min_qty × 0.85
      → Vessel physically cannot load minimum required cargo
      → P5 = BLOCK
      
    offer_hint: "Intake below cargo minimum — be transparent about qty."
    
  OVER CARGO: final_intake > max_qty
  ─────────────────────────────────────────
    excess = 1 - (max_qty / final_intake)
    penalty = excess × 2.0
    P5_base = MAX(15 × (1 - penalty), 2)
    
    Note: No BLOCK for over-cargo — vessel can always load less.
    But penalized because owner won't want to waste capacity.
    
    offer_hint: "Vessel larger than needed — emphasize attractive rate."

================================================================================
STEP 4 — VESSEL UTILIZATION PENALTY (additional modifier)
================================================================================

  PURPOSE: Penalize when external restrictions prevent vessel from using
  full capacity. Owner is less interested if vessel can only load 70%.
  
  APPLIES WHEN: Draft restriction or grain capacity limits reduce intake.
  
  FORMULA:
    unrestricted_intake = MIN(weight_intake, volume_intake)
    restricted_intake = MIN(weight_intake, volume_intake, draft_restricted_intake)
    
    restriction_ratio = restricted_intake / unrestricted_intake
    
    If restriction_ratio >= 0.85: no additional penalty
    
    If restriction_ratio < 0.85:
      vessel_util_penalty = (0.85 - restriction_ratio) × 1.5
      P5_score = P5_base × (1 - vessel_util_penalty)

================================================================================
STEP 5 — CUBATURE MODIFIER (for voluminous cargoes)
================================================================================

  APPLIES WHEN: SF > 47 (cargo is voluminous)
  
  FORMULA:
    cubature_ratio = volume_intake / weight_intake
    
    If cubature_ratio >= 0.85: no penalty
    
    If cubature_ratio < 0.85:
      cubature_penalty = (0.85 - cubature_ratio) × 1.5
      P5_score = P5_score × (1 - cubature_penalty)

================================================================================
FINAL P5 SCORE
================================================================================

  P5 = MAX(P5_score after all modifiers, 2)
  Unless BLOCK → then P5 = BLOCK
  
  BLOCK CONDITIONS:
    - final_intake < min_qty × 0.85 (vessel physically too small)
    - Missing DWT data
    
  Note: Draft restriction causing BLOCK in P5 means the vessel cannot
  physically load the cargo at the restricted draft. This is a P5 BLOCK,
  not a P8 BLOCK. P8 does NOT handle draft restrictions.

================================================================================
COMPLETE EXAMPLE — ADAMAR + WHEAT
================================================================================

  Cargo: wheat 15,000t +/-10% ex Chornomorsk, SF = 47, port draft 7.5m
  Vessel: ADAMAR, DWT 16,653, draft 8.6m, grain capacity 694,700 cbft
  
  Step 1: min_qty = 13,500, max_qty = 16,500
  
  Step 2:
    weight_intake = 16653 - 250 = 16,403
    volume_intake = 694700 / 47 = 14,781
    draft_restricted = 16403 × (7.5/8.6) = 14,305
    final_intake = MIN(16403, 14781, 14305) = 14,305 (draft-limited)
    
  Step 3: 13,500 <= 14,305 <= 16,500 → PERFECT FIT, P5_base = 15
    
  Step 4: unrestricted = 14,781 / restricted = 14,305
    ratio = 0.968 → no penalty
    
  Step 5: SF = 47, not > 47 → skipped
    
  Final P5 = 15/15

================================================================================
COMPLETE EXAMPLE — SMALL VESSEL + DRAFT RESTRICTION
================================================================================

  Cargo: wheat 8,000t +/-5%, SF = 47, port draft 6.0m
  Vessel: DWT 6,800, draft 7.2m, grain capacity 220,000 cbft
  
  Step 1: min_qty = 7,600, max_qty = 8,400
  
  Step 2:
    weight_intake = 6800 - 250 = 6,550
    volume_intake = 220000 / 47 = 4,681
    draft_restricted = 6550 × (6.0/7.2) = 5,458
    final_intake = MIN(6550, 4681, 5458) = 4,681 (volume-limited)
    
  Step 3: 4,681 < 7,600 × 0.85 = 6,460 → BLOCK
  
  Final P5 = BLOCK
  Note: This BLOCK is from P5, not P8. Draft is a P5 matter.

================================================================================
EDGE CASES
================================================================================

  Missing grain capacity:
    Skip volume_intake. Use weight and draft only.
    Note: "Grain capacity unknown." Reduce confidence.

  Missing SF:
    Skip cubature modifier. Note: "SF unknown."
    
  Vessel way too big (intake > max_qty × 3):
    Apply over-cargo penalty. P5_base will be 2-4.
    offer_hint: "Vessel far too large for this parcel."
                   
  Vessel way too small (intake < min_qty × 0.5):
    BLOCK. offer_hint: "Vessel far too small — do not offer."

================================================================================
AI INSTRUCTIONS
================================================================================

  ai_must:
    - Follow all 5 steps in order
    - Show calculation in reasoning (numbers, not just words)
    - Identify the limiting factor (weight/volume/draft)
    - Check BOTH port_restrictions_map AND cargo description for draft limits
    - Apply vessel utilization penalty when restrictions reduce capacity
    - Apply cubature modifier only when SF > 47
    - Note that draft BLOCK is a P5 BLOCK (not P8)
    
  ai_must_not:
    - ❌ Never skip Step 1 (cargo quantity parsing)
    - ❌ Never forget ROB deduction (250t)
    - ❌ Never ignore draft restrictions from cargo description
    - ❌ Never apply cubature penalty when SF <= 47
    - ❌ Never give score below 2 (except BLOCK)
    - ❌ Never put draft restrictions in P8 — they belong in P5
    - ❌ Never assume volume_intake when grain capacity is missing

================================================================================


--- START OF estimator-prompts/port_restrictions_map.txt ---
port_restrictions_map

Short Summary — Port Restrictions Map

This file contains the physical and operational limitations of ports, terminals, and regions.
It defines what a vessel can or cannot do in a specific port based on:

Draft restrictions

LOA / Beam limits

Water type (fresh / brackish / sea)

Seasonal restrictions (ice, low water, draft reduction)

Gear requirements (required / preferred / optional)

Maximum vessel size (typical DWT ranges)

Terminal-level depth and operational constraints

It also includes regional-level patterns, explaining where gear is typically required (Africa, Red Sea, Asia) or rarely needed (Black Sea, America).

This file is the authoritative source for all port-related compatibility checks in the VK Charts AI scoring system.

▶️ How to Use — Short Instructions
1. Use this file to check whether the vessel can physically load/discharge

AI must compare:

vessel draft

LOA

beam

presence/absence of vessel gear

with the port’s restrictions.

If any restriction is violated →
AI must assign a low score or mark the vessel incompatible for this cargo.

2. Apply regional patterns when port-level data is missing

If a specific port is not in the file:

Use region_patterns (e.g., “Africa → gear required”)

This acts as a fallback rule to avoid incorrect assumptions

3. Use seasonal rules for ports like Izmail/Reni

AI must adjust scoring if:

winter ice requires ice-class

low water reduces draft

Danube limitations restrict DWT

These conditions directly influence vessel–cargo compatibility.

4. Use gear_requirement rules for cargo types

Example:
Sugar in bags → vessel gear required (both ends).
If the vessel has no gear → −20 penalty.

This connects port restrictions with cargo-specific requirements.

5. Determine maximum vessel size compatibility

File provides typical DWT limits:

Odessa/Constanta → up to Panamax

Izmail/Reni → ~3–8K DWT

Egypt Med ports → 5–20K DWT

AI must ensure vessel DWT is within the acceptable range.

6. Use “aliases” for correct port matching

Odessa, Chornomorsk, Ilyichevsk → same port group.
Constanta → may require gear only during roadstead ops.

This prevents false negatives in matching.

# ═══════════════════════════════════════════════════════════════════
# METADATA & DEFINITIONS
# ═══════════════════════════════════════════════════════════════════

definitions:
  draft: "Maximum vessel draft in meters (summer draft)"
  loa: "Maximum Length Overall in meters"
  beam: "Maximum vessel beam/width in meters"
  wlthc: "Winter Load Line Tropical Cargo (needs clarification)"
  water_type:
    - fresh: "Freshwater (rivers, lakes)"
    - brackish: "Mixed fresh/salt water (estuaries, deltas)"
    - sea: "Seawater (open sea ports)"
  
  restriction_stability:
    constant: "Restrictions don't change (infrastructure limitation)"
    seasonal: "Restrictions vary by season (water level, ice, etc)"
    
  gear_requirement:
    required: "Vessel gear absolutely necessary"
    preferred: "Vessel gear gives advantage but not mandatory"
    optional: "Shore gear available, vessel gear not needed"
    
  sources:
    airtable: "Port name from Airtable database"
    user_knowledge: "Expert knowledge (Vitaly)"
    port_authority: "Official port documentation"
    practical_experience: "Real fixture experience"

# ═══════════════════════════════════════════════════════════════════
# REGION-LEVEL PATTERNS
# ═══════════════════════════════════════════════════════════════════

region_patterns:
  
  black_sea:
    general_gear_requirement: "optional"
    notes: "Almost never need vessel gear in Black Sea ports"
    water_type: "sea"
    major_ports_capacity: "Up to Panamax size"
    
  mediterranean:
    coaster_gear_requirement: "optional"
    handysize_plus_gear_requirement: "preferred"
    notes: "Coasters rarely need gear, larger vessels sometimes do"
    
  asia:
    general_gear_requirement: "required"
    notes: "Vessel gear often needed for loading operations"
    
  red_sea:
    general_gear_requirement: "required"
    notes: "Vessel gear frequently needed"
    
  africa:
    general_gear_requirement: "required"
    notes: "Vessel gear often needed"
    
  america:
    general_gear_requirement: "optional"
    notes: "Almost never need vessel gear"

# ═══════════════════════════════════════════════════════════════════
# COUNTRY-LEVEL RESTRICTIONS
# ═══════════════════════════════════════════════════════════════════

countries:
  
  ukraine:
    airtable_id: "TBD"
    general_notes: "Major grain exporter, modern facilities in main ports"
    
    ports:
      
      odessa_chornomorsk:
        airtable_id: "TBD"
        official_name: "Odessa/Chornomorsk Port Complex"
        aliases: ["Odessa", "Chornomorsk", "Ilyichevsk"]
        
        restrictions:
          draft: null  # No specific limit, accepts up to Panamax
          loa: null    # Can handle large vessels
          beam: null
          wlthc: null
          restriction_type: "constant"
          
        water_type: "sea"
        
        vessel_gear:
          requirement: "optional"
          reason: "Modern grain terminals with shore equipment"
          
        max_vessel_size:
          description: "Up to Panamax"
          typical_dwt_range: [3000, 75000]
          
        terminals:
          - name: "TIS Grain Terminal"
            draft: 14.0
            notes: "Deep water terminal"
            
          - name: "Kernel Terminal"
            draft: 12.5
            
          - name: "Nika-Tera"
            draft: 12.0
        
        notes: "Major grain export hub with modern facilities"
        
      izmail_reni:
        airtable_id: "TBD"
        official_name: "Izmail/Reni Danube Ports"
        aliases: ["Izmail", "Reni", "Ismail"]
        region: "Danube Delta"
        
        restrictions:
          draft: 7.0
          loa: null
          beam: null
          wlthc: null
          restriction_type: "seasonal"
          
        seasonal_variations:
          winter:
            months: [12, 1, 2]
            additional_restrictions:
              ice: true
              ice_class_required: true
              notes: "Icebreaker assistance may be needed"
              
          low_water:
            months: [8, 9]
            draft_reduction: 0.3
            notes: "Draft may be reduced in dry season"
        
        water_type: "fresh"
        
        vessel_gear:
          requirement: "required"
          reason: "Danube ports limited shore facilities"
          
        max_vessel_size:
          description: "Small handysize max"
          typical_dwt_range: [3000, 8000]
          
        notes: "Danube river ports with draft and seasonal limitations"
  
  romania:
    airtable_id: "TBD"
    
    ports:
      
      constanta:
        airtable_id: "TBD"
        official_name: "Constanta Port"
        
        restrictions:
          draft: null  # No specific limit, major port
          loa: null
          beam: null
          wlthc: null
          restriction_type: "constant"
          
        water_type: "sea"
        
        vessel_gear:
          requirement: "optional"
          reason: "Modern port with shore equipment"
          exceptions:
            - condition: "Roadstead transhipment operations"
              requirement: "required"
              reason: "Loading from small vessel to larger vessel"
          
        max_vessel_size:
          description: "Up to Panamax"
          typical_dwt_range: [3000, 75000]
          
        operations:
          roadstead_transhipment:
            available: true
            vessel_gear_required: true
            typical_scenario: "Small vessel → Large vessel transfer"
            
        notes: "Major Black Sea port, can handle large vessels"
  
  russia:
    airtable_id: "TBD"
    
    ports:
      
      novorossiysk:
        airtable_id: "TBD"
        official_name: "Novorossiysk"
        
        restrictions:
          draft: null  # Major port, deep water
          loa: null
          beam: null
          wlthc: null
          restriction_type: "constant"
          
        water_type: "sea"
        
        vessel_gear:
          requirement: "optional"
          
        max_vessel_size:
          description: "Up to Panamax and larger"
          typical_dwt_range: [5000, 100000]
          
        notes: "Largest Russian Black Sea port"
  
  egypt:
    airtable_id: "TBD"
    
    ports:
      
      alexandria:
        airtable_id: "TBD"
        restrictions:
          draft: 8.5
          loa: null
          beam: null
          wlthc: null
          restriction_type: "constant"
        water_type: "sea"
        vessel_gear:
          requirement: "optional"
        max_vessel_size:
          typical_dwt_range: [5000, 15000]
          
      damietta:
        airtable_id: "TBD"
        restrictions:
          draft: 9.0
          loa: null
          beam: null
          wlthc: null
          restriction_type: "constant"
        water_type: "sea"
        vessel_gear:
          requirement: "optional"
        max_vessel_size:
          typical_dwt_range: [5000, 20000]
          
      port_said:
        airtable_id: "TBD"
        restrictions:
          draft: 10.0
          loa: null
          beam: null
          wlthc: null
          restriction_type: "constant"
        water_type: "sea"
        vessel_gear:
          requirement: "optional"
        max_vessel_size:
          typical_dwt_range: [8000, 30000]

# ═══════════════════════════════════════════════════════════════════
# SPECIAL CARGO GEAR REQUIREMENTS
# ═══════════════════════════════════════════════════════════════════

cargo_gear_requirements:
  
  sugar_in_bags:
    cargo_type: "Sugar (bagged/big bags)"
    
    gear_requirement:
      loading_ports: "required"
      discharge_ports: "required"
      reason: "Bagged cargo handling typically requires vessel gear"
      
    applies_to:
      - "Sugar in bags"
      - "Sugar in big bags"
      - "Similar bagged agricultural products"
      
    scoring_impact:
      vessel_has_gear: 0
      vessel_no_gear: -20

# ═══════════════════════════════════════════════════════════════════
# TEMPLATE FOR NEW PORTS
# ═══════════════════════════════════════════════════════════════════

port_template:
  port_name_here:
    airtable_id: "TBD"
    official_name: ""
    aliases: []
    country: ""
    region: ""
    
    restrictions:
      draft: null          # meters (null if no restriction)
      loa: null           # meters (null if no restriction)  
      beam: null          # meters (null if no restriction)
      wlthc: null         # (needs clarification)
      restriction_type: "constant"  # or "seasonal"
      
    seasonal_variations:  # only if restriction_type: "seasonal"
      season_name:
        months: []
        additional_restrictions: {}
        
    water_type: "sea"    # fresh/brackish/sea
    
    vessel_gear:
      requirement: "optional"  # required/preferred/optional
      reason: ""
      exceptions: []
      
    max_vessel_size:
      description: ""
      typical_dwt_range: [min, max]
      
    terminals: []        # if port has multiple terminals
    
    operations: {}       # special operations (transhipment, etc)
    
    notes: ""
    source: "user_knowledge"
    last_updated: "YYYY-MM-DD"


--- START OF estimator-prompts/proximity_scoring_matrix.txt ---
# ═══════════════════════════════════════════════════════════════════
# PROXIMITY SCORING MATRIX - UPDATED v2.0
# VK Charts AI Scoring System - Criterion P1
# ═══════════════════════════════════════════════════════════════════
#
# CHANGES IN v2.0:
# - Updated East Med scoring (Level 9): 8 → 15 internal for Coasters (~6 P1)
# - Updated Adriatic scoring (Level 10): 4 → 17 internal for Coasters (~7 P1)
# - Added vessel size multipliers for all categories
# - Aligned with broker corrections (Adriatic/East Med are viable for coasters)
#
# ═══════════════════════════════════════════════════════════════════

version: "2.0"
date: "2026-01-19"
priority: "CRITICAL - Distance directly impacts commercial viability"

# ═══════════════════════════════════════════════════════════════════
# SHORT SUMMARY
# ═══════════════════════════════════════════════════════════════════

purpose: |
  This file defines P1 (Proximity) scoring - how AI evaluates geographic
  distance compatibility between vessel's current position and cargo's
  loading port. P1 contributes 0-20 points to the total score (100 max).
  
  WHAT THIS FILE CONTAINS:
  
  1. INTERNAL SCORING LEVELS (0-50 internal points)
     - Level 1: Same port = 50 internal points
     - Level 7: Marmara Sea = 20 internal points
     - Level 10: Adriatic = 17 internal points (UPDATED!)
     - These are SCALED to final P1 range [0, 20]
  
  2. VESSEL SIZE MULTIPLIERS (NEW!)
     - Small Coaster (3-6k): ×0.8 (more sensitive to distance)
     - Coaster (6-8k): ×1.0 (baseline)
     - Small Handy (8-17k): ×1.15
     - Handy (17-24k): ×1.3
     - Large vessels (24k+): ×1.5
  
  3. DISTANCE PENALTIES
     - Fine-tuning based on actual nautical miles within same level
     - Penalty per 100nm varies by vessel size
  
  4. GEOPOLITICAL RESTRICTIONS
     - Ukraine-Russia war sanctions (IMPOSSIBLE scoring)
  
  5. AI USAGE INSTRUCTIONS
     - Step-by-step scoring process

# ═══════════════════════════════════════════════════════════════════
# AI USAGE PROCESS
# ═══════════════════════════════════════════════════════════════════
  
for_ai_langchain:
  role: "Proximity Scoring Implementation"
  process:
    step_1: "Read vessel location from input"
    step_2: "Read cargo loading port from input"
    step_3: "Determine vessel size category (DWT)"
    step_4: "Find matching proximity level in this file"
    step_5: "Get internal base score (0-50 range)"
    step_6: "Apply vessel size multiplier if applicable"
    step_7: "Apply distance penalty if applicable"
    step_8: "Apply geopolitical restrictions if applicable"
    step_9: "Scale final internal score to P1 range [0-20]"
    step_10: "Generate explanation and reasoning"
  
  scaling_formula:
    internal_to_final: "P1_final = (internal_score / 50) * 20"
    example_1: "Internal 50 → P1 = 20 (maximum)"
    example_2: "Internal 25 → P1 = 10 (mid-range)"
    example_3: "Internal 17 → P1 = 6.8 (Adriatic)"
    example_4: "Internal 15 → P1 = 6.0 (East Med)"
    example_5: "Internal 0 → P1 = 0 (minimum)"

# ═══════════════════════════════════════════════════════════════════
# SCORING PRINCIPLE
# ═══════════════════════════════════════════════════════════════════

scoring_principle: |
  Proximity = Lower ballast cost = Higher score
  
  Чем ближе судно к порту погрузки, тем выше score
  
  INTERNAL SCORING: 0-50 points (used for detailed level differentiation)
  FINAL P1 SCORE: 0-20 points (scaled from internal score)
  
  Scaling formula: P1_final = (internal_score / 50) * 20

# ═══════════════════════════════════════════════════════════════════
# BLACK SEA SUB-REGIONS
# ═══════════════════════════════════════════════════════════════════

black_sea_subregions:
  
  poc:
    name: "POC (Pivdenny-Odessa-Chornomorsk)"
    country: "Ukraine"
    ports:
      - "Odessa"
      - "Pivdenny (Yuzhny)"
      - "Chornomorsk (Ilyichevsk)"
    characteristics:
      - "Major grain export hub"
      - "Close proximity to each other"
      - "Shared anchorage areas"
  
  sulina_anchorage:
    name: "Sulina Anchorage"
    country: "Romania/International waters"
    characteristics:
      - "Strategic position"
      - "Can access BOTH Danube AND POC"
      - "Excellent positioning for either direction"
    
  danube_ports:
    name: "Danube River Ports"
    countries: ["Romania", "Moldova", "Ukraine"]
    ports:
      romania:
        - "Galati"
        - "Braila"
      moldova:
        - "Giurgiulesti"
      ukraine:
        - "Kiliya"
        - "Orlovka"
        - "Izmail"
        - "Reni"
    characteristics:
      - "River ports"
      - "Draft restrictions"
      - "Smaller vessel sizes"
  
  cvb:
    name: "CVB (Constanta-Varna-Burgas)"
    countries: ["Romania", "Bulgaria"]
    ports:
      romania:
        - "Constanta"
      bulgaria:
        - "Varna"
        - "Burgas"
    characteristics:
      - "Major Black Sea ports"
      - "Good facilities"
      - "Western Black Sea"
  
  turkish_black_sea:
    name: "Turkish Black Sea Ports"
    country: "Turkey"
    ports:
      - "Samsun"
      - "Trabzon"
      - "Zonguldak"
      - "Eregli"
  
  russian_black_sea:
    name: "Russian Black Sea Ports"
    country: "Russia"
    ports:
      - "Novorossiysk"
      - "Kavkaz (Caucasus)"
    
    geopolitical_restriction:
      status: "BLOCKED due to Ukraine-Russia war"
      ukraine_to_russia: "IMPOSSIBLE - sanctions"
      russia_to_ukraine: "IMPOSSIBLE - sanctions"
      effective_date: "2022-present"
  
  georgian_black_sea:
    name: "Georgian Black Sea Ports"
    country: "Georgia"
    ports:
      - "Poti"
      - "Batumi"

# ═══════════════════════════════════════════════════════════════════
# VESSEL SIZE MULTIPLIERS (NEW IN v2.0!)
# ═══════════════════════════════════════════════════════════════════

vessel_size_multipliers:
  
  principle: |
    Larger vessels can absorb longer ballast legs economically.
    Apply multipliers to distance-sensitive levels (8-12 for coasters).
  
  categories:
    
    small_coaster_3_6k:
      dwt_range: [3000, 6000]
      multiplier: 0.8
      effect: "MORE sensitive to distance - reduce by 20%"
      application: "Multiply internal score by 0.8 for levels 8+"
      
    coaster_6_8k:
      dwt_range: [6001, 8000]
      multiplier: 1.0
      effect: "BASELINE - no adjustment"
      
    small_handy_8_17k:
      dwt_range: [8001, 17000]
      multiplier: 1.15
      effect: "LESS sensitive - increase by 15%"
      
    handy_17_24k:
      dwt_range: [17001, 24000]
      multiplier: 1.3
      effect: "Much less sensitive - increase by 30%"
      
    large_handy_24k_plus:
      dwt_range: [24001, 999999]
      multiplier: 1.5
      effect: "Least sensitive - increase by 50%"
  
  application_rules:
    when_to_apply: "Levels 8 and beyond (longer distance levels)"
    when_NOT_to_apply: "Levels 1-7 (short distances, already optimal)"
    
  example:
    level: "Level 9 - East Med"
    base_internal_score: 15
    
    for_small_coaster_5k:
      calculation: "15 × 0.8 = 12"
      p1_score: "~4.8/20"
      
    for_coaster_7k:
      calculation: "15 × 1.0 = 15"
      p1_score: "~6.0/20"
      
    for_small_handy_12k:
      calculation: "15 × 1.15 = 17.25"
      p1_score: "~6.9/20"
      
    for_handy_20k:
      calculation: "15 × 1.3 = 19.5"
      p1_score: "~7.8/20"

# ═══════════════════════════════════════════════════════════════════
# PROXIMITY SCORING - BASELINE COASTERS (6000-8000 DWT)
# ═══════════════════════════════════════════════════════════════════

proximity_scoring_coasters_baseline:
  vessel_size_range: [6000, 8000]
  cargo_loading_example: "Black Sea (Odessa)"
  multiplier: 1.0
  
  levels:
    
    level_1_same_port:
      internal_score: 50
      p1_equivalent: 20.0
      description: "Vessel in same port as loading port"
      examples:
        - vessel_location: "Odessa"
          cargo_loading: "Odessa"
          result: "Perfect - zero ballast"
      
    level_2_same_port_cluster:
      internal_score: 48
      p1_equivalent: 19.2
      description: "Vessel in same port cluster/region"
      distance_nm: "< 50nm"
      examples:
        - vessel_location: "Pivdenny"
          cargo_loading: "Odessa"
          result: "POC cluster - minimal ballast"
        - vessel_location: "Chornomorsk"
          cargo_loading: "Odessa"
          result: "POC cluster - ~30nm"
      
    level_3_sulina_anchorage:
      internal_score: 48
      p1_equivalent: 19.2
      description: "Special case - Sulina Anchorage to POC"
      distance_nm: "~80nm"
      reasoning: "Strategic waiting area, can access both POC and Danube"
      examples:
        - vessel_location: "Sulina Anchorage"
          cargo_loading: "Chornomorsk"
          result: "Very close, excellent positioning"
      citations:
        - "Correction 3 (eleanora): Sulina is waiting area for POC or Danube"
    
    level_4_same_subregion:
      internal_score: 45
      p1_equivalent: 18.0
      description: "Different port within same Black Sea sub-region"
      distance_nm: "~150nm"
      examples:
        - vessel_location: "Constanta"
          cargo_loading: "Chornomorsk"
          result: "CVB → POC, short ballast"
      
    level_5_nearby_subregion:
      internal_score: 40
      p1_equivalent: 16.0
      description: "Nearby Black Sea sub-region"
      distance_nm: "~300nm"
      examples:
        - vessel_location: "Varna"
          cargo_loading: "Odessa"
          result: "CVB → POC cross-Black Sea"
     
    level_6_same_black_sea:
      internal_score: 35
      p1_equivalent: 14.0
      description: "Anywhere in Black Sea (excluding Russian ports)"
      distance_nm: "~400-600nm"
      examples:
        - vessel_location: "Turkish Black Sea (Samsun)"
          cargo_loading: "Odessa"
          result: "Same sea but longer ballast"
        - vessel_location: "Batumi (Georgia)"
          cargo_loading: "Odessa"
          result: "Cross Black Sea ballast"
      
      geopolitical_exceptions:
        ukraine_russia_block:
          condition: "Ukraine port ↔ Russian vessel OR Russia port ↔ Ukrainian vessel"
          score_override: 0
          p1_override: 0
          reason: "War, sanctions, impossible"
      
    level_7_marmara_sea:
      internal_score: 25
      p1_equivalent: 10.0
      description: "Vessel in Marmara Sea"
      distance_nm: "~400nm"
      examples:
        - vessel_location: "Istanbul (Marmara side)"
          cargo_loading: "Odessa"
          result: "Bosphorus crossing + Black Sea ballast"
        - vessel_location: "Derince"
          cargo_loading: "Constanta"
          result: "Acceptable ballast"
      
    level_8_aegean_east_greece:
      internal_score: 20
      p1_equivalent: 8.0
      description: "Aegean Sea and East coast Greece"
      distance_nm: "~600nm"
      vessel_size_multiplier_applies: true
      examples:
        - vessel_location: "Izmir"
          cargo_loading: "Odessa"
          result: "Aegean → Dardanelles → Marmara → Bosphorus → Black Sea"
        - vessel_location: "Nemrut Bay"
          cargo_loading: "Constanta"
          result: "Short to Dardanelles, then Black Sea"
        - vessel_location: "Thessaloniki"
          cargo_loading: "Varna"
          result: "Eastern Greece → Black Sea acceptable"
      
    level_9_east_med:
      internal_score: 15
      p1_equivalent: 6.0
      description: "East Mediterranean"
      distance_nm: "~1200nm"
      vessel_size_multiplier_applies: true
      examples:
        - vessel_location: "Mersin (Turkey)"
          cargo_loading: "Odessa"
          result: "East Med → Black Sea, viable backhaul"
        - vessel_location: "Limassol (Cyprus)"
          cargo_loading: "Constanta"
          result: "Med → Black Sea feasible"
        - vessel_location: "Alexandria (Egypt)"
          cargo_loading: "Chornomorsk"
          result: "Common backhaul route"
      citations:
        - "Correction 5 (ak brothers): Distance not as critical as initially scored"
        - "Correction: East Med vessels commonly return to Black Sea"
      notes: "UPDATED from 8 → 15 internal (was 3.2 P1, now 6.0 P1)"
      
    level_10_adriatic_ionian:
      internal_score: 17
      p1_equivalent: 6.8
      description: "Adriatic or Ionian Sea"
      distance_nm: "~1100nm"
      vessel_size_multiplier_applies: true
      examples:
        - vessel_location: "Rijeka (Croatia)"
          cargo_loading: "Odessa"
          result: "Adriatic → Med → Black Sea"
        - vessel_location: "Bar (Montenegro)"
          cargo_loading: "Constanta"
          result: "Viable due to lack of Adriatic backhaul"
        - vessel_location: "Durres (Albania)"
          cargo_loading: "Chornomorsk"
          result: "Ionian → Med → Black Sea"
      citations:
        - "Correction 6 (ismail bey): Score should be higher, distance acceptable"
        - "Correction: Adriatic vessels often ballast to Black Sea (no backhaul)"
      notes: "UPDATED from 4 → 17 internal (was 1.6 P1, now 6.8 P1)"
    
    level_11_west_med:
      internal_score: 7
      p1_equivalent: 2.8
      description: "West Mediterranean"
      distance_nm: "~2000nm"
      vessel_size_multiplier_applies: true
      examples:
        - vessel_location: "Barcelona (Spain)"
          cargo_loading: "Odessa"
          result: "Long ballast - marginal for coasters"
        - vessel_location: "Algiers (Algeria)"
          cargo_loading: "Constanta"
          result: "Possible but needs good freight"
      notes: "Approaching limit for coasters"
    
    level_12_atlantic_west_africa:
      internal_score: 0
      p1_equivalent: 0.0
      description: "Atlantic, West Africa - NOT VIABLE for coasters"
      distance_nm: "> 3000nm"
      examples:
        - vessel_location: "Dakar (Senegal)"
          cargo_loading: "Odessa"
          result: "Commercially non-viable for coaster (~4200nm)"
      citations:
        - "Correction 7 (ak beauty): West Africa ballast impossible for coaster"
      notes: "Coasters working in these areas, not positioning to Black Sea"

# ═══════════════════════════════════════════════════════════════════
# SMALL COASTERS (3000-6000 DWT) - Apply 0.8 multiplier
# ═══════════════════════════════════════════════════════════════════

proximity_scoring_small_coasters:
  vessel_size_range: [3000, 6000]
  multiplier: 0.8
  note: "Levels 1-7 same as baseline, levels 8+ reduced by 20%"
  
  adjusted_levels:
    level_8_aegean:
      base_internal: 20
      adjusted_internal: 16
      p1_equivalent: 6.4
      
    level_9_east_med:
      base_internal: 15
      adjusted_internal: 12
      p1_equivalent: 4.8
      
    level_10_adriatic:
      base_internal: 17
      adjusted_internal: 13.6
      p1_equivalent: 5.4
      
    level_11_west_med:
      base_internal: 7
      adjusted_internal: 5.6
      p1_equivalent: 2.2

# ═══════════════════════════════════════════════════════════════════
# SMALL HANDY (8000-17000 DWT) - Apply 1.15 multiplier
# ═══════════════════════════════════════════════════════════════════

proximity_scoring_small_handy:
  vessel_size_range: [8000, 17000]
  multiplier: 1.15
  note: "Levels 1-7 same as baseline, levels 8+ increased by 15%"
  
  adjusted_levels:
    level_8_aegean:
      base_internal: 20
      adjusted_internal: 23
      p1_equivalent: 9.2
      
    level_9_east_med:
      base_internal: 15
      adjusted_internal: 17.25
      p1_equivalent: 6.9
      
    level_10_adriatic:
      base_internal: 17
      adjusted_internal: 19.55
      p1_equivalent: 7.8
      
    level_11_west_med:
      base_internal: 7
      adjusted_internal: 8.05
      p1_equivalent: 3.2
      
    level_12_atlantic:
      base_internal: 3
      p1_equivalent: 1.2
      description: "Feasible for Small Handy"

# ═══════════════════════════════════════════════════════════════════
# HANDY (17000-24000 DWT) - Apply 1.3 multiplier
# ═══════════════════════════════════════════════════════════════════

proximity_scoring_handy:
  vessel_size_range: [17000, 24000]
  multiplier: 1.3
  note: "Levels 1-7 same as baseline, levels 8+ increased by 30%"
  
  adjusted_levels:
    level_8_aegean:
      base_internal: 20
      adjusted_internal: 26
      p1_equivalent: 10.4
      
    level_9_east_med:
      base_internal: 15
      adjusted_internal: 19.5
      p1_equivalent: 7.8
      
    level_10_adriatic:
      base_internal: 17
      adjusted_internal: 22.1
      p1_equivalent: 8.8
      
    level_11_west_med:
      base_internal: 7
      adjusted_internal: 9.1
      p1_equivalent: 3.6
      
    level_12_atlantic:
      base_internal: 5
      p1_equivalent: 2.0
      description: "Acceptable for Handy"

# ═══════════════════════════════════════════════════════════════════
# LARGE VESSELS (24000+ DWT) - Apply 1.5 multiplier
# ═══════════════════════════════════════════════════════════════════

proximity_scoring_large_vessels:
  vessel_size_range: [24000, 80000]
  multiplier: 1.5
  note: "Can absorb long ballast legs, global positioning capability"
  
  adjusted_levels:
    level_8_aegean:
      base_internal: 20
      adjusted_internal: 30
      p1_equivalent: 12.0
      
    level_9_east_med:
      base_internal: 15
      adjusted_internal: 22.5
      p1_equivalent: 9.0
      
    level_10_adriatic:
      base_internal: 17
      adjusted_internal: 25.5
      p1_equivalent: 10.2
      
    level_11_west_med:
      base_internal: 7
      adjusted_internal: 10.5
      p1_equivalent: 4.2
      
    level_12_atlantic:
      base_internal: 10
      p1_equivalent: 4.0
      description: "Good for large vessels"
      
    level_13_west_africa:
      base_internal: 5
      p1_equivalent: 2.0
      description: "Can ballast if rates justify"

# ═══════════════════════════════════════════════════════════════════
# DISTANCE FINE-TUNING (OPTIONAL)
# ═══════════════════════════════════════════════════════════════════

distance_adjustment:
  description: "Fine-tune score based on actual distance within same level"
  
  formula: "adjusted_score = base_level_score - (distance_penalty × nm / 100)"
  
  penalty_by_vessel_size:
    small_coaster_3_6k: 0.5
    coaster_6_8k: 0.4
    small_handy_8_17k: 0.3
    handy_17_24k: 0.2
    large_24k_plus: 0.1
  
  note: |
    This is OPTIONAL fine-tuning. Most of the time, level-based scoring
    is sufficient. Use distance adjustment only when precise maritime
    distance is known and level boundaries are ambiguous.

# ═══════════════════════════════════════════════════════════════════
# AI REASONING TEMPLATES
# ═══════════════════════════════════════════════════════════════════

reasoning_templates:
  
  template_excellent:
    score_range: "[18-20]"
    format: |
      "Vessel is [at/near] [location], approximately [distance]nm from [loading port].
      This is Level [N] proximity ([description]), representing [assessment]."
    example: |
      "Vessel is at Sulina Anchorage, approximately 80nm from Chornomorsk.
      This is Level 3 proximity (strategic waiting area), representing
      excellent positioning for POC loading."
      
  template_good:
    score_range: "[12-17]"
    format: |
      "Vessel is in [region], [distance]nm from [loading port]. This is
      Level [N] proximity, representing a [short/acceptable] ballast leg
      for a [vessel size] vessel."
    example: |
      "Vessel is in the Black Sea, approximately 400nm from Chornomorsk.
      This is Level 6 proximity, representing an acceptable cross-Black Sea
      ballast for a 7k coaster."
      
  template_medium:
    score_range: "[6-11]"
    format: |
      "Vessel is in [region], approximately [distance]nm from [loading port].
      This is Level [N] proximity. [Specific reasoning about viability]."
    example: |
      "Vessel is in the East Mediterranean, approximately 1200nm from Chornomorsk.
      This is Level 9 proximity. While the distance is significant, East Med
      to Black Sea is a common backhaul pattern for coasters."
      
  template_low:
    score_range: "[1-5]"
    format: |
      "Vessel is in [region], approximately [distance]nm from [loading port].
      This is Level [N] proximity, representing a [long/marginal] ballast leg
      that [reasoning about economic viability]."
    example: |
      "Vessel is in West Mediterranean, approximately 2000nm from Chornomorsk.
      This is Level 11 proximity, representing a long ballast leg that
      approaches the commercial limit for a coaster of this size."

# ═══════════════════════════════════════════════════════════════════
# CRITICAL AI INSTRUCTIONS
# ═══════════════════════════════════════════════════════════════════

ai_must:
  - "ALWAYS determine vessel size first (DWT) to select correct scoring table"
  - "ALWAYS apply vessel size multiplier for levels 8+ (long distance)"
  - "ALWAYS check for geopolitical restrictions (Russia-Ukraine)"
  - "ALWAYS scale internal score to P1 range [0-20] using formula"
  - "ALWAYS cite specific level name in reasoning"
  - "NEVER give negative P1 scores (minimum is 0)"

ai_must_not:
  - "Never assume close distance = automatically high score without checking level"
  - "Never ignore vessel size differences in long-distance positioning"
  - "Never score Russia ↔ Ukraine trades above 0"

# ═══════════════════════════════════════════════════════════════════
# END OF PROXIMITY SCORING MATRIX v2.0
# ═══════════════════════════════════════════════════════════════════


--- START OF estimator-prompts/vessel_location_determination.txt ---
================================================================================
VESSEL LOCATION DETERMINATION
Version: 4.0
Last updated: 2026-02-07
================================================================================

PURPOSE:
  Determine the vessel's current position, heading, and operational status
  to support P1 (proximity), P7 (readiness/ETA), and offer generation.
  Includes draught analysis for ballast/laden detection.

  ╔══════════════════════════════════════════════════════════════════╗
  ║  This file provides draught analysis logic that P7 MUST use     ║
  ║  before scoring readiness. See READINESSETA_TO_LOADING_PORT_    ║
  ║  SCORING.txt for how results feed into P7 scoring.             ║
  ╚══════════════════════════════════════════════════════════════════╝

================================================================================
POSITION SOURCES (priority order)
================================================================================

  1. OpenArea data (vessel listing):
     - open_area: "Montoir, Feb 17"
     - Contains: location name, date, sometimes heading
     
  2. VesselFinder / MarineTraffic data:
     - current-position: lat/lon
     - destination: next port
     - eta: estimated arrival
     - navigation-status: "under way", "at anchor", "moored"
     - current-draught: current draught reading (meters)
     
  3. Vessel JSON fields:
     - vessel_area: general area description
     - last_ports: recent port calls with dates

================================================================================
DETERMINING VESSEL READY DATE
================================================================================

  OPTION A — Open area with date only (no destination):
    Example: "open Montoir Feb 17"
    vessel_ready = Feb 17 (use as-is)
    No buffer needed — vessel is stated as open.

  OPTION B — Destination with ETA:
    Example: "heading Ravenna ETA Feb 13"
    
    Step 1: Perform DRAUGHT ANALYSIS (see below)
    Step 2: Apply operations buffer based on result
    
    BALLAST → vessel_ready = ETA (no buffer)
    LADEN   → vessel_ready = ETA + 7 days
    OVER_DRAFT → vessel_ready = ETA + 7 days (treat as laden)
      
  OPTION C — Current position only (no destination/ETA):
    Estimate sailing time from current position to load port.
    Use 10-12 knots average. Add 1 day port entry buffer.
    confidence = "low"

================================================================================
DRAUGHT ANALYSIS — BALLAST/LADEN DETECTION
================================================================================

  FORMULA:
    draught_ratio = current_draught / max_draft
    
    current_draught = field "current-draught" (from AIS/VesselFinder)
    max_draft = field "draft" (summer draft from vessel specs)
    
  THRESHOLDS:
  
    ratio < 0.65 → STATUS: BALLAST
    ────────────────────────────────────────
      Vessel is empty or nearly empty.
      operations_buffer = 0 days
      vessel_ready = ETA
      Ask owner: "Is she proceeding for loading or available?"

    ratio >= 0.65 → STATUS: LADEN
    ────────────────────────────────────────
      Vessel is carrying cargo, heading to discharge.
      operations_buffer = +7 days (discharge + preparation)
      vessel_ready = ETA + 7 days

    current_draught > max_draft → STATUS: OVER_DRAFT
    ────────────────────────────────────────
      Data anomaly (outdated AIS, tropical marks, error).
      Treat as LADEN (conservative).
      operations_buffer = +7 days
      Note data anomaly, confidence = "medium"

  MISSING DATA:
    If current_draught unavailable → default to LADEN (conservative)
    If max_draft unavailable → cannot calculate, use context clues
    Always note missing data in reasoning.

================================================================================
IMPACT ON OTHER CRITERIA
================================================================================

  P7 (Readiness/ETA):
    BALLAST → vessel_ready = ETA → closer to layday = better P7
    LADEN → vessel_ready = ETA + 7 → later ready date = worse P7
    P7 MUST use this analysis. See READINESSETA_TO_LOADING_PORT_SCORING.txt

  P1 (Proximity):
    Use DESTINATION port for distance when vessel is underway
    (not current mid-sea position)

  Offer Opening:
    BALLAST → include question about availability/status
    LADEN → standard approach, mention post-discharge timing

================================================================================
EXAMPLES
================================================================================

  Example 1: OVER_DRAFT (laden)
    current_draught = 8.8m, max_draft = 8.6m
    ratio = 1.023 → OVER_DRAFT → treat as LADEN
    vessel_ready = ETA + 7 days
    Note: "Draught 8.8m exceeds max 8.6m — anomaly, treating as laden."

  Example 2: BALLAST
    current_draught = 2.1m, max_draft = 5.2m  
    ratio = 0.404 → BALLAST
    vessel_ready = ETA (no buffer)
    Ask: "Confirm if heading for loading or open."

  Example 3: LADEN
    current_draught = 7.5m, max_draft = 9.8m
    ratio = 0.765 → LADEN
    vessel_ready = ETA + 7 days

  Example 4: No draught data
    current_draught = not available
    Default: LADEN (+7 days buffer)
    Note: "No draught data — defaulting to laden."
    confidence = "medium"

================================================================================


--- START OF estimator-prompts/vessel_size_classification.txt ---
# ═══════════════════════════════════════════════════════════════════
# SHORT SUMMARY
# ═══════════════════════════════════════════════════════════════════

DOCUMENT: Vessel Size Classification - Size Category Definitions
PURPOSE: Single source of truth for vessel size categorization in VK Charts AI
SCOPE: Dry cargo bulk carriers and general cargo vessels (bulk operations)
INTEGRATION: Used across all scoring criteria (P1-P7) for size-dependent logic

WHAT THIS DOCUMENT DEFINES:
This file establishes the official VK Charts vessel size classification system
for all dry-cargo vessels (bulk + general cargo). It provides the authoritative
DWT ranges, category codes, and size-specific behavioral characteristics that
drive AI scoring decisions across all criteria.

SIZE CATEGORIES (7 total):
1. Small Coasters (SC): 0-4,000 DWT - River/coastal vessels
2. Coasters (C): 4,001-17,000 DWT - Regional bulk trades (most common Black Sea-Med)
3. Small Handy (SH): 17,001-24,000 DWT - Medium haul bulk carriers
4. Handy (H): 24,001-40,000 DWT - Long haul capable (NOT common in Greek trades)
5. Small Supramax (SS): 40,001-50,000 DWT - Deep sea bulk carriers
6. Supramax (SM): 50,001-65,000 DWT - Global bulk trades
7. Panamax (PM): 65,000-80,000 DWT - Maximum size for Panama Canal

KEY FEATURES:
- Precise DWT ranges for each category
- Size-specific economic behavior (ballast tolerance, operating cost)
- Typical trade patterns and routes for each size
- Impact on proximity scoring (smaller vessels = higher distance penalty)
- Cargo-vessel size compatibility rules
- Integration with all scoring criteria

CRITICAL DEPENDENCIES:
- proximity_scoring_matrix.txt: Uses size categories for distance penalties
- regional_trade_patterns_corrected.txt: References size categories in vessel_size_rules
- MASTER_SCORING_SYSTEM.txt: All criteria use vessel size for score adjustments

SIZE IMPACT ON SCORING:
- Small vessels (SC, C): Very sensitive to distance, seek backhaul aggressively
- Medium vessels (SH, H): Moderate distance tolerance, selective on backhaul
- Large vessels (SS, SM, PM): High distance tolerance, can ballast for positioning

SCOPE LIMITATIONS:
✓ INCLUDED: Dry cargo bulk carriers, general cargo (bulk ops)
✗ EXCLUDED: Oil tankers, chemical tankers, LNG/LPG, containers, RoRo, pure breakbulk

EXAMPLE USAGE:
- Vessel DWT 8,500 → Category C (Coaster) → High ballast sensitivity
- Vessel DWT 55,000 → Category SM (Supramax) → Low ballast sensitivity
- Cargo Black Sea-Med grain → Prefer C/SH sizes (4,001-24,000 DWT)

**Size category used across all scoring criteria:**
   - P1 (Proximity): Distance penalty scaling
   - P1A (Regional Patterns): Size-specific trade pattern rules
   - P2 (Regional Preferences): Size preferences for regions
   - P3 (Cargo Preferences): Cargo-vessel size compatibility
   - P4 (Last Ports): Size-specific return patterns
   - P6 (Intake Capacity): Size-based capacity calculations
   - P7 (OpenArea Comments): Size-specific readiness interpretation

### Important Notes:
- DWT is the ONLY input needed for size categorization
- Categories are mutually exclusive (no overlap in ranges)
- This file is the SINGLE SOURCE OF TRUTH - never hardcode ranges elsewhere
- If vessel type is not bulk carrier, skip size-based scoring
- Size category must be included in all scoring responses for transparency

---

## FOR AI/LangChain (Size Categorization Implementation)

### Step-by-Step Algorithm:

**STEP 1: Validate Input**
```
Required: vessel_dwt (integer or float, > 0)
Optional: vessel_type (for scope validation)

Validation:
- IF vessel_dwt <= 0: REJECT with error "Invalid DWT"
- IF vessel_type NOT in [bulk_carrier, general_cargo, multi_purpose]: 
    WARN "Vessel may be outside scope" but CONTINUE
```

**STEP 2: Determine Size Category**
```
Based on vessel_dwt, match to ONE category:

IF dwt >= 0 AND dwt <= 4000:
    category = "SC" (Small Coasters)
    
ELSE IF dwt >= 4001 AND dwt <= 17000:
    category = "C" (Coasters)
    
ELSE IF dwt >= 17001 AND dwt <= 24000:
    category = "SH" (Small Handy)
    
ELSE IF dwt >= 24001 AND dwt <= 40000:
    category = "H" (Handy)
    
ELSE IF dwt >= 40001 AND dwt <= 50000:
    category = "SS" (Small Supramax)
    
ELSE IF dwt >= 50001 AND dwt <= 65000:
    category = "SM" (Supramax)
    
ELSE IF dwt >= 65000 AND dwt <= 80000:
    category = "PM" (Panamax)
    
ELSE IF dwt > 80000:
    category = "OVERSIZED" (outside current scope)
    NOTE: "Vessel larger than Panamax, may need special handling"
```

**STEP 3: Retrieve Category Characteristics**
```
Look up category in vessel_sizes section:
- dwt_range
- typical_characteristics
- typical_uses
- examples
- notes (if any)
```

**STEP 4: Retrieve Economic Behavior**
```
Look up category in economics_by_size section:
- daily_operating_cost
- ballast_cost_sensitivity
- backhaul_seeking_behavior
- viable_ballast_distance
```

**STEP 5: Retrieve Trade Patterns**
```
Determine size group for trade patterns:
- small_coasters_and_coasters: SC, C
- small_handy_and_handy: SH, H
- supramax_and_panamax: SS, SM, PM

Retrieve:
- primary_regions
- typical_routes
- ballast_strategy
- notes (if any)
```

**STEP 6: Calculate Scoring Impact**
```
Based on category, determine impact on scoring:

Proximity Penalty (from ai_scoring_guidelines):
- SC: "Very high penalty per 100nm" → -30 to -50 for long ballast
- C: "High penalty per 100nm" → -20 to -40 for long ballast
- SH: "Medium penalty per 100nm" → -15 to -30 for long ballast
- H: "Medium-low penalty per 100nm" → -10 to -20 for long ballast
- SS/SM/PM: "Low penalty per 100nm" → -5 to -15 for long ballast
```

## QUICK REFERENCE

**Size Categories (7 total):**
- SC: 0-4,000 DWT (Small Coasters)
- C: 4,001-17,000 DWT (Coasters) ← Most common Black Sea-Med
- SH: 17,001-24,000 DWT (Small Handy)
- H: 24,001-40,000 DWT (Handy) ← NOT common in Greek trades
- SS: 40,001-50,000 DWT (Small Supramax)
- SM: 50,001-65,000 DWT (Supramax)
- PM: 65,000-80,000 DWT (Panamax)

**Ballast Tolerance:**
- SC/C: Very low/low - avoid long ballast
- SH/H: Medium - selective on ballast
- SS/SM/PM: High/very high - can ballast for positioning

**Typical Trades:**
- SC/C: Black Sea-Med, regional short haul
- SH/H: Medium to long haul, cross-Med
- SS/SM/PM: Global deep sea, trans-ocean

**Proximity Impact:**
- Smaller vessels = higher distance penalty
- Larger vessels = lower distance penalty

**Cargo Type Fit:**
- Black Sea-Med grain: C, SH preferred
- Black Sea-Far East grain: SM, PM preferred
- Steel/fertilizers: C, SH preferred

**Scope:**
- ✓ Dry cargo bulk, general cargo (bulk ops)
- ✗ Tankers, containers, RoRo, LNG/LPG

# ═══════════════════════════════════════════════════════════════════
# VESSEL SIZE CATEGORIES - DRY CARGO
# ═══════════════════════════════════════════════════════════════════

vessel_sizes:
  
  small_coasters:
    dwt_range: [0, 4000]
    dwt_min: 0
    dwt_max: 4000
    category_code: "SC"
    
    typical_characteristics:
      trade_area: "Very short haul, coastal, inland waterways"
      ballast_tolerance: "Very low - must find cargo"
      
    typical_uses:
      - "River navigation"
      - "Small coastal parcels"
      - "Short sea shipping"
      - "Inland waterways (Danube, Rhine, etc)"
      
    examples:
      - "Small river-sea vessels"
      - "Coastal feeders"
      
  coasters:
    dwt_range: [4001, 17000]
    dwt_min: 4001
    dwt_max: 17000
    category_code: "C"
    
    typical_characteristics:
      trade_area: "Short to medium haul"
      ballast_tolerance: "Low - prefer backhaul"
      typical_routes: "Black Sea-Med, Med-Med, regional trades"
      
    typical_uses:
      - "Regional grain trades"
      - "Steel products"
      - "Fertilizers"
      - "General bulk"
      - "Bagged cargoes"
      
    sub_categories:
      small_coasters:
        dwt_range: [4001, 8000]
        notes: "Lower end coasters"
        
      medium_coasters:
        dwt_range: [8001, 12000]
        notes: "Most common coaster size"
        
      large_coasters:
        dwt_range: [12001, 17000]
        notes: "Upper end coasters"
    
    examples:
      - "Typical Black Sea grain vessels"
      - "Med short haul bulk"
      
  small_handy:
    dwt_range: [17001, 24000]
    dwt_min: 17001
    dwt_max: 24000
    category_code: "SH"
    
    typical_characteristics:
      trade_area: "Medium to long haul"
      ballast_tolerance: "Medium"
      typical_routes: "Cross-Med, Black Sea-North Africa, regional"
      
    typical_uses:
      - "Larger grain parcels"
      - "Steel products"
      - "Fertilizers"
      - "Ore parcels"
      
    examples:
      - "Transitional size between coaster and handy"
      
  handy:
    dwt_range: [24001, 40000]
    dwt_min: 24001
    dwt_max: 40000
    category_code: "H"
    
    typical_characteristics:
      trade_area: "Long haul capable"
      ballast_tolerance: "Medium-high"
      typical_routes: "Trans-ocean, long distance trades"
      
    typical_uses:
      - "Large grain parcels"
      - "Coal"
      - "Iron ore"
      - "Long haul bulk"
      
    notes:
      - "NOT common in Greek trades (per Vitaly)"
      - "More common in Atlantic, long haul trades"
      
    examples:
      - "Handysize bulk carriers"
      
  small_supramax:
    dwt_range: [40001, 50000]
    dwt_min: 40001
    dwt_max: 50000
    category_code: "SS"
    
    typical_characteristics:
      trade_area: "Long haul, deep sea"
      ballast_tolerance: "High"
      typical_routes: "Trans-ocean, far distances"
      
    typical_uses:
      - "Large grain parcels to Far East"
      - "Coal"
      - "Iron ore"
      - "Major bulk commodities"
      
  supramax:
    dwt_range: [50001, 65000]
    dwt_min: 50001
    dwt_max: 65000
    category_code: "SM"
    
    typical_characteristics:
      trade_area: "Global deep sea"
      ballast_tolerance: "Very high - can absorb long ballast"
      typical_routes: "Major trade routes, long haul"
      
    typical_uses:
      - "Major bulk commodity trades"
      - "Grain to Far East"
      - "Coal, iron ore"
      - "Trans-ocean routes"
      
  panamax:
    dwt_range: [65000, 80000]
    dwt_min: 65000
    dwt_max: 80000
    category_code: "PM"
    
    typical_characteristics:
      trade_area: "Global major routes"
      ballast_tolerance: "Very high"
      typical_routes: "Major bulk trade lanes"
      
    typical_uses:
      - "Large grain shipments"
      - "Major coal/ore trades"
      - "Trans-ocean bulk"
      
    notes:
      - "Maximum size for Panama Canal (hence name)"
      - "Maximum practical size ex-Black Sea ports"
      
  other_sizes:
    notes: "Larger sizes (Capesize, etc) can be added later if needed"
    not_relevant_for_current_scope: true

# ═══════════════════════════════════════════════════════════════════
# VESSEL SIZE ECONOMICS
# ═══════════════════════════════════════════════════════════════════

economics_by_size:
  
  small_coasters:
    daily_operating_cost: "lowest"
    ballast_cost_sensitivity: "very high"
    backhaul_seeking_behavior: "aggressive - must find cargo"
    viable_ballast_distance: "< 300 nm"
    
  coasters:
    daily_operating_cost: "low"
    ballast_cost_sensitivity: "high"
    backhaul_seeking_behavior: "strong preference for backhaul"
    viable_ballast_distance: "< 800 nm"
    
  small_handy:
    daily_operating_cost: "medium-low"
    ballast_cost_sensitivity: "medium-high"
    backhaul_seeking_behavior: "moderate"
    viable_ballast_distance: "< 1200 nm"
    
  handy:
    daily_operating_cost: "medium"
    ballast_cost_sensitivity: "medium"
    backhaul_seeking_behavior: "selective"
    viable_ballast_distance: "< 2000 nm"
    
  small_supramax:
    daily_operating_cost: "medium-high"
    ballast_cost_sensitivity: "low-medium"
    backhaul_seeking_behavior: "selective"
    viable_ballast_distance: "< 3000 nm"
    
  supramax:
    daily_operating_cost: "high"
    ballast_cost_sensitivity: "low"
    backhaul_seeking_behavior: "opportunistic - can ballast if rates justify"
    viable_ballast_distance: "< 5000 nm"
    
  panamax:
    daily_operating_cost: "very high"
    ballast_cost_sensitivity: "very low"
    backhaul_seeking_behavior: "strategic - ballast acceptable for positioning"
    viable_ballast_distance: "> 5000 nm possible"

# ═══════════════════════════════════════════════════════════════════
# SIZE-SPECIFIC TRADE PATTERNS
# ═══════════════════════════════════════════════════════════════════

trade_patterns_by_size:
  
  small_coasters_and_coasters:
    primary_regions:
      - "Black Sea"
      - "Mediterranean"
      - "Marmara Sea"
      - "Adriatic"
      - "Short sea shipping"
      
    typical_routes:
      - "Black Sea → Mediterranean"
      - "Black Sea → North Africa"
      - "Mediterranean internal"
      - "Marmara → Black Sea"
      
    ballast_strategy:
      - "Avoid long ballast at all costs"
      - "Seek backhaul aggressively"
      - "Prefer short positioning legs"
      
  small_handy_and_handy:
    primary_regions:
      - "Regional to medium distance"
      - "Can do longer hauls but prefer medium"
      
    typical_routes:
      - "Black Sea → North Africa"
      - "Mediterranean → Atlantic"
      - "Regional bulk trades"
      
    ballast_strategy:
      - "Can consider medium ballast legs"
      - "Still prefer backhaul when economical"
      
    notes:
      - "Handy size NOT common in Greek trades"
      
  supramax_and_panamax:
    primary_regions:
      - "Global trades"
      - "Long haul routes"
      
    typical_routes:
      - "Black Sea → Far East"
      - "Atlantic → Pacific"
      - "Major bulk trade lanes"
      
    ballast_strategy:
      - "Can ballast long distances if rates justify"
      - "Less pressure to find backhaul"
      - "Strategic positioning for high-paying cargoes"

# ═══════════════════════════════════════════════════════════════════
# IMPORTANT NOTES FOR AI SCORING
# ═══════════════════════════════════════════════════════════════════

ai_scoring_guidelines:
  
  critical_rules:
    - "ALWAYS use correct DWT ranges from this file"
    - "Smaller vessels = higher penalty for long ballast"
    - "Larger vessels = more tolerant of ballast positioning"
    - "Coasters in Asia = likely working local market, not positioning"
    - "Supramax+ in Asia = could be positioning from Black Sea"
    
  size_impact_on_scoring:
    - "Small coaster long ballast: -30 to -50 score"
    - "Coaster long ballast: -20 to -40 score"
    - "Small handy long ballast: -15 to -30 score"
    - "Handy long ballast: -10 to -20 score"
    - "Supramax+ long ballast: -5 to -15 score"
    
  proximity_multiplier:
    concept: "Closer = Better, scaled by vessel size"
    formula: "Base score × (1 - distance_penalty)"
    distance_penalty_by_size:
      small_coasters: "Very high penalty per 100nm"
      coasters: "High penalty per 100nm"
      small_handy: "Medium penalty per 100nm"
      handy: "Medium-low penalty per 100nm"
      supramax_panamax: "Low penalty per 100nm"

# ═══════════════════════════════════════════════════════════════════
# CARGO TYPE vs VESSEL SIZE PREFERENCES
# ═══════════════════════════════════════════════════════════════════

cargo_vessel_size_fit:
  
  grain_black_sea_to_med:
    preferred_sizes:
      - "Coasters: 4001-17000 DWT"
      - "Small handy: 17001-24000 DWT"
    rare_sizes:
      - "Handy: 24001-40000 DWT (not common for Med)"
      
  grain_black_sea_to_far_east:
    preferred_sizes:
      - "Supramax: 50001-65000 DWT"
      - "Panamax: 65000-80000 DWT"
    minimum_practical:
      - "Small supramax: 40001-50000 DWT"
      
  steel_products:
    preferred_sizes:
      - "Coasters: 4001-17000 DWT"
      - "Small handy: 17001-24000 DWT"
      
  fertilizers:
    preferred_sizes:
      - "Coasters: 4001-17000 DWT"
      - "Small handy: 17001-24000 DWT"
      
  bauxite_ore:
    preferred_sizes:
      - "Coasters: 8001-17000 DWT"
      - "Small handy: 17001-24000 DWT"

# ═══════════════════════════════════════════════════════════════════
# SCOPE DEFINITION
# ═══════════════════════════════════════════════════════════════════

scope:
  included:
    - "Dry cargo bulk carriers"
    - "General cargo vessels (if carrying bulk)"
    - "Multi-purpose vessels (for bulk operations)"
    
  excluded:
    - "Oil tankers"
    - "Chemical tankers"
    - "LNG/LPG carriers"
    - "Container ships"
    - "RoRo vessels"
    - "Pure breakbulk (non-bulk cargo)"
    
  notes:
    - "This system focuses exclusively on DRY BULK shipping"
    - "Oil and liquid cargo not considered"


