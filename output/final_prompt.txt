
--- START OF estimator-prompts/COMMENTS_PROCESSING_GUIDE.txt ---
# ═══════════════════════════════════════════════════════════════════
# COMMENTS PROCESSING GUIDE - UPDATED v2.0
# VK Charts AI Scoring System
# ═══════════════════════════════════════════════════════════════════
#
# CHANGES IN v2.0:
# - Updated P2 scoring gradations: spec (7.5), ok (5.0), try (3.0)
# - Clarified load region (7.5) + discharge region (7.5) = 15 total split
# - Added explicit examples for load/discharge separation
# - Maintained all other parsing rules from v1.0
#
# ═══════════════════════════════════════════════════════════════════

version: "2.0"
date: "2026-01-19"
priority: "CRITICAL - Comments contain expert non-structured knowledge"

# ═══════════════════════════════════════════════════════════════════
# SHORT SUMMARY
# ═══════════════════════════════════════════════════════════════════

purpose: |
  This document defines how AI must read, interpret, and apply comments
  from Companies, Vessels, and Persons during scoring and offer generation.
  
  The comments contain expert, non-structured knowledge:
  - Cargo preferences
  - Geographic restrictions  
  - Intake data
  - Technical limitations
  - Behavioral and communication notes
  
  AI must extract structured meaning from unstructured comments, filter
  them by relevance to current cargo, resolve contradictions, and incorporate
  them into scoring and offer text reasoning.

# ═══════════════════════════════════════════════════════════════════
# DATA SOURCES
# ═══════════════════════════════════════════════════════════════════

data_sources:
  
  company_comments:
    database_field: "companies.comments"
    example: "spec: turkish domestic cargoes, Italy ok, greece ok, eu ok, cvb ok, continent ok"
    
    typical_content:
      - "Specialization patterns"
      - "Geographic preferences"
      - "Cargo type preferences"
      - "Communication preferences"
      - "Payment history"
      - "Reliability notes"
      - "Special requirements"
      
  vessel_comments:
    database_field: "vessels.comments"
    example: "Real intake: Corn, draft 7m, Izmail = 4800t"
    
    typical_content:
      - "Technical specifications"
      - "Performance data"
      - "Intake records"
      - "Port restrictions"
      - "Maintenance issues"
      - "Crew information"
      - "Historical behavior"
      
  person_comments:
    database_field: "people.comments"
    example: "Prefers WhatsApp communication, responds within 1 hour"
    
    typical_content:
      - "Communication style"
      - "Response patterns"
      - "Decision-making authority"
      - "Language preferences"
      - "Time zone considerations"

# ═══════════════════════════════════════════════════════════════════
# PARSING STRATEGY
# ═══════════════════════════════════════════════════════════════════

parsing_strategy:
  
  principle: "Extract structured information from unstructured text"
  
  step_1_keyword_detection:
    description: "Identify key patterns and keywords"
    
    patterns:
      
      specialization:
        keywords: ["spec:", "specializes", "mainly", "mostly"]
        examples:
          - "spec: turkish domestic cargoes"
          - "specializes in grain trades"
          - "mainly works Black Sea"
          
      geographic_preferences:
        keywords: ["ok", "no", "cannot", "avoids", "prefers", "try"]
        examples:
          - "Italy ok, greece ok, eu ok"
          - "no Egypt"
          - "cannot work Libya"
          - "avoids Turkey"
          - "try POC"
          
      cargo_preferences:
        keywords: ["cargo:", "loads", "carries", "no bulk"]
        examples:
          - "cargo: grain only"
          - "loads steel products"
          - "no bulk fertilizers"
          
      technical_info:
        keywords: ["intake:", "draft", "gear", "speed"]
        examples:
          - "Real intake: Wheat 5200t"
          - "draft restricted to 7m"
          - "geared vessel"
          
      behavioral_notes:
        keywords: ["always", "never", "typically", "usually"]
        examples:
          - "always asks for freight first"
          - "never responds weekends"
          - "typically ballasts to Black Sea"
          
  step_2_relevance_filtering:
    description: "Extract only information relevant to current cargo"
    
    relevance_rules:
      geographic:
        - "If comment mentions cargo loading/discharge region → RELEVANT"
        - "If comment mentions country → RELEVANT"
        - "If general restriction → RELEVANT"
        
      cargo_type:
        - "If comment mentions cargo type → RELEVANT"
        - "If comment about capacity → RELEVANT"
        - "If technical restrictions → RELEVANT"
        
      communication:
        - "Always relevant for offer text generation"
        
  step_3_conflict_resolution:
    description: "Handle contradictions between sources"
    
    priority_order:
      1: "Vessel comments (most specific)"
      2: "Person comments (behavioral patterns)"
      3: "Company comments (general policies)"
      4: "Formal preferences (UI settings)"

# ═══════════════════════════════════════════════════════════════════
# P2 OWNER PREFERENCES SCORING - UPDATED v2.0
# ═══════════════════════════════════════════════════════════════════

p2_owner_preferences_scoring_v2:
  
  total_score: 15
  
  score_split:
    load_region_score: 7.5
    discharge_region_score: 7.5
    
    principle: |
      P2 evaluates preferences for BOTH loading and discharge regions.
      Each region contributes 7.5 points to total 15 points.
      
      This reflects reality: owners care about BOTH where cargo loads
      AND where it discharges. A perfect match requires both.
  
  # ─────────────────────────────────────────────────────────────────
  # SCORING GRADATIONS
  # ─────────────────────────────────────────────────────────────────
  
  keyword_gradations:
    
    spec_specialization:
      keywords: ["spec:", "specializes", "specialized in"]
      score_value: 7.5
      interpretation: "PRIMARY specialization - this is core business"
      examples:
        - "spec: ukraine" for Ukrainian load → 7.5/7.5
        - "spec: turkey" for Turkish discharge → 7.5/7.5
        - "spec: Black Sea grain" for BS grain cargo → 7.5/7.5
      
    ok_acceptable:
      keywords: ["ok", "acceptable", "willing"]
      score_value: 5.0
      interpretation: "INTERMEDIATE - between primary and secondary"
      examples:
        - "ukraine ok" for Ukrainian load → 5.0/7.5
        - "turkey ok" for Turkish discharge → 5.0/7.5
        - "EU ok" for European discharge → 5.0/7.5
      
    try_secondary:
      keywords: ["try", "may try", "can try"]
      score_value: 3.0
      interpretation: "SECONDARY option - willing but not preferred"
      examples:
        - "try POC" for POC load → 3.0/7.5
        - "try Med" for Med discharge → 3.0/7.5
      
      citations:
        - "Correction (akdeniz): 'try POC' means secondary option, not primary"
      
    no_mention:
      score_value: 0.0
      interpretation: "NEUTRAL - no preference stated, no penalty"
      note: "No comment = no bonus, no penalty"
      
    negative_no:
      keywords: ["no", "cannot", "avoid", "never"]
      score_value: -7.5
      interpretation: "NEGATIVE preference - actively avoid"
      examples:
        - "no Egypt" for Egyptian discharge → -7.5/7.5
        - "cannot work Libya" → -7.5/7.5
        - "avoid Turkey" → -7.5/7.5
  
  # ─────────────────────────────────────────────────────────────────
  # LOAD vs DISCHARGE SEPARATION
  # ─────────────────────────────────────────────────────────────────
  
  load_discharge_separation:
    
    principle: |
      Comments must be interpreted in context of cargo route.
      A comment about "ukraine" applies to:
      - LOAD region if cargo loads FROM Ukraine
      - DISCHARGE region if cargo discharges TO Ukraine
      - GENERAL if comment doesn't specify load/discharge
    
    interpretation_rules:
      
      explicit_load_comment:
        format: "loads from X" or "loading: X"
        application: "Apply to load_region_score only"
        example: "loads from Ukraine" → 7.5 to load region
        
      explicit_discharge_comment:
        format: "discharges to X" or "destination: X"
        application: "Apply to discharge_region_score only"
        example: "destination: Turkey" → 7.5 to discharge region
        
      region_only_comment:
        format: "spec: ukraine" or "turkey ok" (no load/discharge specified)
        application: "Apply to whichever region matches cargo"
        
        example_1:
          comment: "spec: ukraine"
          cargo: "Chornomorsk → Yarimca"
          interpretation: "Ukraine is LOAD region"
          scoring: "7.5 to load_region_score, 0 to discharge_region_score"
          
        example_2:
          comment: "spec: turkey"
          cargo: "Chornomorsk → Yarimca"
          interpretation: "Turkey is DISCHARGE region"
          scoring: "0 to load_region_score, 7.5 to discharge_region_score"
          
        example_3:
          comment: "spec: ukraine, turkey ok"
          cargo: "Chornomorsk → Yarimca"
          interpretation: "Ukraine=load (spec), Turkey=discharge (ok)"
          scoring: "7.5 load + 5.0 discharge = 12.5/15 total"
      
      general_region_comment:
        format: "spec: Black Sea" or "spec: Mediterranean"
        application: "Split proportionally if both load and discharge in region"
        
        example:
          comment: "spec: Black Sea"
          cargo: "Chornomorsk → Constanta" (both Black Sea)
          interpretation: "Both regions match"
          scoring: "3.75 load + 3.75 discharge = 7.5/15 total"
          note: "Split the 7.5 points equally when comment covers both"
  
  # ─────────────────────────────────────────────────────────────────
  # SCORING EXAMPLES
  # ─────────────────────────────────────────────────────────────────
  
  scoring_examples:
    
    example_1_perfect_match:
      comment: "spec: ukraine, spec: turkey"
      cargo: "Chornomorsk → Yarimca"
      
      calculation:
        ukraine_load: 7.5
        turkey_discharge: 7.5
        total: 15.0
      
      reasoning: "Perfect specialization match for both load and discharge regions"
    
    example_2_mixed_match:
      comment: "spec: ukraine, turkey ok"
      cargo: "Chornomorsk → Yarimca"
      
      calculation:
        ukraine_load: 7.5
        turkey_discharge: 5.0
        total: 12.5
      
      reasoning: "Strong Ukraine spec, Turkey acceptable"
      citations:
        - "Updated v2.0: 'ok' = 5.0 points (intermediate level)"
    
    example_3_secondary_option:
      comment: "try POC, turkey ok"
      cargo: "Chornomorsk → Yarimca"
      
      calculation:
        poc_load: 3.0
        turkey_discharge: 5.0
        total: 8.0
      
      reasoning: "POC is secondary option, Turkey acceptable"
      citations:
        - "Correction (akdeniz): 'try POC' = secondary, score 3.0"
    
    example_4_negative:
      comment: "ukraine ok, no turkey"
      cargo: "Chornomorsk → Yarimca"
      
      calculation:
        ukraine_load: 5.0
        turkey_discharge: -7.5
        total: -2.5
        adjusted_total: 0
      
      reasoning: "Negative for Turkey discharge, minimum P2 score is 0"
      note: "P2 score cannot go below 0"
    
    example_5_no_comments:
      comment: ""
      cargo: "Chornomorsk → Yarimca"
      
      calculation:
        ukraine_load: 0
        turkey_discharge: 0
        total: 0
      
      reasoning: "No preferences stated, neutral score"

# ═══════════════════════════════════════════════════════════════════
# INTEGRATION WITH OTHER CRITERIA
# ═══════════════════════════════════════════════════════════════════

integration_notes:
  
  p3_cargo_preferences:
    description: "Comments about cargo types"
    examples:
      - "cargo: grain only" → boost P3 if grain cargo
      - "no fertilizers" → penalty P3 if fertilizer cargo
    
  p4_port_familiarity:
    description: "Comments about specific ports"
    examples:
      - "knows Odessa well" → boost P4
      - "avoid Italian ports" → penalty P4
    
  p5_intake:
    description: "Comments with actual intake data"
    examples:
      - "Real intake: Wheat 5200t at Izmail" → override calculated intake
      - "draft 7m max" → affects intake calculation
    
  offer_personalization:
    description: "Comments about communication style"
    examples:
      - "prefers short messages" → adjust offer tone
      - "responds fast on WhatsApp" → mention in offer

# ═══════════════════════════════════════════════════════════════════
# CRITICAL AI INSTRUCTIONS
# ═══════════════════════════════════════════════════════════════════

ai_must:
  - "ALWAYS parse comments for all three sources (company, vessel, person)"
  - "ALWAYS apply load/discharge separation for P2 scoring"
  - "ALWAYS use explicit score values: spec=7.5, ok=5.0, try=3.0"
  - "ALWAYS respect priority: vessel > person > company"
  - "ALWAYS cite specific comment text in reasoning"

ai_must_not:
  - "Never ignore 'try' keyword (it means SECONDARY, not PRIMARY)"
  - "Never apply same regional comment to both load and discharge without logic"
  - "Never exceed 15 points for P2 (7.5 + 7.5 max)"
  - "Never allow P2 to go below 0 (floor at zero)"

# ═══════════════════════════════════════════════════════════════════
# END OF COMMENTS PROCESSING GUIDE v2.0
# ═══════════════════════════════════════════════════════════════════


--- START OF estimator-prompts/MASTER_SCORING_SYSTEM.txt ---
MASTER_SCORING_SYSTEM

SHORT SUMMARY

This is the SINGLE SOURCE OF TRUTH for the VK Charts vessel-cargo scoring system.
It defines all 7 scoring criteria (P1-P7), their weights, ranges, calculation sources, and how they combine into a final compatibility score (0-100 points).

The system evaluates:
• P1 (20pts): Geographic proximity (distance-based)
• P1A (15pts): Regional trade patterns (market logic)
• P2 (15pts): Regional preferences (manual owner settings)
• P2A (20pts): PSC port accessibility (vessel PSC status vs port strictness)
• P3 (15pts): Cargo type compatibility
• P4 (10pts): Last ports familiarity
• P5 (15pts): Intake capacity match
• P6 (modifier, -50 to +25): Current voyage preferences (OpenArea comments)
• P7 (10pts): Timing and readiness (ETA vs laycan)

BASE_SCORE = P1 + P1A + P2 + P2A + P3 + P4 + P5 + P7 (max 115)
MODIFIED_SCORE = BASE_SCORE + P6
FINAL_SCORE = CLAMP(MODIFIED_SCORE, 0, 100)

Blocking conditions: technical impossibility, insufficient capacity, geopolitical restrictions, or P6 ≤ -40.

**Quick Reference - Scoring Ranges:**
P1: [0, 20] | P1A: [0, 15] | P2: [0, 15] | P2A: [0, 20] | P3: [0, 15] | P4: [0, 10] | P5: [0, 15] | P6: [-50, +25] | P7: [0, 10]

# ═══════════════════════════════════════════════════════════════════
# SCORING CRITERIA STRUCTURE
# ═══════════════════════════════════════════════════════════════════

scoring_criteria:
  
  # ─────────────────────────────────────────────────────────────────
  P1_PROXIMITY:
    name: "Geographic Proximity"
    weight: 20  # out of 100
    range: [0, 20]
    
    description: |
      Measures geographic distance and economic viability of ballast leg
      from vessel's current position to loading port.
      
    calculation_source: "proximity_scoring_matrix.txt"
    
    dependencies:
      - file: "vessel_location_determination.txt"
        purpose: "Determine vessel's effective location"
      - file: "vessel_size_classification.txt"
        purpose: "Size-based distance penalties"
      - file: "port_restrictions_map.txt"
        purpose: "Port accessibility validation"
    
    key_factors:
      - "Distance in nautical miles"
      - "Vessel size (affects ballast economics)"
      - "Geographic barriers (straits, canals)"
      - "Geopolitical restrictions"
    
    scoring_logic: |
      1. Determine vessel location via vessel_location_determination
      2. Calculate proximity level (same port → far region)
      3. Apply size-based adjustments
      4. Scale to 0-20 range
    
    blocking_conditions:
      - "Ukraine-Russia sanctions block"
      - "Port physically inaccessible for vessel size"

  # ─────────────────────────────────────────────────────────────────
  P1A_REGIONAL_PATTERNS:
    name: "Regional Trade Patterns"
    weight: 15
    range: [0, 15]
    
    description: |
      Evaluates market logic of vessel positioning from current region
      to loading region based on typical trade flows.
      
    calculation_source: "regional_trade_patterns.txt"
    
    dependencies:
      - file: "cargo_export_map.txt"
        purpose: "Typical cargo flows and vessel sizes"
      - file: "vessel_size_classification.txt"
        purpose: "Size economics and behavior"
      - file: "learning_session_1.txt"
        purpose: "Expert corrections and overrides"
    
    key_factors:
      - "Region pairs (from → to patterns)"
      - "Vessel size economics"
      - "Seasonal patterns"
      - "Backhaul probability"
    
    scoring_logic: |
      1. Find region_pair pattern for vessel_location → loading_region
      2. Apply vessel size bucket rules
      3. Apply seasonal adjustments
      4. Scale to 0-15 range
      
    important_note: |
      Uses CURRENT vessel position region, NOT last discharge region

  # ─────────────────────────────────────────────────────────────────
  P2_REGIONAL_PREFERENCES:
    name: "Owner's Regional Preferences"
    weight: 15
    range: [0, 15]
    
    description: |
      Manual preferences for countries/regions from company/vessel settings
      and comments history.
      
    calculation_source: "COMMENTS_PROCESSING_GUIDE.txt"
    
    data_sources:
      - "Company settings (specializes/prefers/avoids)"
      - "Vessel snapshot settings"
      - "Historical comments patterns"
    
    preference_levels:
      specializes: "+15 points"
      prefers: "+10 points"
      can_work: "+5 points"
      neutral: "0 points"
      avoids: "-10 points"
      cannot_work: "-15 points"
    
    priority_hierarchy:
      1: "Vessel-specific settings"
      2: "Person preferences"
      3: "Company-wide settings"
      4: "Formal UI settings"
  # ─────────────────────────────────────────────────────────────────
  P2A_PSC_PORT_ACCESSIBILITY:
    name: "PSC Port Accessibility"
    weight: 20
    range: [0, 20]
    
    description: |
      Evaluates whether a vessel can enter a port based on Port State
      Control (PSC) status and port's PSC enforcement severity.
      Reflects real shipowner behavior: vessels with poor PSC records
      AVOID strict ports (detention risk) and PREFER lax ports.
    
    calculation_source: "P2A_PSC_PORT_ACCESSIBILITY_SCORING.txt"
    
    data_sources:
      equasis:
        - "Paris MOU status (White/Grey/Black)"
        - "Detention rate (%)"
        - "IMO number (for sanctions check)"
      external:
        - "EU sanctions list (Danish Maritime Authority)"
        - "Paris/Tokyo/USCG MOU banning lists"
    
    key_factors:
      vessel_psc_status:
        - "GOOD: Paris White or (Grey + <3% detention)"
        - "MEDIUM: Paris Grey + 3-8% detention"
        - "POOR: Paris Black or >8% detention"
        - "BANNED: Currently banned from MOU region"
      
      port_psc_severity:
        - "VERY_STRICT: Italy, France, Greece, Germany, Netherlands, Belgium, UK, USA, Japan, Singapore"
        - "MODERATE: Turkey, Egypt, Romania, Bulgaria, Cyprus, Malta"
        - "LAX: Libya, Syria, Lebanon (weak enforcement)"
    
    scoring_logic: |
      Matrix-based scoring: Vessel_Status × Port_Severity
      
      GOOD vessel:
        - Any port: 18-20 points
      
      MEDIUM vessel:
        - Very strict port: 8-12 points
        - Moderate port: 12-15 points
        - Lax port: 15-18 points
      
      POOR vessel:
        - Very strict port: 0-5 points (CRITICAL - owner will AVOID)
        - Moderate port: 8-12 points
        - Lax port: 15-18 points (owner PREFERS lax PSC)
      
      Soft modifiers (±3 points max):
        - IACS class: +1-2 points
        - International Group P&I: +1 point
        - Age >20 years: -1 to -3 points
    
    blocking_conditions:
      hard_blocks:
        - "EU sanctions: Vessel IMO on EU sanctions list → P2A = 0 for ALL EU ports"
        - "MOU banning: Vessel banned from Paris/Tokyo/USCG MOU → P2A = 0 for that region"
      
      critical_scores:
        - "P2A ≤ 5 for Poor vessel at Very strict port → Strong signal to avoid"
    
    behavioral_logic:
      key_principle: |
        Poor PSC vessel + Lax PSC port = HIGH score (15-18)
        This is CORRECT behavior - reflects real shipowner strategy
        Vessels with PSC problems actively SEEK ports with weak enforcement
      
      critical_rules:
        - "⚠️ NEVER block on class/P&I alone (Equasis can be outdated)"
        - "⚠️ NO age restrictions for dry cargo (unlike tankers)"
        - "⚠️ EU sanctions = absolute legal block (not negotiable)"
    
    dependencies:
      - file: "P2A_PSC_PORT_ACCESSIBILITY_SCORING.txt"
        purpose: "Complete PSC scoring logic and country classifications"
    
    reasoning_template: |
      "{vessel_name} PSC status: {paris_mou}, {detention_rate}% detention rate
      {port_name}, {country}: {severity} PSC enforcement ({mou_region})
      {vessel_status} vessel + {port_severity} port → Base: {base_score}
      Modifiers: {modifiers}
      P2A = {final_score}/20 - {interpretation}"
    
    confidence_indicators:
      high: "Complete Equasis PSC data available"
      medium: "MOU status present, missing class/P&I"
      low: "Only flag data, no MOU information (assume MEDIUM status)"
  # ─────────────────────────────────────────────────────────────────
  P3_CARGO_PREFERENCES:
    name: "Cargo Type Compatibility"
    weight: 15
    range: [0, 15]
    
    description: |
      Compatibility with cargo type, technical requirements, and
      vessel capabilities.
      
    calculation_sources:
      - "COMMENTS_PROCESSING_GUIDE.txt"
      - "cargo_export_map.txt"
    
    key_factors:
      - "Cargo type match (grain/steel/fertilizers)"
      - "Technical requirements (gear/grabs/IMO)"
      - "Stowage factor compatibility"
      - "Historical cargo patterns"
    
    preference_levels:
      specializes_in_cargo: "+15 points"
      regularly_carries: "+10 points"
      can_carry: "+5 points"
      neutral: "0 points"
      avoids_cargo: "-10 points"
      cannot_carry_technically: "BLOCK"

  # ─────────────────────────────────────────────────────────────────
  P4_LAST_PORTS:
    name: "Last Ports of Call Familiarity"
    weight: 10
    range: [0, 10]
    
    description: |
      Vessel's historical familiarity with loading/discharge regions
      based on port call statistics.
      
    data_sources:
      - "Vessel's port call history (%)"
      - "Company fleet patterns (if vessel new)"
    
    scoring_logic: |
      >30% calls in region: +10 points
      20-30% calls: +7 points
      10-20% calls: +5 points
      5-10% calls: +3 points
      <5% calls: +1 point
      Never been: 0 points

  # ─────────────────────────────────────────────────────────────────
  P5_INTAKE_CAPACITY:
    name: "Cargo Intake Match"
    weight: 15
    range: [0, 15]
    
    description: |
      Vessel's ability to load required cargo quantity considering
      port restrictions and technical limitations.
      
    calculation_source: "intake_calculator_formula.txt"
    
    scoring_logic: |
      Ratio = vessel_intake / cargo_quantity
      
      ≥110%: 15 points (comfortable margin)
      100-110%: 12 points (exact fit)
      95-100%: 8 points (tight fit)
      90-95%: 3 points (requires negotiation)
      <90%: BLOCK (cannot carry)
    
    override_priority:
      1: "Manual intake from vessel comments"
      2: "Calculated intake"
      3: "DWT-based estimation"

  # ─────────────────────────────────────────────────────────────────
  P6_OPEN_AREA_COMMENTS:
    name: "Current Voyage Preferences"
    type: "MODIFIER"
    range: [-50, +25]
    
    description: |
      Owner's specific requirements for CURRENT voyage from OpenArea
      comments. Acts as modifier on top of base score.
      
    calculation_source: "OPEN_AREA_COMMENTS_SCORING.txt"
    
    key_signals:
      cargo_related:
        - "no grains / only grains"
        - "no steel / prefer steel"
        - "high SF only / no low SF"
      geography_related:
        - "no Black Sea / only Black Sea"
        - "nearby only / no long ballast"
        - "seeking backhaul to X"
      strategy_related:
        - "short trip only"
        - "repositioning to X"
        - "waiting for rates"
    
    impact_levels:
      full_conflict: "-40 to -50 → BLOCK OFFER"
      partial_conflict: "-15 to -25"
      neutral: "0"
      partial_match: "+10 to +15"
      perfect_match: "+20 to +25"
    
    blocking_rule: |
      If P6 score ≤ -40: Do not send offer, regardless of other scores

  # ─────────────────────────────────────────────────────────────────
  P7_READINESS_ETA:
    name: "Timing and Readiness"
    weight: 10
    range: [0, 10]
    
    description: |
      Vessel's ability to meet laycan dates considering current position
      and operational factors.
      
    calculation_source: "READINESSETA_TO_LOADING_PORT_SCORING.txt"
    
    key_factors:
      - "Current position and status (laden/ballast)"
      - "Distance to loading port"
      - "ETA calculation vs laycan window"
      - "Discharge time if laden"
    
    scoring_categories:
      perfect_fit: "9-10 points (within laycan)"
      slightly_early: "7-8 points (1-3 days wait)"
      slightly_late: "4-6 points (needs extension)"
      too_early_or_late: "1-3 points"
      unknown_eta: "0 points"
    
    important_note: |
      P7 focuses on CALENDAR FIT, not distance economics (that's P1)

# ═══════════════════════════════════════════════════════════════════
# SCORING CALCULATION FORMULA
# ═══════════════════════════════════════════════════════════════════

scoring_formula:
  
  base_score_calculation: |
    BASE_SCORE = P1 + P1A + P2 + P3 + P4 + P5 + P7
    (Maximum: 100 points)
  
  modifier_application: |
    MODIFIED_SCORE = BASE_SCORE + P6
    (P6 can push score above 100 or below 0)
  
  final_score: |
    FINAL_SCORE = CLAMP(MODIFIED_SCORE, 0, 100)
    (Bounded between 0 and 100)
  
  blocking_conditions:
    - condition: "P3 = CANNOT_CARRY_TECHNICALLY"
      action: "BLOCK → No score, no offer"
      
    - condition: "P5_ratio < 0.90"
      action: "BLOCK → Insufficient capacity"
      
    - condition: "P6 ≤ -40"
      action: "BLOCK → Owner explicitly avoids"
      
    - condition: "Geopolitical restriction"
      action: "BLOCK → Sanctions/war"

# ═══════════════════════════════════════════════════════════════════
# SCORING THRESHOLDS
# ═══════════════════════════════════════════════════════════════════

thresholds:
  
  classification:
    excellent_match:
      range: [85, 100]
      action: "High priority, immediate offer"
      email_template: "CASE A - Strong Match"
      
    good_match:
      range: [70, 85]
      action: "Standard offer"
      email_template: "CASE A - Standard"
      
    acceptable_match:
      range: [60, 70]
      action: "Offer with caveats"
      email_template: "CASE B - Not Ideal"
      
    marginal_match:
      range: [50, 60]
      action: "Low priority or positioning"
      email_template: "CASE B - Positioning"
      
    poor_match:
      range: [30, 50]
      action: "Only if requested"
      email_template: "CASE B - Unlikely"
      
    do_not_offer:
      range: [0, 30]
      action: "Skip unless manual override"
      email_template: "Do not send"
  
  automatic_actions:
    score_below_30: "Do not include in offer list"
    blocked_vessel: "Mark with reason, exclude completely"
    excellent_match: "Flag for immediate attention"

# ═══════════════════════════════════════════════════════════════════
# DATA NORMALIZATION RULES
# ═══════════════════════════════════════════════════════════════════

normalization:
  
  vessel_sizes:
    canonical_ranges:
      SC: [0, 4000]       # Small Coasters
      C:  [4001, 17000]   # Coasters
      SH: [17001, 24000]  # Small Handy
      H:  [24001, 40000]  # Handy
      SS: [40001, 50000]  # Small Supramax
      SM: [50001, 65000]  # Supramax
      PM: [65001, 80000]  # Panamax
    
    rule: "ALL files must use these exact ranges"
  
  regions:
    canonical_names:
      - "Black Sea"
      - "Black Sea Danube"
      - "Mediterranean"
      - "East Mediterranean"
      - "West Mediterranean"
      - "Egypt Mediterranean"
      - "Libya"
      - "Turkey"
      - "Greece"
      - "Marmara Sea"
      - "Adriatic"
      - "Atlantic"
      - "North Europe"
      - "Red Sea"
      - "Arabian Sea"
      - "Far East"
    
    rule: "Use exact names for region_pairs matching"

# ═══════════════════════════════════════════════════════════════════
# REASONING GENERATION RULES
# ═══════════════════════════════════════════════════════════════════

reasoning_templates:
  
  structure: |
    1. Overall Score: {final_score}/100
    2. Strengths: {top_scoring_criteria}
    3. Weaknesses: {low_scoring_criteria}
    4. Key Factors: {decisive_factors}
    5. Recommendation: {action}
  
  criterion_explanations:
    P1: "Vessel is {distance}nm from loading port ({proximity_level})"
    P1A: "{match_level} with typical {region_pair} trade pattern"
    P2: "Owner {preference_level} this region"
    P3: "Vessel {compatibility} with {cargo_type}"
    P4: "Vessel has {percentage}% history in this region"
    P5: "Can load {intake}t vs required {cargo_qty}t ({ratio}%)"
    P6: "Current voyage: {open_area_signal}"
    P7: "ETA {eta_date} vs laycan {laycan} ({timing_category})"
  
  blocking_explanations:
    technical: "Vessel cannot technically carry this cargo"
    capacity: "Insufficient intake capacity ({ratio}% of required)"
    owner_preference: "Owner explicitly avoids {restriction}"
    geopolitical: "Blocked due to {restriction_reason}"


--- START OF estimator-prompts/OPEN_AREA_COMMENTS_SCORING.txt ---
# ═══════════════════════════════════════════════════════════════════
# SHORT SUMMARY
# ═══════════════════════════════════════════════════════════════════

DOCUMENT: OpenArea Comments Scoring - P6 Criterion (Voyage-Specific Owner Comments)
PURPOSE: Evaluate how current voyage-specific owner comments align with cargo parameters
SCORE RANGE: [-50, +25] - Penalty-based modifier (no hard blocks)
INTEGRATION: Part of VK Charts AI Scoring System (criterion P6)

WHAT IS P6 (OpenArea Comments Scoring):
P6 evaluates how well the current cargo matches the vessel owner's voyage-specific
comments in OpenArea fields. Unlike Cargo/Regional Preferences (P2/P3) which are
long-term patterns, OpenArea Comments reflect CURRENT strategy for THIS specific
voyage: what cargoes they want now, what regions they prefer now, what voyage type
they seek now.

KEY FEATURES:
- Interprets CURRENT voyage-specific comments (not historical preferences)
- Three signal categories: Cargo-Type, Geography, Trade Pattern/Strategy
- AI-centric interpretation (extracts signals from unstructured text)
- Penalty-focused: Strong conflicts = -40 to -50, perfect match = +20 to +25
- NO HARD BLOCKS (soft rules philosophy - always show cargo with reasoning)
- High priority criterion (reflects real-time owner intentions)
- Directly influences offer text personalization

CRITICAL DISTINCTIONS:
- P3 (Cargo Preferences) = Long-term cargo type patterns
- P2 (Regional Preferences) = Long-term geographic patterns
- P6 (OpenArea Comments) = CURRENT voyage-specific strategy

These are COMPLEMENTARY criteria - P6 adds real-time context to historical patterns.

COMMENT CATEGORIES (3 types):
1. Cargo-Type Related: "no grains", "prefer high SF cargoes", "only fertilizers"
2. Geography Related: "not going to Black Sea", "only East Med", "no Egypt"
3. Trade Pattern/Strategy: "looking for short trip", "seeking repositioning", "avoid long ballast"

SCORING LOGIC:
- Full Conflict (strong negative): -40 to -50 points
  Example: "no grains" + cargo is grain → -45 points
- Soft Conflict (moderate negative): -10 to -25 points
  Example: "prefer close cargo" + cargo 800nm away → -15 points
- Neutral: 0 points (no relevant comments)
- Positive Match: +10 to +15 points
  Example: "prefer high SF cargo" + cargo SF = 1.45 → +12 points
- Perfect Match: +20 to +25 points
  Example: "looking for short trip to Egypt with high SF" + exact match → +25 points

EXAMPLE USAGE:
- Comment: "no grains, prefer nearby cargo only, seeking short trip"
- Cargo: Wheat 5000t, 800nm ballast, 5-day voyage
- Result: -45 (grain conflict) -15 (far) -10 (long trip) = -70 → clamped to -50
- Reasoning: "Strong mismatch with current preferences, but cargo shown for consideration"

PRIORITY IN SYSTEM:
High priority - placed above LPOC and Proximity because it reflects CURRENT daily
changing intentions, not historical patterns.


### Important Notes:
- OpenArea comments are CURRENT and VOYAGE-SPECIFIC
- P6 complements (not replaces) P2/P3 (historical preferences)
- Score range is ASYMMETRIC: more penalty (-50) than bonus (+25)
- NO HARD BLOCKS - even with -50, cargo is shown with reasoning
- Comments integration with COMMENTS_PROCESSING_GUIDE.txt for parsing

---

## FOR AI/LangChain (OpenArea Comment Processing Implementation)

### Step-by-Step Algorithm:

**STEP 1: Receive and Parse OpenArea Comments**
```
Input: open_area_comments (string, may be empty)

If empty: 
  P6_score = 0 (neutral)
  reasoning = "No current voyage-specific comments available"
  RETURN

Parse comments using COMMENTS_PROCESSING_GUIDE.txt patterns:
- Cargo-type signals
- Geography signals
- Strategy signals
```

**STEP 2: Extract Cargo-Type Signals**
```
Keywords to detect:
- Negative: "no", "avoid", "not", "cannot", "refuse"
- Positive: "prefer", "seeking", "looking for", "only"
- Types: "grains", "steel", "coils", "fertilizers", "high SF", "low SF"

Examples:
  "no grains" → cargo_type_signals.add({type: "grains", sentiment: "REFUSE"})
  "prefer high SF cargoes" → cargo_type_signals.add({type: "high_SF", sentiment: "PREFER"})
  "only fertilizers" → cargo_type_signals.add({type: "fertilizers", sentiment: "ONLY"})

For current cargo, check if cargo.type or cargo.stowage_factor matches:
  IF cargo.type = "Wheat" AND signal = "no grains":
    conflict = FULL
    impact = -45
```

**STEP 3: Extract Geography Signals**
```
Keywords to detect:
- Regions: "Black Sea", "Med", "Egypt", "Libya", "Adriatic", etc.
- Proximity: "nearby", "close", "local", "far", "long ballast"
- Directions: "not going to", "prefer", "only", "avoid"

Examples:
  "not going to Black Sea" → geography_signals.add({region: "Black Sea", sentiment: "REFUSE"})
  "prefer nearby cargo only" → geography_signals.add({proximity: "nearby", sentiment: "PREFER"})
  "only East Med" → geography_signals.add({region: "East Med", sentiment: "ONLY"})

For current cargo, check if regions match:
  IF cargo.loading_region = "Black Sea" AND signal = "not going to Black Sea":
    conflict = FULL
    impact = -40
    
  IF cargo.distance_ballast > 500nm AND signal = "prefer nearby cargo":
    conflict = SOFT
    impact = -15
```

**STEP 4: Extract Strategy Signals**
```
Keywords to detect:
- Voyage length: "short trip", "long haul", "quick turnaround"
- Positioning: "repositioning", "ballast", "backhaul"
- Operations: "fast loading", "avoid long ballast", "canal transit"
- Concerns: "PSC", "flag restrictions", "sanctions"

Examples:
  "looking for short trip" → strategy_signals.add({type: "voyage_length", value: "short"})
  "seeking repositioning to Continent" → strategy_signals.add({type: "positioning", destination: "Continent"})
  "avoid long ballast" → strategy_signals.add({type: "ballast", preference: "avoid_long"})

For current cargo, evaluate match:
  IF cargo.voyage_duration_days <= 3 AND signal = "looking for short trip":
    match = POSITIVE
    impact = +15
    
  IF cargo.distance_ballast > 1000nm AND signal = "avoid long ballast":
    conflict = SOFT
    impact = -20
```

**STEP 5: Calculate Conflict Levels**
```
For each signal, determine conflict level:

FULL CONFLICT:
- Direct refusal + cargo matches refused type
- "no grains" + cargo is grain
- "not going to Egypt" + cargo discharges Egypt
- Impact: -40 to -50

SOFT CONFLICT:
- Preference not met but not explicitly refused
- "prefer close cargo" + cargo 800nm away
- "prefer short trip" + cargo 7-day voyage
- Impact: -10 to -25

NEUTRAL:
- Signal not relevant to cargo
- "no steel coils" + cargo is grain
- Impact: 0

POSITIVE MATCH:
- Cargo meets stated preference
- "prefer high SF" + cargo SF = 1.45
- "seeking Egypt backhaul" + cargo to Egypt
- Impact: +10 to +15

PERFECT MATCH:
- Multiple preferences met simultaneously
- "short trip to Egypt with high SF" + cargo matches all
- Impact: +20 to +25
```

**STEP 6: Sum and Clamp Score**
```
Sum all impacts:
  cargo_type_total = sum(cargo_type_signals.impacts)
  geography_total = sum(geography_signals.impacts)
  strategy_total = sum(strategy_signals.impacts)
  
  raw_total = cargo_type_total + geography_total + strategy_total

Clamp to range:
  IF raw_total < -50:
    p6_score = -50
  ELSE IF raw_total > 25:
    p6_score = 25
  ELSE:
    p6_score = raw_total

IMPORTANT: No hard blocks - even at -50, cargo is shown
```

**STEP 7: Generate Reasoning**
```
Create human-readable explanation:

IF p6_score <= -30:
  reasoning = "Strong conflict with current voyage preferences: [list main conflicts]. However, cargo shown for consideration as circumstances may have changed."
  
ELSE IF p6_score < 0:
  reasoning = "Some mismatch with stated preferences: [list conflicts], but [list any positive aspects]."
  
ELSE IF p6_score = 0:
  reasoning = "Neutral match - no specific conflicts or strong preferences indicated in current comments."
  
ELSE IF p6_score > 0:
  reasoning = "Good match with current preferences: [list positive matches]."
  
ELSE IF p6_score >= 20:
  reasoning = "Excellent match - cargo aligns perfectly with stated voyage strategy: [list all matches]."
```

**STEP 9: Return Complete P6 Analysis**
```json
{
  "criterion_p6_score": numeric [-50, +25],
  "signals_extracted": {
    "cargo_type": [...],
    "geography": [...],
    "strategy": [...]
  },
  "breakdown": {
    "cargo_type_score": numeric,
    "geography_score": numeric,
    "strategy_score": numeric,
    "raw_total": numeric,
    "clamped_score": numeric
  },
  "reasoning": "Human-readable explanation",
  "offer_text_guidance": {
    "acknowledge_conflict": boolean,
    "conflict_text": "string",
    "positive_angle": "string"
  }
}

## FOR KNOWLEDGE BASE UPDATES (Maintenance)

### When to Update This File:

1. **New Signal Type Discovered**
   - Users consistently use new type of voyage-specific comment
   - Add to cargo_type/geography/strategy categories
   - Define keyword detection patterns
   - Document scoring impact

2. **Score Range Adjustment**
   - Market feedback suggests different penalty/bonus levels
   - Update score range or impact values
   - Coordinate with MASTER_SCORING_SYSTEM.txt
   - Document reasoning in changelog

3. **New Conflict Level Needed**
   - Current 4 levels (Full/Soft/Neutral/Positive) insufficient
   - Add new conflict level with clear definition
   - Update scoring impact range
   - Add examples

4. **Integration Point Change**
   - P7 priority in system changes
   - Update priority documentation
   - Coordinate with MASTER_SCORING_SYSTEM.txt
   - Document reasoning

5. **Offer Text Template Update**
   - New diplomatic phrasing needed for conflicts
   - User feedback on offer text effectiveness
   - Update offer_text_guidance patterns
   - Test with real scenarios

### Update Principles:
- ✓ Maintain "no hard blocks" philosophy (soft rules approach)
- ✓ Keep score range asymmetric (more penalty than bonus)
- ✓ Coordinate with COMMENTS_PROCESSING_GUIDE.txt for parsing
- ✓ Test with real OpenArea comment examples
- ✓ Ensure diplomatic conflict acknowledgment in offers
- ✓ Version bump: minor change = +0.1, major change = +1.0
- ✓ Document user feedback driving changes

### Validation Checklist:
- [ ] Score range [-50, +25] maintained
- [ ] Three signal categories comprehensive (cargo/geography/strategy)
- [ ] Conflict levels clearly defined (Full/Soft/Neutral/Positive/Perfect)
- [ ] No hard blocks in any scenario
- [ ] Offer text templates diplomatic and respectful
- [ ] Integration with COMMENTS_PROCESSING_GUIDE.txt verified
- [ ] P6 priority in MASTER_SCORING_SYSTEM.txt correct
- [ ] Real-world comment examples tested

### Testing Guidelines:
```
Test with real OpenArea comments:
1. Parse comment using signal categories
2. Extract cargo/geography/strategy signals
3. Evaluate conflict levels for test cargo
4. Calculate P6 score (verify clamping)
5. Generate reasoning text
6. Create offer text with conflict acknowledgment
7. Verify no hard blocks (cargo shown even at -50)
8. Validate against user expectations
```

---

## QUICK REFERENCE

**Score Range:** [-50, +25] (asymmetric: more penalty than bonus)

**Signal Categories (3 types):**
1. Cargo-Type: "no grains", "prefer high SF", "only fertilizers"
2. Geography: "not going to Black Sea", "prefer nearby cargo", "only East Med"
3. Strategy: "seeking short trip", "avoid long ballast", "repositioning to Continent"

**Conflict Levels:**
- Full Conflict: -40 to -50 (direct refusal + cargo matches)
- Soft Conflict: -10 to -25 (preference not met)
- Neutral: 0 (signal not relevant)
- Positive Match: +10 to +15 (meets preference)
- Perfect Match: +20 to +25 (multiple preferences met)

**Key Principles:**
- NO HARD BLOCKS (cargo always shown with reasoning)
- Voyage-specific (current strategy, not historical patterns)
- High priority (reflects real-time owner intentions)
- Complements P2/P3 (adds current context to historical preferences)

**Example Scoring:**
- "no grains" + wheat cargo = -45 points
- "prefer nearby" + 800nm away = -15 points
- "seeking Egypt" + Egypt cargo = +15 points
- "short trip high SF to Egypt" + perfect match = +25 points

**Offer Text Approach:**
- Full Conflict: Acknowledge honestly, find positive angle
- Soft Conflict: Explain difference, emphasize strengths
- Positive Match: Highlight perfect alignment with preferences

**Critical Notes:**
- P7 changes daily/weekly (not stable like P2/P3)
- Use COMMENTS_PROCESSING_GUIDE.txt for parsing
- Diplomatic conflict acknowledgment required
- Even -50 score doesn't block cargo display


# ═══════════════════════════════════════════════════════════════════
# OPEN AREA COMMENTS SCORING
# VK Charts AI Scoring System - Criterion P6
# ═══════════════════════════════════════════════════════════════════
#
# Оценка соответствия груза текущим voyage-specific комментариям владельца
#
# ═══════════════════════════════════════════════════════════════════

version: "1.2"
last_updated: "2024-12-01"
criterion_code: "P6"
score_range: [-50, 25]
priority: "HIGH - Reflects current real-time owner intentions"

# ═══════════════════════════════════════════════════════════════════
# CRITERION DEFINITION
# ═══════════════════════════════════════════════════════════════════

definition:
  name: "OpenArea Comments Scoring"
  description: |
    Оценка того, насколько текущие, voyage-specific комментарии владельца 
    судна совпадают или конфликтуют с грузом. AI интерпретирует сигналы 
    по трем направлениям (cargo, geography, strategy), применяет бонусы 
    или штрафы, и использует комментарии в reasoning и оффере.
    
  key_characteristics:
    - "Voyage-specific (не долговременные паттерны)"
    - "Высокий приоритет (отражает текущие намерения)"
    - "Нет жестких блоков (только penalties)"
    - "AI-centric интерпретация"
    - "Дипломатичное использование в оффере"
    
  what_it_is_not:
    - "Это НЕ Cargo Preferences (P3) - те долговременные"
    - "Это НЕ Regional Preferences (P2) - те долговременные"
    - "Это НЕ формальные настройки из UI"
    
  relationship_to_other_criteria:
    complements: ["P2 (Regional Preferences)", "P3 (Cargo Preferences)"]
    overrides: []  # Не отменяет другие критерии, дополняет
    priority_level: "HIGH - выше P4 (LPOC) и P1 (Proximity)"

# ═══════════════════════════════════════════════════════════════════
# COMMENT CATEGORIES
# ═══════════════════════════════════════════════════════════════════

comment_categories:
  
  cargo_type_related:
    description: "Комментарии о типах груза, SF, технических характеристиках"
    
    examples:
      negative:
        - "no grains"
        - "no steel coils"
        - "not low SF cargoes (<1.0)"
        - "no dirty bulk"
        - "no breakbulk"
        
      positive:
        - "prefer high SF cargoes"
        - "only fertilizers"
        - "seeking grain cargoes"
        - "looking for bagged cargoes"
        
    keywords:
      refuse: ["no", "not", "avoid", "cannot", "refuse"]
      prefer: ["prefer", "seeking", "looking for", "only", "want"]
      cargo_types: ["grains", "wheat", "corn", "steel", "coils", "fertilizers", 
                    "bauxite", "high SF", "low SF", "dirty bulk", "breakbulk"]
                    
  geography_related:
    description: "Комментарии о регионах, портах, направлениях"
    
    examples:
      negative:
        - "not going to Black Sea"
        - "no Libya / no Egypt"
        - "no Marmara"
        - "avoid Turkey"
        
      positive:
        - "only looking for East Med cargoes"
        - "prefer close cargo from current port"
        - "prefer backhaul towards Adriatic"
        - "seeking Egypt area"
        
    keywords:
      refuse: ["not going to", "no", "avoid", "cannot call"]
      prefer: ["only", "prefer", "seeking", "looking for"]
      proximity: ["nearby", "close", "local", "far", "long ballast"]
      regions: ["Black Sea", "Med", "Egypt", "Libya", "Marmara", "Adriatic",
                "Continent", "Turkey", "Greece", "Far East"]
                
  trade_pattern_strategy:
    description: "Комментарии о типе рейса, стратегии, позиционировании"
    
    examples:
      voyage_type:
        - "looking for short trip"
        - "looking for long haul"
        - "need quick turnaround"
        
      positioning:
        - "seeking repositioning to Continent"
        - "want to stay in Med"
        - "avoid long ballast"
        
      operational:
        - "need fast loading"
        - "not ready for canal transit"
        - "PSC concerns in Egypt"
        
    keywords:
      voyage_length: ["short trip", "long haul", "quick", "fast turnaround"]
      positioning: ["repositioning", "backhaul", "stay in", "heading to"]
      ballast: ["avoid long ballast", "prefer nearby", "long ballast ok"]
      operational: ["fast loading", "slow ops ok", "canal transit", "PSC concerns"]

# ═══════════════════════════════════════════════════════════════════
# SCORING LOGIC
# ═══════════════════════════════════════════════════════════════════

scoring_logic:
  
  principle: "AI-centric interpretation with soft rules (no hard blocks)"
  
  conflict_levels:
    
    full_conflict:
      description: "Прямой запрет + груз соответствует запрету"
      score_range: [-50, -40]
      
      examples:
        - comment: "no grains"
          cargo: "Wheat"
          score: -45
          reasoning: "Direct refusal of grain cargoes, cargo is wheat"
          
        - comment: "not going to Black Sea"
          cargo_loading: "Odessa, Ukraine (Black Sea)"
          score: -40
          reasoning: "Owner explicitly refuses Black Sea routes"
          
        - comment: "prefer only high SF cargo"
          cargo_sf: 0.68
          score: -45
          reasoning: "Low SF cargo conflicts with 'only high SF' preference"
          
      important_note: "Even at -50, cargo is STILL SHOWN to user with reasoning"
      
    soft_conflict:
      description: "Предпочтение не выполнено, но не явный запрет"
      score_range: [-25, -10]
      
      examples:
        - comment: "prefer closer cargo"
          ballast_distance: 800
          score: -15
          reasoning: "Cargo far from current position, owner prefers nearby"
          
        - comment: "prefer short trip"
          voyage_days: 7
          score: -12
          reasoning: "7-day voyage doesn't match 'short trip' preference"
          
        - comment: "avoid Turkey"
          cargo_loading: "Iskenderun, Turkey"
          score: -20
          reasoning: "Soft avoidance of Turkey, cargo loads there"
          
    neutral:
      description: "Сигнал не релевантен к грузу"
      score_range: [0, 0]
      
      examples:
        - comment: "no steel coils"
          cargo: "Wheat"
          score: 0
          reasoning: "Comment about steel not relevant to grain cargo"
          
    positive_match:
      description: "Груз соответствует заявленным предпочтениям"
      score_range: [10, 15]
      
      examples:
        - comment: "prefer high SF cargo"
          cargo_sf: 1.45
          score: 12
          reasoning: "Cargo SF 1.45 matches high SF preference"
          
        - comment: "seeking Egypt/Libya backhaul"
          cargo_discharge: "Alexandria, Egypt"
          score: 15
          reasoning: "Egypt discharge matches backhaul preference"
          
        - comment: "looking for nearby cargo"
          ballast_distance: 150
          score: 10
          reasoning: "150nm ballast matches 'nearby' preference"
          
    perfect_match:
      description: "Несколько предпочтений выполнены одновременно"
      score_range: [20, 25]
      
      examples:
        - comment: "short trip to Egypt with high SF"
          cargo: 
            type: "Bagged fertilizers"
            sf: 1.50
            discharge: "Alexandria, Egypt"
            voyage_days: 3
          score: 25
          reasoning: "Perfect alignment: high SF, Egypt destination, short trip (3 days)"

# ═══════════════════════════════════════════════════════════════════
# SCORING CALCULATION
# ═══════════════════════════════════════════════════════════════════

calculation_method:
  
  step_by_step:
    
    step_1_parse_comments:
      description: "Extract signals from OpenArea comments"
      output: "List of cargo_signals, geography_signals, strategy_signals"
      
    step_2_evaluate_each_signal:
      description: "For each signal, determine conflict level and impact"
      output: "List of {signal, conflict_level, impact_score}"
      
    step_3_sum_impacts:
      description: "Sum all impact scores"
      formula: "raw_score = sum(all_impacts)"
      
    step_4_clamp_to_range:
      description: "Ensure score within [-50, +25]"
      formula: |
        IF raw_score < -50: p7_score = -50
        ELSE IF raw_score > 25: p7_score = 25
        ELSE: p7_score = raw_score
        
    step_5_generate_reasoning:
      description: "Create human-readable explanation"
      includes:
        - Main conflicts identified
        - Positive matches found
        - Overall assessment
        - Why cargo shown despite conflicts
        
  example_calculation:
    
    comment: "no grains, prefer nearby cargo only, seeking short trip to Egypt"
    
    cargo:
      type: "Wheat"
      stowage_factor: 0.68
      loading_port: "Constanta, Romania"
      discharge_port: "Alexandria, Egypt"
      distance_ballast: 420
      voyage_duration_days: 5
      
    signal_evaluation:
      - signal: "no grains"
        cargo_matches: true  # cargo is grain (wheat)
        conflict_level: "FULL"
        impact: -45
        
      - signal: "prefer nearby cargo only"
        distance: 420  # 420nm ballast
        conflict_level: "SOFT"
        impact: -10
        reasoning: "420nm not exactly 'nearby'"
        
      - signal: "seeking short trip to Egypt"
        voyage_days: 5
        discharge_matches: true  # Egypt
        conflict_level: "POSITIVE_MATCH"
        impact: +15
        reasoning: "5-day trip reasonably short, Egypt matches"
        
    calculation:
      raw_score: -45 + (-10) + 15 = -40
      clamped_score: -40  # within range
      final_p6_score: -40
      
    reasoning_output: |
    "Strong conflict with current preferences: owner specified 'no grains' 
    and cargo is wheat (-45). Additional soft conflict on distance (420nm 
    not exactly 'nearby', -10). However, positive match on destination 
    and trip length (Egypt, 5-day trip, +15). Overall P6 score: -40.
      Cargo shown for consideration as circumstances may have changed."

# ═══════════════════════════════════════════════════════════════════
# OFFER TEXT INTEGRATION
# ═══════════════════════════════════════════════════════════════════

offer_text_guidelines:
  
  principle: "Acknowledge conflicts diplomatically, emphasize positive aspects"
  
  full_conflict_template:
    approach: "Honest acknowledgment + positive angle"
    
    examples:
      - comment: "no grains"
        cargo: "Wheat"
        
        bad_text: |
          "Я знаю, что вы писали 'no grains', но решил отправить в любом случае 
          — вдруг ситуация изменилась."
          
        good_text: |
          "I see you mentioned 'no grains' in your current comments. I'm showing 
          this wheat cargo because [position is excellent / rate is attractive / 
          quick turnaround]. If your strategy has shifted or there's flexibility 
          on this particular cargo, it could work well."
          
  soft_conflict_template:
    approach: "Acknowledge preference + show why worth considering"
    
    examples:
      - comment: "prefer close cargo"
        ballast: 800
        
        text: |
          "I understand you prefer nearby cargo, and this is 800nm ballast. 
          However, [strong freight rate / excellent return cargo opportunity / 
          positions you well for next voyage] might make it worth considering."
          
  positive_match_template:
    approach: "Highlight alignment with preferences"
    
    examples:
      - comment: "seeking short trip to Egypt with high SF"
        cargo: "Perfect match"
        
        text: |
          "This cargo matches your current preferences perfectly: high SF (1.48), 
          Egypt destination, 3-day voyage. Should be exactly what you're looking 
          for right now."
          
  diplomatic_principles:
    - "Never argue with owner's stated preferences"
    - "Acknowledge conflicts honestly"
    - "Find positive angles (rate, position, opportunity)"
    - "Leave door open for changed circumstances"
    - "Be respectful of owner's strategy"
    - "Don't be pushy if strong conflict exists"

# ═══════════════════════════════════════════════════════════════════
# AI PROMPT INTEGRATION
# ═══════════════════════════════════════════════════════════════════

prompt_template:
  
  section: |
    ═══════════════════════════════════════════════════════════════
    OPEN AREA COMMENTS (Voyage-Specific Owner Notes)
    ═══════════════════════════════════════════════════════════════
    
    OpenArea Comments: {open_area_comments}
    
    These comments reflect the owner's CURRENT preferences for THIS specific 
    voyage. They may override or complement historical Regional/Cargo 
    Preferences (P2/P3).
    
    Your tasks:
    1. Extract cargo-type, geography, and strategy signals
    2. Evaluate conflicts and matches with current cargo
    3. Calculate P6 score [-50, +25]
    4. Generate diplomatic reasoning
    5. Provide offer text guidance
    
    CRITICAL RULES:
    - NO HARD BLOCKS - even at -50, show cargo with explanation
    - Acknowledge conflicts honestly in offer text
    - Find positive angles where possible
    - Be respectful of owner's stated preferences
    - Score range is asymmetric (more penalty than bonus)
    
    Score the alignment and provide reasoning.

# ═══════════════════════════════════════════════════════════════════
# INTEGRATION WITH SYSTEM
# ═══════════════════════════════════════════════════════════════════

system_integration:
  
  priority_in_scoring:
    position: "Above LPOC (P4) and Proximity (P1)"
    reasoning: |
      OpenArea comments reflect CURRENT daily changing intentions, which are 
      more important than historical patterns (LPOC) or pure distance (Proximity).
      
  suggested_order:
    1: "P5 (Intake) - Hard capacity constraint"
    2: "P3 (Cargo Preferences) - Long-term cargo patterns"
    3: "P2 (Regional Preferences) - Long-term regional patterns"
    4: "P6 (OpenArea Comments) - CURRENT voyage-specific strategy ← THIS"
    5: "P4 (Last Ports) - Historical familiarity"
    6: "P1 (Proximity) - Geographic distance"
    7: "P7 (Readiness ETA) - Timing"
    
  relationship_to_comments_guide:
    reference: "COMMENTS_PROCESSING_GUIDE.txt"
    note: |
      OpenArea Comments use same parsing methodology as vessel/company comments,
      but have separate scoring criterion because they are voyage-specific.
      
  no_hard_blocks_philosophy:
    principle: "Soft rules approach"
    implementation: |
      Even with -50 P7 score, cargo MUST be shown to user with clear reasoning.
      This allows human judgment to override AI assessment if circumstances 
      have changed or there are special considerations.

# ═══════════════════════════════════════════════════════════════════
# METADATA & VERSIONING
# ═══════════════════════════════════════════════════════════════════

metadata:
  created_by: "Vitaly (VK Charts expert)"
  created_date: "2024-11-28"
  last_modified: "2024-12-01"
  version: "1.1.0"
  
  changelog:
    - version: "1.2.0"
      date: "2024-12-01"
      changes:
        - "CRITICAL FIX: Changed criterion code from P7 to P6"
        - "Updated all references from P7 to P6 throughout document"
        - "Corrected suggested_order to match MASTER_SCORING_SYSTEM.txt"
        - "Fixed priority_level description"
        - "Reason: MASTER_SCORING_SYSTEM.txt defines P6 = OpenArea Comments, P7 = Readiness/ETA"
        - "No logic changes - purely nomenclature correction"
      
    - version: "1.1.0"
      date: "2024-11-30"
      changes:
        - "Restructured SHORT SUMMARY in unified format"
        - "Added comprehensive HOW TO USE DOCUMENT with 3 sections:"
        - "  - For Developers (Laravel ↔ LangChain integration)"
        - "  - For AI/LangChain (9-step OpenArea comment processing algorithm)"
        - "  - For Knowledge Base Updates (maintenance procedures)"
        - "Added Quick Reference section"
        - "Enhanced documentation structure for clarity"
        - "Verified score range [-50, +25] consistency"
        - "Verified no hard blocks philosophy maintained"
        - "Confirmed integration with COMMENTS_PROCESSING_GUIDE.txt"
        - "Enhanced offer text templates with diplomatic principles"
        - "No logic changes - purely documentation improvements"
      
    - version: "1.0.0"
      date: "2024-11-28"
      changes:
        - "Initial OpenArea Comments Scoring criterion (originally labeled P7)"
        - "Defined three comment categories (cargo/geography/strategy)"
        - "Established conflict levels (Full/Soft/Neutral/Positive/Perfect)"
        - "Set score range [-50, +25] with asymmetric penalties"
        - "Documented no hard blocks philosophy"
        - "Created offer text integration guidelines"
        - "Established high priority in scoring system"
  
  notes:
    - "P6 is voyage-specific - reflects CURRENT strategy, not historical patterns"
    - "NO HARD BLOCKS - cargo always shown even with -50 score"
    - "Score range asymmetric: -50 max penalty vs +25 max bonus"
    - "High priority criterion - above P4 (LPOC) and P1 (Proximity)"
    - "Complements (not replaces) P2/P3 historical preferences"
    - "CORRECTED 2024-12-01: Renamed from P7 to P6 per MASTER_SCORING_SYSTEM.txt"

# ═══════════════════════════════════════════════════════════════════
# SUMMARY
# ═══════════════════════════════════════════════════════════════════

summary:
  
  key_principles:
    1: "Voyage-specific comments reflect CURRENT owner strategy"
    2: "Three signal types: cargo-type, geography, strategy"
    3: "AI-centric interpretation with soft rules"
    4: "NO HARD BLOCKS - always show cargo with reasoning"
    5: "Diplomatic acknowledgment of conflicts in offer text"
    6: "High priority - above P4 (LPOC) and P1 (Proximity)"
    7: "Asymmetric scoring: more penalty than bonus"
    8: "Criterion code: P6 (not P7) per MASTER_SCORING_SYSTEM.txt"
    
  ai_responsibilities:
    - "Parse OpenArea comments for signals"
    - "Evaluate conflict levels accurately"
    - "Calculate P6 score within [-50, +25]"
    - "Generate diplomatic reasoning"
    - "Provide offer text guidance"
    - "Respect owner's stated preferences"
    
  quality_indicators:
    good_processing:
      - "Signals correctly identified and categorized"
      - "Conflict levels appropriately assessed"
      - "Reasoning acknowledges conflicts honestly"
      - "Offer text is diplomatic and respectful"
      - "Positive angles found where possible"
      
    poor_processing:
      - "Ignores OpenArea comments"
      - "Creates hard blocks (cargo not shown)"
      - "Argumentative offer text"
      - "Doesn't acknowledge conflicts"
      - "Score outside [-50, +25] range"


--- START OF estimator-prompts/P2A_PSC_PORT_ACCESSIBILITY_SCORING.txt ---
# ═══════════════════════════════════════════════════════════════════
# P2A: PSC PORT ACCESSIBILITY SCORING - UPDATED v2.0
# VK Charts AI - Port State Control Based Vessel-Port Matching  
# ═══════════════════════════════════════════════════════════════════
#
# CHANGES IN v2.0:
# - Added explicit Ukraine vs Turkey differentiation
# - Ukraine: MODERATE severity but TOLERANT enforcement (simple requirements)
# - Turkey: MODERATE severity but STRICT enforcement  
# - Updated scoring for POOR vessels in Ukraine (12/20 instead of 8-12)
# - Citations from broker corrections
#
# ═══════════════════════════════════════════════════════════════════

version: "2.0"
date: "2026-01-19"
priority: "CRITICAL - PSC affects vessel acceptance"

# ═══════════════════════════════════════════════════════════════════
# PURPOSE & SCORING PRINCIPLE
# ═══════════════════════════════════════════════════════════════════

purpose: |
  Determine if a vessel with certain PSC (Port State Control) status
  can enter a port without high risk of detention, considering the
  vessel's technical/safety record and port's PSC enforcement severity.
  
  SCORE RANGE: 0-20 points
  
  KEY PRINCIPLE:
  Vessels with poor PSC status AVOID ports with strict PSC enforcement
  because detention risk = lost time and money. This scoring reflects
  real shipowner behavioral patterns.

scoring_principle: |
  P2A Score = Vessel PSC Status × Port PSC Severity × Enforcement Style
  
  Key Logic:
  • Vessels with GOOD PSC status → can go anywhere
  • Vessels with POOR PSC status → AVOID strict ports, PREFER lax ports
  • This reflects real shipowner behavior (avoiding detention = saving time/money)
  
  CRITICAL DISTINCTION (v2.0):
  • SEVERITY (inspection frequency) ≠ ENFORCEMENT (strictness/tolerance)
  • Example: Ukraine = MODERATE severity but TOLERANT (simple requirements)
  • Example: Turkey = MODERATE severity but STRICT (complex requirements)

# ═══════════════════════════════════════════════════════════════════
# VESSEL PSC STATUS CLASSIFICATION
# ═══════════════════════════════════════════════════════════════════

vessel_psc_status:
  
  GOOD:
    definition: "Clean PSC record, can enter any port"
    conditions:
      - "Paris MOU = White"
      - "OR (Paris MOU = Grey AND detention_rate < 3%)"
      - "No detentions in last 12 months"
      - "IACS classification society (DNV, LR, BV, ABS, etc.)"
    characteristics: "Low PSC risk, accepted at all ports"
    examples:
      - "Paris MOU: White, Detention rate: 1.8%"
      - "Paris MOU: Grey, Detention rate: 2.5%, no recent detentions"
  
  MEDIUM:
    definition: "Some PSC issues, will avoid strict ports when possible"
    conditions:
      - "Paris MOU = Grey AND detention_rate 3-8%"
      - "1-2 detentions in last 24 months (now resolved)"
    characteristics: "Moderate PSC risk, prefers moderate ports"
    examples:
      - "Paris MOU: Grey, Detention rate: 5.0%"
      - "1 detention 18 months ago, deficiencies cleared"
  
  POOR:
    definition: "Significant PSC problems, actively seeks lax PSC ports"
    conditions:
      - "Paris MOU = Black"
      - "OR detention_rate > 8%"
      - "OR 2+ detentions in last 36 months"
    characteristics: "High PSC risk, strongly PREFERS lax enforcement"
    examples:
      - "Paris MOU: Black, Detention rate: 11.1%"
      - "3 detentions in last 24 months"
    
    CRITICAL_NOTE: |
      Even POOR (Black List) vessels can often call Ukraine.
      Ukraine PSC is relatively simple and tolerant.
  
  BANNED:
    definition: "Vessel banned from specific MOU region"
    conditions:
      - "Paris MOU: 3 detentions in 24-36 months (depending on flag)"
      - "USCG: 3 detentions in 12 months"
      - "Jumped detention (left port before clearance)"
    impact: "ABSOLUTE BLOCK for entire MOU region"

# ═══════════════════════════════════════════════════════════════════
# PORT PSC SEVERITY & ENFORCEMENT CLASSIFICATION (UPDATED v2.0)
# ═══════════════════════════════════════════════════════════════════

port_psc_classification:
  
  description: |
    Ports classified by TWO dimensions:
    1. SEVERITY: Inspection frequency (Very Strict / Moderate / Lax)
    2. ENFORCEMENT: Tolerance level (Strict / Tolerant / Lax)
  
  # ─────────────────────────────────────────────────────────────────
  # VERY STRICT SEVERITY + STRICT ENFORCEMENT
  # ─────────────────────────────────────────────────────────────────
  
  VERY_STRICT_AND_STRICT:
    severity: "Very Strict"
    enforcement: "Strict"
    description: "Highest PSC risk - vessels with issues strongly avoid"
    
    countries:
      tier_1_maximum: 
        - "Italy"
        - "France"  
        - "Greece"
      tier_2_high:
        - "Germany"
        - "Netherlands"
        - "Belgium"
        - "UK"
      tier_3_medium_high:
        - "Spain"
        - "Portugal"
        - "Scandinavia"
        - "Canada"
      tokyo_mou:
        - "Japan"
        - "Singapore"
        - "South Korea"
        - "Australia"
      uscg:
        - "USA"
  
  # ─────────────────────────────────────────────────────────────────
  # MODERATE SEVERITY - VARIES BY ENFORCEMENT
  # ─────────────────────────────────────────────────────────────────
  
  MODERATE_SEVERITY_STRICT_ENFORCEMENT:
    severity: "Moderate"
    enforcement: "Strict"
    description: "Moderate inspection freq, but strict requirements when inspected"
    
    countries:
      turkey_all_ports:
        - "Istanbul area (Marmara)"
        - "Yarimca"
        - "Derince"
        - "Gemlik"
        - "Bandirma"
        - "Aliaga"
        - "Izmir"
        - "Nemrut Bay"
        - "Mersin"
        - "Iskenderun"
      
      note: |
        Turkey is MODERATE severity but STRICT enforcement.
        PSC requirements are complex and thoroughly checked.
        POOR vessels face significant detention risk.
      
      citations:
        - "Correction (akdeniz): Turkey PSC stricter than Ukraine"
  
  MODERATE_SEVERITY_TOLERANT_ENFORCEMENT:
    severity: "Moderate"
    enforcement: "Tolerant (Simple Requirements)"
    description: "Moderate inspection freq, but simple/tolerant requirements"
    
    countries:
      ukraine_all_ports:
        - "Chornomorsk"
        - "Odessa"
        - "Pivdennyi"
        - "Mykolaiv"
        - "Kherson"
      
      other_moderate_tolerant:
        - "Georgia"
        - "Cyprus"
        - "Malta"
        - "Romania"
        - "Bulgaria"
      
      note: |
        Ukraine has relatively SIMPLE PSC requirements.
        Even vessels with Paris MOU Black List can usually call.
        This is critical for POC grain export operations.
      
      citations:
        - "Correction (akdeniz): Ukraine PSC requirements relatively simple"
        - "Correction (valmiera): Even Black List vessels usually OK in Ukraine"
  
  MODERATE_SEVERITY_STANDARD_ENFORCEMENT:
    severity: "Moderate"
    enforcement: "Standard"
    description: "Moderate inspection frequency and standard requirements"
    
    countries:
      - "Egypt"
      - "Morocco"
      - "Tunisia"
      - "Algeria"
  
  # ─────────────────────────────────────────────────────────────────
  # LAX SEVERITY + LAX ENFORCEMENT
  # ─────────────────────────────────────────────────────────────────
  
  LAX_SEVERITY_LAX_ENFORCEMENT:
    severity: "Lax"
    enforcement: "Lax"
    description: "Minimal PSC enforcement - preferred by vessels with issues"
    
    countries:
      - "Libya"
      - "Syria"
      - "Lebanon (weak enforcement)"

# ═══════════════════════════════════════════════════════════════════
# SCORING MATRIX v2.0 - EXPLICIT VALUES
# ═══════════════════════════════════════════════════════════════════

scoring_matrix_v2:
  
  # ─────────────────────────────────────────────────────────────────
  # GOOD VESSELS (White/IACS)
  # ─────────────────────────────────────────────────────────────────
  
  GOOD_vessel:
    
    very_strict_strict:
      score: 18
      confidence: 90
      reasoning: "Clean record, no restrictions, minor inspection formalities only"
      ports: ["Italy", "France", "Germany", "Netherlands", "Greece"]
    
    moderate_strict_turkey:
      score: 18
      confidence: 90
      reasoning: "Good vessel handles Turkish PSC requirements without issues"
      ports: ["Turkey (all ports)"]
      citations:
        - "Updated v2.0: GOOD vessels have no problems in Turkey"
    
    moderate_tolerant_ukraine:
      score: 20
      confidence: 90
      reasoning: "Simple PSC requirements, no issues for good vessels"
      ports: ["Ukraine (all ports)"]
      citations:
        - "Updated v2.0: Ukraine very accepting of good vessels"
    
    moderate_standard:
      score: 19
      confidence: 90
      reasoning: "No issues with standard PSC procedures"
      ports: ["Egypt", "Morocco", "Tunisia", "Algeria"]
    
    lax_lax:
      score: 20
      confidence: 90
      reasoning: "Can go anywhere, including minimal PSC ports"
      ports: ["Libya", "Syria", "Lebanon"]
  
  # ─────────────────────────────────────────────────────────────────
  # MEDIUM VESSELS (Grey)
  # ─────────────────────────────────────────────────────────────────
  
  MEDIUM_vessel:
    
    very_strict_strict:
      score: 10
      confidence: 85
      reasoning: "May face inspection, prefers to avoid these ports"
      ports: ["Italy", "France", "Germany", "Netherlands", "Greece"]
    
    moderate_strict_turkey:
      score: 12
      confidence: 85
      reasoning: "Turkey enforcement is strict, moderate risk for Grey vessels"
      ports: ["Turkey (all ports)"]
      citations:
        - "Updated v2.0: Turkey more challenging for MEDIUM vessels"
    
    moderate_tolerant_ukraine:
      score: 16
      confidence: 90
      reasoning: "Simple requirements, acceptable for Grey list vessels"
      ports: ["Ukraine (all ports)"]
      citations:
        - "Updated v2.0: Ukraine tolerant, MEDIUM vessels usually OK"
    
    moderate_standard:
      score: 14
      confidence: 85
      reasoning: "Acceptable, moderate risk of inspection"
      ports: ["Egypt", "Morocco", "Georgia", "Cyprus"]
    
    lax_lax:
      score: 17
      confidence: 90
      reasoning: "Vessel prefers lax ports to avoid scrutiny"
      ports: ["Libya", "Syria", "Lebanon"]
  
  # ─────────────────────────────────────────────────────────────────
  # POOR VESSELS (Black)
  # ─────────────────────────────────────────────────────────────────
  
  POOR_vessel:
    
    very_strict_strict:
      score: 3
      confidence: 90
      reasoning: "CRITICAL - vessel will STRONGLY AVOID, very high detention risk"
      owner_behavior: "Will NOT accept cargo to these ports"
      ports: ["Italy", "France", "Germany", "Netherlands", "Greece"]
    
    moderate_strict_turkey:
      score: 6
      confidence: 85
      reasoning: "High detention risk in Turkey due to strict enforcement"
      owner_behavior: "Will avoid if possible, risky if must call"
      ports: ["Turkey (all ports)"]
      citations:
        - "Correction (akdeniz): Turkey problematic for Black List vessels"
        - "Updated v2.0: Significant risk in Turkish ports"
    
    moderate_tolerant_ukraine:
      score: 12
      confidence: 90
      reasoning: "Ukraine relatively simple PSC - even Black List often acceptable"
      owner_behavior: "Usually willing to call, manageable risk"
      ports: ["Ukraine (all ports)"]
      citations:
        - "Correction (akdeniz, valmiera): Ukraine tolerant of Black List"
        - "CRITICAL: Even Paris MOU Black vessels can usually call Ukraine"
      notes: |
        This is a KEY difference from other moderate ports.
        Ukraine PSC focuses on basic safety, not complex requirements.
        Black List vessels regularly call Ukrainian ports for grain exports.
    
    moderate_standard:
      score: 10
      confidence: 80
      reasoning: "Moderate risk, may attempt if freight is good"
      owner_behavior: "Selective - will evaluate case by case"
      ports: ["Egypt", "Morocco", "Georgia"]
    
    lax_lax:
      score: 16
      confidence: 90
      reasoning: "Vessel STRONGLY PREFERS lax PSC - minimal detention risk"
      owner_behavior: "Actively seeks these ports"
      ports: ["Libya", "Syria", "Lebanon"]
  
  # ─────────────────────────────────────────────────────────────────
  # BANNED VESSELS
  # ─────────────────────────────────────────────────────────────────
  
  BANNED_vessel:
    banned_region:
      score: 0
      confidence: 100
      reasoning: "ABSOLUTE BLOCK - cannot enter MOU region"

# ═══════════════════════════════════════════════════════════════════
# AI SCORING LOGIC
# ═══════════════════════════════════════════════════════════════════

ai_scoring_process:
  
  step_1_determine_vessel_status:
    input: "Paris MOU status, detention rate, recent history"
    output: "GOOD / MEDIUM / POOR / BANNED"
    
  step_2_determine_port_classification:
    input: "Loading port, discharge port countries"
    output: "Port PSC category for each port"
    
    special_rules:
      ukraine_ports:
        classification: "MODERATE_SEVERITY_TOLERANT_ENFORCEMENT"
        apply_to: ["Chornomorsk", "Odessa", "Pivdennyi", "Mykolaiv"]
        
      turkey_ports:
        classification: "MODERATE_SEVERITY_STRICT_ENFORCEMENT"
        apply_to: ["All Turkish ports (Marmara, Aegean, Mediterranean)"]
        
      italian_ports:
        classification: "VERY_STRICT_AND_STRICT"
        
      egypt_ports:
        classification: "MODERATE_SEVERITY_STANDARD_ENFORCEMENT"
  
  step_3_calculate_combined_score:
    description: |
      For routes with BOTH loading and discharge ports:
      - Calculate P2A score for loading port
      - Calculate P2A score for discharge port
      - Final P2A = MINIMUM of the two scores
      
      Rationale: Vessel must be acceptable at BOTH ports.
      If one port is problematic, entire route is problematic.
    
    example:
      route: "Chornomorsk → Yarimca"
      vessel: "Paris MOU Black (POOR)"
      
      chornomorsk_ukraine_score: 12
      yarimca_turkey_score: 6
      
      final_p2a_score: 6
      reasoning: "Limited by stricter Turkish port requirements"
  
  step_4_generate_explanation:
    template: |
      "Vessel has [PSC status] with [specific details]. [Loading port]
      has [PSC category] ([score]/20). [Discharge port] has [PSC category]
      ([score]/20). Combined P2A score: [minimum]/20."
    
    example: |
      "Vessel has POOR PSC status (Paris MOU Black). Chornomorsk (Ukraine)
      has moderate/tolerant enforcement (12/20). Yarimca (Turkey) has
      moderate/strict enforcement (6/20). Combined P2A score: 6/20."

# ═══════════════════════════════════════════════════════════════════
# HARD BLOCKS (Absolute Restrictions)
# ═══════════════════════════════════════════════════════════════════

hard_blocks:
  
  eu_sanctions:
    description: "EU sanctioned vessels (Russian shadow fleet)"
    source: "Danish Maritime Authority EU Vessel Designations"
    url: "https://www.dma.dk/.../eu-vessel-designations"
    format: "Downloadable .xlsx/.csv with IMO numbers"
    list_size: "~600 vessels (Jan 2026)"
    
    impact:
      score: 0
      p2a_override: 0
      reasoning: "ABSOLUTE BLOCK - cannot enter EU ports"
      applies_to: "All EU member state ports"
  
  mou_bans:
    description: "Vessel banned from entire MOU region"
    trigger: "3+ detentions in specified period"
    
    impact:
      score: 0
      p2a_override: 0
      reasoning: "ABSOLUTE BLOCK - banned from region"

# ═══════════════════════════════════════════════════════════════════
# AI REASONING TEMPLATES
# ═══════════════════════════════════════════════════════════════════

reasoning_templates:
  
  template_good_vessel:
    format: |
      "Vessel has [GOOD PSC status details]. Both [loading port] and
      [discharge port] are accessible with [minimal/no] PSC concerns."
    
  template_medium_vessel_ukraine:
    format: |
      "Vessel has [MEDIUM PSC status]. Ukraine ([port name]) has moderate
      severity but tolerant enforcement - acceptable for Grey list vessels.
      [Other port assessment]."
    
  template_poor_vessel_ukraine_turkey:
    format: |
      "Vessel has [POOR PSC status details]. Ukraine ([port name]) has
      relatively simple PSC requirements ([score]/20). Turkey ([port name])
      has stricter enforcement ([lower score]/20), resulting in [risk level]."
    
    example: |
      "Vessel is Paris MOU Black List (POOR status). Chornomorsk (Ukraine)
      has relatively simple PSC requirements (12/20 - acceptable for Black List).
      Yarimca (Turkey) has stricter enforcement (6/20 - significant detention risk).
      Combined P2A score: 6/20 due to Turkish port constraints."

# ═══════════════════════════════════════════════════════════════════
# CRITICAL AI INSTRUCTIONS
# ═══════════════════════════════════════════════════════════════════

ai_must:
  - "ALWAYS distinguish Ukraine (tolerant) from Turkey (strict)"
  - "ALWAYS use explicit scoring values from matrix v2.0"
  - "ALWAYS calculate MINIMUM score when route has 2 ports"
  - "ALWAYS cite specific PSC classification in reasoning"
  - "NEVER assume POOR vessels cannot call Ukraine - they usually can!"

ai_must_not:
  - "Never treat all MODERATE severity ports the same"
  - "Never give POOR vessel in Ukraine a score below 10"
  - "Never ignore Turkey's stricter enforcement vs Ukraine"

# ═══════════════════════════════════════════════════════════════════
# END OF P2A PSC PORT ACCESSIBILITY SCORING v2.0
# ═══════════════════════════════════════════════════════════════════


--- START OF estimator-prompts/READINESSETA_TO_LOADING_PORT_SCORING.txt ---
# ═══════════════════════════════════════════════════════════════════
# P7: READINESS/ETA TO LOADING PORT SCORING - UPDATED v2.0
# VK Charts AI Scoring System
# ═══════════════════════════════════════════════════════════════════
#
# CHANGES IN v2.0:
# - Added ETA + 7 days operations logic
# - Added layday vs canceling date scoring thresholds
# - Added AIS staleness warning (30+ days)
# - Clarified difference between destination ETA vs actual opening
# - Added Tuzla dry dock special handling
#
# ═══════════════════════════════════════════════════════════════════

version: "2.0"
date: "2026-01-19"
priority: "CRITICAL - Timing compatibility affects commercial viability"

# ═══════════════════════════════════════════════════════════════════
# OVERVIEW
# ═══════════════════════════════════════════════════════════════════

purpose: |
  P7 evaluates whether vessel will be ready at loading port in time
  for the cargo's laycan (loading window). 
  
  SCORE RANGE: 0-10 points
  
  KEY PRINCIPLE:
  - Vessel ready BEFORE layday = idle time cost (unfavorable)
  - Vessel ready AT layday = perfect timing (optimal)
  - Vessel ready AFTER canceling = impossible (blocked)

# ═══════════════════════════════════════════════════════════════════
# DATA SOURCES & PRIORITY
# ═══════════════════════════════════════════════════════════════════

data_sources:
  
  priority_1_open_area:
    source: "OpenArea field (manually set)"
    format: "Port name + Date"
    example: "Constanta, Jan 20"
    reliability: "HIGHEST - directly stated by owner"
    
    usage: |
      If open_area is provided, use this as the definitive opening position
      and date. This is the owner's stated availability.
  
  priority_2_destination:
    source: "Destination field (from AIS)"
    format: "Port name"
    additional: "ETA (Estimated Time of Arrival)"
    reliability: "MEDIUM - vessel is heading there, but purpose unknown"
    
    usage: |
      If destination is set, vessel is likely going there to:
      a) Discharge current cargo, OR
      b) Load next cargo, OR
      c) Bunkers/provisions/repairs
      
      CRITICAL: Add +7 days to ETA for operations (loading/discharge)
      before vessel is actually "open" for next cargo.
    
    special_case_tuzla:
      port: "Tuzla (Turkey)"
      interpretation: "DRY DOCK / REPAIRS"
      add_time: "+30 days (minimum)"
      reasoning: |
        Tuzla is a major repair/dry dock location. If vessel is currently
        in Tuzla or heading to Tuzla, assume repairs lasting ~1 month.
        Repair completion dates are uncertain.
      
      scoring_impact:
        if_current_in_tuzla: "P7 score = 2/10 (high uncertainty)"
        if_heading_to_tuzla: "P7 score = 3/10 (repairs expected)"
  
  priority_3_current_area:
    source: "Current Area field (from AIS)"
    format: "Geographic region"
    example: "East Mediterranean"
    reliability: "LOW - only shows current position, no destination"
    
    usage: |
      Use only if no open_area or destination available.
      Assume vessel is at anchor or drifting, date from position_received.
  
  ais_staleness_check:
    threshold: 30
    threshold_unit: "days"
    
    check: |
      If (current_date - position_received) > 30 days:
        - AIS may be turned off
        - Vessel may have issues
        - Position data UNRELIABLE
    
    action:
      add_warning: true
      warning_text: |
        "⚠️ Warning: AIS data is stale (last update: {position_received}).
        Vessel may have disabled AIS or encountered issues.
        Position reliability: LOW."
      
      reduce_confidence:
        overall_confidence: -10
        p7_confidence: -20

# ═══════════════════════════════════════════════════════════════════
# OPERATIONS TIME ESTIMATION
# ═══════════════════════════════════════════════════════════════════

operations_time:
  
  principle: |
    If vessel has a destination with ETA but no explicit "open" date,
    we must add time for loading/discharge operations before vessel
    is actually ready for next cargo.
  
  standard_operations:
    duration: 7
    unit: "days"
    reasoning: |
      Standard allowance for loading OR discharge operations.
      Covers:
      - Port approach and berthing
      - Cargo operations (loading or discharge)
      - Documentation and clearance
      - Departure
    
    note: |
      Loading and discharge times differ, but for simplicity we use
      a standard 7-day allowance. This prevents over-complexity.
  
  calculation_example:
    scenario: "Vessel heading to Mersin, ETA Jan 25"
    cargo_laycan: "Feb 5"
    
    calculation:
      eta_arrival: "Jan 25"
      operations: "+7 days"
      vessel_ready: "Feb 1"
      days_before_layday: "4 days"
      
    result:
      p7_score: "8/10 (good timing)"

# ═══════════════════════════════════════════════════════════════════
# LAYCAN HANDLING
# ═══════════════════════════════════════════════════════════════════

laycan_logic:
  
  definitions:
    layday:
      definition: "FIRST possible loading date"
      abbreviation: "L/D or Layday"
      example: "Feb 5, 2026"
      
    canceling_date:
      definition: "LAST possible arrival date"
      abbreviation: "CAN or Canceling"
      example: "Feb 10, 2026"
      
    full_laycan:
      format: "Layday - Canceling"
      example: "Feb 5-10, 2026"
      interpretation: "Vessel must arrive between Feb 5 and Feb 10"
  
  single_date_handling:
    scenario: "Cargo shows only one date (e.g., '05 feb 2026')"
    
    interpretation_1:
      if_format: "Single date with no range"
      treat_as: "BOTH layday AND canceling on same date"
      example: "05 feb 2026 → Layday: Feb 5, Canceling: Feb 5"
      tolerance: "+7 days implicit tolerance"
      
      scoring:
        vessel_ready_on_date: "10/10 (perfect)"
        vessel_ready_1_3_days_early: "9/10"
        vessel_ready_4_7_days_early: "7/10"
        vessel_ready_8_plus_days_early: "< 5/10"
        vessel_ready_1_7_days_late: "5/10"
        vessel_ready_8_plus_days_late: "2/10"
  
  range_handling:
    scenario: "Cargo shows range (e.g., '05-10 feb 2026')"
    
    interpretation:
      layday: "Feb 5 (first date)"
      canceling: "Feb 10 (last date)"
      
    scoring:
      vessel_ready_on_layday: "10/10 (perfect timing)"
      vessel_ready_before_layday: "See early arrival matrix below"
      vessel_ready_after_layday_before_canceling: "7/10 (acceptable)"
      vessel_ready_after_canceling: "2/10 (very problematic)"

# ═══════════════════════════════════════════════════════════════════
# SCORING MATRIX v2.0
# ═══════════════════════════════════════════════════════════════════

scoring_matrix_v2:
  
  # ─────────────────────────────────────────────────────────────────
  # PERFECT TIMING
  # ─────────────────────────────────────────────────────────────────
  
  on_time:
    condition: "Vessel ready 0-3 days before layday"
    score: 10
    confidence: 90
    reasoning: "Perfect timing - vessel arrives just before laycan starts"
    example: "Layday Feb 5, vessel ready Feb 3"
  
  # ─────────────────────────────────────────────────────────────────
  # EARLY ARRIVAL (Idle Time Costs)
  # ─────────────────────────────────────────────────────────────────
  
  slightly_early:
    condition: "Vessel ready 4-7 days before layday"
    score: 8
    confidence: 85
    reasoning: "Good timing, minor idle time"
    example: "Layday Feb 5, vessel ready Jan 30"
  
  early:
    condition: "Vessel ready 8-15 days before layday"
    score: 5
    confidence: 85
    reasoning: "Early - vessel needs filler cargo or waits with idle costs"
    example: "Layday Feb 5, vessel ready Jan 22"
    citations:
      - "Correction (akdeniz, valmiera): Long gap before laycan unfavorable"
  
  too_early:
    condition: "Vessel ready 16-25 days before layday"
    score: 2
    confidence: 90
    reasoning: "Too early - significant idle time, owner will seek other business"
    example: "Layday Feb 5, vessel ready Jan 12"
    citations:
      - "Correction: 23-day gap is highly unfavorable"
  
  very_early:
    condition: "Vessel ready 25+ days before layday"
    score: 0
    confidence: 90
    reasoning: "Far too early - vessel will fix other cargo before this laycan"
    example: "Layday Feb 5, vessel ready Dec 30"
    citations:
      - "Correction (ak khadeja): 36-day gap means vessel will fix other business"
  
  # ─────────────────────────────────────────────────────────────────
  # LATE ARRIVAL
  # ─────────────────────────────────────────────────────────────────
  
  after_layday_before_canceling:
    condition: "Vessel ready after layday but before canceling"
    score: 7
    confidence: 80
    reasoning: "Acceptable - vessel arrives during laycan window"
    example: "Layday Feb 5, Canceling Feb 10, vessel ready Feb 7"
  
  after_canceling_slight:
    condition: "Vessel ready 1-3 days after canceling"
    score: 4
    confidence: 75
    reasoning: "Risky - charterer may cancel, requires negotiation"
    example: "Canceling Feb 10, vessel ready Feb 12"
  
  after_canceling_significant:
    condition: "Vessel ready 4-7 days after canceling"
    score: 2
    confidence: 70
    reasoning: "Very problematic - charterer likely to cancel"
    example: "Canceling Feb 10, vessel ready Feb 15"
  
  impossible:
    condition: "Vessel ready 8+ days after canceling"
    score: 0
    confidence: 90
    reasoning: "Impossible - vessel cannot make laycan"
    example: "Canceling Feb 10, vessel ready Feb 20"

# ═══════════════════════════════════════════════════════════════════
# AI CALCULATION PROCESS
# ═══════════════════════════════════════════════════════════════════

ai_calculation_process:
  
  step_1_determine_vessel_ready_date:
    
    option_a_open_area_provided:
      if: "open_area field exists"
      then: "Use open_area date as vessel_ready_date"
      example: "open_area: 'Constanta, Jan 20' → vessel_ready = Jan 20"
    
    option_b_destination_with_eta:
      if: "destination + ETA provided, no open_area"
      then: "vessel_ready_date = ETA + 7 days"
      example: "destination: Mersin, ETA: Jan 25 → vessel_ready = Feb 1"
      
      special_case_tuzla:
        if: "destination = Tuzla"
        then: "vessel_ready_date = ETA + 30 days (dry dock)"
        example: "destination: Tuzla, ETA: Jan 20 → vessel_ready = Feb 20"
    
    option_c_current_area_only:
      if: "Only current_area available, no destination"
      then: "vessel_ready_date = position_received date"
      caveat: "Assume vessel at anchor, ready immediately"
      
    option_d_ais_stale:
      if: "(current_date - position_received) > 30 days"
      then:
        add_warning: true
        reduce_confidence: true
        use_conservative_estimate: true
  
  step_2_parse_laycan:
    
    single_date:
      format: "05 feb 2026"
      interpretation:
        layday: "Feb 5, 2026"
        canceling: "Feb 5, 2026 (same day)"
        tolerance: "+7 days implicit"
    
    date_range:
      format: "05-10 feb 2026"
      interpretation:
        layday: "Feb 5, 2026"
        canceling: "Feb 10, 2026"
  
  step_3_calculate_gap:
    formula: "gap_days = layday - vessel_ready_date"
    
    examples:
      example_1:
        vessel_ready: "Feb 3"
        layday: "Feb 5"
        gap: "+2 days (vessel 2 days early)"
        
      example_2:
        vessel_ready: "Jan 20"
        layday: "Feb 5"
        gap: "+16 days (vessel 16 days early)"
        
      example_3:
        vessel_ready: "Feb 7"
        layday: "Feb 5"
        gap: "-2 days (vessel 2 days late)"
  
  step_4_determine_score:
    use: "scoring_matrix_v2 thresholds"
    match_gap_to_condition: true
    output_score: "[0-10]"
  
  step_5_generate_reasoning:
    include:
      - "How vessel_ready_date was determined"
      - "Laycan window (layday-canceling)"
      - "Gap in days (early/late)"
      - "Commercial impact (idle cost / impossible / perfect)"
    
    template: |
      "Vessel ready [date] ([source]). Laycan starts [layday]. 
      Gap: [X] days [early/late]. [Impact assessment]."
    
    example: |
      "Vessel ready Feb 1 (destination Mersin ETA Jan 25 + 7 days operations).
      Laycan starts Feb 5. Gap: 4 days early. Minor idle time, acceptable timing."

# ═══════════════════════════════════════════════════════════════════
# CRITICAL AI INSTRUCTIONS
# ═══════════════════════════════════════════════════════════════════

ai_must:
  - "ALWAYS add +7 days to destination ETA if no explicit open date"
  - "ALWAYS check AIS staleness (30+ days)"
  - "ALWAYS treat Tuzla as dry dock (+30 days)"
  - "ALWAYS calculate gap relative to LAYDAY, not canceling"
  - "NEVER assume vessel is ready at destination ETA without operations time"

ai_must_not:
  - "Never ignore the +7 days operations buffer"
  - "Never treat single date as only layday (it's also canceling)"
  - "Never give high score for 20+ day early arrival"

# ═══════════════════════════════════════════════════════════════════
# END OF P7 READINESS/ETA SCORING v2.0
# ═══════════════════════════════════════════════════════════════════


--- START OF estimator-prompts/estimation-template-example.md ---
STRICT use this JSON template for all estimation responses you make
In "citation" value for each score show core data values used in decision making including referenses to rules provided in prompt 
For scores with critical issues add "critical": true
recommendation enum: RECOMMENDED, CONDITIONAL, NOT_RECOMMENDED, BLOCKED

{
  "vessel_name": "MV Example",
  "total_score": 51,
  "max_score": 100,
  "confidence": 70,
  "confidence_note": "Not enough data for P6",
  "recommendation": "CONDITIONAL",
  "short_summary": "This vessel recommended to process if no better options you have",
  "detailed_scoring": {
    "proximity": {
      "code": "P1",
      "score": 11.0,
      "max_score": 20,
      "reasoning": "Vessel is in the Azov Sea. Ballast to the Danube (Reni) is ~450nm. For a Small Coaster (SC), this is a moderate ballast leg.",
      "confidence": "test",
      "citations": ["ref:23"]
    },
    "regional_patterns": {
      "code": "P1A",
      "score": 12,
      "max_score": 15,
      "reasoning": "Azov/Black Sea to East Med (Greece) is a standard trade pattern for this vessel size.",
      "confidence": "test",
      "citations": ["ref:23"]
    },
    "owner_preferences": {
      "code": "P2",
      "score": 5,
      "max_score": 15,
      "reasoning": "Company comments state \"ukr ok sometimes\" and \"ukr expensive.\" This indicates a neutral-to-cautious willingness to work Ukraine.",
      "confidence": "test",
      "citations": ["ref:23"]
    },
    "port_accessibility": {
      "code": "P2A",
      "score": 5,
      "max_score": 20,
      "reasoning": "France - VERY STRICT PSC region",
      "confidence": "test",
      "citations": ["ref:23"]
    },
    "cargo_preferences": {
      "code": "P3",
      "score": 12,
      "max_score": 15,
      "reasoning": "SBS (SF 51) is a standard agricultural bulk cargo. Vessel is a General Cargo ship suitable for this type.",
      "confidence": "test",
      "citations": ["ref:23"]
    },
    "last_ports": {
      "code": "P4",
      "score": 1,
      "max_score": 10,
      "reasoning": "No specific port call history provided; score based on company's general regional familiarity.",
      "confidence": "test",
      "citations": ["ref:23"]
    },
    "intake_capacity": {
      "code": "P5",
      "score": 3,
      "max_score": 15,
      "reasoning": "**CRITICAL:** Volume limitation. With a grain capacity of 140,659 cuft and SF 51, max intake is ~2,758t. This is only 92% of the 3,000t requirement.",
      "confidence": "test",
      "citations": ["ref:23"],
      "critical": true
    },
    "openarea_modifier": {
      "code": "P6",
      "score": 0,
      "max_score": 0,
      "reasoning": "No voyage-specific comments provided.",
      "confidence": "test",
      "citations": ["ref:23"]
    },
    "readiness_eta": {
      "code": "P7",
      "score": 7,
      "max_score": 10,
      "reasoning": "Based on position in Azov Sea and 8kn speed, vessel can reach Reni in ~2.5 days, well within the Jan 12-20 laycan.",
      "confidence": "test",
      "citations": ["ref:23"]
    }
  }
}



--- START OF estimator-prompts/intake_calculator_formula.txt ---
# ═══════════════════════════════════════════════════════════════════
# P5: INTAKE CAPACITY CALCULATOR - UPDATED v2.0
# VK Charts AI Scoring System
# ═══════════════════════════════════════════════════════════════════
#
# CHANGES IN v2.0:
# - Added penalties for under-utilization (<90%)
# - Added penalties for over-utilization (>110%)
# - Clarified cargo quantity range handling (min-max or ±10%)
# - Linear penalty formulas for both under and over capacity
#
# ═══════════════════════════════════════════════════════════════════

version: "2.0"
date: "2026-01-19"
priority: "CRITICAL - Intake affects commercial viability"

# ═══════════════════════════════════════════════════════════════════
# OVERVIEW
# ═══════════════════════════════════════════════════════════════════

purpose: |
  P5 evaluates whether vessel can physically carry the cargo quantity.
  
  SCORE RANGE: 0-15 points
  
  KEY PRINCIPLE:
  - Optimal utilization: 90-110% of cargo quantity
  - Under-utilization: Vessel too large → lost revenue per ton
  - Over-utilization: Cargo too large → physically impossible or risky

# ═══════════════════════════════════════════════════════════════════
# CARGO QUANTITY RANGES
# ═══════════════════════════════════════════════════════════════════

cargo_quantity_formats:
  
  explicit_range:
    format: "6000-6600t"
    interpretation:
      min_quantity: 6000
      max_quantity: 6600
      optimal_target: 6300
    
    example: "Wheat 6000/6600t Odessa/Mersin"
  
  plus_minus_percentage:
    format: "6000t ±10%"
    interpretation:
      base_quantity: 6000
      percentage: 10
      min_quantity: "6000 × 0.90 = 5400t"
      max_quantity: "6000 × 1.10 = 6600t"
    
    example: "Corn 6000t MOLOO Chornomorsk/Yarimca"
    note: "MOLOO = More Or Less Owner's Option (±10%)"
  
  single_quantity:
    format: "6000t"
    interpretation:
      target_quantity: 6000
      assume_range: "6000 ±5% (5700-6300t)"
    
    note: "Default tolerance if no range specified"
  
  calculation_basis:
    use_for_utilization: "cargo_max_quantity"
    reasoning: |
      Always calculate utilization against MAX possible cargo.
      This ensures vessel can handle worst-case (largest) parcel.

# ═══════════════════════════════════════════════════════════════════
# INTAKE CALCULATION STEPS
# ═══════════════════════════════════════════════════════════════════

intake_calculation:
  
  step_1_weight_based_intake:
    formula: "effective_dwt = vessel_dwt - rob - constant"
    
    components:
      vessel_dwt:
        source: "Vessel database field"
        example: 7853
      
      rob:
        full_name: "Remaining On Board (fuel, water, stores)"
        typical_value: 250
        unit: "tons"
        note: "Standard assumption for coasters"
      
      constant:
        value: 0
        note: "Reserved for future adjustments"
    
    example:
      vessel_dwt: 7853
      rob: 250
      constant: 0
      effective_dwt: "7853 - 250 - 0 = 7603t"
  
  step_2_volume_based_intake:
    description: "Calculate intake limited by cargo volume (grain capacity)"
    
    condition: "IF cargo has high stowage factor (volumetric cargo)"
    
    formula: "volume_based_intake = grain_capacity / stowage_factor"
    
    components:
      grain_capacity:
        source: "Vessel database field"
        unit: "cubic feet"
        example: 283120
      
      stowage_factor:
        source: "Cargo database or description"
        unit: "cubic feet per ton"
        example: 47
        note: "Higher SF = lighter/bulkier cargo"
      
      conversion:
        if_needed: "Convert grain capacity to cubic meters if SF in m³/t"
    
    example:
      grain_capacity: 283120
      stowage_factor: 47
      volume_based_intake: "283120 / 47 = 6023t"
  
  step_3_draft_based_intake:
    description: "Calculate intake limited by port draft restrictions"
    
    condition: "IF port has draft restriction < vessel max draft"
    
    formula: "Use TPC (Tons Per Centimeter) curves or approximation"
    
    note: |
      Draft restrictions are complex and vessel-specific.
      For MVP, use weight and volume checks primarily.
      Draft can be added later with TPC data.
  
  step_4_final_intake:
    formula: "final_intake = MIN(weight_based, volume_based, draft_based)"
    
    reasoning: |
      Vessel intake is LIMITED by the most restrictive factor:
      - Weight limit (DWT)
      - Volume limit (grain capacity ÷ SF)
      - Draft limit (port restriction)
    
    example:
      weight_based: 7603
      volume_based: 6023
      draft_based: "N/A (no restriction)"
      final_intake: "MIN(7603, 6023) = 6023t"

# ═══════════════════════════════════════════════════════════════════
# UTILIZATION CALCULATION
# ═══════════════════════════════════════════════════════════════════

utilization_calculation:
  
  formula: "utilization_percent = (cargo_max_quantity / final_intake) × 100"
  
  example:
    cargo_quantity: "6000t"
    cargo_max: 6000
    final_intake: 6023
    utilization: "(6000 / 6023) × 100 = 99.6%"
  
  interpretation:
    optimal_range: "90-110%"
    under_utilized: "< 90%"
    over_utilized: "> 110%"

# ═══════════════════════════════════════════════════════════════════
# SCORING MATRIX v2.0 - WITH PENALTIES
# ═══════════════════════════════════════════════════════════════════

scoring_matrix_v2:
  
  # ─────────────────────────────────────────────────────────────────
  # OPTIMAL UTILIZATION (90-110%)
  # ─────────────────────────────────────────────────────────────────
  
  optimal_90_110:
    condition: "90% ≤ utilization ≤ 110%"
    base_score: 15
    penalty: 0
    final_score: 15
    confidence: 90
    reasoning: "Excellent fit - cargo and vessel well-matched"
    examples:
      - utilization: "95%"
        score: 15
      - utilization: "100%"
        score: 15
      - utilization: "105%"
        score: 15
  
  # ─────────────────────────────────────────────────────────────────
  # UNDER-UTILIZATION (<90%) - Vessel Too Large
  # ─────────────────────────────────────────────────────────────────
  
  under_utilization_formula:
    condition: "utilization < 90%"
    
    penalty_formula: "penalty_percent = (90 - utilization) × 0.5"
    final_score_formula: "score = 15 × (1 - penalty_percent/100)"
    
    explanation: |
      For every 1% below 90% utilization, apply 0.5% penalty.
      This reflects owner's lost revenue from unused capacity.
    
    examples:
      
      example_1:
        utilization: "85%"
        penalty_calculation: "(90 - 85) × 0.5 = 2.5%"
        final_score: "15 × (1 - 0.025) = 14.6"
        reasoning: "Minor under-utilization, acceptable"
      
      example_2:
        utilization: "79%"
        penalty_calculation: "(90 - 79) × 0.5 = 5.5%"
        final_score: "15 × (1 - 0.055) = 14.2"
        reasoning: "Moderate under-utilization"
        citations:
          - "Correction (valmiera): 7782 DWT for 6000t cargo = significant under-utilization"
      
      example_3:
        utilization: "70%"
        penalty_calculation: "(90 - 70) × 0.5 = 10%"
        final_score: "15 × (1 - 0.10) = 13.5"
        reasoning: "Vessel significantly too large"
      
      example_4:
        utilization: "60%"
        penalty_calculation: "(90 - 60) × 0.5 = 15%"
        final_score: "15 × (1 - 0.15) = 12.8"
        reasoning: "Poor match - vessel far too large"
  
  # ─────────────────────────────────────────────────────────────────
  # OVER-UTILIZATION (>110%) - Cargo Too Large
  # ─────────────────────────────────────────────────────────────────
  
  over_utilization_110_120:
    condition: "110% < utilization ≤ 120%"
    base_score: 15
    penalty_formula: "(utilization - 110) × 0.5"
    
    examples:
      
      example_1:
        utilization: "112%"
        penalty: "(112 - 110) × 0.5 = 1%"
        final_score: "15 × (1 - 0.01) = 14.9"
        reasoning: "Tight fit, possible with careful planning"
      
      example_2:
        utilization: "115%"
        penalty: "(115 - 110) × 0.5 = 2.5%"
        final_score: "15 × (1 - 0.025) = 14.6"
        reasoning: "Very tight, requires optimization"
      
      example_3:
        utilization: "119%"
        penalty: "(119 - 110) × 0.5 = 4.5%"
        final_score: "15 × (1 - 0.045) = 14.3"
        reasoning: "Borderline feasible"
  
  over_utilization_120_130:
    condition: "120% < utilization ≤ 130%"
    score_range: [6, 10]
    reasoning: "Very risky - may require cargo reduction or favorable conditions"
    
    examples:
      utilization: "125%"
      score: 8
      reasoning: "Risky - likely need to reduce cargo or optimize SF"
  
  over_utilization_above_130:
    condition: "utilization > 130%"
    score_range: [2, 5]
    reasoning: "Physically very difficult - extreme measures required"
    
    examples:
      utilization: "135%"
      score: 3
      reasoning: "Nearly impossible without major cargo reduction"
  
  # ─────────────────────────────────────────────────────────────────
  # MINIMUM SCORE FLOOR
  # ─────────────────────────────────────────────────────────────────
  
  minimum_score:
    value: 2
    reasoning: |
      Even if cargo doesn't fit perfectly, score should never be zero.
      There's always potential for negotiation (cargo reduction, etc.)

# ═══════════════════════════════════════════════════════════════════
# SPECIAL CONSIDERATIONS
# ═══════════════════════════════════════════════════════════════════

special_cases:
  
  stowage_factor_missing:
    condition: "Cargo SF not available"
    action: "Skip volume_based_intake calculation"
    use: "weight_based_intake only"
    note: "Assume weight-limited cargo (low SF like grain)"
  
  grain_capacity_missing:
    condition: "Vessel grain capacity not in database"
    action: "Estimate from DWT or skip volume check"
    conservative_estimate: "grain_capacity ≈ DWT × 50 cubic feet/ton"
  
  draft_restriction:
    condition: "Port draft < vessel draft"
    action: "Flag in reasoning, reduce confidence"
    future_enhancement: "Add draft-based intake calculation"
  
  dense_cargo:
    examples: ["Iron ore", "Steel products", "Kaolin"]
    characteristic: "Low SF (weight-limited)"
    impact: "weight_based_intake is limiting factor"
  
  light_cargo:
    examples: ["Wood chips", "Cotton", "Light grain"]
    characteristic: "High SF (volume-limited)"
    impact: "volume_based_intake is limiting factor"

# ═══════════════════════════════════════════════════════════════════
# AI REASONING TEMPLATES
# ═══════════════════════════════════════════════════════════════════

reasoning_templates:
  
  template_optimal:
    condition: "90-110% utilization"
    format: |
      "Vessel DWT ([dwt]) accommodates [cargo_qty] cargo with [util]% utilization.
      [limiting_factor if relevant]. Excellent/Good fit."
    example: |
      "Vessel DWT (6687) accommodates 6000t cargo with 90% utilization after ROB deduction.
      Good fit for this parcel size."
  
  template_under_utilized:
    condition: "<90% utilization"
    format: |
      "Vessel DWT ([dwt]) significantly exceeds cargo requirement ([cargo_qty]).
      Utilization: [util]%, indicating vessel is [X]% under-utilized. [Impact]."
    example: |
      "Vessel DWT (7782) significantly exceeds cargo requirement (6000t).
      Utilization: 77%, indicating vessel is 23% under-utilized.
      Owner loses revenue on unused capacity."
  
  template_over_utilized:
    condition: ">110% utilization"
    format: |
      "Cargo [cargo_qty] requires [util]% of vessel capacity ([intake]).
      [tight/risky/difficult] fit. [Actions needed]."
    example: |
      "Cargo 6000t requires 115% of vessel capacity (5200t effective).
      Tight fit, may require cargo reduction or favorable draft conditions."

# ═══════════════════════════════════════════════════════════════════
# CRITICAL AI INSTRUCTIONS
# ═══════════════════════════════════════════════════════════════════

ai_must:
  - "ALWAYS calculate utilization against cargo MAX quantity"
  - "ALWAYS apply penalties for <90% or >110% utilization"
  - "ALWAYS check for volumetric cargoes (high SF)"
  - "ALWAYS use MIN of weight/volume/draft as final intake"
  - "NEVER give zero score (minimum is 2)"

ai_must_not:
  - "Never ignore under-utilization penalties"
  - "Never assume vessel can carry >130% without major penalty"
  - "Never skip volume check if SF is available"

# ═══════════════════════════════════════════════════════════════════
# END OF P5 INTAKE CAPACITY CALCULATOR v2.0
# ═══════════════════════════════════════════════════════════════════


--- START OF estimator-prompts/port_restrictions_map.txt ---
port_restrictions_map

Short Summary — Port Restrictions Map

This file contains the physical and operational limitations of ports, terminals, and regions.
It defines what a vessel can or cannot do in a specific port based on:

Draft restrictions

LOA / Beam limits

Water type (fresh / brackish / sea)

Seasonal restrictions (ice, low water, draft reduction)

Gear requirements (required / preferred / optional)

Maximum vessel size (typical DWT ranges)

Terminal-level depth and operational constraints

It also includes regional-level patterns, explaining where gear is typically required (Africa, Red Sea, Asia) or rarely needed (Black Sea, America).

This file is the authoritative source for all port-related compatibility checks in the VK Charts AI scoring system.

▶️ How to Use — Short Instructions
1. Use this file to check whether the vessel can physically load/discharge

AI must compare:

vessel draft

LOA

beam

presence/absence of vessel gear

with the port’s restrictions.

If any restriction is violated →
AI must assign a low score or mark the vessel incompatible for this cargo.

2. Apply regional patterns when port-level data is missing

If a specific port is not in the file:

Use region_patterns (e.g., “Africa → gear required”)

This acts as a fallback rule to avoid incorrect assumptions

3. Use seasonal rules for ports like Izmail/Reni

AI must adjust scoring if:

winter ice requires ice-class

low water reduces draft

Danube limitations restrict DWT

These conditions directly influence vessel–cargo compatibility.

4. Use gear_requirement rules for cargo types

Example:
Sugar in bags → vessel gear required (both ends).
If the vessel has no gear → −20 penalty.

This connects port restrictions with cargo-specific requirements.

5. Determine maximum vessel size compatibility

File provides typical DWT limits:

Odessa/Constanta → up to Panamax

Izmail/Reni → ~3–8K DWT

Egypt Med ports → 5–20K DWT

AI must ensure vessel DWT is within the acceptable range.

6. Use “aliases” for correct port matching

Odessa, Chornomorsk, Ilyichevsk → same port group.
Constanta → may require gear only during roadstead ops.

This prevents false negatives in matching.

# ═══════════════════════════════════════════════════════════════════
# METADATA & DEFINITIONS
# ═══════════════════════════════════════════════════════════════════

definitions:
  draft: "Maximum vessel draft in meters (summer draft)"
  loa: "Maximum Length Overall in meters"
  beam: "Maximum vessel beam/width in meters"
  wlthc: "Winter Load Line Tropical Cargo (needs clarification)"
  water_type:
    - fresh: "Freshwater (rivers, lakes)"
    - brackish: "Mixed fresh/salt water (estuaries, deltas)"
    - sea: "Seawater (open sea ports)"
  
  restriction_stability:
    constant: "Restrictions don't change (infrastructure limitation)"
    seasonal: "Restrictions vary by season (water level, ice, etc)"
    
  gear_requirement:
    required: "Vessel gear absolutely necessary"
    preferred: "Vessel gear gives advantage but not mandatory"
    optional: "Shore gear available, vessel gear not needed"
    
  sources:
    airtable: "Port name from Airtable database"
    user_knowledge: "Expert knowledge (Vitaly)"
    port_authority: "Official port documentation"
    practical_experience: "Real fixture experience"

# ═══════════════════════════════════════════════════════════════════
# REGION-LEVEL PATTERNS
# ═══════════════════════════════════════════════════════════════════

region_patterns:
  
  black_sea:
    general_gear_requirement: "optional"
    notes: "Almost never need vessel gear in Black Sea ports"
    water_type: "sea"
    major_ports_capacity: "Up to Panamax size"
    
  mediterranean:
    coaster_gear_requirement: "optional"
    handysize_plus_gear_requirement: "preferred"
    notes: "Coasters rarely need gear, larger vessels sometimes do"
    
  asia:
    general_gear_requirement: "required"
    notes: "Vessel gear often needed for loading operations"
    
  red_sea:
    general_gear_requirement: "required"
    notes: "Vessel gear frequently needed"
    
  africa:
    general_gear_requirement: "required"
    notes: "Vessel gear often needed"
    
  america:
    general_gear_requirement: "optional"
    notes: "Almost never need vessel gear"

# ═══════════════════════════════════════════════════════════════════
# COUNTRY-LEVEL RESTRICTIONS
# ═══════════════════════════════════════════════════════════════════

countries:
  
  ukraine:
    airtable_id: "TBD"
    general_notes: "Major grain exporter, modern facilities in main ports"
    
    ports:
      
      odessa_chornomorsk:
        airtable_id: "TBD"
        official_name: "Odessa/Chornomorsk Port Complex"
        aliases: ["Odessa", "Chornomorsk", "Ilyichevsk"]
        
        restrictions:
          draft: null  # No specific limit, accepts up to Panamax
          loa: null    # Can handle large vessels
          beam: null
          wlthc: null
          restriction_type: "constant"
          
        water_type: "sea"
        
        vessel_gear:
          requirement: "optional"
          reason: "Modern grain terminals with shore equipment"
          
        max_vessel_size:
          description: "Up to Panamax"
          typical_dwt_range: [3000, 75000]
          
        terminals:
          - name: "TIS Grain Terminal"
            draft: 14.0
            notes: "Deep water terminal"
            
          - name: "Kernel Terminal"
            draft: 12.5
            
          - name: "Nika-Tera"
            draft: 12.0
        
        notes: "Major grain export hub with modern facilities"
        
      izmail_reni:
        airtable_id: "TBD"
        official_name: "Izmail/Reni Danube Ports"
        aliases: ["Izmail", "Reni", "Ismail"]
        region: "Danube Delta"
        
        restrictions:
          draft: 7.0
          loa: null
          beam: null
          wlthc: null
          restriction_type: "seasonal"
          
        seasonal_variations:
          winter:
            months: [12, 1, 2]
            additional_restrictions:
              ice: true
              ice_class_required: true
              notes: "Icebreaker assistance may be needed"
              
          low_water:
            months: [8, 9]
            draft_reduction: 0.3
            notes: "Draft may be reduced in dry season"
        
        water_type: "fresh"
        
        vessel_gear:
          requirement: "required"
          reason: "Danube ports limited shore facilities"
          
        max_vessel_size:
          description: "Small handysize max"
          typical_dwt_range: [3000, 8000]
          
        notes: "Danube river ports with draft and seasonal limitations"
  
  romania:
    airtable_id: "TBD"
    
    ports:
      
      constanta:
        airtable_id: "TBD"
        official_name: "Constanta Port"
        
        restrictions:
          draft: null  # No specific limit, major port
          loa: null
          beam: null
          wlthc: null
          restriction_type: "constant"
          
        water_type: "sea"
        
        vessel_gear:
          requirement: "optional"
          reason: "Modern port with shore equipment"
          exceptions:
            - condition: "Roadstead transhipment operations"
              requirement: "required"
              reason: "Loading from small vessel to larger vessel"
          
        max_vessel_size:
          description: "Up to Panamax"
          typical_dwt_range: [3000, 75000]
          
        operations:
          roadstead_transhipment:
            available: true
            vessel_gear_required: true
            typical_scenario: "Small vessel → Large vessel transfer"
            
        notes: "Major Black Sea port, can handle large vessels"
  
  russia:
    airtable_id: "TBD"
    
    ports:
      
      novorossiysk:
        airtable_id: "TBD"
        official_name: "Novorossiysk"
        
        restrictions:
          draft: null  # Major port, deep water
          loa: null
          beam: null
          wlthc: null
          restriction_type: "constant"
          
        water_type: "sea"
        
        vessel_gear:
          requirement: "optional"
          
        max_vessel_size:
          description: "Up to Panamax and larger"
          typical_dwt_range: [5000, 100000]
          
        notes: "Largest Russian Black Sea port"
  
  egypt:
    airtable_id: "TBD"
    
    ports:
      
      alexandria:
        airtable_id: "TBD"
        restrictions:
          draft: 8.5
          loa: null
          beam: null
          wlthc: null
          restriction_type: "constant"
        water_type: "sea"
        vessel_gear:
          requirement: "optional"
        max_vessel_size:
          typical_dwt_range: [5000, 15000]
          
      damietta:
        airtable_id: "TBD"
        restrictions:
          draft: 9.0
          loa: null
          beam: null
          wlthc: null
          restriction_type: "constant"
        water_type: "sea"
        vessel_gear:
          requirement: "optional"
        max_vessel_size:
          typical_dwt_range: [5000, 20000]
          
      port_said:
        airtable_id: "TBD"
        restrictions:
          draft: 10.0
          loa: null
          beam: null
          wlthc: null
          restriction_type: "constant"
        water_type: "sea"
        vessel_gear:
          requirement: "optional"
        max_vessel_size:
          typical_dwt_range: [8000, 30000]

# ═══════════════════════════════════════════════════════════════════
# SPECIAL CARGO GEAR REQUIREMENTS
# ═══════════════════════════════════════════════════════════════════

cargo_gear_requirements:
  
  sugar_in_bags:
    cargo_type: "Sugar (bagged/big bags)"
    
    gear_requirement:
      loading_ports: "required"
      discharge_ports: "required"
      reason: "Bagged cargo handling typically requires vessel gear"
      
    applies_to:
      - "Sugar in bags"
      - "Sugar in big bags"
      - "Similar bagged agricultural products"
      
    scoring_impact:
      vessel_has_gear: 0
      vessel_no_gear: -20

# ═══════════════════════════════════════════════════════════════════
# TEMPLATE FOR NEW PORTS
# ═══════════════════════════════════════════════════════════════════

port_template:
  port_name_here:
    airtable_id: "TBD"
    official_name: ""
    aliases: []
    country: ""
    region: ""
    
    restrictions:
      draft: null          # meters (null if no restriction)
      loa: null           # meters (null if no restriction)  
      beam: null          # meters (null if no restriction)
      wlthc: null         # (needs clarification)
      restriction_type: "constant"  # or "seasonal"
      
    seasonal_variations:  # only if restriction_type: "seasonal"
      season_name:
        months: []
        additional_restrictions: {}
        
    water_type: "sea"    # fresh/brackish/sea
    
    vessel_gear:
      requirement: "optional"  # required/preferred/optional
      reason: ""
      exceptions: []
      
    max_vessel_size:
      description: ""
      typical_dwt_range: [min, max]
      
    terminals: []        # if port has multiple terminals
    
    operations: {}       # special operations (transhipment, etc)
    
    notes: ""
    source: "user_knowledge"
    last_updated: "YYYY-MM-DD"


--- START OF estimator-prompts/proximity_scoring_matrix.txt ---
# ═══════════════════════════════════════════════════════════════════
# PROXIMITY SCORING MATRIX
# VK Charts AI Scoring System - Criterion P1
# ═══════════════════════════════════════════════════════════════════
#
# SHORT SUMMARY
#
# This file defines P1 (Proximity) scoring - how AI evaluates geographic
# distance compatibility between vessel's current position and cargo's
# loading port. P1 contributes 0-20 points to the total score (100 max).
#
# WHAT THIS FILE CONTAINS:
#
# 1. INTERNAL SCORING LEVELS (0-50 internal points)
#    - Level 1: Same port = 50 internal points
#    - Level 7: Marmara Sea = 20 internal points
#    - Level 12: Beyond viable range = -10 internal points
#    - These are SCALED to final P1 range [0, 20]
#
# 2. VESSEL SIZE ADJUSTMENTS
#    - Coasters (4001-17000 DWT): Limited range, higher penalties
#    - Small Handy (17001-24000 DWT): Better tolerance
#    - Handy (24001-40000 DWT): Good long-distance capability
#    - Supramax/Panamax (40000+ DWT): Can ballast globally
#
# 3. DISTANCE PENALTIES
#    - Fine-tuning based on actual nautical miles within same level
#    - Penalty per 100nm varies by vessel size
#
# 4. GEOPOLITICAL RESTRICTIONS
#    - Ukraine-Russia war sanctions (IMPOSSIBLE scoring)
#    - Port accessibility by vessel size
#
# 5. AI USAGE INSTRUCTIONS
#    - Step-by-step scoring process
#    - Location determination logic
#    - Score calculation and scaling
#
# CRITICAL NOTE:
# Internal scores (0-50) in this file are SCALED to P1 final range [0, 20]
# according to MASTER_SCORING_SYSTEM.txt formula.
#
# ═══════════════════════════════════════════════════════════════════
  
  for_ai_langchain:
    role: "Proximity Scoring Implementation"
    process:
      step_1: "Read vessel location from input"
      step_2: "Read cargo loading port from input"
      step_3: "Determine vessel size category (DWT)"
      step_4: "Find matching proximity level in this file"
      step_5: "Get internal base score (0-50 range)"
      step_6: "Apply distance penalty if applicable"
      step_7: "Apply geopolitical restrictions if applicable"
      step_8: "Scale final internal score to P1 range [0-20]"
      step_9: "Generate explanation and reasoning"
    
      example: |
        {
          "criterion_1_proximity": {
            "score": 7.6,
            "score_range": "[0-20]",
            "internal_calculation": "level_7_marmara_sea: 20 internal points - 0.96 penalty = 19.04 → scaled to 7.6/20",
            "explanation": "Vessel in Marmara Sea, cargo loading Black Sea. Acceptable ballast through Bosphorus.",
            "reasoning": "For coaster-size vessel, Marmara to Black Sea is Level 7 proximity..."
          }
        }
    
    scaling_formula:
      internal_to_final: "P1_final = (internal_score / 50) * 20"
      example_1: "Internal 50 → P1 = 20 (maximum)"
      example_2: "Internal 25 → P1 = 10 (mid-range)"
      example_3: "Internal 0 → P1 = 0 (minimum)"
      example_4: "Internal -10 → P1 = 0 (blocked, cannot be negative)"


# ═══════════════════════════════════════════════════════════════════
# SCORING PRINCIPLE
# ═══════════════════════════════════════════════════════════════════

scoring_principle: |
  Proximity = Lower ballast cost = Higher score
  
  Чем ближе судно к порту погрузки, тем выше score
  
  INTERNAL SCORING: 0-50 points (used for detailed level differentiation)
  FINAL P1 SCORE: 0-20 points (scaled from internal score)
  
  Scaling formula: P1_final = (internal_score / 50) * 20

# ═══════════════════════════════════════════════════════════════════
# GEOGRAPHIC HIERARCHY
# ═══════════════════════════════════════════════════════════════════
  
  hierarchy:
    - "Port (lowest level)"
    - "Country"
    - "Region (optional sub-grouping)"
    - "Sea"
    - "Global Region (highest level)"
  
  example:
    port: "Odessa"
    country: "Ukraine"
    region: "POC"
    sea: "Black Sea"
    global_region: "Eastern Europe"

# ═══════════════════════════════════════════════════════════════════
# BLACK SEA SUB-REGIONS
# ═══════════════════════════════════════════════════════════════════

black_sea_subregions:
  
  poc:
    name: "POC (Pivdenny-Odessa-Chornomorsk)"
    country: "Ukraine"
    ports:
      - "Odessa"
      - "Pivdenny (Yuzhny)"
      - "Chornomorsk (Ilyichevsk)"
    characteristics:
      - "Major grain export hub"
      - "Close proximity to each other"
      - "Shared anchorage areas"
  
  sulina_anchorage:
    name: "Sulina Anchorage"
    country: "Romania/International waters"
    characteristics:
      - "Strategic position"
      - "Can access BOTH Danube AND POC"
      - "Excellent positioning for either direction"
    
  danube_ports:
    name: "Danube River Ports"
    countries: ["Romania", "Moldova", "Ukraine"]
    ports:
      romania:
        - "Galati"
        - "Braila"
      moldova:
        - "Giurgiulesti"
      ukraine:
        - "Kiliya"
        - "Orlovka"
        - "Izmail"
        - "Reni"
    characteristics:
      - "River ports"
      - "Draft restrictions"
      - "Smaller vessel sizes"
  
  cvb:
    name: "CVB (Constanta-Varna-Burgas)"
    countries: ["Romania", "Bulgaria"]
    ports:
      romania:
        - "Constanta"
      bulgaria:
        - "Varna"
        - "Burgas"
    characteristics:
      - "Major Black Sea ports"
      - "Good facilities"
      - "Western Black Sea"
  
  turkish_black_sea:
    name: "Turkish Black Sea Ports"
    country: "Turkey"
    ports:
      - "Samsun"
      - "Trabzon"
      - "Zonguldak"
      - "Eregli"
      - "And other Turkish Black Sea ports"
  
  russian_black_sea:
    name: "Russian Black Sea Ports"
    country: "Russia"
    ports:
      - "Novorossiysk"
      - "Kavkaz (Caucasus)"
      - "Other Russian Black Sea ports"
    
    geopolitical_restriction:
      status: "BLOCKED due to Ukraine-Russia war"
      ukraine_to_russia: "IMPOSSIBLE - sanctions"
      russia_to_ukraine: "IMPOSSIBLE - sanctions"
      effective_date: "2022-present"
  
  georgian_black_sea:
    name: "Georgian Black Sea Ports"
    country: "Georgia"
    ports:
      - "Poti"
      - "Batumi"

# ═══════════════════════════════════════════════════════════════════
# PROXIMITY SCORING - COASTERS (4001-17000 DWT)
# ═══════════════════════════════════════════════════════════════════

proximity_scoring_coasters:
  vessel_size_range: [4001, 17000]
  cargo_loading_example: "Black Sea (Odessa)"
  
  levels:
    
    level_1_same_port:
      internal_score: 50
      p1_equivalent: "~20 points"
      description: "Vessel in same port as loading port"
      examples:
        - vessel_location: "Odessa"
          cargo_loading: "Odessa"
          result: "Perfect - zero ballast"
      
    level_2_same_port_cluster:
      internal_score: 45
      p1_equivalent: "~18 points"
      description: "Vessel in same port cluster/region"
      examples:
        - vessel_location: "Pivdenny"
          cargo_loading: "Odessa"
          result: "POC cluster - minimal ballast (few hours)"
        - vessel_location: "Chornomorsk"
          cargo_loading: "Odessa"
          result: "POC cluster - minimal ballast"
      
    level_3_sulina_anchorage:
      internal_score: 48
      p1_equivalent: "~19 points"
      description: "Special case - Sulina Anchorage"
      reasoning: "Can access both POC and Danube easily"
      examples:
        - vessel_location: "Sulina Anchorage"
          cargo_loading: "Odessa"
          result: "Very close, excellent positioning"
        - vessel_location: "Sulina Anchorage"
          cargo_loading: "Reni (Danube)"
          result: "Also very close"
    
    level_4_same_subregion:
      internal_score: 40
      p1_equivalent: "~16 points"
      description: "Vessel in different port within same Black Sea sub-region"
      examples:
        - vessel_location: "Constanta"
          cargo_loading: "POC"
          result: "Both CVB region - short ballast"
      
    level_5_nearby_subregion:
      internal_score: 35
      p1_equivalent: "~14 points"
      description: "Vessel in nearby Black Sea sub-region"
      examples:
        - vessel_location: "CVB"
          cargo_loading: "POC"
          result: "Short cross-Black Sea ballast"
     
    level_6_same_black_sea:
      internal_score: 30
      p1_equivalent: "~12 points"
      description: "Vessel anywhere in Black Sea"
      examples:
        - vessel_location: "Turkish Black Sea"
          cargo_loading: "Odessa"
          result: "Same sea but longer ballast"
        - vessel_location: "Batumi (Georgia)"
          cargo_loading: "Odessa"
          result: "Cross Black Sea ballast"
      
      geopolitical_exceptions:
        ukraine_russia_block:
          condition: "Ukraine port ↔ Russian vessel OR Russia port ↔ Ukrainian vessel"
          score: "IMPOSSIBLE"
          reason: "War, sanctions, blocked"
          examples:
            - vessel: "Russian flag in Novorossiysk"
              cargo: "Loading in Odessa"
              result: "IMPOSSIBLE - cannot enter Ukraine"
            - vessel: "Any vessel in Ukraine"
              cargo: "Loading in Novorossiysk"  
              result: "IMPOSSIBLE - cannot enter Russia"
    
    level_7_marmara_sea:
      internal_score: 20
      p1_equivalent: "~8 points"
      description: "Vessel in Marmara Sea"
      examples:
        - vessel_location: "Istanbul"
          cargo_loading: "Odessa"
          result: "Bosphorus crossing + Black Sea ballast"
        - vessel_location: "Derince"
          cargo_loading: "Constanta"
          result: "Acceptable ballast"
      
    level_8_izmir_nemrut_east_greece:
      internal_score: 12
      p1_equivalent: "~5 points"
      description: "Vessel in line of Izmir-Nemrut Bay area and east coast Greece"
      examples:
        - vessel_location: "Izmir"
          cargo_loading: "Odessa"
          result: "Med → Dardanelles → Marmara → Bosphorus → Black Sea"
        - vessel_location: "Nemrut Bay"
          cargo_loading: "Constanta"
          result: "Short to Dardanelles, then Black Sea"
        - vessel_location: "Thessaloniki"
          cargo_loading: "Varna"
          result: "Eastern Greece → Black Sea acceptable"
      
    level_9_east_med:
      internal_score: 8
      p1_equivalent: "~3 points"
      description: "Vessel in East Mediterranean"
      examples:
        - vessel_location: "Limassol (Cyprus)"
          cargo_loading: "Odessa"
          result: "Longer Med → Black Sea ballast"
        - vessel_location: "Lebanon"
          cargo_loading: "Constanta"
          result: "East Med → Black Sea feasible but long"
      
    level_10_adriatic_ionian:
      internal_score: 4
      p1_equivalent: "~2 points"
      description: "Vessel in Adriatic or Ionian Sea"
      examples:
        - vessel_location: "Bar (Montenegro)"
          cargo_loading: "Odessa"
          result: "Adriatic → Med → Black Sea - long ballast"
        - vessel_location: "Durres (Albania)"
          cargo_loading: "Constanta"
          result: "Ionian → Med → Black Sea - marginal for coasters"
      notes: "Approaching limit for coasters"
    
    level_11_west_med:
      internal_score: 0
      p1_equivalent: "0 points"
      description: "Vessel in West Mediterranean - RARE for coasters"
      examples:
        - vessel_location: "Barcelona"
          cargo_loading: "Odessa"
          result: "Very long ballast - unlikely for coaster"
      notes: "Coasters typically won't ballast from this distance"
    
    level_12_beyond:
      internal_score: -10
      p1_equivalent: "0 points (blocked)"
      description: "Further than West Med - NOT VIABLE for coasters"
      examples:
        - vessel_location: "Atlantic"
        - vessel_location: "North Europe"
        - vessel_location: "Asia"
      notes: "Coasters working in these areas, not positioning to Black Sea"

# ═══════════════════════════════════════════════════════════════════
# PROXIMITY SCORING - SMALL HANDY (17001-24000 DWT)
# ═══════════════════════════════════════════════════════════════════

proximity_scoring_small_handy:
  vessel_size_range: [17001, 24000]
  cargo_loading_example: "Black Sea (Odessa)"
  
  levels:
    # Same top levels as coasters
    level_1_same_port:
      internal_score: 50
      p1_equivalent: "~20 points"
      
    level_2_same_port_cluster:
      internal_score: 45
      p1_equivalent: "~18 points"
      
    level_3_sulina_anchorage:
      internal_score: 48
      p1_equivalent: "~19 points"
      
    level_4_same_subregion:
      internal_score: 40
      p1_equivalent: "~16 points"
      
    level_5_nearby_subregion:
      internal_score: 35
      p1_equivalent: "~14 points"
      
    level_6_same_black_sea:
      internal_score: 30
      p1_equivalent: "~12 points"
      
    level_7_marmara_sea:
      internal_score: 22
      p1_equivalent: "~9 points"
      note: "Slightly higher than coasters"
      
    level_8_izmir_nemrut_east_greece:
      internal_score: 15
      p1_equivalent: "~6 points"
      note: "Better tolerance"
      
    level_9_east_med:
      internal_score: 10
      p1_equivalent: "~4 points"
      
    level_10_adriatic_ionian:
      internal_score: 6
      p1_equivalent: "~2 points"
      
    level_11_west_med:
      internal_score: 3
      p1_equivalent: "~1 point"
      description: "Feasible but not optimal"
      
    level_12_italy_spain:
      internal_score: 1
      p1_equivalent: "~0.4 points"
      description: "Marginal for small handy"
      
    level_13_beyond:
      internal_score: -5
      p1_equivalent: "0 points (blocked)"
      description: "Atlantic, North Europe - unlikely"

# ═══════════════════════════════════════════════════════════════════
# PROXIMITY SCORING - HANDY (24001-40000 DWT)
# ═══════════════════════════════════════════════════════════════════

proximity_scoring_handy:
  vessel_size_range: [24001, 40000]
  cargo_loading_example: "Black Sea (Odessa)"
  
  levels:
    # Same top levels (1-10)
    level_1_same_port:
      internal_score: 50
      p1_equivalent: "~20 points"
      
    level_2_same_port_cluster:
      internal_score: 45
      p1_equivalent: "~18 points"
      
    level_3_sulina_anchorage:
      internal_score: 48
      p1_equivalent: "~19 points"
      
    level_4_same_subregion:
      internal_score: 40
      p1_equivalent: "~16 points"
      
    level_5_nearby_subregion:
      internal_score: 35
      p1_equivalent: "~14 points"
      
    level_6_same_black_sea:
      internal_score: 30
      p1_equivalent: "~12 points"
      
    level_7_marmara_sea:
      internal_score: 22
      p1_equivalent: "~9 points"
      
    level_8_izmir_nemrut_east_greece:
      internal_score: 15
      p1_equivalent: "~6 points"
      
    level_9_east_med:
      internal_score: 10
      p1_equivalent: "~4 points"
      
    level_10_adriatic_ionian:
      internal_score: 6
      p1_equivalent: "~2 points"
    
    level_11_west_med:
      internal_score: 8
      p1_equivalent: "~3 points"
      description: "Acceptable for handy size"
      
    level_12_italy_france_spain:
      internal_score: 8
      p1_equivalent: "~3 points"
      
    level_13_gibraltar_area:
      internal_score: 8
      p1_equivalent: "~3 points"
      
    level_14_north_europe_baltic:
      internal_score: 2
      p1_equivalent: "~1 point"
      description: "Long but possible for handy"
      
    level_15_atlantic:
      internal_score: 0
      p1_equivalent: "0 points"
      description: "Very long ballast - marginal"
      
    level_16_beyond:
      internal_score: -10
      p1_equivalent: "0 points (blocked)"
      description: "Americas, Asia - not viable"

# ═══════════════════════════════════════════════════════════════════
# PROXIMITY SCORING - SUPRAMAX/PANAMAX (40000+ DWT)
# ═══════════════════════════════════════════════════════════════════

proximity_scoring_large_vessels:
  vessel_size_range: [40000, 80000]
  cargo_loading_example: "Black Sea (Odessa)"
  
  levels:
    # Same top levels (1-10)
    level_1_same_port:
      internal_score: 50
      p1_equivalent: "~20 points"
      
    level_2_same_port_cluster:
      internal_score: 45
      p1_equivalent: "~18 points"
      
    level_3_sulina_anchorage:
      internal_score: 48
      p1_equivalent: "~19 points"
      
    level_4_same_subregion:
      internal_score: 40
      p1_equivalent: "~16 points"
      
    level_5_nearby_subregion:
      internal_score: 35
      p1_equivalent: "~14 points"
      
    level_6_same_black_sea:
      internal_score: 30
      p1_equivalent: "~12 points"
      
    level_7_marmara_sea:
      internal_score: 22
      p1_equivalent: "~9 points"
      
    level_8_izmir_nemrut_east_greece:
      internal_score: 15
      p1_equivalent: "~6 points"
      
    level_9_east_med:
      internal_score: 10
      p1_equivalent: "~4 points"
      
    level_10_adriatic_ionian:
      internal_score: 6
      p1_equivalent: "~2 points"
    
    level_11_west_med:
      internal_score: 15
      p1_equivalent: "~6 points"
      description: "Good for large vessels"
      
    level_12_atlantic_islands:
      internal_score: 10
      p1_equivalent: "~4 points"
      
    level_13_north_europe:
      internal_score: 8
      p1_equivalent: "~3 points"
      description: "Long haul acceptable"
      
    level_14_uk_ireland:
      internal_score: 6
      p1_equivalent: "~2 points"
      
    level_15_west_africa:
      internal_score: 5
      p1_equivalent: "~2 points"
      description: "Can ballast if rates justify"
      
    level_16_americas_ecsa:
      internal_score: 3
      p1_equivalent: "~1 point"
      description: "Very long but possible"
      
    level_17_far_east_asia:
      internal_score: 0
      p1_equivalent: "0 points"
      description: "Extremely long - only if positioning for major cargo program"
      
    level_18_beyond:
      internal_score: -5
      p1_equivalent: "0 points (blocked)"

# ═══════════════════════════════════════════════════════════════════
# DISTANCE FACTOR (Nautical Miles)
# ═══════════════════════════════════════════════════════════════════

distance_adjustment:
  description: "Fine-tune score based on actual distance within same level"
  
  formula: "final_internal_score = base_level_score - (distance_penalty × MARITIME_distance_nm / 100)"
  
  note: "After distance adjustment, scale internal score to P1 range [0-20]"
  
  distance_penalty_by_vessel_size:
    small_coasters:
      penalty_per_100nm: 0.5
      max_penalty: 10
      
    coasters:
      penalty_per_100nm: 0.3
      max_penalty: 8
      
    small_handy:
      penalty_per_100nm: 0.2
      max_penalty: 6
      
    handy:
      penalty_per_100nm: 0.15
      max_penalty: 5
      
    supramax_panamax:
      penalty_per_100nm: 0.1
      max_penalty: 3
  
  examples:
    - vessel: "Coaster in Constanta"
      cargo: "Loading Odessa"
      distance: "~250 nm"
      base_internal_score: 35  # level_5_nearby_subregion
      distance_penalty: "0.3 × 250/100 = 0.75"
      final_internal_score: "35 - 0.75 = 34.25"
      p1_final: "(34.25 / 50) * 20 = 13.7 points"
      
    - vessel: "Coaster in Istanbul"
      cargo: "Loading Odessa"
      distance: "~320 nm"
      base_internal_score: 20  # level_7_marmara_sea
      distance_penalty: "0.3 × 320/100 = 0.96"
      final_internal_score: "20 - 0.96 = 19.04"
      p1_final: "(19.04 / 50) * 20 = 7.6 points"

# ═══════════════════════════════════════════════════════════════════
# PORT SIZE FACTOR
# ═══════════════════════════════════════════════════════════════════

port_size_impact:
  description: "Smaller ports restrict vessel sizes"
  
  rule: "If vessel DWT > port max DWT capacity → IMPOSSIBLE"
  
  examples:
    major_ports:
      ports: ["Odessa", "Constanta", "Novorossiysk", "Varna", "Burgas", "Batumi"]
      max_capacity: "Up to Panamax (80000 DWT)"
      
    medium_ports:
      ports: ["Crete island"]
      max_capacity: "Up to Handymax (~35000 DWT)"
      
    small_ports_danube:
      ports: ["Reni", "Izmail", "Galati"]
      max_capacity: "Up to small handy (~12000 DWT)"
      restriction: "Draft limited by Danube"
      
  scoring_adjustment:
    - condition: "Vessel size > port capacity"
      score: "IMPOSSIBLE"
      
    - condition: "Vessel size close to port limit (within 10%)"
      penalty: -5
      reason: "Tight fit, operational risk"

# ═══════════════════════════════════════════════════════════════════
# GEOPOLITICAL RESTRICTIONS
# ═══════════════════════════════════════════════════════════════════

geopolitical_blocks:
  
  ukraine_russia_war:
    status: "ACTIVE"
    effective_since: "2022-02-24"
    
    restrictions:
      - description: "Russian vessels CANNOT enter Ukrainian ports"
        reason: "War, sanctions"
        score_impact: "IMPOSSIBLE"
        
      - description: "Vessels in Ukraine CANNOT enter Russian ports"
        reason: "War, sanctions"
        score_impact: "IMPOSSIBLE"
        
      - description: "Russian-flagged vessels restrictions in EU"
        reason: "EU sanctions"
        note: "May affect scoring for EU ports"
    
    future_considerations:
      - "Situation may change"
      - "System must be flexible to update restrictions"
      - "May need temporal logic (restrictions valid from/to dates)"

# ═══════════════════════════════════════════════════════════════════
# USAGE INSTRUCTIONS FOR AI
# ═══════════════════════════════════════════════════════════════════

ai_usage_instructions:
  
  step_1_identify_locations:
    vessel_location:
      - "Determine: Port, Country, Region, Sea, Global Region"
      - "Use Airtable geographic hierarchy"
      - "Refer to vessel_location_determination.txt for logic"
      
    cargo_loading_location:
      - "Determine: Port, Country, Region, Sea, Global Region"
  
  step_2_determine_vessel_size:
    - "Get vessel DWT"
    - "Classify into size category (coaster/small handy/handy/supramax/panamax)"
    - "Select appropriate proximity_scoring table"
  
  step_3_find_proximity_level:
    - "Match vessel location to cargo loading location"
    - "Find the closest matching level"
    - "Get base internal score (0-50 range)"
  
  step_4_apply_adjustments:
    - "Calculate distance in nautical miles (use VesselFinder API if available)"
    - "Apply distance penalty formula"
    - "Check port size restrictions"
    - "Check geopolitical blocks"
    - "Calculate final internal score"
  
  step_5_scale_to_p1_range:
    - "Use formula: P1_final = (internal_score / 50) * 20"
    - "Ensure P1_final is within [0, 20] range"
    - "If internal_score <= 0, P1_final = 0"
  
  step_6_generate_explanation:
    - "Explain which level matched"
    - "Explain any adjustments applied"
    - "Show internal calculation and P1 final score"
    - "Provide reasoning for offer text"
  
  example_process:
    vessel:
      name: "MV EXAMPLE"
      dwt: 7500
      location: "Istanbul, Turkey"
      location_note: "See vessel_location_determination.txt for how to determine this"
      
    cargo:
      loading_port: "Odessa, Ukraine"
      loading_region: "POC"
      loading_sea: "Black Sea"
      
    ai_calculation:
      step_1: "Vessel: Marmara Sea | Cargo: Black Sea POC"
      step_2: "Vessel 7500 DWT = Coaster (4001-17000)"
      step_3: "Match: level_7_marmara_sea → base_internal_score = 20"
      step_4: "Distance ~320nm → penalty 0.96 → adjusted_internal = 19.04"
      step_5: "P1_final = (19.04 / 50) * 20 = 7.6 points"
      step_6: "Generate explanation below"
      
    example_output:
      {
        "criterion_1_proximity": {
          "score": 7.6,
          "score_range": "[0-20]",
          "internal_calculation": "Level 7 (Marmara Sea): 20 internal points - 0.96 distance penalty = 19.04 internal → scaled to 7.6/20 P1",
          "explanation": "Vessel is in Marmara Sea (Istanbul), loading port is Black Sea (Odessa). This is Level 7 proximity for coasters - acceptable ballast through Bosphorus. Distance approximately 320 nautical miles reduces score slightly.",
          "reasoning": "For a 7500 DWT coaster, positioning from Marmara Sea to Black Sea represents moderate ballast economics. The vessel needs to transit the Bosphorus Strait, which is a routine operation. While not optimal, this proximity level is commercially acceptable for the cargo opportunity. The P1 score of 7.6/20 (38%) reflects that ballast costs are manageable but not negligible."
        }
      }


--- START OF estimator-prompts/vessel_location_determination.txt ---
# ═══════════════════════════════════════════════════════════════════
# VESSEL LOCATION DETERMINATION - UPDATED v2.0
# VK Charts AI Scoring System
# ═══════════════════════════════════════════════════════════════════
#
# CHANGES IN v2.0:
# - Added Istanbul/Canakkale as TRANSIT CHANNELS (not actual ports)
# - Added Tuzla as DRY DOCK location (+30 days for repairs)
# - Clarified priority logic for determining opening position
# - Added special handling rules for edge cases
#
# ═══════════════════════════════════════════════════════════════════

version: "2.0"
date: "2026-01-19"
priority: "CRITICAL - Location determines P1, P1A, P7 scoring"

# ═══════════════════════════════════════════════════════════════════
# OVERVIEW
# ═══════════════════════════════════════════════════════════════════

purpose: |
  Determine vessel's effective opening position for scoring purposes.
  
  This affects:
  - P1 (Proximity): Distance to loading port
  - P1A (Regional Patterns): Trade pattern viability
  - P7 (Readiness): When vessel will be ready
  
  KEY PRINCIPLE:
  Use most specific/reliable data available, following priority order.

# ═══════════════════════════════════════════════════════════════════
# DATA PRIORITY ORDER
# ═══════════════════════════════════════════════════════════════════

priority_order:
  
  priority_1_open_area:
    source: "OpenArea field (manually entered)"
    reliability: "HIGHEST - owner's stated position"
    format: "Port name + Date"
    example: "Constanta, Jan 20"
    
    usage: |
      If open_area is provided, this is DEFINITIVE.
      Use this location and date for all scoring.
      Ignore destination and current_area.
    
  priority_2_destination:
    source: "Destination field (from AIS)"
    reliability: "MEDIUM - vessel heading there, but purpose unclear"
    format: "Port name"
    additional: "ETA (Estimated Time of Arrival)"
    example: "Mersin, ETA Jan 25"
    
    usage: |
      If destination is set (and no open_area):
      - Vessel is likely going there to load OR discharge
      - Opening location = destination port
      - Opening date = ETA + 7 days (operations buffer)
      
      EXCEPTIONS:
      - Istanbul: Treat as TRANSIT, not destination
      - Canakkale: Treat as TRANSIT, not destination  
      - Tuzla: Treat as DRY DOCK (+30 days)
    
  priority_3_current_area:
    source: "Current Area field (from AIS)"
    reliability: "LOW - only shows current position"
    format: "Geographic region or port name"
    example: "East Mediterranean" or "Sulina"
    
    usage: |
      If no open_area or valid destination:
      - Use current_area as opening location
      - Use position_received as opening date
      - Assume vessel is at anchor/waiting
      
      EXCEPTIONS:
      - Istanbul: Treat as TRANSIT
      - Canakkale: Treat as TRANSIT
      - Tuzla: Treat as DRY DOCK

# ═══════════════════════════════════════════════════════════════════
# SPECIAL LOCATION HANDLING
# ═══════════════════════════════════════════════════════════════════

special_locations:
  
  # ─────────────────────────────────────────────────────────────────
  # ISTANBUL - TRANSIT CHANNEL (NOT A PORT)
  # ─────────────────────────────────────────────────────────────────
  
  istanbul_handling:
    
    principle: |
      Istanbul is a TRANSIT CHANNEL (Bosphorus Strait), not a destination port.
      When vessels pass through Istanbul, it appears in their position data,
      but this is NOT an actual port call - just transit between Black Sea
      and Marmara/Mediterranean.
    
    recognition:
      port_names:
        - "Istanbul"
        - "Bosphorus"
        - "Bosporus"
      
      context_clues:
        - "Appears in top_ports with high percentage"
        - "Vessel track shows brief passage"
        - "No long stays (just hours, not days)"
    
    ai_interpretation:
      
      if_in_destination:
        condition: "destination = Istanbul"
        action: "IGNORE - treat as null destination"
        reasoning: "Vessel transiting through straits, not calling Istanbul port"
        fallback: "Use current_area or treat as in-transit"
        
        example:
          vessel_destination: "Istanbul"
          vessel_current_area: "Black Sea"
          interpretation: "Vessel exiting Black Sea via Bosphorus, NOT opening in Istanbul"
          use_for_scoring: "Black Sea (current_area)"
      
      if_in_current_area:
        condition: "current_area = Istanbul"
        action: "Determine direction of transit"
        
        if_heading_to_black_sea:
          interpretation: "Vessel entering Black Sea"
          use_for_scoring: "Marmara Sea (origin) or Black Sea (destination)"
          
        if_heading_to_mediterranean:
          interpretation: "Vessel exiting Black Sea"
          use_for_scoring: "Black Sea (origin) or Marmara/Med (destination)"
      
      if_in_top_ports:
        condition: "Istanbul appears in vessel's top_ports history"
        action: "DO NOT count as actual port experience"
        reasoning: |
          High Istanbul percentage simply means vessel transits frequently
          between Black Sea and Med. It does NOT indicate familiarity with
          Istanbul as a loading/discharge port.
        
        citations:
          - "Correction (valmiera): Istanbul is transit channel, not port"
          - "Correction: Do not treat Istanbul as port call in P4 scoring"
  
  # ─────────────────────────────────────────────────────────────────
  # CANAKKALE - TRANSIT CHANNEL (NOT A PORT)
  # ─────────────────────────────────────────────────────────────────
  
  canakkale_handling:
    
    principle: |
      Canakkale is DARDANELLES STRAIT transit, similar to Istanbul.
      Same logic applies: transit channel, not destination port.
    
    recognition:
      port_names:
        - "Canakkale"
        - "Dardanelles"
        - "Çanakkale"
    
    ai_interpretation:
      same_as_istanbul: true
      
      if_in_destination:
        action: "IGNORE - treat as null destination"
        
      if_in_current_area:
        action: "Determine direction (Marmara ↔ Aegean)"
        
      if_in_top_ports:
        action: "DO NOT count as port experience"
  
  # ─────────────────────────────────────────────────────────────────
  # TUZLA - DRY DOCK / REPAIRS
  # ─────────────────────────────────────────────────────────────────
  
  tuzla_handling:
    
    principle: |
      Tuzla (Turkey) is a major SHIPYARD and DRY DOCK location.
      If vessel is in Tuzla or heading to Tuzla, assume repairs.
      Repair durations are UNCERTAIN, typically 1+ months.
    
    recognition:
      port_names:
        - "Tuzla"
        - "Tuzla Shipyard"
      
      location:
        country: "Turkey"
        region: "Marmara Sea"
        near: "Istanbul"
    
    ai_interpretation:
      
      if_currently_in_tuzla:
        condition: "current_area = Tuzla OR destination = Tuzla (already arrived)"
        
        impact_on_p7:
          assumption: "Vessel undergoing repairs"
          duration_estimate: "+30 days minimum"
          uncertainty: "HIGH - repair completion dates very uncertain"
          
          scoring:
            p7_score: 2
            confidence: 60
            reasoning: |
              "Vessel currently in Tuzla (dry dock). Repairs typically take
              1+ months with uncertain completion. Position highly unreliable
              for near-term cargo."
        
        impact_on_other_criteria:
          p1_proximity: "Calculate from Tuzla, but add uncertainty note"
          p1a_regional: "Normal assessment, but flag repair status"
        
        warning_to_user: |
          "⚠️ Vessel is currently in Tuzla shipyard. This typically indicates
          repairs/dry docking. Completion date uncertain."
      
      if_heading_to_tuzla:
        condition: "destination = Tuzla AND not yet arrived"
        
        impact_on_p7:
          vessel_ready_date: "ETA + 30 days (minimum)"
          
          scoring:
            p7_score: 3
            confidence: 65
            reasoning: |
              "Vessel heading to Tuzla (ETA {date}). Tuzla is a major shipyard,
              suggesting scheduled repairs. Assume +30 days for dry docking."
        
        warning_to_user: |
          "⚠️ Vessel is heading to Tuzla shipyard (ETA {date}). This likely
          indicates planned repairs. Opening date highly uncertain."
  
  # ─────────────────────────────────────────────────────────────────
  # SULINA ANCHORAGE - SPECIAL POSITIONING
  # ─────────────────────────────────────────────────────────────────
  
  sulina_handling:
    
    principle: |
      Sulina is a WAITING AREA / ANCHORAGE, not a commercial port.
      Vessels wait here before either:
      a) Entering Danube River, OR
      b) Proceeding to POC ports
      
      This is NOT an issue like Istanbul - Sulina IS a valid opening position.
    
    recognition:
      port_names:
        - "Sulina"
        - "Sulina Anchorage"
      
    ai_interpretation:
      treat_as: "Valid opening position"
      
      impact_on_p1:
        proximity_to_poc: "Level 3 (very close, ~80nm)"
        proximity_to_danube: "Level 3 (very close, river entrance)"
      
      impact_on_p1a:
        pattern_to_poc: "Score 14/15 (excellent positioning)"
        pattern_to_danube: "Score 14/15 (excellent positioning)"
        reasoning: "Sulina = neutral waiting area, equal viability for both directions"
        
        citations:
          - "Correction (eleanora): Sulina vessels can go to POC or Danube equally"

# ═══════════════════════════════════════════════════════════════════
# LOCATION DETERMINATION ALGORITHM
# ═══════════════════════════════════════════════════════════════════

determination_algorithm:
  
  step_1_check_open_area:
    if: "open_area field is not null"
    then:
      location: "Use open_area port"
      date: "Use open_area date"
      confidence: "HIGH"
      stop: true
  
  step_2_check_destination:
    if: "destination field is not null"
    then:
      
      check_special_cases:
        
        if_istanbul_or_canakkale:
          action: "SKIP destination, continue to step 3"
          reasoning: "Transit channel, not valid destination"
        
        if_tuzla:
          location: "Tuzla (dry dock)"
          date: "ETA + 30 days"
          confidence: "LOW (repair uncertainty)"
          add_warning: true
          stop: true
        
        if_normal_port:
          location: "Use destination port"
          date: "ETA + 7 days (operations)"
          confidence: "MEDIUM"
          stop: true
  
  step_3_check_current_area:
    if: "current_area is not null"
    then:
      
      check_special_cases:
        
        if_istanbul_or_canakkale:
          action: "Interpret as in-transit, use broader region"
          location: "Use adjacent sea (Black Sea or Marmara)"
          date: "position_received"
          confidence: "LOW"
          stop: true
        
        if_tuzla:
          location: "Tuzla (dry dock)"
          date: "position_received + 30 days"
          confidence: "LOW"
          add_warning: true
          stop: true
        
        if_normal_location:
          location: "Use current_area"
          date: "position_received"
          confidence: "LOW (no confirmed destination)"
          stop: true
  
  step_4_no_data:
    if: "All fields are null"
    then:
      action: "ERROR - insufficient data"
      recommendation: "Request owner clarification"

# ═══════════════════════════════════════════════════════════════════
# P4 (LAST PORTS) SPECIAL HANDLING
# ═══════════════════════════════════════════════════════════════════

p4_top_ports_filtering:
  
  principle: |
    When analyzing vessel's top_ports historical data, EXCLUDE
    transit channels from port experience calculation.
  
  exclude_from_p4:
    - "Istanbul"
    - "Canakkale"
    - "Bosphorus"
    - "Dardanelles"
  
  rationale: |
    These locations appear frequently in AIS data due to transit,
    but they do NOT represent actual port calling experience.
    
    Including them inflates P4 scores incorrectly.
  
  example:
    raw_top_ports:
      - "Istanbul: 25.7%"
      - "Sulina: 12.2%"
      - "Izmail: 8.5%"
      - "Constanta: 6.3%"
    
    filtered_top_ports:
      - "Sulina: 12.2%"
      - "Izmail: 8.5%"
      - "Constanta: 6.3%"
      - "(Istanbul removed as transit)"
    
    p4_calculation:
      use: "Filtered list only"
      reasoning: "Istanbul removed - transit channel, not port experience"
    
    citations:
      - "Correction (valmeira, eleanora): Istanbul is transit, not port call"

# ═══════════════════════════════════════════════════════════════════
# CRITICAL AI INSTRUCTIONS
# ═══════════════════════════════════════════════════════════════════

ai_must:
  - "ALWAYS follow priority order: open_area > destination > current_area"
  - "ALWAYS treat Istanbul/Canakkale as transit (not valid destinations)"
  - "ALWAYS treat Tuzla as dry dock (+30 days)"
  - "ALWAYS exclude Istanbul/Canakkale from P4 top_ports analysis"
  - "ALWAYS add +7 days to destination ETA for operations"
  - "ALWAYS add warning if vessel in/heading to Tuzla"

ai_must_not:
  - "Never use Istanbul/Canakkale as opening position"
  - "Never count Istanbul/Canakkale in P4 port experience"
  - "Never assume vessel ready at destination ETA without operations buffer"
  - "Never ignore Tuzla dry dock implications"

# ═══════════════════════════════════════════════════════════════════
# END OF VESSEL LOCATION DETERMINATION v2.0
# ═══════════════════════════════════════════════════════════════════


--- START OF estimator-prompts/vessel_size_classification.txt ---
# ═══════════════════════════════════════════════════════════════════
# SHORT SUMMARY
# ═══════════════════════════════════════════════════════════════════

DOCUMENT: Vessel Size Classification - Size Category Definitions
PURPOSE: Single source of truth for vessel size categorization in VK Charts AI
SCOPE: Dry cargo bulk carriers and general cargo vessels (bulk operations)
INTEGRATION: Used across all scoring criteria (P1-P7) for size-dependent logic

WHAT THIS DOCUMENT DEFINES:
This file establishes the official VK Charts vessel size classification system
for all dry-cargo vessels (bulk + general cargo). It provides the authoritative
DWT ranges, category codes, and size-specific behavioral characteristics that
drive AI scoring decisions across all criteria.

SIZE CATEGORIES (7 total):
1. Small Coasters (SC): 0-4,000 DWT - River/coastal vessels
2. Coasters (C): 4,001-17,000 DWT - Regional bulk trades (most common Black Sea-Med)
3. Small Handy (SH): 17,001-24,000 DWT - Medium haul bulk carriers
4. Handy (H): 24,001-40,000 DWT - Long haul capable (NOT common in Greek trades)
5. Small Supramax (SS): 40,001-50,000 DWT - Deep sea bulk carriers
6. Supramax (SM): 50,001-65,000 DWT - Global bulk trades
7. Panamax (PM): 65,000-80,000 DWT - Maximum size for Panama Canal

KEY FEATURES:
- Precise DWT ranges for each category
- Size-specific economic behavior (ballast tolerance, operating cost)
- Typical trade patterns and routes for each size
- Impact on proximity scoring (smaller vessels = higher distance penalty)
- Cargo-vessel size compatibility rules
- Integration with all scoring criteria

CRITICAL DEPENDENCIES:
- proximity_scoring_matrix.txt: Uses size categories for distance penalties
- regional_trade_patterns_corrected.txt: References size categories in vessel_size_rules
- MASTER_SCORING_SYSTEM.txt: All criteria use vessel size for score adjustments

SIZE IMPACT ON SCORING:
- Small vessels (SC, C): Very sensitive to distance, seek backhaul aggressively
- Medium vessels (SH, H): Moderate distance tolerance, selective on backhaul
- Large vessels (SS, SM, PM): High distance tolerance, can ballast for positioning

SCOPE LIMITATIONS:
✓ INCLUDED: Dry cargo bulk carriers, general cargo (bulk ops)
✗ EXCLUDED: Oil tankers, chemical tankers, LNG/LPG, containers, RoRo, pure breakbulk

EXAMPLE USAGE:
- Vessel DWT 8,500 → Category C (Coaster) → High ballast sensitivity
- Vessel DWT 55,000 → Category SM (Supramax) → Low ballast sensitivity
- Cargo Black Sea-Med grain → Prefer C/SH sizes (4,001-24,000 DWT)

**Size category used across all scoring criteria:**
   - P1 (Proximity): Distance penalty scaling
   - P1A (Regional Patterns): Size-specific trade pattern rules
   - P2 (Regional Preferences): Size preferences for regions
   - P3 (Cargo Preferences): Cargo-vessel size compatibility
   - P4 (Last Ports): Size-specific return patterns
   - P6 (Intake Capacity): Size-based capacity calculations
   - P7 (OpenArea Comments): Size-specific readiness interpretation

### Important Notes:
- DWT is the ONLY input needed for size categorization
- Categories are mutually exclusive (no overlap in ranges)
- This file is the SINGLE SOURCE OF TRUTH - never hardcode ranges elsewhere
- If vessel type is not bulk carrier, skip size-based scoring
- Size category must be included in all scoring responses for transparency

---

## FOR AI/LangChain (Size Categorization Implementation)

### Step-by-Step Algorithm:

**STEP 1: Validate Input**
```
Required: vessel_dwt (integer or float, > 0)
Optional: vessel_type (for scope validation)

Validation:
- IF vessel_dwt <= 0: REJECT with error "Invalid DWT"
- IF vessel_type NOT in [bulk_carrier, general_cargo, multi_purpose]: 
    WARN "Vessel may be outside scope" but CONTINUE
```

**STEP 2: Determine Size Category**
```
Based on vessel_dwt, match to ONE category:

IF dwt >= 0 AND dwt <= 4000:
    category = "SC" (Small Coasters)
    
ELSE IF dwt >= 4001 AND dwt <= 17000:
    category = "C" (Coasters)
    
ELSE IF dwt >= 17001 AND dwt <= 24000:
    category = "SH" (Small Handy)
    
ELSE IF dwt >= 24001 AND dwt <= 40000:
    category = "H" (Handy)
    
ELSE IF dwt >= 40001 AND dwt <= 50000:
    category = "SS" (Small Supramax)
    
ELSE IF dwt >= 50001 AND dwt <= 65000:
    category = "SM" (Supramax)
    
ELSE IF dwt >= 65000 AND dwt <= 80000:
    category = "PM" (Panamax)
    
ELSE IF dwt > 80000:
    category = "OVERSIZED" (outside current scope)
    NOTE: "Vessel larger than Panamax, may need special handling"
```

**STEP 3: Retrieve Category Characteristics**
```
Look up category in vessel_sizes section:
- dwt_range
- typical_characteristics
- typical_uses
- examples
- notes (if any)
```

**STEP 4: Retrieve Economic Behavior**
```
Look up category in economics_by_size section:
- daily_operating_cost
- ballast_cost_sensitivity
- backhaul_seeking_behavior
- viable_ballast_distance
```

**STEP 5: Retrieve Trade Patterns**
```
Determine size group for trade patterns:
- small_coasters_and_coasters: SC, C
- small_handy_and_handy: SH, H
- supramax_and_panamax: SS, SM, PM

Retrieve:
- primary_regions
- typical_routes
- ballast_strategy
- notes (if any)
```

**STEP 6: Calculate Scoring Impact**
```
Based on category, determine impact on scoring:

Proximity Penalty (from ai_scoring_guidelines):
- SC: "Very high penalty per 100nm" → -30 to -50 for long ballast
- C: "High penalty per 100nm" → -20 to -40 for long ballast
- SH: "Medium penalty per 100nm" → -15 to -30 for long ballast
- H: "Medium-low penalty per 100nm" → -10 to -20 for long ballast
- SS/SM/PM: "Low penalty per 100nm" → -5 to -15 for long ballast
```

## QUICK REFERENCE

**Size Categories (7 total):**
- SC: 0-4,000 DWT (Small Coasters)
- C: 4,001-17,000 DWT (Coasters) ← Most common Black Sea-Med
- SH: 17,001-24,000 DWT (Small Handy)
- H: 24,001-40,000 DWT (Handy) ← NOT common in Greek trades
- SS: 40,001-50,000 DWT (Small Supramax)
- SM: 50,001-65,000 DWT (Supramax)
- PM: 65,000-80,000 DWT (Panamax)

**Ballast Tolerance:**
- SC/C: Very low/low - avoid long ballast
- SH/H: Medium - selective on ballast
- SS/SM/PM: High/very high - can ballast for positioning

**Typical Trades:**
- SC/C: Black Sea-Med, regional short haul
- SH/H: Medium to long haul, cross-Med
- SS/SM/PM: Global deep sea, trans-ocean

**Proximity Impact:**
- Smaller vessels = higher distance penalty
- Larger vessels = lower distance penalty

**Cargo Type Fit:**
- Black Sea-Med grain: C, SH preferred
- Black Sea-Far East grain: SM, PM preferred
- Steel/fertilizers: C, SH preferred

**Scope:**
- ✓ Dry cargo bulk, general cargo (bulk ops)
- ✗ Tankers, containers, RoRo, LNG/LPG

# ═══════════════════════════════════════════════════════════════════
# VESSEL SIZE CATEGORIES - DRY CARGO
# ═══════════════════════════════════════════════════════════════════

vessel_sizes:
  
  small_coasters:
    dwt_range: [0, 4000]
    dwt_min: 0
    dwt_max: 4000
    category_code: "SC"
    
    typical_characteristics:
      trade_area: "Very short haul, coastal, inland waterways"
      ballast_tolerance: "Very low - must find cargo"
      
    typical_uses:
      - "River navigation"
      - "Small coastal parcels"
      - "Short sea shipping"
      - "Inland waterways (Danube, Rhine, etc)"
      
    examples:
      - "Small river-sea vessels"
      - "Coastal feeders"
      
  coasters:
    dwt_range: [4001, 17000]
    dwt_min: 4001
    dwt_max: 17000
    category_code: "C"
    
    typical_characteristics:
      trade_area: "Short to medium haul"
      ballast_tolerance: "Low - prefer backhaul"
      typical_routes: "Black Sea-Med, Med-Med, regional trades"
      
    typical_uses:
      - "Regional grain trades"
      - "Steel products"
      - "Fertilizers"
      - "General bulk"
      - "Bagged cargoes"
      
    sub_categories:
      small_coasters:
        dwt_range: [4001, 8000]
        notes: "Lower end coasters"
        
      medium_coasters:
        dwt_range: [8001, 12000]
        notes: "Most common coaster size"
        
      large_coasters:
        dwt_range: [12001, 17000]
        notes: "Upper end coasters"
    
    examples:
      - "Typical Black Sea grain vessels"
      - "Med short haul bulk"
      
  small_handy:
    dwt_range: [17001, 24000]
    dwt_min: 17001
    dwt_max: 24000
    category_code: "SH"
    
    typical_characteristics:
      trade_area: "Medium to long haul"
      ballast_tolerance: "Medium"
      typical_routes: "Cross-Med, Black Sea-North Africa, regional"
      
    typical_uses:
      - "Larger grain parcels"
      - "Steel products"
      - "Fertilizers"
      - "Ore parcels"
      
    examples:
      - "Transitional size between coaster and handy"
      
  handy:
    dwt_range: [24001, 40000]
    dwt_min: 24001
    dwt_max: 40000
    category_code: "H"
    
    typical_characteristics:
      trade_area: "Long haul capable"
      ballast_tolerance: "Medium-high"
      typical_routes: "Trans-ocean, long distance trades"
      
    typical_uses:
      - "Large grain parcels"
      - "Coal"
      - "Iron ore"
      - "Long haul bulk"
      
    notes:
      - "NOT common in Greek trades (per Vitaly)"
      - "More common in Atlantic, long haul trades"
      
    examples:
      - "Handysize bulk carriers"
      
  small_supramax:
    dwt_range: [40001, 50000]
    dwt_min: 40001
    dwt_max: 50000
    category_code: "SS"
    
    typical_characteristics:
      trade_area: "Long haul, deep sea"
      ballast_tolerance: "High"
      typical_routes: "Trans-ocean, far distances"
      
    typical_uses:
      - "Large grain parcels to Far East"
      - "Coal"
      - "Iron ore"
      - "Major bulk commodities"
      
  supramax:
    dwt_range: [50001, 65000]
    dwt_min: 50001
    dwt_max: 65000
    category_code: "SM"
    
    typical_characteristics:
      trade_area: "Global deep sea"
      ballast_tolerance: "Very high - can absorb long ballast"
      typical_routes: "Major trade routes, long haul"
      
    typical_uses:
      - "Major bulk commodity trades"
      - "Grain to Far East"
      - "Coal, iron ore"
      - "Trans-ocean routes"
      
  panamax:
    dwt_range: [65000, 80000]
    dwt_min: 65000
    dwt_max: 80000
    category_code: "PM"
    
    typical_characteristics:
      trade_area: "Global major routes"
      ballast_tolerance: "Very high"
      typical_routes: "Major bulk trade lanes"
      
    typical_uses:
      - "Large grain shipments"
      - "Major coal/ore trades"
      - "Trans-ocean bulk"
      
    notes:
      - "Maximum size for Panama Canal (hence name)"
      - "Maximum practical size ex-Black Sea ports"
      
  other_sizes:
    notes: "Larger sizes (Capesize, etc) can be added later if needed"
    not_relevant_for_current_scope: true

# ═══════════════════════════════════════════════════════════════════
# VESSEL SIZE ECONOMICS
# ═══════════════════════════════════════════════════════════════════

economics_by_size:
  
  small_coasters:
    daily_operating_cost: "lowest"
    ballast_cost_sensitivity: "very high"
    backhaul_seeking_behavior: "aggressive - must find cargo"
    viable_ballast_distance: "< 300 nm"
    
  coasters:
    daily_operating_cost: "low"
    ballast_cost_sensitivity: "high"
    backhaul_seeking_behavior: "strong preference for backhaul"
    viable_ballast_distance: "< 800 nm"
    
  small_handy:
    daily_operating_cost: "medium-low"
    ballast_cost_sensitivity: "medium-high"
    backhaul_seeking_behavior: "moderate"
    viable_ballast_distance: "< 1200 nm"
    
  handy:
    daily_operating_cost: "medium"
    ballast_cost_sensitivity: "medium"
    backhaul_seeking_behavior: "selective"
    viable_ballast_distance: "< 2000 nm"
    
  small_supramax:
    daily_operating_cost: "medium-high"
    ballast_cost_sensitivity: "low-medium"
    backhaul_seeking_behavior: "selective"
    viable_ballast_distance: "< 3000 nm"
    
  supramax:
    daily_operating_cost: "high"
    ballast_cost_sensitivity: "low"
    backhaul_seeking_behavior: "opportunistic - can ballast if rates justify"
    viable_ballast_distance: "< 5000 nm"
    
  panamax:
    daily_operating_cost: "very high"
    ballast_cost_sensitivity: "very low"
    backhaul_seeking_behavior: "strategic - ballast acceptable for positioning"
    viable_ballast_distance: "> 5000 nm possible"

# ═══════════════════════════════════════════════════════════════════
# SIZE-SPECIFIC TRADE PATTERNS
# ═══════════════════════════════════════════════════════════════════

trade_patterns_by_size:
  
  small_coasters_and_coasters:
    primary_regions:
      - "Black Sea"
      - "Mediterranean"
      - "Marmara Sea"
      - "Adriatic"
      - "Short sea shipping"
      
    typical_routes:
      - "Black Sea → Mediterranean"
      - "Black Sea → North Africa"
      - "Mediterranean internal"
      - "Marmara → Black Sea"
      
    ballast_strategy:
      - "Avoid long ballast at all costs"
      - "Seek backhaul aggressively"
      - "Prefer short positioning legs"
      
  small_handy_and_handy:
    primary_regions:
      - "Regional to medium distance"
      - "Can do longer hauls but prefer medium"
      
    typical_routes:
      - "Black Sea → North Africa"
      - "Mediterranean → Atlantic"
      - "Regional bulk trades"
      
    ballast_strategy:
      - "Can consider medium ballast legs"
      - "Still prefer backhaul when economical"
      
    notes:
      - "Handy size NOT common in Greek trades"
      
  supramax_and_panamax:
    primary_regions:
      - "Global trades"
      - "Long haul routes"
      
    typical_routes:
      - "Black Sea → Far East"
      - "Atlantic → Pacific"
      - "Major bulk trade lanes"
      
    ballast_strategy:
      - "Can ballast long distances if rates justify"
      - "Less pressure to find backhaul"
      - "Strategic positioning for high-paying cargoes"

# ═══════════════════════════════════════════════════════════════════
# IMPORTANT NOTES FOR AI SCORING
# ═══════════════════════════════════════════════════════════════════

ai_scoring_guidelines:
  
  critical_rules:
    - "ALWAYS use correct DWT ranges from this file"
    - "Smaller vessels = higher penalty for long ballast"
    - "Larger vessels = more tolerant of ballast positioning"
    - "Coasters in Asia = likely working local market, not positioning"
    - "Supramax+ in Asia = could be positioning from Black Sea"
    
  size_impact_on_scoring:
    - "Small coaster long ballast: -30 to -50 score"
    - "Coaster long ballast: -20 to -40 score"
    - "Small handy long ballast: -15 to -30 score"
    - "Handy long ballast: -10 to -20 score"
    - "Supramax+ long ballast: -5 to -15 score"
    
  proximity_multiplier:
    concept: "Closer = Better, scaled by vessel size"
    formula: "Base score × (1 - distance_penalty)"
    distance_penalty_by_size:
      small_coasters: "Very high penalty per 100nm"
      coasters: "High penalty per 100nm"
      small_handy: "Medium penalty per 100nm"
      handy: "Medium-low penalty per 100nm"
      supramax_panamax: "Low penalty per 100nm"

# ═══════════════════════════════════════════════════════════════════
# CARGO TYPE vs VESSEL SIZE PREFERENCES
# ═══════════════════════════════════════════════════════════════════

cargo_vessel_size_fit:
  
  grain_black_sea_to_med:
    preferred_sizes:
      - "Coasters: 4001-17000 DWT"
      - "Small handy: 17001-24000 DWT"
    rare_sizes:
      - "Handy: 24001-40000 DWT (not common for Med)"
      
  grain_black_sea_to_far_east:
    preferred_sizes:
      - "Supramax: 50001-65000 DWT"
      - "Panamax: 65000-80000 DWT"
    minimum_practical:
      - "Small supramax: 40001-50000 DWT"
      
  steel_products:
    preferred_sizes:
      - "Coasters: 4001-17000 DWT"
      - "Small handy: 17001-24000 DWT"
      
  fertilizers:
    preferred_sizes:
      - "Coasters: 4001-17000 DWT"
      - "Small handy: 17001-24000 DWT"
      
  bauxite_ore:
    preferred_sizes:
      - "Coasters: 8001-17000 DWT"
      - "Small handy: 17001-24000 DWT"

# ═══════════════════════════════════════════════════════════════════
# SCOPE DEFINITION
# ═══════════════════════════════════════════════════════════════════

scope:
  included:
    - "Dry cargo bulk carriers"
    - "General cargo vessels (if carrying bulk)"
    - "Multi-purpose vessels (for bulk operations)"
    
  excluded:
    - "Oil tankers"
    - "Chemical tankers"
    - "LNG/LPG carriers"
    - "Container ships"
    - "RoRo vessels"
    - "Pure breakbulk (non-bulk cargo)"
    
  notes:
    - "This system focuses exclusively on DRY BULK shipping"
    - "Oil and liquid cargo not considered"


