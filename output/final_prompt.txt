
--- START OF estimator-prompts/COMMENTS_PROCESSING_GUIDE.txt ---
# ═══════════════════════════════════════════════════════════════════
# COMMENTS PROCESSING GUIDE - UPDATED v2.0
# VK Charts AI Scoring System
# ═══════════════════════════════════════════════════════════════════
#
# CHANGES IN v2.0:
# - Updated P2 scoring gradations: spec (7.5), ok (5.0), try (3.0)
# - Clarified load region (7.5) + discharge region (7.5) = 15 total split
# - Added explicit examples for load/discharge separation
# - Maintained all other parsing rules from v1.0
#
# ═══════════════════════════════════════════════════════════════════

version: "2.0"
date: "2026-01-19"
priority: "CRITICAL - Comments contain expert non-structured knowledge"

# ═══════════════════════════════════════════════════════════════════
# SHORT SUMMARY
# ═══════════════════════════════════════════════════════════════════

purpose: |
  This document defines how AI must read, interpret, and apply comments
  from Companies, Vessels, and Persons during scoring and offer generation.
  
  The comments contain expert, non-structured knowledge:
  - Cargo preferences
  - Geographic restrictions  
  - Intake data
  - Technical limitations
  - Behavioral and communication notes
  
  AI must extract structured meaning from unstructured comments, filter
  them by relevance to current cargo, resolve contradictions, and incorporate
  them into scoring and offer text reasoning.

# ═══════════════════════════════════════════════════════════════════
# DATA SOURCES
# ═══════════════════════════════════════════════════════════════════

data_sources:
  
  company_comments:
    database_field: "companies.comments"
    example: "spec: turkish domestic cargoes, Italy ok, greece ok, eu ok, cvb ok, continent ok"
    
    typical_content:
      - "Specialization patterns"
      - "Geographic preferences"
      - "Cargo type preferences"
      - "Communication preferences"
      - "Payment history"
      - "Reliability notes"
      - "Special requirements"
      
  vessel_comments:
    database_field: "vessels.comments"
    example: "Real intake: Corn, draft 7m, Izmail = 4800t"
    
    typical_content:
      - "Technical specifications"
      - "Performance data"
      - "Intake records"
      - "Port restrictions"
      - "Maintenance issues"
      - "Crew information"
      - "Historical behavior"
      
  person_comments:
    database_field: "people.comments"
    example: "Prefers WhatsApp communication, responds within 1 hour"
    
    typical_content:
      - "Communication style"
      - "Response patterns"
      - "Decision-making authority"
      - "Language preferences"
      - "Time zone considerations"

# ═══════════════════════════════════════════════════════════════════
# PARSING STRATEGY
# ═══════════════════════════════════════════════════════════════════

parsing_strategy:
  
  principle: "Extract structured information from unstructured text"
  
  step_1_keyword_detection:
    description: "Identify key patterns and keywords"
    
    patterns:
      
      specialization:
        keywords: ["spec:", "specializes", "mainly", "mostly"]
        examples:
          - "spec: turkish domestic cargoes"
          - "specializes in grain trades"
          - "mainly works Black Sea"
          
      geographic_preferences:
        keywords: ["ok", "no", "cannot", "avoids", "prefers", "try"]
        examples:
          - "Italy ok, greece ok, eu ok"
          - "no Egypt"
          - "cannot work Libya"
          - "avoids Turkey"
          - "try POC"
          
      cargo_preferences:
        keywords: ["cargo:", "loads", "carries", "no bulk"]
        examples:
          - "cargo: grain only"
          - "loads steel products"
          - "no bulk fertilizers"
          
      technical_info:
        keywords: ["intake:", "draft", "gear", "speed"]
        examples:
          - "Real intake: Wheat 5200t"
          - "draft restricted to 7m"
          - "geared vessel"
          
      behavioral_notes:
        keywords: ["always", "never", "typically", "usually"]
        examples:
          - "always asks for freight first"
          - "never responds weekends"
          - "typically ballasts to Black Sea"
          
  step_2_relevance_filtering:
    description: "Extract only information relevant to current cargo"
    
    relevance_rules:
      geographic:
        - "If comment mentions cargo loading/discharge region → RELEVANT"
        - "If comment mentions country → RELEVANT"
        - "If general restriction → RELEVANT"
        
      cargo_type:
        - "If comment mentions cargo type → RELEVANT"
        - "If comment about capacity → RELEVANT"
        - "If technical restrictions → RELEVANT"
        
      communication:
        - "Always relevant for offer text generation"
        
  step_3_conflict_resolution:
    description: "Handle contradictions between sources"
    
    priority_order:
      1: "Vessel comments (most specific)"
      2: "Person comments (behavioral patterns)"
      3: "Company comments (general policies)"
      4: "Formal preferences (UI settings)"

# ═══════════════════════════════════════════════════════════════════
# P2 OWNER PREFERENCES SCORING - UPDATED v2.0
# ═══════════════════════════════════════════════════════════════════

p2_owner_preferences_scoring_v2:
  
  total_score: 15
  
  score_split:
    load_region_score: 7.5
    discharge_region_score: 7.5
    
    principle: |
      P2 evaluates preferences for BOTH loading and discharge regions.
      Each region contributes 7.5 points to total 15 points.
      
      This reflects reality: owners care about BOTH where cargo loads
      AND where it discharges. A perfect match requires both.
  
  # ─────────────────────────────────────────────────────────────────
  # SCORING GRADATIONS
  # ─────────────────────────────────────────────────────────────────
  
  keyword_gradations:
    
    spec_specialization:
      keywords: ["spec:", "specializes", "specialized in"]
      score_value: 7.5
      interpretation: "PRIMARY specialization - this is core business"
      examples:
        - "spec: ukraine" for Ukrainian load → 7.5/7.5
        - "spec: turkey" for Turkish discharge → 7.5/7.5
        - "spec: Black Sea grain" for BS grain cargo → 7.5/7.5
      
    ok_acceptable:
      keywords: ["ok", "acceptable", "willing"]
      score_value: 5.0
      interpretation: "INTERMEDIATE - between primary and secondary"
      examples:
        - "ukraine ok" for Ukrainian load → 5.0/7.5
        - "turkey ok" for Turkish discharge → 5.0/7.5
        - "EU ok" for European discharge → 5.0/7.5
      
    try_secondary:
      keywords: ["try", "may try", "can try"]
      score_value: 3.0
      interpretation: "SECONDARY option - willing but not preferred"
      examples:
        - "try POC" for POC load → 3.0/7.5
        - "try Med" for Med discharge → 3.0/7.5
      
      citations:
        - "Correction (akdeniz): 'try POC' means secondary option, not primary"
      
    no_mention:
      score_value: 0.0
      interpretation: "NEUTRAL - no preference stated, no penalty"
      note: "No comment = no bonus, no penalty"
      
    negative_no:
      keywords: ["no", "cannot", "avoid", "never"]
      score_value: 0
      interpretation: "NEGATIVE preference - no points for this region"
      note: "Score is 0, NOT negative. P2 cannot go below 0."
      examples:
        - "no Egypt" for Egyptian discharge → 0/7.5
        - "cannot work Libya" → 0/7.5
        - "avoid Turkey" → 0/7.5
  
  # ─────────────────────────────────────────────────────────────────
  # LOAD vs DISCHARGE SEPARATION
  # ─────────────────────────────────────────────────────────────────
  
  load_discharge_separation:
    
    principle: |
      Comments must be interpreted in context of cargo route.
      A comment about "ukraine" applies to:
      - LOAD region if cargo loads FROM Ukraine
      - DISCHARGE region if cargo discharges TO Ukraine
      - GENERAL if comment doesn't specify load/discharge
    
    interpretation_rules:
      
      explicit_load_comment:
        format: "loads from X" or "loading: X"
        application: "Apply to load_region_score only"
        example: "loads from Ukraine" → 7.5 to load region
        
      explicit_discharge_comment:
        format: "discharges to X" or "destination: X"
        application: "Apply to discharge_region_score only"
        example: "destination: Turkey" → 7.5 to discharge region
        
      region_only_comment:
        format: "spec: ukraine" or "turkey ok" (no load/discharge specified)
        application: "Apply to whichever region matches cargo"
        
        example_1:
          comment: "spec: ukraine"
          cargo: "Chornomorsk → Yarimca"
          interpretation: "Ukraine is LOAD region"
          scoring: "7.5 to load_region_score, 0 to discharge_region_score"
          
        example_2:
          comment: "spec: turkey"
          cargo: "Chornomorsk → Yarimca"
          interpretation: "Turkey is DISCHARGE region"
          scoring: "0 to load_region_score, 7.5 to discharge_region_score"
          
        example_3:
          comment: "spec: ukraine, turkey ok"
          cargo: "Chornomorsk → Yarimca"
          interpretation: "Ukraine=load (spec), Turkey=discharge (ok)"
          scoring: "7.5 load + 5.0 discharge = 12.5/15 total"
      
      general_region_comment:
        format: "spec: Black Sea" or "spec: Mediterranean"
        application: "Split proportionally if both load and discharge in region"
        
        example:
          comment: "spec: Black Sea"
          cargo: "Chornomorsk → Constanta" (both Black Sea)
          interpretation: "Both regions match"
          scoring: "3.75 load + 3.75 discharge = 7.5/15 total"
          note: "Split the 7.5 points equally when comment covers both"
  
  # ─────────────────────────────────────────────────────────────────
  # SCORING EXAMPLES
  # ─────────────────────────────────────────────────────────────────
  
  scoring_examples:
    
    example_1_perfect_match:
      comment: "spec: ukraine, spec: turkey"
      cargo: "Chornomorsk → Yarimca"
      
      calculation:
        ukraine_load: 7.5
        turkey_discharge: 7.5
        total: 15.0
      
      reasoning: "Perfect specialization match for both load and discharge regions"
    
    example_2_mixed_match:
      comment: "spec: ukraine, turkey ok"
      cargo: "Chornomorsk → Yarimca"
      
      calculation:
        ukraine_load: 7.5
        turkey_discharge: 5.0
        total: 12.5
      
      reasoning: "Strong Ukraine spec, Turkey acceptable"
      citations:
        - "Updated v2.0: 'ok' = 5.0 points (intermediate level)"
    
    example_3_secondary_option:
      comment: "try POC, turkey ok"
      cargo: "Chornomorsk → Yarimca"
      
      calculation:
        poc_load: 3.0
        turkey_discharge: 5.0
        total: 8.0
      
      reasoning: "POC is secondary option, Turkey acceptable"
      citations:
        - "Correction (akdeniz): 'try POC' = secondary, score 3.0"
    
    example_4_negative:
      comment: "ukraine ok, no turkey"
      cargo: "Chornomorsk → Yarimca"

      calculation:
        ukraine_load: 5.0    # "ukraine ok" = 5.0 points
        turkey_discharge: 0  # "no turkey" = 0 points, NOT negative
        total: 5.0

      reasoning: "Ukraine acceptable (5.0), Turkey explicitly avoided (0)"
      note: "P2 score is sum of [0, 7.5] + [0, 7.5], never negative"

    example_5_no_comments:
      comment: ""
      cargo: "Chornomorsk → Yarimca"

      calculation:
        ukraine_load: 0
        turkey_discharge: 0
        total: 0

      reasoning: "No preferences stated, neutral score"

    example_6_spec_greece_no_ukraine:
      comment: "spec: greece, no ukraine"
      cargo: "Izmail → Crete"

      calculation:
        ukraine_load: 0       # "no ukraine" = 0 points
        greece_discharge: 7.5 # "spec: greece" = max points

        total: 7.5

      reasoning: "Owner specializes in Greece discharge but avoids Ukraine loading"
      note: "This is correct - 'no ukraine' gives 0, not negative"

# ═══════════════════════════════════════════════════════════════════
# INTEGRATION WITH OTHER CRITERIA
# ═══════════════════════════════════════════════════════════════════

integration_notes:
  
  p3_cargo_preferences:
    description: "Comments about cargo types"
    examples:
      - "cargo: grain only" → boost P3 if grain cargo
      - "no fertilizers" → penalty P3 if fertilizer cargo
    
  p4_port_familiarity:
    description: "Comments about specific ports"
    examples:
      - "knows Odessa well" → boost P4
      - "avoid Italian ports" → penalty P4
    
  p5_intake:
    description: "Comments with actual intake data"
    examples:
      - "Real intake: Wheat 5200t at Izmail" → override calculated intake
      - "draft 7m max" → affects intake calculation
    
  offer_personalization:
    description: "Comments about communication style"
    examples:
      - "prefers short messages" → adjust offer tone
      - "responds fast on WhatsApp" → mention in offer

# ═══════════════════════════════════════════════════════════════════
# CRITICAL AI INSTRUCTIONS
# ═══════════════════════════════════════════════════════════════════

ai_must:
  - "ALWAYS parse comments for all three sources (company, vessel, person)"
  - "ALWAYS apply load/discharge separation for P2 scoring"
  - "ALWAYS use explicit score values: spec=7.5, ok=5.0, try=3.0"
  - "ALWAYS respect priority: vessel > person > company"
  - "ALWAYS cite specific comment text in reasoning"

ai_must_not:
  - "Never ignore 'try' keyword (it means SECONDARY, not PRIMARY)"
  - "Never apply same regional comment to both load and discharge without logic"
  - "Never exceed 15 points for P2 (7.5 + 7.5 max)"
  - "Never use NEGATIVE scores - 'no X' means 0 points, not -7.5"
  - "P2 range is always [0, 15] - sum of two [0, 7.5] components"

# ═══════════════════════════════════════════════════════════════════
# END OF COMMENTS PROCESSING GUIDE v2.0
# ═══════════════════════════════════════════════════════════════════


--- START OF estimator-prompts/MASTER_SCORING_SYSTEM.txt ---
================================================================================
MASTER SCORING SYSTEM
Version: 4.0
Last updated: 2026-02-07
================================================================================

PURPOSE:
  Central scoring framework for vessel-cargo matching. Defines all criteria,
  dynamic score calculation, priority order, P9 relationship check, and 
  offer opening generation logic.

================================================================================
ALL CRITERIA — OVERVIEW
================================================================================

  Code  Name                    Max    Type       Reference File
  ────  ────────────────────    ───    ────       ──────────────
  P1    Proximity               20     Always     proximity_scoring_matrix.txt
  P1A   Regional Patterns       15     Always     P1A_REGIONAL_SCORING_RULES.txt
  P2    Owner Preferences       15     Dynamic    COMMENTS_PROCESSING_GUIDE.txt
  P2A   PSC Port Accessibility  20     Always     P2A_PSC_PORT_ACCESSIBILITY_SCORING.txt
  P3    Cargo Preferences       15     Dynamic    COMMENTS_PROCESSING_GUIDE.txt
  P4    Last Ports              10     Always     (inline logic)
  P5    Intake / Cargo Fit      15     Always     intake_calculator_formula.txt
  P6    OpenArea Comments       15     Dynamic    OPEN_AREA_COMMENTS_SCORING.txt
  P7    Readiness / ETA         10     Always     READINESSETA_TO_LOADING_PORT_SCORING.txt
  P8    Restrictions            20     Dynamic    P8_RESTRICTIONS_COMPLIANCE_SCORING.txt
  P9    Relationship Check      —      Warning    (this file, section below)

================================================================================
DYNAMIC MAX_SCORE CALCULATION
================================================================================

  Not all criteria are always active. Some criteria produce 0/0 when there
  is no data — these are EXCLUDED from the total, not penalized.

  ALWAYS ACTIVE (max_score is always set):
    P1  = 20
    P1A = 15
    P2A = 20
    P4  = 10
    P5  = 15
    P7  = 10
    ────────
    Base always-active MAX = 90

  DYNAMIC (max_score = 0 if no data, otherwise max):
    P2  = 15 or 0 (no owner preference data → excluded)
    P3  = 15 or 0 (no cargo preference data → excluded)
    P6  = 15 or 0 (no OpenArea comments → excluded)
    P8  = 20 or 0 (no restrictions set → excluded)

  FORMULA:
    dynamic_max_score = SUM of max_score for ALL criteria where max_score > 0
    
    Minimum: 90 (only always-active criteria)
    Maximum: 90 + 15 + 15 + 15 + 20 = 155 (all criteria active)

  FINAL SCORE:
    total_score_raw = SUM of all active criteria scores
    total_score = ROUND((total_score_raw / dynamic_max_score) × 100, 1)
    
    Always expressed as percentage: 100% = perfect match

================================================================================
EVALUATION PRIORITY ORDER
================================================================================

  Evaluate in this order (highest impact first):
  
  1. P8  — Restrictions Compliance (BLOCK potential)
  2. P2A — PSC Port Accessibility (BLOCK potential)
  3. P3  — Cargo Preferences
  4. P2  — Owner Preferences (BLOCK potential for "no X")
  5. P6  — OpenArea Comments
  6. P4  — Last Ports
  7. P1A — Regional Patterns
  8. P1  — Proximity (BLOCK for non-viable distances)
  9. P5  — Intake / Cargo Fit (BLOCK potential)
  10. P7  — Readiness / ETA (BLOCK for missed laycan)
  11. P9  — Relationship Check (warning only, no score)

================================================================================
BLOCK LOGIC
================================================================================

  Any criterion can produce a BLOCK. A single BLOCK = vessel is not viable.
  
  When BLOCK is triggered:
    - recommendation = "BLOCKED"
    - Still score ALL other criteria (for informational value)
    - Mark blocked criterion with "decision": "blocked", "critical": true
    - short_summary explains why vessel is blocked
    - Offer opening is NOT generated (or marked as "do not offer")

  Multiple BLOCKs: Report all. Summary mentions the most impactful.

================================================================================
RECOMMENDATION CATEGORIES
================================================================================

  Based on total_score (percentage):

  BLOCKED — One or more criteria triggered BLOCK
    → Do not offer
    
  STRONG (80%+) — Excellent match
    → Offer with confidence, intent = ATTRACT
    
  GOOD (65-80%) — Solid match with minor issues
    → Offer proactively, intent = ATTRACT or INQUIRE
    
  CONDITIONAL (50-65%) — Decent match, has concerns
    → Offer with questions, intent = INQUIRE
    
  WEAK (35-50%) — Poor match but may work
    → Offer for information gathering, intent = INFORM
    
  SKIP (<35%) — Not worth offering
    → Skip unless desperate for tonnage

================================================================================
P9 — RELATIONSHIP CHECK (WARNING ONLY)
================================================================================

  P9 is NOT a scoring criterion. It generates a warning flag that influences
  the offer approach but does not affect total_score.

  PURPOSE: Detect if the vessel owner has a known relationship with the 
  charterer (cargo account) — either direct or through another broker.

  DATA SOURCES:
    - Company/vessel/person comments (current format)
    - Dedicated relationship field (future, when available)
    - Any structured data about owner-charterer connections
    
  PARSING NOTE:
    AI should check ALL available sources for relationship data.
    Source format may change — logic remains the same:
    Find mentions of charterer names, broker names, "works direct with X"

  WARNING TYPES:

    DIRECT_RELATIONSHIP
    ─────────────────────────────────────────
      Trigger: Owner works directly with this charterer
      Example comment: "works direct with Bunge"
      Cargo account: "Bunge"
      Warning: "⚠️ Owner works directly with Bunge. They may already have 
               this cargo or prefer direct communication."
      Offer impact: Be careful — don't offer cargo they may already know 
               about. Consider mentioning "in case you haven't seen this yet"
               
    BROKER_RELATIONSHIP
    ─────────────────────────────────────────
      Trigger: Owner works through specific broker for this charterer
      Example comment: "Cargill cargoes via Clarkson"
      Cargo account: "Cargill"
      Warning: "⚠️ Owner handles Cargill cargoes through Clarkson."
      Offer impact: Owner may not respond or redirect to their broker.
               Adjust expectations.
               
    NO_RELATIONSHIP (CLEAR)
    ─────────────────────────────────────────
      Trigger: No known connection found
      Warning: null
      Offer impact: Standard approach

  OUTPUT FORMAT:
  
    When warning found:
    "relationship_warning": {
      "status": "WARNING",
      "type": "direct_relationship",
      "details": "Owner works directly with Bunge (from company comments)",
      "offer_guidance": "They may already have this cargo. Approach carefully."
    }
    
    When no relationship found:
    "relationship_warning": {
      "status": "CLEAR"
    }

================================================================================
OFFER OPENING GENERATION
================================================================================

  After scoring all criteria, generate an offer opening line for both 
  email and messenger formats. The offer opening is a ready-to-use phrase
  for the beginning of the communication to the owner.
  
  See: OFFER_OPENING_STYLE_GUIDE.txt for detailed style rules and examples.

  GENERATION LOGIC:

  1. Determine INTENT based on total_score:
     - ATTRACT (70%+): Confident, enthusiastic, lead with strengths
     - INQUIRE (50-70%): Balanced, show cargo + ask key questions
     - INFORM (<50%): Cautious, "for your reference", gather info
     
  2. Extract KEY SELLING POINTS from high-scoring criteria (offer_hints)
  
  3. Extract KEY CONCERNS from low-scoring/critical criteria (offer_hints)
  
  4. Extract QUESTIONS TO ASK from missing data or unclear points
  
  5. Generate email_text (2-4 sentences, shipping English, abbreviations)
  
  6. Generate messenger_text (1-2 sentences, max abbreviations, no sign-off)

  OUTPUT FORMAT:
  
  "offer_opening": {
    "intent": "attract",
    "email_text": "Pls find below cargo details which we believe suits mv 
                   Example perfectly — she's well positioned and timing aligns 
                   nicely. Kindly let us know yr interest/ideas.",
    "messenger_text": "hi, have a nice cargo for Example — good position, 
                       good timing. pls see below, lmk if interested?",
    "key_selling_points": ["proximity", "timing"],
    "key_concerns": ["intake slightly tight"],
    "questions_to_ask": []
  }
  
  IMPORTANT: 
    - NO greetings in offer_opening text (greetings handled separately)
    - Use authentic shipping abbreviations (see OFFER_OPENING_STYLE_GUIDE.txt)
    - Never sound like AI — sound like a colleague sharing an opportunity
    - When BLOCKED: offer_opening not generated (or intent = "do_not_offer")

================================================================================
JSON OUTPUT TEMPLATE
================================================================================

{
  "vessel_name": "MV Example",
  "total_score": 67.4,
  "total_score_raw": 51,
  "dynamic_max_score": 90,
  "confidence": 70,
  "confidence_note": "No data for P2, P6",
  "recommendation": "CONDITIONAL",
  "short_summary": "Decent match — good positioning and timing, but vessel 
                    oversized for this parcel. Worth offering if no better options.",
  
  "relationship_warning": {
    "status": "CLEAR"
  },
  
  "offer_opening": {
    "intent": "inquire",
    "email_text": "...",
    "messenger_text": "...",
    "key_selling_points": ["proximity", "timing"],
    "key_concerns": ["vessel oversized"],
    "questions_to_ask": ["confirm opening date"]
  },
  
  "detailed_scoring": {
    "proximity": {
      "code": "P1",
      "score": 14.0,
      "max_score": 20,
      "reasoning": "Constanta, ~150nm from Chornomorsk. Level 4 — short ballast.",
      "offer_hint": "Great positioning — lead with 'well positioned nearby'.",
      "decision": "accepted",
      "confidence": "high",
      "critical": false,
      "citations": ["ref:proximity Level 4"]
    },
    "regional_patterns": {
      "code": "P1A",
      "score": 12,
      "max_score": 15,
      "reasoning": "BS to Med — strong natural trade flow for this size.",
      "offer_hint": "Natural trade pattern — mention backhaul opportunity.",
      "decision": "accepted",
      "confidence": "high",
      "critical": false,
      "citations": ["ref:P1A BS→Med score 12"]
    },
    "owner_preferences": {
      "code": "P2",
      "score": 0,
      "max_score": 0,
      "reasoning": "No preference data available — criterion excluded.",
      "offer_hint": null,
      "decision": "excluded",
      "confidence": "n/a",
      "critical": false,
      "citations": []
    },
    "port_accessibility": {
      "code": "P2A",
      "score": 18,
      "max_score": 20,
      "reasoning": "IACS class + IG P&I. Both ports Tier 3 — no PSC concerns.",
      "offer_hint": null,
      "decision": "accepted",
      "confidence": "high",
      "critical": false,
      "citations": ["ref:P2A Tier3 + High status"]
    },
    "cargo_preferences": {
      "code": "P3",
      "score": 0,
      "max_score": 0,
      "reasoning": "No cargo preference data — criterion excluded.",
      "offer_hint": null,
      "decision": "excluded",
      "confidence": "n/a",
      "critical": false,
      "citations": []
    },
    "last_ports": {
      "code": "P4",
      "score": 7,
      "max_score": 10,
      "reasoning": "Regular BS/Med caller — Poti 8.7%, Samsun 6.5%.",
      "offer_hint": "Vessel knows the area — mention familiarity.",
      "decision": "accepted",
      "confidence": "high",
      "critical": false,
      "citations": ["top_ports data"]
    },
    "intake_capacity": {
      "code": "P5",
      "score": 12,
      "max_score": 15,
      "reasoning": "Intake 14,300t vs cargo 13,500-16,500t. Fits within range but draft-restricted.",
      "offer_hint": "Cargo fits but draft restriction limits flexibility. Be transparent.",
      "decision": "accepted",
      "confidence": "high",
      "critical": false,
      "citations": ["ref:intake_calculator Step 3"]
    },
    "openarea_modifier": {
      "code": "P6",
      "score": 0,
      "max_score": 0,
      "reasoning": "No OpenArea comments — criterion excluded.",
      "offer_hint": null,
      "decision": "excluded",
      "confidence": "n/a",
      "critical": false,
      "citations": []
    },
    "readiness_eta": {
      "code": "P7",
      "score": 10,
      "max_score": 10,
      "reasoning": "Open Constanta Feb 12, layday Feb 14. Gap = -2 days — ideal.",
      "offer_hint": "Timing is perfect — highlight in opening.",
      "decision": "accepted",
      "confidence": "high",
      "critical": false,
      "citations": ["ref:P7 gap -2 = 10/10"]
    },
    "restrictions_compliance": {
      "code": "P8",
      "score": 0,
      "max_score": 0,
      "reasoning": "No restrictions set — criterion excluded.",
      "offer_hint": null,
      "restrictions_checked": [],
      "decision": "excluded",
      "confidence": "n/a",
      "critical": false,
      "citations": []
    }
  }
}

================================================================================
AI INSTRUCTIONS
================================================================================

  ai_must:
    - Evaluate ALL criteria, even when BLOCK is found early
    - Calculate dynamic_max_score correctly (only active criteria)
    - Generate offer_hint for each criterion
    - Perform P9 relationship check
    - Generate offer_opening (unless BLOCKED)
    - Use short, natural reasoning (not verbose)
    - Express total_score as percentage
    
  ai_must_not:
    - Never include criteria with max_score = 0 in the denominator
    - Never skip criteria evaluation
    - Never generate offer_opening when vessel is BLOCKED
    - Never include greetings in offer_opening text
    - Never let P9 affect the numerical score
    - Never use overly formal or AI-sounding language in summaries

================================================================================


--- START OF estimator-prompts/OPEN_AREA_COMMENTS_SCORING.txt ---
================================================================================
OPEN_AREA_COMMENTS_SCORING — P6
Version: 4.0
Last updated: 2026-02-07
================================================================================

PURPOSE:
  Evaluate how well the cargo matches the vessel's stated voyage strategy 
  as expressed in OpenArea comments. These comments reflect what the owner
  or operator has communicated about their intentions, preferences, or 
  requirements for the next voyage.

SCORE RANGE: [0, 15]
DYNAMIC CRITERION: If no comments exist → score = 0, max_score = 0 (excluded from total)

================================================================================
CRITICAL RULE — NO DATA HANDLING
================================================================================

  If the vessel has NO OpenArea comments (empty or missing):
    score = 0
    max_score = 0
    reasoning = "No OpenArea comments available — criterion excluded from scoring."
    offer_hint = null
    
  RATIONALE: Absence of data should not inflate or deflate the total score.
  The criterion is simply excluded from the dynamic MAX_SCORE calculation.
  This is different from "neutral" — neutral means data exists but doesn't
  help or hurt.

================================================================================
SCORING LEVELS (when comments exist, max_score = 15)
================================================================================

  FULL CONFLICT — score: 0/15
  ─────────────────────────────────────────
    Owner explicitly states they do NOT want what this cargo offers.
    Examples:
      - Comment says "looking for Med" but cargo is Black Sea
      - Comment says "no grain" but cargo is wheat
      - Comment says "needs min 20k" but cargo is 6,000t
    offer_hint: "Owner's stated strategy conflicts with this cargo. Only offer 
                 if exceptional circumstances justify it. Acknowledge their preference."

  SOFT CONFLICT — score: 3-5/15
  ─────────────────────────────────────────
    Owner's stated preferences don't match well but aren't hard blocks.
    Examples:
      - Comment says "pref Med/BS" and cargo is East Med (borderline)
      - Comment mentions a different cargo type but doesn't exclude this one
      - Comment says "looking for long voyage" but this is short
    offer_hint: "Partial mismatch with owner's stated preferences. Emphasize 
                 what makes this cargo attractive despite the mismatch."

  NEUTRAL — score: 7.5/15
  ─────────────────────────────────────────
    Comments exist but don't clearly support or contradict this cargo.
    Examples:
      - Comment only mentions opening date/area, no preferences
      - Comment is generic ("open for offers")
      - Comment mentions unrelated details
    offer_hint: null (no specific guidance needed)

  POSITIVE MATCH — score: 10-12/15
  ─────────────────────────────────────────
    Owner's comments align well with what this cargo offers.
    Examples:
      - Comment says "open for BS/Med" and cargo is Black Sea
      - Comment mentions similar cargo type
      - Comment says "looking for short voyage" and this fits
    offer_hint: "Owner's strategy aligns with this cargo — mention this alignment 
                 in the opening."

  PERFECT MATCH — score: 15/15
  ─────────────────────────────────────────
    Owner explicitly asks for exactly what this cargo is.
    Examples:
      - Comment says "looking for grain ex Ukraine" and cargo is wheat ex Chornomorsk
      - Comment says "need cargo to Sfax" and discharge is Sfax
      - Comment mentions the exact charterer or cargo type
    offer_hint: "Perfect match with owner's stated strategy — lead with this. 
                 Cargo is exactly what they asked for."

================================================================================
AI INSTRUCTIONS
================================================================================

  ai_must:
    - Read ALL OpenArea comments carefully
    - Compare comments against: cargo type, load region, discharge region, 
      quantity range, voyage duration, laycan timing
    - Score based on degree of alignment/conflict
    - Generate offer_hint based on the scoring outcome
    - Set max_score = 0 when no comments exist

  ai_must_not:
    - Never invent or assume preferences not stated in comments
    - Never score neutral (7.5) when there is a clear match or conflict
    - Never give max_score = 15 when comments are empty
    - Never consider vessel specifications here (that's P5, P8)
    - Never consider owner preferences from other sources here (that's P2)

================================================================================
DATA SOURCES
================================================================================

  Primary: OpenArea comments field from vessel listing
  
  Comment types to look for:
    - Region preferences: "pref Med", "looking for BS", "no Atlantic"
    - Cargo preferences: "grain preferred", "no dangerous", "cement ok"
    - Quantity preferences: "needs min 15k", "looking for full cargo"
    - Voyage preferences: "short voyage", "TC out", "trip to Far East"
    - Timing: "need prompt cargo", "can wait until end month"
    - Restrictions: "no war zone", "no sanctions", "no [country]"

================================================================================


--- START OF estimator-prompts/P1A_REGIONAL_SCORING_RULES.txt ---
# ═══════════════════════════════════════════════════════════════════
# P1A: REGIONAL TRADE PATTERNS - EXPLICIT SCORING RULES
# VK Charts AI Scoring System
# ═══════════════════════════════════════════════════════════════════
#
# CRITICAL: This file provides EXPLICIT scoring rules for P1A criterion
# AI must use these rules instead of making assumptions about trade patterns
#
# Maximum Score: 15 points
# Confidence Range: 60-90%
#
# ═══════════════════════════════════════════════════════════════════

version: "2.0"
date: "2026-01-19"
priority: "CRITICAL - Regional patterns are complex and require explicit rules"

# ═══════════════════════════════════════════════════════════════════
# OVERVIEW
# ═══════════════════════════════════════════════════════════════════

purpose: |
  Regional trade patterns reflect:
  - Economic viability of vessel positioning
  - Availability of backhaul cargoes
  - Geopolitical restrictions (sanctions, war zones)
  - Cost structures (canal fees, ballast costs)
  - Historical trade flows and market practices
  
  AI MUST use explicit scoring rules from this file, not general assumptions.

# ═══════════════════════════════════════════════════════════════════
# SCORING METHODOLOGY
# ═══════════════════════════════════════════════════════════════════

scoring_approach: |
  1. Identify vessel's opening region/port
  2. Identify cargo loading region
  3. Match pattern to scoring table below
  4. Apply vessel size adjustments if needed
  5. Consider special cases (Danube, Russian ports, etc.)

# ═══════════════════════════════════════════════════════════════════
# EXPLICIT SCORING TABLE - PRIMARY PATTERNS
# ═══════════════════════════════════════════════════════════════════

primary_trade_patterns:

  # ─────────────────────────────────────────────────────────────────
  # BLACK SEA PATTERNS (Coasters & Small Handy)
  # ─────────────────────────────────────────────────────────────────
  
  black_sea_to_marmara:
    vessel_opens: "Black Sea (POC, Danube, Constanta area)"
    cargo_loads: "Black Sea"
    cargo_discharges: "Marmara Sea (Turkey)"
    vessel_sizes: ["Small Coaster", "Coaster", "Small Handy"]
    score: 15
    confidence: 90
    reasoning: |
      This is THE primary trade pattern for Black Sea coasters.
      POC grain/minerals to Turkish/Marmara ports is the backbone trade.
    examples:
      - "Chornomorsk → Yarimca"
      - "Odessa → Istanbul (Marmara)"
      - "Constanta → Derince"
      
  black_sea_to_mediterranean:
    vessel_opens: "Black Sea"
    cargo_loads: "Black Sea"
    cargo_discharges: "Mediterranean (Libya, Egypt, Lebanon, Israel)"
    vessel_sizes: ["Coaster", "Small Handy"]
    score: 14
    confidence: 90
    reasoning: |
      Standard export route for Black Sea grain and minerals.
      Slightly less common than Marmara but still core business.
    examples:
      - "Chornomorsk → Alexandria"
      - "Constanta → Tripoli"
      
  black_sea_internal:
    vessel_opens: "Black Sea"
    cargo_loads: "Black Sea"
    cargo_discharges: "Black Sea"
    vessel_sizes: ["Small Coaster", "Coaster"]
    score: 13
    confidence: 85
    reasoning: |
      Internal Black Sea trades - less common than export routes.
      Examples: Bulgaria to Romania, Georgia coastal trades.

  # ─────────────────────────────────────────────────────────────────
  # BACKHAUL PATTERNS (High Favorability)
  # ─────────────────────────────────────────────────────────────────
  
  aegean_to_black_sea:
    vessel_opens: "Aegean Sea"
    cargo_loads: "Black Sea (POC, Danube)"
    vessel_sizes: ["Small Coaster", "Coaster", "Small Handy"]
    score: 12
    confidence: 90
    reasoning: |
      STRONG backhaul pattern. Vessels commonly discharge in Aegean
      (Turkish Aegean ports, Greek ports) and return to Black Sea for loading.
      This is a well-established trade flow.
    examples:
      - "Aliaga → Chornomorsk"
      - "Piraeus → Constanta"
    citations:
      - "Correction: Aegean vessels commonly find backhaul to Black Sea"
      
  adriatic_to_black_sea:
    vessel_opens: "Adriatic Sea"
    cargo_loads: "Black Sea (POC, Danube)"
    vessel_sizes: ["Small Coaster", "Coaster", "Small Handy"]
    score: 12
    confidence: 90
    reasoning: |
      STRONG backhaul pattern due to LACK of Adriatic backhaul cargoes.
      After discharging in Adriatic ports (Italy, Croatia, Albania),
      vessels commonly ballast to Black Sea as there are limited 
      outbound cargoes from Adriatic region.
    examples:
      - "Rijeka → Chornomorsk"
      - "Bar → Constanta"
    citations:
      - "Correction: Adriatic vessels often ballast to Black Sea due to lack of backhaul"
      
  east_med_to_black_sea:
    vessel_opens: "East Mediterranean"
    cargo_loads: "Black Sea (POC, Danube)"
    vessel_sizes: ["Coaster", "Small Handy"]
    score: 11
    confidence: 85
    reasoning: |
      Common backhaul pattern. After discharging in East Med ports
      (Egypt, Libya, Lebanon, Israel), many vessels return to Black Sea.
      Strong backhaul market exists.
    examples:
      - "Alexandria → Chornomorsk"
      - "Mersin → Constanta"
    citations:
      - "Correction: East Med vessels commonly return to Black Sea for backhaul"

  # ─────────────────────────────────────────────────────────────────
  # DANUBE-SPECIFIC PATTERNS (Complex Economics)
  # ─────────────────────────────────────────────────────────────────
  
  danube_port_to_poc:
    vessel_opens: "Danube River ports (Braila, Reni, Izmail, Giurgiulesti)"
    vessel_opens_NOT: "Sulina Anchorage"
    cargo_loads: "POC (Chornomorsk, Pivdennyi, Odessa)"
    vessel_sizes: ["Small Coaster", "Coaster"]
    score: 8
    confidence: 90
    reasoning: |
      SECONDARY option. If vessel is already IN Danube port, it has
      paid high costs to enter (Sulina Bar transit fees, pilotage).
      Owners will PREFER to find cargo FROM Danube ports first to
      recoup these entry costs. Shifting to POC is possible but not ideal.
    key_principle: "Already paid Danube entry costs → seeks Danube cargo first"
    examples:
      - "Vessel at Braila → Chornomorsk loading"
      - "Vessel at Izmail → Chornomorsk loading"
    citations:
      - "Correction 1 (akdeniz): Danube vessels prefer Danube cargo to offset Sulina costs"
      
  sulina_anchorage_to_poc:
    vessel_opens: "Sulina Anchorage"
    cargo_loads: "POC (Chornomorsk, Pivdennyi, Odessa)"
    vessel_sizes: ["Small Coaster", "Coaster"]
    score: 14
    confidence: 90
    reasoning: |
      HIGH favorability. Sulina is a WAITING AREA / ANCHORAGE where
      vessels wait for either:
      a) Entry into Danube River, OR
      b) Direct call to POC ports
      
      From Sulina, POC and Danube are EQUAL choices - vessel has not
      yet committed to either direction. Distance to POC is minimal (~80nm).
    key_principle: "Sulina = neutral waiting area, POC and Danube equally viable"
    examples:
      - "Vessel at Sulina anchorage → Chornomorsk"
    citations:
      - "Correction 3 (eleanora): Sulina vessels can proceed to POC or Danube equally"
      
  heading_to_danube_to_poc:
    vessel_opens: "In transit, destination = Danube port"
    cargo_loads: "POC (Chornomorsk, Pivdennyi, Odessa)"
    vessel_sizes: ["Small Coaster", "Coaster"]
    score: 7
    confidence: 85
    reasoning: |
      LOW favorability. If vessel is HEADING TO (destination set to)
      a Danube port, it indicates owners have already chosen to enter
      Danube. Redirecting to POC is possible but requires changing plans.
    key_principle: "Vessel already committed to Danube direction"
    examples:
      - "Vessel heading to Izmail → Chornomorsk loading"
    warning: |
      AI should also ask owner to clarify if vessel is really opening
      in Danube or if it's loading there and will open elsewhere.

  # ─────────────────────────────────────────────────────────────────
  # GEOPOLITICAL RESTRICTIONS
  # ─────────────────────────────────────────────────────────────────
  
  russian_black_sea_to_ukraine:
    vessel_opens: "Russian Black Sea (Novorossiysk, Kavkaz, Kerch, Taman)"
    cargo_loads: "Ukraine (POC)"
    vessel_sizes: ["ALL"]
    score: 2
    confidence: 90
    reasoning: |
      MINIMAL viability due to geopolitical situation (Russia-Ukraine war,
      sanctions). Vessels opening in Russian Black Sea ports will seek
      Russian cargoes. Extremely unlikely to position to Ukrainian ports.
    key_principle: "Geopolitical barriers prevent Russian → Ukraine trades"
    examples:
      - "Novorossiysk → Chornomorsk (highly unlikely)"
    citations:
      - "Correction: Russian Black Sea vessels will seek Russian cargo, not Ukraine"
      
  ukraine_to_russian_black_sea:
    vessel_opens: "Ukraine (POC)"
    cargo_loads: "Russian Black Sea"
    vessel_sizes: ["ALL"]
    score: 2
    confidence: 90
    reasoning: |
      Same geopolitical barriers apply in reverse direction.
      Sanctions and war situation prevent normal trade flows.

  # ─────────────────────────────────────────────────────────────────
  # MEDIUM-DISTANCE PATTERNS
  # ─────────────────────────────────────────────────────────────────
  
  west_med_to_black_sea:
    vessel_opens: "West Mediterranean (Spain, France, Algeria, Morocco)"
    cargo_loads: "Black Sea"
    vessel_sizes: ["Coaster", "Small Handy"]
    score: 8
    confidence: 75
    reasoning: |
      Longer ballast leg (~2000nm) but viable for right freight rates.
      More common for Small Handy size, less for pure coasters.
    examples:
      - "Barcelona → Chornomorsk"
      
  atlantic_to_black_sea:
    vessel_opens: "Atlantic (Portugal, UK, Morocco Atlantic coast)"
    cargo_loads: "Black Sea"
    vessel_sizes: ["Small Handy", "Handy"]
    score: 6
    confidence: 70
    reasoning: |
      Long ballast (~3000nm). Requires strong freight incentive.
      Only viable for larger vessels or exceptional market conditions.
      
  west_africa_to_black_sea:
    vessel_opens: "West Africa (Senegal, Ivory Coast, Ghana, Nigeria)"
    cargo_loads: "Black Sea"
    vessel_sizes: ["Coaster"]
    score: 0
    confidence: 90
    reasoning: |
      Commercially non-viable for coasters. Distance ~4200nm creates
      prohibitive ballast costs. Would only occur for larger vessels
      or very exceptional circumstances.
    examples:
      - "Dakar → Chornomorsk (not viable for 7k coaster)"
    citations:
      - "Correction 7 (ak beauty): West Africa ballast non-viable for coaster"

# ═══════════════════════════════════════════════════════════════════
# VESSEL SIZE ADJUSTMENTS
# ═══════════════════════════════════════════════════════════════════

vessel_size_adjustments:
  
  principle: |
    Larger vessels can absorb longer ballast legs due to:
    - Higher earning potential per voyage
    - Lower ballast cost as % of revenue
    - More strategic positioning behavior
  
  adjustment_multipliers:
    description: |
      For patterns with distance-based scoring penalties,
      apply these multipliers based on vessel size:
    
    small_coaster_3_6k:
      range: "3000-6000 DWT"
      multiplier: 0.8
      effect: "MORE sensitive to distance - reduce score by 20%"
      
    coaster_6_8k:
      range: "6000-8000 DWT"
      multiplier: 1.0
      effect: "BASELINE - no adjustment"
      
    small_handy_8_17k:
      range: "8000-17000 DWT"
      multiplier: 1.15
      effect: "LESS sensitive - increase score by 15%"
      
    handy_17_24k:
      range: "17000-24000 DWT"
      multiplier: 1.3
      effect: "Much less sensitive - increase score by 30%"
      
    large_handy_plus:
      range: "24000+ DWT"
      multiplier: 1.5
      effect: "Least sensitive - increase score by 50%"
  
  application_example:
    pattern: "Adriatic to Black Sea"
    base_score: 12
    
    for_small_coaster:
      calculation: "12 × 0.8 = 9.6"
      final_score: 10
      
    for_coaster:
      calculation: "12 × 1.0 = 12"
      final_score: 12
      
    for_small_handy:
      calculation: "12 × 1.15 = 13.8"
      final_score: 14
      
    for_handy:
      calculation: "12 × 1.3 = 15.6"
      final_score: 15
      
  patterns_requiring_adjustment:
    - "adriatic_to_black_sea"
    - "east_med_to_black_sea"
    - "aegean_to_black_sea"
    - "west_med_to_black_sea"
    - "atlantic_to_black_sea"
    
  patterns_NOT_requiring_adjustment:
    - "black_sea_to_marmara" (already optimal)
    - "sulina_anchorage_to_poc" (very short distance)
    - "russian_black_sea_to_ukraine" (geopolitical, not economic)

# ═══════════════════════════════════════════════════════════════════
# SPECIAL CONSIDERATIONS
# ═══════════════════════════════════════════════════════════════════

special_rules:
  
  mediterranean_internal_trades:
    description: |
      For Med → Med trades (e.g., Egypt → Turkey, Libya → Italy):
    score_range: "11-13"
    reasoning: "Regional trade, economically viable but not as strong as Black Sea export routes"
    
  marmara_internal_trades:
    description: |
      Turkish Marmara → Turkish Marmara or Aegean
    score_range: "12-13"
    reasoning: "Turkish domestic trades, common for coasters"
    
  positioning_after_discharge:
    description: |
      If vessel has a known discharge port with ETA, and cargo loading
      is in a different region, consider the DISCHARGE port as the
      effective opening position for P1A scoring.
    example: |
      Vessel: "Current area: Aegean, Destination: Mersin (ETA Jan 25)"
      Cargo: Loads from Chornomorsk (Feb 5)
      
      Apply: "east_med_to_black_sea" pattern (score: 11)
      NOT: "aegean_to_black_sea" (vessel will be in East Med when ready)

# ═══════════════════════════════════════════════════════════════════
# AI REASONING TEMPLATES
# ═══════════════════════════════════════════════════════════════════

reasoning_templates:
  
  template_strong_pattern:
    score_range: "12-15"
    format: |
      "[Opening Region] to [Loading Region] is a [strong/primary] trade pattern 
      for [vessel size] vessels. [Specific reasoning: backhaul availability / 
      core trade route / etc.]"
    example: |
      "Aegean to Black Sea is a strong backhaul pattern for Coaster vessels. 
      Many vessels discharge in Turkish Aegean ports and return to Black Sea 
      for grain loading."
      
  template_secondary_pattern:
    score_range: "7-11"
    format: |
      "[Opening Region] to [Loading Region] is a [viable/secondary] option for 
      [vessel size]. [Specific challenges: distance / economics / alternatives]"
    example: |
      "Danube port to POC is a secondary option. Vessel has already paid Sulina 
      transit costs and will prioritize finding cargo from Danube ports first."
      
  template_weak_pattern:
    score_range: "0-6"
    format: |
      "[Opening Region] to [Loading Region] is [unfavorable/unlikely] due to 
      [specific reason: distance / geopolitics / economics]"
    example: |
      "Russian Black Sea to Ukraine is highly unlikely due to geopolitical 
      situation (sanctions, war). Vessel will seek Russian cargoes instead."

# ═══════════════════════════════════════════════════════════════════
# CRITICAL AI INSTRUCTIONS
# ═══════════════════════════════════════════════════════════════════

ai_must:
  - "ALWAYS check this file for explicit pattern matches before scoring P1A"
  - "NEVER assume a pattern is good/bad without checking explicit rules"
  - "Apply vessel size adjustments for distance-based patterns"
  - "Consider special cases (Danube, Russian ports, discharge positioning)"
  - "Cite specific pattern name in reasoning (e.g., 'aegean_to_black_sea pattern')"
  - "If pattern not found in this file, use conservative middle score (8-10) and note uncertainty"

ai_must_not:
  - "Never assume 'close distance = automatically good regional pattern'"
  - "Never ignore Danube economics (Sulina costs matter!)"
  - "Never ignore geopolitical restrictions (Russia-Ukraine)"
  - "Never use vague reasoning like 'regional trade is good' - be specific"

# ═══════════════════════════════════════════════════════════════════
# CONFIDENCE LEVELS
# ═══════════════════════════════════════════════════════════════════

confidence_guidelines:
  
  high_confidence_90:
    when: "Pattern explicitly defined in this file with clear examples"
    patterns:
      - "black_sea_to_marmara"
      - "sulina_anchorage_to_poc"
      - "russian_black_sea_to_ukraine"
      - "aegean_to_black_sea"
      - "adriatic_to_black_sea"
      
  medium_confidence_85:
    when: "Pattern defined but with some variability in market conditions"
    patterns:
      - "danube_port_to_poc"
      - "east_med_to_black_sea"
      - "heading_to_danube_to_poc"
      
  lower_confidence_70_75:
    when: "Longer distance patterns, market-dependent, or edge cases"
    patterns:
      - "west_med_to_black_sea"
      - "atlantic_to_black_sea"

# ═══════════════════════════════════════════════════════════════════
# END OF P1A REGIONAL SCORING RULES
# ═══════════════════════════════════════════════════════════════════


--- START OF estimator-prompts/P2A_PSC_PORT_ACCESSIBILITY_SCORING.txt ---
================================================================================
P2A — PSC PORT ACCESSIBILITY SCORING
Version: 3.0
Last updated: 2026-02-07
================================================================================

PURPOSE:
  Evaluate whether the vessel can safely call at the cargo's loading and 
  discharge ports without excessive PSC (Port State Control) risk. Considers
  vessel's class, P&I, age, flag, and inspection history against port 
  strictness tiers.

SCORE RANGE: [0, 20]
ALWAYS ACTIVE: This criterion always has max_score = 20

================================================================================
PORT STRICTNESS TIERS
================================================================================

  TIER 1 — Very Strict (high detention risk)
  ─────────────────────────────────────────
    Countries: Italy, France, Greece, Spain, Portugal, Belgium, Netherlands,
               Germany, UK, Ireland, Norway, Sweden, Denmark, Finland,
               Australia, New Zealand, Canada, Japan, South Korea
    
  TIER 2 — Moderate Strict
  ─────────────────────────────────────────
    Countries: Turkey, Croatia, Slovenia, Montenegro, Albania, 
               Romania, Bulgaria, Egypt (Suez/Alex)
               
  TIER 3 — Moderate Tolerant
  ─────────────────────────────────────────
    Countries: Ukraine, Russia (Black Sea ports), Georgia, 
               Tunisia, Algeria, Morocco, Libya, Lebanon, Syria
               
  TIER 4 — Lax (low detention risk)
  ─────────────────────────────────────────
    Countries: Most West Africa, India, Bangladesh, Pakistan,
               most Southeast Asia, Central America, South America

================================================================================
VESSEL STATUS CATEGORIES
================================================================================

  HIGH STATUS — Score bonus for strict ports
    - IACS class (BV, LR, DNV, ABS, ClassNK, RINA, CCS, KR, RS, PRS, CRS, IRS)
    - Top-tier P&I (IG clubs)
    - Flag: EU/established maritime nation
    - Age: < 15 years
    
  MEDIUM STATUS — Standard scoring
    - IACS class OR recognized non-IACS
    - P&I coverage exists
    - Flag: acceptable but not premium
    - Age: 15-25 years
    
  LOW STATUS — Penalty for strict ports
    - Non-IACS class or unknown
    - No P&I or unknown P&I
    - Flag of convenience / blacklisted
    - Age: > 25 years

================================================================================
BASE SCORING MATRIX
================================================================================

  Score = f(vessel_status, port_tier)

  Port Tier 1 (Very Strict):
    HIGH status:   16-20/20
    MEDIUM status: 10-14/20
    LOW status:    2-6/20 (potential BLOCK if critical deficiency)

  Port Tier 2 (Moderate Strict):
    HIGH status:   18-20/20
    MEDIUM status: 14-17/20
    LOW status:    6-10/20

  Port Tier 3 (Moderate Tolerant):
    HIGH status:   20/20
    MEDIUM status: 16-19/20
    LOW status:    10-14/20

  Port Tier 4 (Lax):
    HIGH status:   20/20
    MEDIUM status: 18-20/20
    LOW status:    14-18/20

================================================================================
PORT HISTORY BONUS
================================================================================

  If the vessel has RECENT successful calls at ports in the SAME TIER or 
  HIGHER (stricter) tier as the cargo ports, apply a bonus.
  
  The bonus reflects proven ability to pass PSC at that level of strictness.
  
  RULES:
    - Bonus applies to ports of the SAME tier AND lower (less strict) tiers
    - Bonuses do NOT stack — use the highest applicable bonus only
    - "Recent" = within the last 12 months of port call history
    - We do NOT have detention data — do not require "no detention" condition

  BONUS VALUES:
  
    Tier 1 (Very Strict) history found:
      → +3 bonus for ALL port tiers (Tier 1, 2, 3, 4)
      Rationale: If vessel passed Italy/France PSC, she's good everywhere
      
    Tier 2 (Moderate Strict / Turkey) history found:
      → +2 bonus for Tier 2, 3, and 4 ports
      → NO bonus for Tier 1 ports
      Rationale: Turkey PSC clearance doesn't guarantee Italy clearance
      
    Tier 3 (Moderate Tolerant) history found:
      → +1 bonus for Tier 3 and 4 ports only
      → NO bonus for Tier 1 or 2 ports

    Tier 4 (Lax) history found:
      → No bonus (doesn't prove anything)

  EXAMPLES:
  
    Example 1: Vessel called at Ravenna (Italy, Tier 1)
      → Cargo ports: Thessaloniki (Greece, Tier 1) → +3 bonus
      → Cargo ports: Mersin (Turkey, Tier 2) → +3 bonus  
      → Cargo ports: Chornomorsk (Ukraine, Tier 3) → +3 bonus
      
    Example 2: Vessel called at Istanbul (Turkey, Tier 2)
      → Cargo ports: Genoa (Italy, Tier 1) → NO bonus
      → Cargo ports: Constanta (Romania, Tier 2) → +2 bonus
      → Cargo ports: Odessa (Ukraine, Tier 3) → +2 bonus
      
    Example 3: Vessel called at both Naples (Tier 1) AND Samsun (Tier 2)
      → Use highest applicable: Naples gives +3 for everything
      → Do NOT add +3 and +2 together

  BONUS CAP: Total P2A score cannot exceed 20

================================================================================
SCORING FOR MULTIPLE PORTS
================================================================================

  When cargo has both loading and discharge ports:
    - Score each port separately
    - Final P2A = weighted average (load port 60%, discharge port 40%)
    - If either port results in BLOCK → entire P2A is BLOCK

================================================================================
BLOCK CONDITIONS
================================================================================

  - LOW status vessel + Tier 1 port + no port history bonus → BLOCK
  - Vessel on Paris MOU blacklist + any EU port → BLOCK
  - No class certificate available + Tier 1 or 2 port → BLOCK

================================================================================
OFFER HINTS
================================================================================

  High score (16+): null (no PSC concerns to mention)
  
  Medium score (10-15): "PSC risk is manageable but be aware — vessel's 
    [class/age/flag] may draw attention at [port]. Recent successful calls 
    at similar ports help."
    
  Low score (<10): "Significant PSC risk at [port]. Consider whether owner 
    is willing to accept inspection risk. Mention alternative discharge 
    options if available."
    
  BLOCK: "Vessel cannot safely call at [port] — PSC risk too high. 
    Do not offer for this port combination."

================================================================================
AI INSTRUCTIONS
================================================================================

  ai_must:
    - Check vessel class against IACS member list
    - Check P&I club if available
    - Determine vessel status category (HIGH/MEDIUM/LOW)
    - Look up port tiers for all cargo ports
    - Check vessel's port call history for bonus eligibility
    - Apply highest applicable bonus (no stacking)
    - Score using the matrix
    - Generate appropriate offer_hint
    
  ai_must_not:
    - Never require "no detention" data (we don't have it)
    - Never stack multiple port history bonuses
    - Never apply Tier 2 bonus to Tier 1 ports
    - Never ignore port history when it's available
    - Never block a vessel solely based on age without considering other factors

================================================================================


--- START OF estimator-prompts/READINESSETA_TO_LOADING_PORT_SCORING.txt ---
================================================================================
READINESS / ETA TO LOADING PORT SCORING — P7
Version: 3.0
Last updated: 2026-02-07
================================================================================

PURPOSE:
  Score how well the vessel's availability timing matches the cargo laycan.
  Integrates draught analysis to determine if vessel needs operations buffer.

SCORE RANGE: [0, 10]
ALWAYS ACTIVE: max_score = 10

================================================================================
STEP 1 — DETERMINE VESSEL READY DATE
================================================================================

  Use vessel_location_determination.txt logic:
  
  A) Vessel is OPEN with a date:
     vessel_ready = stated opening date
     
  B) Vessel has destination + ETA:
     Perform draught analysis:
     
     If BALLAST (draught_ratio < 0.65):
       vessel_ready = ETA to destination
       Note: "Vessel appears in ballast — using ETA without operations buffer.
              Recommend confirming availability with owner."
              
     If LADEN (draught_ratio >= 0.65):
       vessel_ready = ETA to destination + 7 days
       Note: "Vessel appears laden — adding 7 days operations buffer 
              (discharge + preparation)."
              
     If OVER_DRAFT (current > max):
       vessel_ready = ETA + 7 days (conservative, treat as laden)
       Note: "Draught data anomaly — treating as laden with +7 days buffer."

  C) Vessel has no clear ETA:
     Estimate based on current position + sailing time to cargo load port
     confidence = "low"

================================================================================
STEP 2 — CALCULATE GAP
================================================================================

  gap = vessel_ready - cargo_layday (start of laycan)
  
  Positive gap = vessel is late (arrives AFTER layday)
  Negative gap = vessel is early (arrives BEFORE layday)
  Zero gap = perfect timing

================================================================================
STEP 3 — SCORING MATRIX
================================================================================

  gap ≤ -7 days (very early):
    score = 4/10
    Note: Vessel idle too long waiting for laycan, owner may lose interest
    offer_hint: "Vessel ready much earlier than laycan — suggest flexibility 
                 on dates or mention filler cargo opportunity."

  gap = -6 to -3 days (early):
    score = 7/10
    Note: Slight wait but manageable
    offer_hint: "Vessel ready a few days early — timing works, mention 
                 flexibility on laycan if possible."

  gap = -2 to +1 days (ideal window):
    score = 10/10
    Note: Perfect timing match
    offer_hint: "Timing aligns perfectly — highlight this in the opening."

  gap = +2 to +3 days (slightly late):
    score = 7/10
    Note: Acceptable if charterer is flexible
    offer_hint: "Timing slightly tight — mention if there's flexibility 
                 on laycan extension."

  gap = +4 to +5 days (late):
    score = 4/10
    Note: Risky, may miss canceling date
    offer_hint: "Timing is tight — only offer if laycan may extend or 
                 vessel can speed up."

  gap = +6 to +7 days (very late):
    score = 2/10
    Note: Likely misses canceling, but not impossible
    offer_hint: "Vessel likely misses canceling — only offer if confirmed 
                 laycan extension possible."

  gap > +7 days (past canceling):
    score = 0/10
    decision = BLOCK
    offer_hint: "Vessel cannot meet laycan — do not offer unless laycan 
                 extension is confirmed."

================================================================================
SPECIAL CASES
================================================================================

  BALLAST QUESTION:
    When vessel is determined to be in ballast heading somewhere:
    - Score using ETA (without +7 days)
    - Add question to offer: confirm if vessel is fixed or open
    - If vessel turns out to be fixed → she's not available anyway
    - If vessel is positioning → she's available sooner
    
    offer_hint includes: "Vessel appears in ballast — confirm with owner 
      if she's proceeding for loading or available for redirection."

  NO ETA AVAILABLE:
    - Estimate sailing time from current position to load port
    - Use average speed (10-12 knots for general cargo)
    - Add 1 day port entry buffer
    - Score with low confidence
    
  VESSEL AT ANCHOR / MOORED (no clear next destination):
    - If at load port area → vessel_ready = today/tomorrow
    - If at other port → estimate sailing time
    - Check if waiting for cargo or waiting for berth

================================================================================
EXAMPLES
================================================================================

  Example 1: Laden vessel
    Vessel heading Ravenna, ETA Feb 13
    current_draught = 8.8m, max_draft = 8.6m → LADEN (over_draft)
    vessel_ready = Feb 13 + 7 = Feb 20
    Cargo layday = Feb 5, canceling = Feb 10
    gap = Feb 20 - Feb 5 = +15 days → score = 0/10, BLOCK
    offer_hint: "Vessel cannot meet laycan — opens 10+ days after canceling."

  Example 2: Ballast vessel  
    Vessel heading Mersin, ETA Feb 10
    current_draught = 2.1m, max_draft = 5.2m → BALLAST
    vessel_ready = Feb 10 (no buffer)
    Cargo layday = Feb 8, canceling = Feb 15
    gap = Feb 10 - Feb 8 = +2 days → score = 7/10
    offer_hint: "Timing works if vessel is available. Confirm ballast status."

  Example 3: Open vessel
    Vessel open Constanta Feb 12
    vessel_ready = Feb 12
    Cargo layday = Feb 14, canceling = Feb 20
    gap = Feb 12 - Feb 14 = -2 days → score = 10/10
    offer_hint: "Timing aligns perfectly — lead with this."

================================================================================


--- START OF estimator-prompts/estimation-template-example.md ---
STRICT use this JSON template for all estimation responses you make
!!!Impotrant!!! In "citation" value for each score show data values and referenses to rules provided in prompt you used in decision making
For scores with critical issues add "critical": true
recommendation enum: RECOMMENDED, CONDITIONAL, NOT_RECOMMENDED, BLOCKED

{
  "vessel_name": "MV Example",
  "total_score": 51,
  "max_score": 100,
  "confidence": 70,
  "confidence_note": "Not enough data for P6",
  "recommendation": "CONDITIONAL",
  "short_summary": "This vessel recommended to process if no better options you have",
  "detailed_scoring": {
    "proximity": {
      "code": "P1",
      "score": 11.0,
      "max_score": 20,
      "reasoning": "Vessel is in the Azov Sea. Ballast to the Danube (Reni) is ~450nm. For a Small Coaster (SC), this is a moderate ballast leg.",
      "confidence": "test",
      "citations": ["ref:23"]
    },
    "regional_patterns": {
      "code": "P1A",
      "score": 12,
      "max_score": 15,
      "reasoning": "Azov/Black Sea to East Med (Greece) is a standard trade pattern for this vessel size.",
      "confidence": "test",
      "citations": ["ref:23"]
    },
    "owner_preferences": {
      "code": "P2",
      "score": 5,
      "max_score": 15,
      "reasoning": "Company comments state \"ukr ok sometimes\" and \"ukr expensive.\" This indicates a neutral-to-cautious willingness to work Ukraine.",
      "confidence": "test",
      "citations": ["ref:23"]
    },
    "port_accessibility": {
      "code": "P2A",
      "score": 5,
      "max_score": 20,
      "reasoning": "France - VERY STRICT PSC region",
      "confidence": "test",
      "citations": ["ref:23"]
    },
    "cargo_preferences": {
      "code": "P3",
      "score": 12,
      "max_score": 15,
      "reasoning": "SBS (SF 51) is a standard agricultural bulk cargo. Vessel is a General Cargo ship suitable for this type.",
      "confidence": "test",
      "citations": ["ref:23"]
    },
    "last_ports": {
      "code": "P4",
      "score": 1,
      "max_score": 10,
      "reasoning": "No specific port call history provided; score based on company's general regional familiarity.",
      "confidence": "test",
      "citations": ["ref:23"]
    },
    "intake_capacity": {
      "code": "P5",
      "score": 3,
      "max_score": 15,
      "reasoning": "**CRITICAL:** Volume limitation. With a grain capacity of 140,659 cuft and SF 51, max intake is ~2,758t. This is only 92% of the 3,000t requirement.",
      "confidence": "test",
      "citations": ["ref:23"],
      "critical": true
    },
    "openarea_modifier": {
      "code": "P6",
      "score": 0,
      "max_score": 0,
      "reasoning": "No voyage-specific comments provided.",
      "confidence": "test",
      "citations": ["ref:23"]
    },
    "readiness_eta": {
      "code": "P7",
      "score": 7,
      "max_score": 10,
      "reasoning": "Based on position in Azov Sea and 8kn speed, vessel can reach Reni in ~2.5 days, well within the Jan 12-20 laycan.",
      "confidence": "test",
      "citations": ["ref:23"]
    }
  }
}



--- START OF estimator-prompts/intake_calculator_formula.txt ---
================================================================================
INTAKE CALCULATOR FORMULA — P5
Version: 4.0
Last updated: 2026-02-07
================================================================================

PURPOSE:
  Calculate vessel's cargo intake capacity and score how well the vessel 
  fits the cargo quantity requirements. Multi-step process covering weight,
  volume, draft restrictions, vessel utilization, and cubature.

SCORE RANGE: [0, 15]
ALWAYS ACTIVE: max_score = 15
MINIMUM SCORE: 2 (except when BLOCK)

================================================================================
STEP 1 — PARSE CARGO QUANTITY (min_qty / max_qty)
================================================================================

  Convert cargo quantity description into numeric min/max range:
  
  Format: "15,000t ±10%"
    min_qty = 15000 × 0.90 = 13,500
    max_qty = 15000 × 1.10 = 16,500
    
  Format: "6000/6600t" or "6000-6600t"
    min_qty = 6,000
    max_qty = 6,600
    
  Format: "6000t MOLOO" (more or less in owner's option)
    min_qty = 6000 × 0.95 = 5,700
    max_qty = 6000 × 1.05 = 6,300
    
  Format: "6000t" (no qualifier)
    min_qty = 6000 × 0.95 = 5,700
    max_qty = 6000 × 1.05 = 6,300
    (Default: assume ±5% flexibility)
    
  Format: "15,000mt 10% MOLOO"
    min_qty = 15000 × 0.90 = 13,500
    max_qty = 15000 × 1.10 = 16,500

  Format: "abt 8,000t" (about)
    min_qty = 8000 × 0.95 = 7,600
    max_qty = 8000 × 1.05 = 8,400

================================================================================
STEP 2 — CALCULATE VESSEL INTAKE
================================================================================

  A) WEIGHT INTAKE:
     weight_intake = DWT - ROB
     ROB (Remaining On Board) = 250 tonnes (default fuel/water/stores)
     
     If DWT is not available → BLOCK with note "Missing DWT data"
     
  B) VOLUME INTAKE (if stowage factor is known):
     volume_intake = grain_capacity / SF
     
     grain_capacity = from vessel specs (cubic feet or cubic meters)
     SF = Stowage Factor of the cargo (cubic feet per tonne)
     
     Common SF values:
       Wheat: 46-48 cbft/t
       Corn/Maize: 47-50 cbft/t
       Barley: 49-53 cbft/t
       Soybeans: 48-50 cbft/t
       Rice: 42-52 cbft/t (varies by type)
       Cement: 28-30 cbft/t
       Coal: 42-48 cbft/t
       Fertilizer (urea): 42-45 cbft/t
       Sugar: 38-42 cbft/t
       Steel products: 15-25 cbft/t
       
     If grain_capacity is not available → skip volume check
     If SF is not known → skip volume check
     
  C) DRAFT-RESTRICTED INTAKE (if port has draft restriction):
     draft_restricted_intake = (port_max_draft - vessel_light_draft) / 
                               (vessel_max_draft - vessel_light_draft) × DWT
     
     Simplified estimate when light draft is unknown:
       draft_ratio = port_max_draft / vessel_max_draft
       draft_restricted_intake = weight_intake × draft_ratio
       (This is approximate — actual calculation depends on vessel design)
       
     If no draft restriction → draft_restricted_intake = unlimited
     
  D) FINAL INTAKE:
     final_intake = MIN(weight_intake, volume_intake, draft_restricted_intake)
     
     Use whichever is the limiting factor.

================================================================================
STEP 3 — CARGO FIT SCORE (base P5 score)
================================================================================

  Compare final_intake to cargo min_qty / max_qty:
  
  PERFECT FIT: min_qty ≤ final_intake ≤ max_qty
  ─────────────────────────────────────────
    P5_base = 15/15
    offer_hint: "Cargo fits vessel perfectly — mention full utilization."
    
  UNDER CARGO: final_intake < min_qty
  ─────────────────────────────────────────
    shortfall = 1 - (final_intake / min_qty)
    penalty = shortfall × 2.0
    P5_base = MAX(15 × (1 - penalty), 2)
    
    Example: intake = 12,000, min_qty = 13,500
      shortfall = 1 - 12000/13500 = 0.111
      penalty = 0.111 × 2.0 = 0.222
      P5_base = 15 × (1 - 0.222) = 11.67
      
    BLOCK CONDITION: final_intake < min_qty × 0.85
      → Vessel physically cannot load minimum required cargo
      → P5 = BLOCK
      
    offer_hint: "Vessel intake is below cargo minimum — be transparent about 
                 quantity limitations. Mention MOLOO flexibility if applicable."
    
  OVER CARGO: final_intake > max_qty
  ─────────────────────────────────────────
    excess = 1 - (max_qty / final_intake)
    penalty = excess × 2.0
    P5_base = MAX(15 × (1 - penalty), 2)
    
    Example: intake = 25,000, max_qty = 16,500
      excess = 1 - 16500/25000 = 0.340
      penalty = 0.340 × 2.0 = 0.680
      P5_base = 15 × (1 - 0.680) = 4.8
      
    Note: No BLOCK for over-cargo — vessel can always load less.
    But heavily penalized because owner won't want to waste capacity.
    
    offer_hint: "Vessel significantly larger than needed — emphasize 
                 attractive freight rate to compensate underutilization."

================================================================================
STEP 4 — VESSEL UTILIZATION PENALTY (additional modifier)
================================================================================

  PURPOSE: Penalize when external restrictions (draft, grain capacity) prevent
  the vessel from using her full capacity. An owner is less interested if 
  their vessel can only load 70% of what she could normally carry.
  
  APPLIES WHEN: Any restriction reduces intake below unrestricted capacity.
  This includes draft restrictions AND grain capacity limitations.
  
  FORMULA:
    unrestricted_intake = MIN(weight_intake, volume_intake)  # without draft limits
    restricted_intake = MIN(weight_intake, volume_intake, draft_restricted_intake)
    
    restriction_ratio = restricted_intake / unrestricted_intake
    
    If restriction_ratio >= 0.85: no additional penalty
    
    If restriction_ratio < 0.85:
      vessel_util_penalty = (0.85 - restriction_ratio) × 1.5
      P5_score = P5_base × (1 - vessel_util_penalty)
      
  EXAMPLE:
    Vessel DWT = 16,000, weight_intake = 15,750
    Port draft restriction → draft_restricted_intake = 12,000
    No volume restriction → volume_intake = 16,000
    
    unrestricted = MIN(15750, 16000) = 15,750
    restricted = MIN(15750, 16000, 12000) = 12,000
    restriction_ratio = 12000 / 15750 = 0.762
    
    0.762 < 0.85 → penalty applies
    vessel_util_penalty = (0.85 - 0.762) × 1.5 = 0.132
    P5_score = P5_base × (1 - 0.132) = P5_base × 0.868
    
  EXAMPLE with grain capacity limitation:
    weight_intake = 8,000
    volume_intake = 6,200 (grain capacity limits)
    No draft restriction
    
    unrestricted = MIN(8000, 6200) = 6,200 (volume limited)
    restricted = same = 6,200
    restriction_ratio = 1.0 → no penalty (grain cap IS the limit, not an external restriction)
    
    BUT if there's ALSO a draft restriction reducing it further:
    draft_restricted = 5,000
    restricted = MIN(8000, 6200, 5000) = 5,000
    unrestricted = MIN(8000, 6200) = 6,200
    restriction_ratio = 5000/6200 = 0.806 → penalty applies

================================================================================
STEP 5 — CUBATURE MODIFIER (for voluminous cargoes)
================================================================================

  PURPOSE: Additional penalty when vessel's hold volume limits intake
  significantly below weight capacity. Only relevant for light/bulky cargoes.
  
  APPLIES WHEN: SF > 47 (cargo is voluminous — grains, feeds, some minerals)
  
  FORMULA:
    cubature_ratio = volume_intake / weight_intake
    
    If cubature_ratio >= 0.85: no penalty (vessel has enough volume)
    
    If cubature_ratio < 0.85:
      cubature_penalty = (0.85 - cubature_ratio) × 1.5
      P5_score = P5_score × (1 - cubature_penalty)
      
  EXAMPLE:
    Vessel: DWT 8,000 → weight_intake = 7,750
    Grain capacity = 280,000 cbft, Cargo SF = 50
    volume_intake = 280000 / 50 = 5,600t
    
    cubature_ratio = 5600 / 7750 = 0.723
    0.723 < 0.85 → penalty applies
    cubature_penalty = (0.85 - 0.723) × 1.5 = 0.191
    P5_score = P5_score × (1 - 0.191) = P5_score × 0.809

================================================================================
FINAL P5 SCORE
================================================================================

  P5 = MAX(P5_score after all modifiers, 2)
  
  Unless BLOCK condition was triggered → then P5 = BLOCK
  
  BLOCK CONDITIONS:
    - final_intake < min_qty × 0.85 (vessel physically too small)
    - Missing DWT data

================================================================================
COMPLETE EXAMPLE — ADAMAR + WHEAT
================================================================================

  Cargo: wheat 15,000t ±10% ex Chornomorsk, SF = 47, port draft 7.5m
  Vessel: ADAMAR, DWT 16,653, draft 8.6m, grain capacity 694,700 cbft
  
  Step 1: min_qty = 13,500, max_qty = 16,500
  
  Step 2:
    weight_intake = 16653 - 250 = 16,403
    volume_intake = 694700 / 47 = 14,781
    draft_restricted = 16403 × (7.5/8.6) = 14,305 (approximate)
    final_intake = MIN(16403, 14781, 14305) = 14,305
    
  Step 3: Cargo Fit
    13,500 ≤ 14,305 ≤ 16,500 → PERFECT FIT
    P5_base = 15/15
    
  Step 4: Vessel Utilization
    unrestricted = MIN(16403, 14781) = 14,781
    restricted = 14,305
    ratio = 14305/14781 = 0.968 → no penalty (≥ 0.85)
    
  Step 5: Cubature (SF = 47, not > 47)
    Skipped — SF not above threshold
    
  Final P5 = 15/15
  offer_hint: "Cargo fits vessel well within draft restriction."

================================================================================
COMPLETE EXAMPLE — SMALL VESSEL + DRAFT RESTRICTION
================================================================================

  Cargo: wheat 8,000t ±5%, SF = 47, port draft 6.0m
  Vessel: DWT 6,800, draft 7.2m, grain capacity 220,000 cbft
  
  Step 1: min_qty = 7,600, max_qty = 8,400
  
  Step 2:
    weight_intake = 6800 - 250 = 6,550
    volume_intake = 220000 / 47 = 4,681
    draft_restricted = 6550 × (6.0/7.2) = 5,458
    final_intake = MIN(6550, 4681, 5458) = 4,681
    
  Step 3: Cargo Fit
    4,681 < min_qty × 0.85 = 6,460 → BLOCK
    Vessel physically cannot load minimum required cargo.
    
  Final P5 = BLOCK
  offer_hint: "Vessel cannot load minimum cargo quantity — grain capacity and 
               draft restriction limit intake to ~4,700t vs 7,600t minimum."

================================================================================
EDGE CASES
================================================================================

  Missing grain capacity:
    - Skip volume_intake calculation
    - Use weight_intake and draft_restricted only
    - Note: "Grain capacity unknown — intake based on DWT/draft only"
    - Reduce confidence

  Missing SF:
    - Skip cubature modifier
    - Note: "Cargo SF unknown — cubature check skipped"
    
  Vessel way too big (intake > max_qty × 3):
    - Apply over-cargo penalty as normal
    - P5_base will be very low (2-4 range)
    - offer_hint: "Vessel far too large for this parcel — only offer if 
                   vessel is desperate for cargo."
                   
  Vessel way too small (intake < min_qty × 0.5):
    - BLOCK
    - offer_hint: "Vessel far too small — do not offer."

================================================================================
AI INSTRUCTIONS
================================================================================

  ai_must:
    - Follow all 5 steps in order
    - Show calculation in reasoning
    - Identify the limiting factor (weight/volume/draft)
    - Apply vessel utilization penalty when restrictions reduce capacity
    - Apply cubature modifier only when SF > 47
    - Generate appropriate offer_hint
    
  ai_must_not:
    - Never skip Step 1 (cargo quantity parsing)
    - Never forget ROB deduction (250t)
    - Never ignore draft restrictions when provided
    - Never apply cubature penalty when SF ≤ 47
    - Never give score below 2 (except BLOCK)
    - Never assume volume_intake when grain capacity is missing

================================================================================


--- START OF estimator-prompts/port_restrictions_map.txt ---
port_restrictions_map

Short Summary — Port Restrictions Map

This file contains the physical and operational limitations of ports, terminals, and regions.
It defines what a vessel can or cannot do in a specific port based on:

Draft restrictions

LOA / Beam limits

Water type (fresh / brackish / sea)

Seasonal restrictions (ice, low water, draft reduction)

Gear requirements (required / preferred / optional)

Maximum vessel size (typical DWT ranges)

Terminal-level depth and operational constraints

It also includes regional-level patterns, explaining where gear is typically required (Africa, Red Sea, Asia) or rarely needed (Black Sea, America).

This file is the authoritative source for all port-related compatibility checks in the VK Charts AI scoring system.

▶️ How to Use — Short Instructions
1. Use this file to check whether the vessel can physically load/discharge

AI must compare:

vessel draft

LOA

beam

presence/absence of vessel gear

with the port’s restrictions.

If any restriction is violated →
AI must assign a low score or mark the vessel incompatible for this cargo.

2. Apply regional patterns when port-level data is missing

If a specific port is not in the file:

Use region_patterns (e.g., “Africa → gear required”)

This acts as a fallback rule to avoid incorrect assumptions

3. Use seasonal rules for ports like Izmail/Reni

AI must adjust scoring if:

winter ice requires ice-class

low water reduces draft

Danube limitations restrict DWT

These conditions directly influence vessel–cargo compatibility.

4. Use gear_requirement rules for cargo types

Example:
Sugar in bags → vessel gear required (both ends).
If the vessel has no gear → −20 penalty.

This connects port restrictions with cargo-specific requirements.

5. Determine maximum vessel size compatibility

File provides typical DWT limits:

Odessa/Constanta → up to Panamax

Izmail/Reni → ~3–8K DWT

Egypt Med ports → 5–20K DWT

AI must ensure vessel DWT is within the acceptable range.

6. Use “aliases” for correct port matching

Odessa, Chornomorsk, Ilyichevsk → same port group.
Constanta → may require gear only during roadstead ops.

This prevents false negatives in matching.

# ═══════════════════════════════════════════════════════════════════
# METADATA & DEFINITIONS
# ═══════════════════════════════════════════════════════════════════

definitions:
  draft: "Maximum vessel draft in meters (summer draft)"
  loa: "Maximum Length Overall in meters"
  beam: "Maximum vessel beam/width in meters"
  wlthc: "Winter Load Line Tropical Cargo (needs clarification)"
  water_type:
    - fresh: "Freshwater (rivers, lakes)"
    - brackish: "Mixed fresh/salt water (estuaries, deltas)"
    - sea: "Seawater (open sea ports)"
  
  restriction_stability:
    constant: "Restrictions don't change (infrastructure limitation)"
    seasonal: "Restrictions vary by season (water level, ice, etc)"
    
  gear_requirement:
    required: "Vessel gear absolutely necessary"
    preferred: "Vessel gear gives advantage but not mandatory"
    optional: "Shore gear available, vessel gear not needed"
    
  sources:
    airtable: "Port name from Airtable database"
    user_knowledge: "Expert knowledge (Vitaly)"
    port_authority: "Official port documentation"
    practical_experience: "Real fixture experience"

# ═══════════════════════════════════════════════════════════════════
# REGION-LEVEL PATTERNS
# ═══════════════════════════════════════════════════════════════════

region_patterns:
  
  black_sea:
    general_gear_requirement: "optional"
    notes: "Almost never need vessel gear in Black Sea ports"
    water_type: "sea"
    major_ports_capacity: "Up to Panamax size"
    
  mediterranean:
    coaster_gear_requirement: "optional"
    handysize_plus_gear_requirement: "preferred"
    notes: "Coasters rarely need gear, larger vessels sometimes do"
    
  asia:
    general_gear_requirement: "required"
    notes: "Vessel gear often needed for loading operations"
    
  red_sea:
    general_gear_requirement: "required"
    notes: "Vessel gear frequently needed"
    
  africa:
    general_gear_requirement: "required"
    notes: "Vessel gear often needed"
    
  america:
    general_gear_requirement: "optional"
    notes: "Almost never need vessel gear"

# ═══════════════════════════════════════════════════════════════════
# COUNTRY-LEVEL RESTRICTIONS
# ═══════════════════════════════════════════════════════════════════

countries:
  
  ukraine:
    airtable_id: "TBD"
    general_notes: "Major grain exporter, modern facilities in main ports"
    
    ports:
      
      odessa_chornomorsk:
        airtable_id: "TBD"
        official_name: "Odessa/Chornomorsk Port Complex"
        aliases: ["Odessa", "Chornomorsk", "Ilyichevsk"]
        
        restrictions:
          draft: null  # No specific limit, accepts up to Panamax
          loa: null    # Can handle large vessels
          beam: null
          wlthc: null
          restriction_type: "constant"
          
        water_type: "sea"
        
        vessel_gear:
          requirement: "optional"
          reason: "Modern grain terminals with shore equipment"
          
        max_vessel_size:
          description: "Up to Panamax"
          typical_dwt_range: [3000, 75000]
          
        terminals:
          - name: "TIS Grain Terminal"
            draft: 14.0
            notes: "Deep water terminal"
            
          - name: "Kernel Terminal"
            draft: 12.5
            
          - name: "Nika-Tera"
            draft: 12.0
        
        notes: "Major grain export hub with modern facilities"
        
      izmail_reni:
        airtable_id: "TBD"
        official_name: "Izmail/Reni Danube Ports"
        aliases: ["Izmail", "Reni", "Ismail"]
        region: "Danube Delta"
        
        restrictions:
          draft: 7.0
          loa: null
          beam: null
          wlthc: null
          restriction_type: "seasonal"
          
        seasonal_variations:
          winter:
            months: [12, 1, 2]
            additional_restrictions:
              ice: true
              ice_class_required: true
              notes: "Icebreaker assistance may be needed"
              
          low_water:
            months: [8, 9]
            draft_reduction: 0.3
            notes: "Draft may be reduced in dry season"
        
        water_type: "fresh"
        
        vessel_gear:
          requirement: "required"
          reason: "Danube ports limited shore facilities"
          
        max_vessel_size:
          description: "Small handysize max"
          typical_dwt_range: [3000, 8000]
          
        notes: "Danube river ports with draft and seasonal limitations"
  
  romania:
    airtable_id: "TBD"
    
    ports:
      
      constanta:
        airtable_id: "TBD"
        official_name: "Constanta Port"
        
        restrictions:
          draft: null  # No specific limit, major port
          loa: null
          beam: null
          wlthc: null
          restriction_type: "constant"
          
        water_type: "sea"
        
        vessel_gear:
          requirement: "optional"
          reason: "Modern port with shore equipment"
          exceptions:
            - condition: "Roadstead transhipment operations"
              requirement: "required"
              reason: "Loading from small vessel to larger vessel"
          
        max_vessel_size:
          description: "Up to Panamax"
          typical_dwt_range: [3000, 75000]
          
        operations:
          roadstead_transhipment:
            available: true
            vessel_gear_required: true
            typical_scenario: "Small vessel → Large vessel transfer"
            
        notes: "Major Black Sea port, can handle large vessels"
  
  russia:
    airtable_id: "TBD"
    
    ports:
      
      novorossiysk:
        airtable_id: "TBD"
        official_name: "Novorossiysk"
        
        restrictions:
          draft: null  # Major port, deep water
          loa: null
          beam: null
          wlthc: null
          restriction_type: "constant"
          
        water_type: "sea"
        
        vessel_gear:
          requirement: "optional"
          
        max_vessel_size:
          description: "Up to Panamax and larger"
          typical_dwt_range: [5000, 100000]
          
        notes: "Largest Russian Black Sea port"
  
  egypt:
    airtable_id: "TBD"
    
    ports:
      
      alexandria:
        airtable_id: "TBD"
        restrictions:
          draft: 8.5
          loa: null
          beam: null
          wlthc: null
          restriction_type: "constant"
        water_type: "sea"
        vessel_gear:
          requirement: "optional"
        max_vessel_size:
          typical_dwt_range: [5000, 15000]
          
      damietta:
        airtable_id: "TBD"
        restrictions:
          draft: 9.0
          loa: null
          beam: null
          wlthc: null
          restriction_type: "constant"
        water_type: "sea"
        vessel_gear:
          requirement: "optional"
        max_vessel_size:
          typical_dwt_range: [5000, 20000]
          
      port_said:
        airtable_id: "TBD"
        restrictions:
          draft: 10.0
          loa: null
          beam: null
          wlthc: null
          restriction_type: "constant"
        water_type: "sea"
        vessel_gear:
          requirement: "optional"
        max_vessel_size:
          typical_dwt_range: [8000, 30000]

# ═══════════════════════════════════════════════════════════════════
# SPECIAL CARGO GEAR REQUIREMENTS
# ═══════════════════════════════════════════════════════════════════

cargo_gear_requirements:
  
  sugar_in_bags:
    cargo_type: "Sugar (bagged/big bags)"
    
    gear_requirement:
      loading_ports: "required"
      discharge_ports: "required"
      reason: "Bagged cargo handling typically requires vessel gear"
      
    applies_to:
      - "Sugar in bags"
      - "Sugar in big bags"
      - "Similar bagged agricultural products"
      
    scoring_impact:
      vessel_has_gear: 0
      vessel_no_gear: -20

# ═══════════════════════════════════════════════════════════════════
# TEMPLATE FOR NEW PORTS
# ═══════════════════════════════════════════════════════════════════

port_template:
  port_name_here:
    airtable_id: "TBD"
    official_name: ""
    aliases: []
    country: ""
    region: ""
    
    restrictions:
      draft: null          # meters (null if no restriction)
      loa: null           # meters (null if no restriction)  
      beam: null          # meters (null if no restriction)
      wlthc: null         # (needs clarification)
      restriction_type: "constant"  # or "seasonal"
      
    seasonal_variations:  # only if restriction_type: "seasonal"
      season_name:
        months: []
        additional_restrictions: {}
        
    water_type: "sea"    # fresh/brackish/sea
    
    vessel_gear:
      requirement: "optional"  # required/preferred/optional
      reason: ""
      exceptions: []
      
    max_vessel_size:
      description: ""
      typical_dwt_range: [min, max]
      
    terminals: []        # if port has multiple terminals
    
    operations: {}       # special operations (transhipment, etc)
    
    notes: ""
    source: "user_knowledge"
    last_updated: "YYYY-MM-DD"


--- START OF estimator-prompts/proximity_scoring_matrix.txt ---
# ═══════════════════════════════════════════════════════════════════
# PROXIMITY SCORING MATRIX - UPDATED v2.0
# VK Charts AI Scoring System - Criterion P1
# ═══════════════════════════════════════════════════════════════════
#
# CHANGES IN v2.0:
# - Updated East Med scoring (Level 9): 8 → 15 internal for Coasters (~6 P1)
# - Updated Adriatic scoring (Level 10): 4 → 17 internal for Coasters (~7 P1)
# - Added vessel size multipliers for all categories
# - Aligned with broker corrections (Adriatic/East Med are viable for coasters)
#
# ═══════════════════════════════════════════════════════════════════

version: "2.0"
date: "2026-01-19"
priority: "CRITICAL - Distance directly impacts commercial viability"

# ═══════════════════════════════════════════════════════════════════
# SHORT SUMMARY
# ═══════════════════════════════════════════════════════════════════

purpose: |
  This file defines P1 (Proximity) scoring - how AI evaluates geographic
  distance compatibility between vessel's current position and cargo's
  loading port. P1 contributes 0-20 points to the total score (100 max).
  
  WHAT THIS FILE CONTAINS:
  
  1. INTERNAL SCORING LEVELS (0-50 internal points)
     - Level 1: Same port = 50 internal points
     - Level 7: Marmara Sea = 20 internal points
     - Level 10: Adriatic = 17 internal points (UPDATED!)
     - These are SCALED to final P1 range [0, 20]
  
  2. VESSEL SIZE MULTIPLIERS (NEW!)
     - Small Coaster (3-6k): ×0.8 (more sensitive to distance)
     - Coaster (6-8k): ×1.0 (baseline)
     - Small Handy (8-17k): ×1.15
     - Handy (17-24k): ×1.3
     - Large vessels (24k+): ×1.5
  
  3. DISTANCE PENALTIES
     - Fine-tuning based on actual nautical miles within same level
     - Penalty per 100nm varies by vessel size
  
  4. GEOPOLITICAL RESTRICTIONS
     - Ukraine-Russia war sanctions (IMPOSSIBLE scoring)
  
  5. AI USAGE INSTRUCTIONS
     - Step-by-step scoring process

# ═══════════════════════════════════════════════════════════════════
# AI USAGE PROCESS
# ═══════════════════════════════════════════════════════════════════
  
for_ai_langchain:
  role: "Proximity Scoring Implementation"
  process:
    step_1: "Read vessel location from input"
    step_2: "Read cargo loading port from input"
    step_3: "Determine vessel size category (DWT)"
    step_4: "Find matching proximity level in this file"
    step_5: "Get internal base score (0-50 range)"
    step_6: "Apply vessel size multiplier if applicable"
    step_7: "Apply distance penalty if applicable"
    step_8: "Apply geopolitical restrictions if applicable"
    step_9: "Scale final internal score to P1 range [0-20]"
    step_10: "Generate explanation and reasoning"
  
  scaling_formula:
    internal_to_final: "P1_final = (internal_score / 50) * 20"
    example_1: "Internal 50 → P1 = 20 (maximum)"
    example_2: "Internal 25 → P1 = 10 (mid-range)"
    example_3: "Internal 17 → P1 = 6.8 (Adriatic)"
    example_4: "Internal 15 → P1 = 6.0 (East Med)"
    example_5: "Internal 0 → P1 = 0 (minimum)"

# ═══════════════════════════════════════════════════════════════════
# SCORING PRINCIPLE
# ═══════════════════════════════════════════════════════════════════

scoring_principle: |
  Proximity = Lower ballast cost = Higher score
  
  Чем ближе судно к порту погрузки, тем выше score
  
  INTERNAL SCORING: 0-50 points (used for detailed level differentiation)
  FINAL P1 SCORE: 0-20 points (scaled from internal score)
  
  Scaling formula: P1_final = (internal_score / 50) * 20

# ═══════════════════════════════════════════════════════════════════
# BLACK SEA SUB-REGIONS
# ═══════════════════════════════════════════════════════════════════

black_sea_subregions:
  
  poc:
    name: "POC (Pivdenny-Odessa-Chornomorsk)"
    country: "Ukraine"
    ports:
      - "Odessa"
      - "Pivdenny (Yuzhny)"
      - "Chornomorsk (Ilyichevsk)"
    characteristics:
      - "Major grain export hub"
      - "Close proximity to each other"
      - "Shared anchorage areas"
  
  sulina_anchorage:
    name: "Sulina Anchorage"
    country: "Romania/International waters"
    characteristics:
      - "Strategic position"
      - "Can access BOTH Danube AND POC"
      - "Excellent positioning for either direction"
    
  danube_ports:
    name: "Danube River Ports"
    countries: ["Romania", "Moldova", "Ukraine"]
    ports:
      romania:
        - "Galati"
        - "Braila"
      moldova:
        - "Giurgiulesti"
      ukraine:
        - "Kiliya"
        - "Orlovka"
        - "Izmail"
        - "Reni"
    characteristics:
      - "River ports"
      - "Draft restrictions"
      - "Smaller vessel sizes"
  
  cvb:
    name: "CVB (Constanta-Varna-Burgas)"
    countries: ["Romania", "Bulgaria"]
    ports:
      romania:
        - "Constanta"
      bulgaria:
        - "Varna"
        - "Burgas"
    characteristics:
      - "Major Black Sea ports"
      - "Good facilities"
      - "Western Black Sea"
  
  turkish_black_sea:
    name: "Turkish Black Sea Ports"
    country: "Turkey"
    ports:
      - "Samsun"
      - "Trabzon"
      - "Zonguldak"
      - "Eregli"
  
  russian_black_sea:
    name: "Russian Black Sea Ports"
    country: "Russia"
    ports:
      - "Novorossiysk"
      - "Kavkaz (Caucasus)"
    
    geopolitical_restriction:
      status: "BLOCKED due to Ukraine-Russia war"
      ukraine_to_russia: "IMPOSSIBLE - sanctions"
      russia_to_ukraine: "IMPOSSIBLE - sanctions"
      effective_date: "2022-present"
  
  georgian_black_sea:
    name: "Georgian Black Sea Ports"
    country: "Georgia"
    ports:
      - "Poti"
      - "Batumi"

# ═══════════════════════════════════════════════════════════════════
# VESSEL SIZE MULTIPLIERS (NEW IN v2.0!)
# ═══════════════════════════════════════════════════════════════════

vessel_size_multipliers:
  
  principle: |
    Larger vessels can absorb longer ballast legs economically.
    Apply multipliers to distance-sensitive levels (8-12 for coasters).
  
  categories:
    
    small_coaster_3_6k:
      dwt_range: [3000, 6000]
      multiplier: 0.8
      effect: "MORE sensitive to distance - reduce by 20%"
      application: "Multiply internal score by 0.8 for levels 8+"
      
    coaster_6_8k:
      dwt_range: [6001, 8000]
      multiplier: 1.0
      effect: "BASELINE - no adjustment"
      
    small_handy_8_17k:
      dwt_range: [8001, 17000]
      multiplier: 1.15
      effect: "LESS sensitive - increase by 15%"
      
    handy_17_24k:
      dwt_range: [17001, 24000]
      multiplier: 1.3
      effect: "Much less sensitive - increase by 30%"
      
    large_handy_24k_plus:
      dwt_range: [24001, 999999]
      multiplier: 1.5
      effect: "Least sensitive - increase by 50%"
  
  application_rules:
    when_to_apply: "Levels 8 and beyond (longer distance levels)"
    when_NOT_to_apply: "Levels 1-7 (short distances, already optimal)"
    
  example:
    level: "Level 9 - East Med"
    base_internal_score: 15
    
    for_small_coaster_5k:
      calculation: "15 × 0.8 = 12"
      p1_score: "~4.8/20"
      
    for_coaster_7k:
      calculation: "15 × 1.0 = 15"
      p1_score: "~6.0/20"
      
    for_small_handy_12k:
      calculation: "15 × 1.15 = 17.25"
      p1_score: "~6.9/20"
      
    for_handy_20k:
      calculation: "15 × 1.3 = 19.5"
      p1_score: "~7.8/20"

# ═══════════════════════════════════════════════════════════════════
# PROXIMITY SCORING - BASELINE COASTERS (6000-8000 DWT)
# ═══════════════════════════════════════════════════════════════════

proximity_scoring_coasters_baseline:
  vessel_size_range: [6000, 8000]
  cargo_loading_example: "Black Sea (Odessa)"
  multiplier: 1.0
  
  levels:
    
    level_1_same_port:
      internal_score: 50
      p1_equivalent: 20.0
      description: "Vessel in same port as loading port"
      examples:
        - vessel_location: "Odessa"
          cargo_loading: "Odessa"
          result: "Perfect - zero ballast"
      
    level_2_same_port_cluster:
      internal_score: 48
      p1_equivalent: 19.2
      description: "Vessel in same port cluster/region"
      distance_nm: "< 50nm"
      examples:
        - vessel_location: "Pivdenny"
          cargo_loading: "Odessa"
          result: "POC cluster - minimal ballast"
        - vessel_location: "Chornomorsk"
          cargo_loading: "Odessa"
          result: "POC cluster - ~30nm"
      
    level_3_sulina_anchorage:
      internal_score: 48
      p1_equivalent: 19.2
      description: "Special case - Sulina Anchorage to POC"
      distance_nm: "~80nm"
      reasoning: "Strategic waiting area, can access both POC and Danube"
      examples:
        - vessel_location: "Sulina Anchorage"
          cargo_loading: "Chornomorsk"
          result: "Very close, excellent positioning"
      citations:
        - "Correction 3 (eleanora): Sulina is waiting area for POC or Danube"
    
    level_4_same_subregion:
      internal_score: 45
      p1_equivalent: 18.0
      description: "Different port within same Black Sea sub-region"
      distance_nm: "~150nm"
      examples:
        - vessel_location: "Constanta"
          cargo_loading: "Chornomorsk"
          result: "CVB → POC, short ballast"
      
    level_5_nearby_subregion:
      internal_score: 40
      p1_equivalent: 16.0
      description: "Nearby Black Sea sub-region"
      distance_nm: "~300nm"
      examples:
        - vessel_location: "Varna"
          cargo_loading: "Odessa"
          result: "CVB → POC cross-Black Sea"
     
    level_6_same_black_sea:
      internal_score: 35
      p1_equivalent: 14.0
      description: "Anywhere in Black Sea (excluding Russian ports)"
      distance_nm: "~400-600nm"
      examples:
        - vessel_location: "Turkish Black Sea (Samsun)"
          cargo_loading: "Odessa"
          result: "Same sea but longer ballast"
        - vessel_location: "Batumi (Georgia)"
          cargo_loading: "Odessa"
          result: "Cross Black Sea ballast"
      
      geopolitical_exceptions:
        ukraine_russia_block:
          condition: "Ukraine port ↔ Russian vessel OR Russia port ↔ Ukrainian vessel"
          score_override: 0
          p1_override: 0
          reason: "War, sanctions, impossible"
      
    level_7_marmara_sea:
      internal_score: 25
      p1_equivalent: 10.0
      description: "Vessel in Marmara Sea"
      distance_nm: "~400nm"
      examples:
        - vessel_location: "Istanbul (Marmara side)"
          cargo_loading: "Odessa"
          result: "Bosphorus crossing + Black Sea ballast"
        - vessel_location: "Derince"
          cargo_loading: "Constanta"
          result: "Acceptable ballast"
      
    level_8_aegean_east_greece:
      internal_score: 20
      p1_equivalent: 8.0
      description: "Aegean Sea and East coast Greece"
      distance_nm: "~600nm"
      vessel_size_multiplier_applies: true
      examples:
        - vessel_location: "Izmir"
          cargo_loading: "Odessa"
          result: "Aegean → Dardanelles → Marmara → Bosphorus → Black Sea"
        - vessel_location: "Nemrut Bay"
          cargo_loading: "Constanta"
          result: "Short to Dardanelles, then Black Sea"
        - vessel_location: "Thessaloniki"
          cargo_loading: "Varna"
          result: "Eastern Greece → Black Sea acceptable"
      
    level_9_east_med:
      internal_score: 15
      p1_equivalent: 6.0
      description: "East Mediterranean"
      distance_nm: "~1200nm"
      vessel_size_multiplier_applies: true
      examples:
        - vessel_location: "Mersin (Turkey)"
          cargo_loading: "Odessa"
          result: "East Med → Black Sea, viable backhaul"
        - vessel_location: "Limassol (Cyprus)"
          cargo_loading: "Constanta"
          result: "Med → Black Sea feasible"
        - vessel_location: "Alexandria (Egypt)"
          cargo_loading: "Chornomorsk"
          result: "Common backhaul route"
      citations:
        - "Correction 5 (ak brothers): Distance not as critical as initially scored"
        - "Correction: East Med vessels commonly return to Black Sea"
      notes: "UPDATED from 8 → 15 internal (was 3.2 P1, now 6.0 P1)"
      
    level_10_adriatic_ionian:
      internal_score: 17
      p1_equivalent: 6.8
      description: "Adriatic or Ionian Sea"
      distance_nm: "~1100nm"
      vessel_size_multiplier_applies: true
      examples:
        - vessel_location: "Rijeka (Croatia)"
          cargo_loading: "Odessa"
          result: "Adriatic → Med → Black Sea"
        - vessel_location: "Bar (Montenegro)"
          cargo_loading: "Constanta"
          result: "Viable due to lack of Adriatic backhaul"
        - vessel_location: "Durres (Albania)"
          cargo_loading: "Chornomorsk"
          result: "Ionian → Med → Black Sea"
      citations:
        - "Correction 6 (ismail bey): Score should be higher, distance acceptable"
        - "Correction: Adriatic vessels often ballast to Black Sea (no backhaul)"
      notes: "UPDATED from 4 → 17 internal (was 1.6 P1, now 6.8 P1)"
    
    level_11_west_med:
      internal_score: 7
      p1_equivalent: 2.8
      description: "West Mediterranean"
      distance_nm: "~2000nm"
      vessel_size_multiplier_applies: true
      examples:
        - vessel_location: "Barcelona (Spain)"
          cargo_loading: "Odessa"
          result: "Long ballast - marginal for coasters"
        - vessel_location: "Algiers (Algeria)"
          cargo_loading: "Constanta"
          result: "Possible but needs good freight"
      notes: "Approaching limit for coasters"
    
    level_12_atlantic_west_africa:
      internal_score: 0
      p1_equivalent: 0.0
      description: "Atlantic, West Africa - NOT VIABLE for coasters"
      distance_nm: "> 3000nm"
      examples:
        - vessel_location: "Dakar (Senegal)"
          cargo_loading: "Odessa"
          result: "Commercially non-viable for coaster (~4200nm)"
      citations:
        - "Correction 7 (ak beauty): West Africa ballast impossible for coaster"
      notes: "Coasters working in these areas, not positioning to Black Sea"

# ═══════════════════════════════════════════════════════════════════
# SMALL COASTERS (3000-6000 DWT) - Apply 0.8 multiplier
# ═══════════════════════════════════════════════════════════════════

proximity_scoring_small_coasters:
  vessel_size_range: [3000, 6000]
  multiplier: 0.8
  note: "Levels 1-7 same as baseline, levels 8+ reduced by 20%"
  
  adjusted_levels:
    level_8_aegean:
      base_internal: 20
      adjusted_internal: 16
      p1_equivalent: 6.4
      
    level_9_east_med:
      base_internal: 15
      adjusted_internal: 12
      p1_equivalent: 4.8
      
    level_10_adriatic:
      base_internal: 17
      adjusted_internal: 13.6
      p1_equivalent: 5.4
      
    level_11_west_med:
      base_internal: 7
      adjusted_internal: 5.6
      p1_equivalent: 2.2

# ═══════════════════════════════════════════════════════════════════
# SMALL HANDY (8000-17000 DWT) - Apply 1.15 multiplier
# ═══════════════════════════════════════════════════════════════════

proximity_scoring_small_handy:
  vessel_size_range: [8000, 17000]
  multiplier: 1.15
  note: "Levels 1-7 same as baseline, levels 8+ increased by 15%"
  
  adjusted_levels:
    level_8_aegean:
      base_internal: 20
      adjusted_internal: 23
      p1_equivalent: 9.2
      
    level_9_east_med:
      base_internal: 15
      adjusted_internal: 17.25
      p1_equivalent: 6.9
      
    level_10_adriatic:
      base_internal: 17
      adjusted_internal: 19.55
      p1_equivalent: 7.8
      
    level_11_west_med:
      base_internal: 7
      adjusted_internal: 8.05
      p1_equivalent: 3.2
      
    level_12_atlantic:
      base_internal: 3
      p1_equivalent: 1.2
      description: "Feasible for Small Handy"

# ═══════════════════════════════════════════════════════════════════
# HANDY (17000-24000 DWT) - Apply 1.3 multiplier
# ═══════════════════════════════════════════════════════════════════

proximity_scoring_handy:
  vessel_size_range: [17000, 24000]
  multiplier: 1.3
  note: "Levels 1-7 same as baseline, levels 8+ increased by 30%"
  
  adjusted_levels:
    level_8_aegean:
      base_internal: 20
      adjusted_internal: 26
      p1_equivalent: 10.4
      
    level_9_east_med:
      base_internal: 15
      adjusted_internal: 19.5
      p1_equivalent: 7.8
      
    level_10_adriatic:
      base_internal: 17
      adjusted_internal: 22.1
      p1_equivalent: 8.8
      
    level_11_west_med:
      base_internal: 7
      adjusted_internal: 9.1
      p1_equivalent: 3.6
      
    level_12_atlantic:
      base_internal: 5
      p1_equivalent: 2.0
      description: "Acceptable for Handy"

# ═══════════════════════════════════════════════════════════════════
# LARGE VESSELS (24000+ DWT) - Apply 1.5 multiplier
# ═══════════════════════════════════════════════════════════════════

proximity_scoring_large_vessels:
  vessel_size_range: [24000, 80000]
  multiplier: 1.5
  note: "Can absorb long ballast legs, global positioning capability"
  
  adjusted_levels:
    level_8_aegean:
      base_internal: 20
      adjusted_internal: 30
      p1_equivalent: 12.0
      
    level_9_east_med:
      base_internal: 15
      adjusted_internal: 22.5
      p1_equivalent: 9.0
      
    level_10_adriatic:
      base_internal: 17
      adjusted_internal: 25.5
      p1_equivalent: 10.2
      
    level_11_west_med:
      base_internal: 7
      adjusted_internal: 10.5
      p1_equivalent: 4.2
      
    level_12_atlantic:
      base_internal: 10
      p1_equivalent: 4.0
      description: "Good for large vessels"
      
    level_13_west_africa:
      base_internal: 5
      p1_equivalent: 2.0
      description: "Can ballast if rates justify"

# ═══════════════════════════════════════════════════════════════════
# DISTANCE FINE-TUNING (OPTIONAL)
# ═══════════════════════════════════════════════════════════════════

distance_adjustment:
  description: "Fine-tune score based on actual distance within same level"
  
  formula: "adjusted_score = base_level_score - (distance_penalty × nm / 100)"
  
  penalty_by_vessel_size:
    small_coaster_3_6k: 0.5
    coaster_6_8k: 0.4
    small_handy_8_17k: 0.3
    handy_17_24k: 0.2
    large_24k_plus: 0.1
  
  note: |
    This is OPTIONAL fine-tuning. Most of the time, level-based scoring
    is sufficient. Use distance adjustment only when precise maritime
    distance is known and level boundaries are ambiguous.

# ═══════════════════════════════════════════════════════════════════
# AI REASONING TEMPLATES
# ═══════════════════════════════════════════════════════════════════

reasoning_templates:
  
  template_excellent:
    score_range: "[18-20]"
    format: |
      "Vessel is [at/near] [location], approximately [distance]nm from [loading port].
      This is Level [N] proximity ([description]), representing [assessment]."
    example: |
      "Vessel is at Sulina Anchorage, approximately 80nm from Chornomorsk.
      This is Level 3 proximity (strategic waiting area), representing
      excellent positioning for POC loading."
      
  template_good:
    score_range: "[12-17]"
    format: |
      "Vessel is in [region], [distance]nm from [loading port]. This is
      Level [N] proximity, representing a [short/acceptable] ballast leg
      for a [vessel size] vessel."
    example: |
      "Vessel is in the Black Sea, approximately 400nm from Chornomorsk.
      This is Level 6 proximity, representing an acceptable cross-Black Sea
      ballast for a 7k coaster."
      
  template_medium:
    score_range: "[6-11]"
    format: |
      "Vessel is in [region], approximately [distance]nm from [loading port].
      This is Level [N] proximity. [Specific reasoning about viability]."
    example: |
      "Vessel is in the East Mediterranean, approximately 1200nm from Chornomorsk.
      This is Level 9 proximity. While the distance is significant, East Med
      to Black Sea is a common backhaul pattern for coasters."
      
  template_low:
    score_range: "[1-5]"
    format: |
      "Vessel is in [region], approximately [distance]nm from [loading port].
      This is Level [N] proximity, representing a [long/marginal] ballast leg
      that [reasoning about economic viability]."
    example: |
      "Vessel is in West Mediterranean, approximately 2000nm from Chornomorsk.
      This is Level 11 proximity, representing a long ballast leg that
      approaches the commercial limit for a coaster of this size."

# ═══════════════════════════════════════════════════════════════════
# CRITICAL AI INSTRUCTIONS
# ═══════════════════════════════════════════════════════════════════

ai_must:
  - "ALWAYS determine vessel size first (DWT) to select correct scoring table"
  - "ALWAYS apply vessel size multiplier for levels 8+ (long distance)"
  - "ALWAYS check for geopolitical restrictions (Russia-Ukraine)"
  - "ALWAYS scale internal score to P1 range [0-20] using formula"
  - "ALWAYS cite specific level name in reasoning"
  - "NEVER give negative P1 scores (minimum is 0)"

ai_must_not:
  - "Never assume close distance = automatically high score without checking level"
  - "Never ignore vessel size differences in long-distance positioning"
  - "Never score Russia ↔ Ukraine trades above 0"

# ═══════════════════════════════════════════════════════════════════
# END OF PROXIMITY SCORING MATRIX v2.0
# ═══════════════════════════════════════════════════════════════════


--- START OF estimator-prompts/vessel_location_determination.txt ---
================================================================================
VESSEL LOCATION DETERMINATION
Version: 3.0
Last updated: 2026-02-07
================================================================================

PURPOSE:
  Determine the vessel's current position, heading, and operational status
  to support P1 (proximity), P7 (readiness/ETA), and offer generation.
  Includes draught analysis for ballast/laden detection.

================================================================================
POSITION SOURCES (priority order)
================================================================================

  1. OpenArea data (vessel listing):
     - open_area: "Montoir, Feb 17"
     - Contains: location name, date, sometimes heading
     
  2. VesselFinder / MarineTraffic data:
     - current-position: lat/lon
     - destination: next port
     - eta: estimated arrival
     - navigation-status: "under way", "at anchor", "moored"
     - current-draught: current draught reading (meters)
     
  3. Vessel JSON fields:
     - vessel_area: general area description
     - last_ports: recent port calls with dates

================================================================================
DETERMINING VESSEL READY DATE
================================================================================

  OPTION A — Open area with date only (no destination):
    Example: "open Montoir Feb 17"
    vessel_ready = Feb 17 (use as-is)
    No ballast/operations buffer needed — vessel is stated as open.

  OPTION B — Destination with ETA:
    Example: "heading Ravenna ETA Feb 13"
    
    Step 1: Perform DRAUGHT ANALYSIS (see below)
    Step 2: Apply operations buffer based on draught status
    
    If BALLAST: vessel_ready = ETA (no +7 days)
      → Vessel is likely heading to load, may be available for redirection
      → Ask owner to confirm if heading for loading or positioning
      
    If LADEN: vessel_ready = ETA + 7 days
      → Vessel is carrying cargo, needs time to discharge + prepare
      → 7 days is default operations buffer (discharge + cleaning + docs)
      
  OPTION C — Current position only (no destination/ETA):
    Example: "last seen at anchor Iskenderun"
    vessel_ready = today + estimated sailing time to load port
    Use with low confidence, note in reasoning.

================================================================================
DRAUGHT ANALYSIS — BALLAST/LADEN DETECTION
================================================================================

  PURPOSE: Determine if the vessel is currently in ballast or laden (carrying
  cargo) based on current draught vs maximum summer draught.

  FORMULA:
    draught_ratio = current_draught / max_draft
    
    current_draught = from VesselFinder data (field: "current-draught")
    max_draft = from vessel specs (field: "draft" — summer draft/loaded)
    
  THRESHOLDS:
  
    draught_ratio < 0.65 → STATUS: BALLAST
    ────────────────────────────────────────
      Vessel is likely empty or nearly empty, heading to loading port.
      
      Impact:
        - operations_buffer = 0 days (vessel may be ready upon arrival)
        - vessel_ready = ETA (no +7 days added)
        - ask_owner = true (confirm if fixed for loading or open)
        
      Offer text suggestion:
        "We note vsl appears to be in ballast heading to [destination].
         Could you confirm if she is proceeding for loading (already fixed)
         or if this is ballast positioning?"

    draught_ratio >= 0.65 → STATUS: LADEN
    ────────────────────────────────────────
      Vessel is likely carrying cargo, heading to discharge port.
      
      Impact:
        - operations_buffer = +7 days (discharge + prepare for next)
        - vessel_ready = ETA + 7 days
        - Standard approach — offer for post-discharge window
        
    current_draught > max_draft → STATUS: OVER_DRAFT
    ────────────────────────────────────────
      Data anomaly — current draught exceeds vessel specs.
      Possible causes: outdated AIS data, measurement error, 
      vessel loaded to tropical marks.
      
      Impact:
        - Treat as LADEN (conservative approach)
        - operations_buffer = +7 days  
        - Note data anomaly in reasoning
        - confidence = "medium" (due to data quality)

  DATA FIELD MAPPING:
    - current_draught: VesselFinder field "current-draught" (meters)
    - max_draft: Vessel specs field "draft" (summer draft in meters)
    - navigation_status: VesselFinder field "navigation-status"
    
  MISSING DATA:
    If current_draught is not available:
      - Check navigation-status: "under way using engine" suggests active voyage
      - Default to LADEN assumption (conservative)
      - Note missing data in reasoning, reduce confidence
      
    If max_draft is not available:
      - Cannot calculate ratio
      - Use navigation-status and destination context
      - Default to LADEN assumption

================================================================================
IMPACT ON OTHER CRITERIA
================================================================================

  P7 (Readiness/ETA):
    - BALLAST: vessel_ready = ETA (faster availability)
    - LADEN: vessel_ready = ETA + 7 days (slower availability)
    - See: READINESSETA_TO_LOADING_PORT_SCORING.txt

  P1 (Proximity):
    - Use destination port (not current position) for distance calculation
      when vessel is underway

  Offer Opening:
    - BALLAST vessels: include question about availability/fixing status
    - LADEN vessels: standard approach with post-discharge timing

================================================================================
EXAMPLES
================================================================================

  Example 1: ADAMAR heading to Ravenna
    current_draught = 8.8m, max_draft = 8.6m
    draught_ratio = 8.8 / 8.6 = 1.023 → OVER_DRAFT
    Treat as LADEN, +7 days buffer
    Note: "Current draught 8.8m exceeds max draft 8.6m — data anomaly,
           treating as laden. Vessel ready = ETA + 7 days."

  Example 2: Small coaster heading to Mersin
    current_draught = 2.1m, max_draft = 5.2m  
    draught_ratio = 2.1 / 5.2 = 0.404 → BALLAST
    No buffer, vessel may be available at ETA
    Ask owner: "Is she proceeding for loading or open?"

  Example 3: Handysize heading to Constanta  
    current_draught = 7.5m, max_draft = 9.8m
    draught_ratio = 7.5 / 9.8 = 0.765 → LADEN
    Standard +7 days buffer
    vessel_ready = ETA + 7 days

================================================================================


--- START OF estimator-prompts/vessel_size_classification.txt ---
# ═══════════════════════════════════════════════════════════════════
# SHORT SUMMARY
# ═══════════════════════════════════════════════════════════════════

DOCUMENT: Vessel Size Classification - Size Category Definitions
PURPOSE: Single source of truth for vessel size categorization in VK Charts AI
SCOPE: Dry cargo bulk carriers and general cargo vessels (bulk operations)
INTEGRATION: Used across all scoring criteria (P1-P7) for size-dependent logic

WHAT THIS DOCUMENT DEFINES:
This file establishes the official VK Charts vessel size classification system
for all dry-cargo vessels (bulk + general cargo). It provides the authoritative
DWT ranges, category codes, and size-specific behavioral characteristics that
drive AI scoring decisions across all criteria.

SIZE CATEGORIES (7 total):
1. Small Coasters (SC): 0-4,000 DWT - River/coastal vessels
2. Coasters (C): 4,001-17,000 DWT - Regional bulk trades (most common Black Sea-Med)
3. Small Handy (SH): 17,001-24,000 DWT - Medium haul bulk carriers
4. Handy (H): 24,001-40,000 DWT - Long haul capable (NOT common in Greek trades)
5. Small Supramax (SS): 40,001-50,000 DWT - Deep sea bulk carriers
6. Supramax (SM): 50,001-65,000 DWT - Global bulk trades
7. Panamax (PM): 65,000-80,000 DWT - Maximum size for Panama Canal

KEY FEATURES:
- Precise DWT ranges for each category
- Size-specific economic behavior (ballast tolerance, operating cost)
- Typical trade patterns and routes for each size
- Impact on proximity scoring (smaller vessels = higher distance penalty)
- Cargo-vessel size compatibility rules
- Integration with all scoring criteria

CRITICAL DEPENDENCIES:
- proximity_scoring_matrix.txt: Uses size categories for distance penalties
- regional_trade_patterns_corrected.txt: References size categories in vessel_size_rules
- MASTER_SCORING_SYSTEM.txt: All criteria use vessel size for score adjustments

SIZE IMPACT ON SCORING:
- Small vessels (SC, C): Very sensitive to distance, seek backhaul aggressively
- Medium vessels (SH, H): Moderate distance tolerance, selective on backhaul
- Large vessels (SS, SM, PM): High distance tolerance, can ballast for positioning

SCOPE LIMITATIONS:
✓ INCLUDED: Dry cargo bulk carriers, general cargo (bulk ops)
✗ EXCLUDED: Oil tankers, chemical tankers, LNG/LPG, containers, RoRo, pure breakbulk

EXAMPLE USAGE:
- Vessel DWT 8,500 → Category C (Coaster) → High ballast sensitivity
- Vessel DWT 55,000 → Category SM (Supramax) → Low ballast sensitivity
- Cargo Black Sea-Med grain → Prefer C/SH sizes (4,001-24,000 DWT)

**Size category used across all scoring criteria:**
   - P1 (Proximity): Distance penalty scaling
   - P1A (Regional Patterns): Size-specific trade pattern rules
   - P2 (Regional Preferences): Size preferences for regions
   - P3 (Cargo Preferences): Cargo-vessel size compatibility
   - P4 (Last Ports): Size-specific return patterns
   - P6 (Intake Capacity): Size-based capacity calculations
   - P7 (OpenArea Comments): Size-specific readiness interpretation

### Important Notes:
- DWT is the ONLY input needed for size categorization
- Categories are mutually exclusive (no overlap in ranges)
- This file is the SINGLE SOURCE OF TRUTH - never hardcode ranges elsewhere
- If vessel type is not bulk carrier, skip size-based scoring
- Size category must be included in all scoring responses for transparency

---

## FOR AI/LangChain (Size Categorization Implementation)

### Step-by-Step Algorithm:

**STEP 1: Validate Input**
```
Required: vessel_dwt (integer or float, > 0)
Optional: vessel_type (for scope validation)

Validation:
- IF vessel_dwt <= 0: REJECT with error "Invalid DWT"
- IF vessel_type NOT in [bulk_carrier, general_cargo, multi_purpose]: 
    WARN "Vessel may be outside scope" but CONTINUE
```

**STEP 2: Determine Size Category**
```
Based on vessel_dwt, match to ONE category:

IF dwt >= 0 AND dwt <= 4000:
    category = "SC" (Small Coasters)
    
ELSE IF dwt >= 4001 AND dwt <= 17000:
    category = "C" (Coasters)
    
ELSE IF dwt >= 17001 AND dwt <= 24000:
    category = "SH" (Small Handy)
    
ELSE IF dwt >= 24001 AND dwt <= 40000:
    category = "H" (Handy)
    
ELSE IF dwt >= 40001 AND dwt <= 50000:
    category = "SS" (Small Supramax)
    
ELSE IF dwt >= 50001 AND dwt <= 65000:
    category = "SM" (Supramax)
    
ELSE IF dwt >= 65000 AND dwt <= 80000:
    category = "PM" (Panamax)
    
ELSE IF dwt > 80000:
    category = "OVERSIZED" (outside current scope)
    NOTE: "Vessel larger than Panamax, may need special handling"
```

**STEP 3: Retrieve Category Characteristics**
```
Look up category in vessel_sizes section:
- dwt_range
- typical_characteristics
- typical_uses
- examples
- notes (if any)
```

**STEP 4: Retrieve Economic Behavior**
```
Look up category in economics_by_size section:
- daily_operating_cost
- ballast_cost_sensitivity
- backhaul_seeking_behavior
- viable_ballast_distance
```

**STEP 5: Retrieve Trade Patterns**
```
Determine size group for trade patterns:
- small_coasters_and_coasters: SC, C
- small_handy_and_handy: SH, H
- supramax_and_panamax: SS, SM, PM

Retrieve:
- primary_regions
- typical_routes
- ballast_strategy
- notes (if any)
```

**STEP 6: Calculate Scoring Impact**
```
Based on category, determine impact on scoring:

Proximity Penalty (from ai_scoring_guidelines):
- SC: "Very high penalty per 100nm" → -30 to -50 for long ballast
- C: "High penalty per 100nm" → -20 to -40 for long ballast
- SH: "Medium penalty per 100nm" → -15 to -30 for long ballast
- H: "Medium-low penalty per 100nm" → -10 to -20 for long ballast
- SS/SM/PM: "Low penalty per 100nm" → -5 to -15 for long ballast
```

## QUICK REFERENCE

**Size Categories (7 total):**
- SC: 0-4,000 DWT (Small Coasters)
- C: 4,001-17,000 DWT (Coasters) ← Most common Black Sea-Med
- SH: 17,001-24,000 DWT (Small Handy)
- H: 24,001-40,000 DWT (Handy) ← NOT common in Greek trades
- SS: 40,001-50,000 DWT (Small Supramax)
- SM: 50,001-65,000 DWT (Supramax)
- PM: 65,000-80,000 DWT (Panamax)

**Ballast Tolerance:**
- SC/C: Very low/low - avoid long ballast
- SH/H: Medium - selective on ballast
- SS/SM/PM: High/very high - can ballast for positioning

**Typical Trades:**
- SC/C: Black Sea-Med, regional short haul
- SH/H: Medium to long haul, cross-Med
- SS/SM/PM: Global deep sea, trans-ocean

**Proximity Impact:**
- Smaller vessels = higher distance penalty
- Larger vessels = lower distance penalty

**Cargo Type Fit:**
- Black Sea-Med grain: C, SH preferred
- Black Sea-Far East grain: SM, PM preferred
- Steel/fertilizers: C, SH preferred

**Scope:**
- ✓ Dry cargo bulk, general cargo (bulk ops)
- ✗ Tankers, containers, RoRo, LNG/LPG

# ═══════════════════════════════════════════════════════════════════
# VESSEL SIZE CATEGORIES - DRY CARGO
# ═══════════════════════════════════════════════════════════════════

vessel_sizes:
  
  small_coasters:
    dwt_range: [0, 4000]
    dwt_min: 0
    dwt_max: 4000
    category_code: "SC"
    
    typical_characteristics:
      trade_area: "Very short haul, coastal, inland waterways"
      ballast_tolerance: "Very low - must find cargo"
      
    typical_uses:
      - "River navigation"
      - "Small coastal parcels"
      - "Short sea shipping"
      - "Inland waterways (Danube, Rhine, etc)"
      
    examples:
      - "Small river-sea vessels"
      - "Coastal feeders"
      
  coasters:
    dwt_range: [4001, 17000]
    dwt_min: 4001
    dwt_max: 17000
    category_code: "C"
    
    typical_characteristics:
      trade_area: "Short to medium haul"
      ballast_tolerance: "Low - prefer backhaul"
      typical_routes: "Black Sea-Med, Med-Med, regional trades"
      
    typical_uses:
      - "Regional grain trades"
      - "Steel products"
      - "Fertilizers"
      - "General bulk"
      - "Bagged cargoes"
      
    sub_categories:
      small_coasters:
        dwt_range: [4001, 8000]
        notes: "Lower end coasters"
        
      medium_coasters:
        dwt_range: [8001, 12000]
        notes: "Most common coaster size"
        
      large_coasters:
        dwt_range: [12001, 17000]
        notes: "Upper end coasters"
    
    examples:
      - "Typical Black Sea grain vessels"
      - "Med short haul bulk"
      
  small_handy:
    dwt_range: [17001, 24000]
    dwt_min: 17001
    dwt_max: 24000
    category_code: "SH"
    
    typical_characteristics:
      trade_area: "Medium to long haul"
      ballast_tolerance: "Medium"
      typical_routes: "Cross-Med, Black Sea-North Africa, regional"
      
    typical_uses:
      - "Larger grain parcels"
      - "Steel products"
      - "Fertilizers"
      - "Ore parcels"
      
    examples:
      - "Transitional size between coaster and handy"
      
  handy:
    dwt_range: [24001, 40000]
    dwt_min: 24001
    dwt_max: 40000
    category_code: "H"
    
    typical_characteristics:
      trade_area: "Long haul capable"
      ballast_tolerance: "Medium-high"
      typical_routes: "Trans-ocean, long distance trades"
      
    typical_uses:
      - "Large grain parcels"
      - "Coal"
      - "Iron ore"
      - "Long haul bulk"
      
    notes:
      - "NOT common in Greek trades (per Vitaly)"
      - "More common in Atlantic, long haul trades"
      
    examples:
      - "Handysize bulk carriers"
      
  small_supramax:
    dwt_range: [40001, 50000]
    dwt_min: 40001
    dwt_max: 50000
    category_code: "SS"
    
    typical_characteristics:
      trade_area: "Long haul, deep sea"
      ballast_tolerance: "High"
      typical_routes: "Trans-ocean, far distances"
      
    typical_uses:
      - "Large grain parcels to Far East"
      - "Coal"
      - "Iron ore"
      - "Major bulk commodities"
      
  supramax:
    dwt_range: [50001, 65000]
    dwt_min: 50001
    dwt_max: 65000
    category_code: "SM"
    
    typical_characteristics:
      trade_area: "Global deep sea"
      ballast_tolerance: "Very high - can absorb long ballast"
      typical_routes: "Major trade routes, long haul"
      
    typical_uses:
      - "Major bulk commodity trades"
      - "Grain to Far East"
      - "Coal, iron ore"
      - "Trans-ocean routes"
      
  panamax:
    dwt_range: [65000, 80000]
    dwt_min: 65000
    dwt_max: 80000
    category_code: "PM"
    
    typical_characteristics:
      trade_area: "Global major routes"
      ballast_tolerance: "Very high"
      typical_routes: "Major bulk trade lanes"
      
    typical_uses:
      - "Large grain shipments"
      - "Major coal/ore trades"
      - "Trans-ocean bulk"
      
    notes:
      - "Maximum size for Panama Canal (hence name)"
      - "Maximum practical size ex-Black Sea ports"
      
  other_sizes:
    notes: "Larger sizes (Capesize, etc) can be added later if needed"
    not_relevant_for_current_scope: true

# ═══════════════════════════════════════════════════════════════════
# VESSEL SIZE ECONOMICS
# ═══════════════════════════════════════════════════════════════════

economics_by_size:
  
  small_coasters:
    daily_operating_cost: "lowest"
    ballast_cost_sensitivity: "very high"
    backhaul_seeking_behavior: "aggressive - must find cargo"
    viable_ballast_distance: "< 300 nm"
    
  coasters:
    daily_operating_cost: "low"
    ballast_cost_sensitivity: "high"
    backhaul_seeking_behavior: "strong preference for backhaul"
    viable_ballast_distance: "< 800 nm"
    
  small_handy:
    daily_operating_cost: "medium-low"
    ballast_cost_sensitivity: "medium-high"
    backhaul_seeking_behavior: "moderate"
    viable_ballast_distance: "< 1200 nm"
    
  handy:
    daily_operating_cost: "medium"
    ballast_cost_sensitivity: "medium"
    backhaul_seeking_behavior: "selective"
    viable_ballast_distance: "< 2000 nm"
    
  small_supramax:
    daily_operating_cost: "medium-high"
    ballast_cost_sensitivity: "low-medium"
    backhaul_seeking_behavior: "selective"
    viable_ballast_distance: "< 3000 nm"
    
  supramax:
    daily_operating_cost: "high"
    ballast_cost_sensitivity: "low"
    backhaul_seeking_behavior: "opportunistic - can ballast if rates justify"
    viable_ballast_distance: "< 5000 nm"
    
  panamax:
    daily_operating_cost: "very high"
    ballast_cost_sensitivity: "very low"
    backhaul_seeking_behavior: "strategic - ballast acceptable for positioning"
    viable_ballast_distance: "> 5000 nm possible"

# ═══════════════════════════════════════════════════════════════════
# SIZE-SPECIFIC TRADE PATTERNS
# ═══════════════════════════════════════════════════════════════════

trade_patterns_by_size:
  
  small_coasters_and_coasters:
    primary_regions:
      - "Black Sea"
      - "Mediterranean"
      - "Marmara Sea"
      - "Adriatic"
      - "Short sea shipping"
      
    typical_routes:
      - "Black Sea → Mediterranean"
      - "Black Sea → North Africa"
      - "Mediterranean internal"
      - "Marmara → Black Sea"
      
    ballast_strategy:
      - "Avoid long ballast at all costs"
      - "Seek backhaul aggressively"
      - "Prefer short positioning legs"
      
  small_handy_and_handy:
    primary_regions:
      - "Regional to medium distance"
      - "Can do longer hauls but prefer medium"
      
    typical_routes:
      - "Black Sea → North Africa"
      - "Mediterranean → Atlantic"
      - "Regional bulk trades"
      
    ballast_strategy:
      - "Can consider medium ballast legs"
      - "Still prefer backhaul when economical"
      
    notes:
      - "Handy size NOT common in Greek trades"
      
  supramax_and_panamax:
    primary_regions:
      - "Global trades"
      - "Long haul routes"
      
    typical_routes:
      - "Black Sea → Far East"
      - "Atlantic → Pacific"
      - "Major bulk trade lanes"
      
    ballast_strategy:
      - "Can ballast long distances if rates justify"
      - "Less pressure to find backhaul"
      - "Strategic positioning for high-paying cargoes"

# ═══════════════════════════════════════════════════════════════════
# IMPORTANT NOTES FOR AI SCORING
# ═══════════════════════════════════════════════════════════════════

ai_scoring_guidelines:
  
  critical_rules:
    - "ALWAYS use correct DWT ranges from this file"
    - "Smaller vessels = higher penalty for long ballast"
    - "Larger vessels = more tolerant of ballast positioning"
    - "Coasters in Asia = likely working local market, not positioning"
    - "Supramax+ in Asia = could be positioning from Black Sea"
    
  size_impact_on_scoring:
    - "Small coaster long ballast: -30 to -50 score"
    - "Coaster long ballast: -20 to -40 score"
    - "Small handy long ballast: -15 to -30 score"
    - "Handy long ballast: -10 to -20 score"
    - "Supramax+ long ballast: -5 to -15 score"
    
  proximity_multiplier:
    concept: "Closer = Better, scaled by vessel size"
    formula: "Base score × (1 - distance_penalty)"
    distance_penalty_by_size:
      small_coasters: "Very high penalty per 100nm"
      coasters: "High penalty per 100nm"
      small_handy: "Medium penalty per 100nm"
      handy: "Medium-low penalty per 100nm"
      supramax_panamax: "Low penalty per 100nm"

# ═══════════════════════════════════════════════════════════════════
# CARGO TYPE vs VESSEL SIZE PREFERENCES
# ═══════════════════════════════════════════════════════════════════

cargo_vessel_size_fit:
  
  grain_black_sea_to_med:
    preferred_sizes:
      - "Coasters: 4001-17000 DWT"
      - "Small handy: 17001-24000 DWT"
    rare_sizes:
      - "Handy: 24001-40000 DWT (not common for Med)"
      
  grain_black_sea_to_far_east:
    preferred_sizes:
      - "Supramax: 50001-65000 DWT"
      - "Panamax: 65000-80000 DWT"
    minimum_practical:
      - "Small supramax: 40001-50000 DWT"
      
  steel_products:
    preferred_sizes:
      - "Coasters: 4001-17000 DWT"
      - "Small handy: 17001-24000 DWT"
      
  fertilizers:
    preferred_sizes:
      - "Coasters: 4001-17000 DWT"
      - "Small handy: 17001-24000 DWT"
      
  bauxite_ore:
    preferred_sizes:
      - "Coasters: 8001-17000 DWT"
      - "Small handy: 17001-24000 DWT"

# ═══════════════════════════════════════════════════════════════════
# SCOPE DEFINITION
# ═══════════════════════════════════════════════════════════════════

scope:
  included:
    - "Dry cargo bulk carriers"
    - "General cargo vessels (if carrying bulk)"
    - "Multi-purpose vessels (for bulk operations)"
    
  excluded:
    - "Oil tankers"
    - "Chemical tankers"
    - "LNG/LPG carriers"
    - "Container ships"
    - "RoRo vessels"
    - "Pure breakbulk (non-bulk cargo)"
    
  notes:
    - "This system focuses exclusively on DRY BULK shipping"
    - "Oil and liquid cargo not considered"


